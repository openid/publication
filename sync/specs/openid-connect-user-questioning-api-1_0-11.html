<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>OpenID Connect User Questioning API 1.0 </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Notation and Conventions">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Overview">
<link href="#rfc.section.1.4" rel="Chapter" title="1.4 User Questioning flows">
<link href="#rfc.section.1.4.1" rel="Chapter" title="1.4.1 Pulled-By-Client Flow">
<link href="#rfc.section.1.4.2" rel="Chapter" title="1.4.2 Pushed-To-Client Flow">
<link href="#rfc.section.1.5" rel="Chapter" title="1.5 Example of use cases involving the User Questioning API">
<link href="#rfc.section.1.6" rel="Chapter" title="1.6 When to use the User Questioning API">
<link href="#rfc.section.2" rel="Chapter" title="2 User Statement Token">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 User Statement Token Validation">
<link href="#rfc.section.3" rel="Chapter" title="3 OP Discovery and Client registration">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 OP Discovery">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Client registration">
<link href="#rfc.section.4" rel="Chapter" title="4 Endpoints">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 User Questioning Request Endpoint">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 User Questioning Request">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Processing the User Questioning Request">
<link href="#rfc.section.4.1.2.1" rel="Chapter" title="4.1.2.1 Processing the Authorization">
<link href="#rfc.section.4.1.2.2" rel="Chapter" title="4.1.2.2 Processing user_id">
<link href="#rfc.section.4.1.2.3" rel="Chapter" title="4.1.2.3 Processing wished_amr">
<link href="#rfc.section.4.1.2.4" rel="Chapter" title="4.1.2.4 Allowing the user to explicitly refuse to answer">
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 Successful Response">
<link href="#rfc.section.4.1.4" rel="Chapter" title="4.1.4 Error Response">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 User Questioning Polling Endpoint">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Polling Request">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 Processing the Polling Request">
<link href="#rfc.section.4.2.2.1" rel="Chapter" title="4.2.2.1 Processing the Authorization">
<link href="#rfc.section.4.2.3" rel="Chapter" title="4.2.3 Pending Response">
<link href="#rfc.section.4.2.4" rel="Chapter" title="4.2.4 Successful Response">
<link href="#rfc.section.4.2.5" rel="Chapter" title="4.2.5 Error Response">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Client Notification Endpoint">
<link href="#rfc.section.4.3.1" rel="Chapter" title="4.3.1 Successful Response">
<link href="#rfc.section.4.3.2" rel="Chapter" title="4.3.2 Error Response">
<link href="#rfc.section.4.3.3" rel="Chapter" title="4.3.3 Processing the Response">
<link href="#rfc.section.4.3.3.1" rel="Chapter" title="4.3.3.1 Processing the Authorization">
<link href="#rfc.section.4.3.3.2" rel="Chapter" title="4.3.3.2 Processing the User Statement Token">
<link href="#rfc.section.4.3.4" rel="Chapter" title="4.3.4 Acknowledgement">
<link href="#rfc.section.5" rel="Chapter" title="5 Error Object">
<link href="#rfc.section.6" rel="Chapter" title="6 Implementation Considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Implementation of Questioning Methods">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Non Repudiation">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Signatures and Encryption">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Signing and Encryption Order">
<link href="#rfc.section.8" rel="Chapter" title="8 Privacy Considerations">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Personal Information">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="10 Normative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements">
<link href="#rfc.appendix.B" rel="Chapter" title="B Notices">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 3.3.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Aillery, N., Marais, C., and J. Manger" />
  <meta name="dct.identifier" content="urn:ietf:id:openid-connect-user-questioning-api-1_0" />
  <meta name="dct.issued" scheme="ISO8601" content="2020-07-15" />
  <meta name="dct.abstract" content="This specification defines an API offered by an OpenID Provider (OP) that can be used by an application to send a question to a user of the OP.  The user does not need to be interacting with the application when the question is asked.  The user&#x27;s answer is returned asynchronously, digitally-signed by the OP. " />
  <meta name="description" content="This specification defines an API offered by an OpenID Provider (OP) that can be used by an application to send a question to a user of the OP.  The user does not need to be interacting with the application when the question is asked.  The user&#x27;s answer is returned asynchronously, digitally-signed by the OP. " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left"></td>
<td class="right">N. Aillery</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">C. Marais</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Orange</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J. Manger</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Telstra</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 15, 2020</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">OpenID Connect User Questioning API 1.0 <br />
  <span class="filename">openid-connect-user-questioning-api-1_0</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This specification defines an API offered by an OpenID Provider (OP) that can be used by an application to send a question to a user of the OP.  The user does not need to be interacting with the application when the question is asked.  The user's answer is returned asynchronously, digitally-signed by the OP.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Requirements Notation and Conventions</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Overview</a>
</li>
<li>1.4.   <a href="#rfc.section.1.4">User Questioning flows</a>
</li>
<ul><li>1.4.1.   <a href="#rfc.section.1.4.1">Pulled-By-Client Flow</a>
</li>
<li>1.4.2.   <a href="#rfc.section.1.4.2">Pushed-To-Client Flow</a>
</li>
</ul><li>1.5.   <a href="#rfc.section.1.5">Example of use cases involving the User Questioning API</a>
</li>
<li>1.6.   <a href="#rfc.section.1.6">When to use the User Questioning API</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">User Statement Token</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">User Statement Token Validation</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">OP Discovery and Client registration</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">OP Discovery</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Client registration</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Endpoints</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">User Questioning Request Endpoint</a>
</li>
<ul><li>4.1.1.   <a href="#rfc.section.4.1.1">User Questioning Request</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Processing the User Questioning Request</a>
</li>
<ul><li>4.1.2.1.   <a href="#rfc.section.4.1.2.1">Processing the Authorization</a>
</li>
<li>4.1.2.2.   <a href="#rfc.section.4.1.2.2">Processing user_id</a>
</li>
<li>4.1.2.3.   <a href="#rfc.section.4.1.2.3">Processing wished_amr</a>
</li>
<li>4.1.2.4.   <a href="#rfc.section.4.1.2.4">Allowing the user to explicitly refuse to answer</a>
</li>
</ul><li>4.1.3.   <a href="#rfc.section.4.1.3">Successful Response</a>
</li>
<li>4.1.4.   <a href="#rfc.section.4.1.4">Error Response</a>
</li>
</ul><li>4.2.   <a href="#rfc.section.4.2">User Questioning Polling Endpoint</a>
</li>
<ul><li>4.2.1.   <a href="#rfc.section.4.2.1">Polling Request</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">Processing the Polling Request</a>
</li>
<ul><li>4.2.2.1.   <a href="#rfc.section.4.2.2.1">Processing the Authorization</a>
</li>
</ul><li>4.2.3.   <a href="#rfc.section.4.2.3">Pending Response</a>
</li>
<li>4.2.4.   <a href="#rfc.section.4.2.4">Successful Response</a>
</li>
<li>4.2.5.   <a href="#rfc.section.4.2.5">Error Response</a>
</li>
</ul><li>4.3.   <a href="#rfc.section.4.3">Client Notification Endpoint</a>
</li>
<ul><li>4.3.1.   <a href="#rfc.section.4.3.1">Successful Response</a>
</li>
<li>4.3.2.   <a href="#rfc.section.4.3.2">Error Response</a>
</li>
<li>4.3.3.   <a href="#rfc.section.4.3.3">Processing the Response</a>
</li>
<ul><li>4.3.3.1.   <a href="#rfc.section.4.3.3.1">Processing the Authorization</a>
</li>
<li>4.3.3.2.   <a href="#rfc.section.4.3.3.2">Processing the User Statement Token</a>
</li>
</ul><li>4.3.4.   <a href="#rfc.section.4.3.4">Acknowledgement</a>
</li>
</ul></ul><li>5.   <a href="#rfc.section.5">Error Object</a>
</li>
<li>6.   <a href="#rfc.section.6">Implementation Considerations</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Implementation of Questioning Methods</a>
</li>
</ul><li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<ul><li>7.1.   <a href="#rfc.section.7.1">Non Repudiation</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Signatures and Encryption</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Signing and Encryption Order</a>
</li>
</ul><li>8.   <a href="#rfc.section.8">Privacy Considerations</a>
</li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Personal Information</a>
</li>
</ul><li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.references">Normative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">Notices</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This specification defines a specific API used by a Client (i.e. Service Provider) in order to question an End-User and get his Statement (i.e. his answer). The question is a short interrogative sentence (e.g. "Which product do you want to order ?") and the statement (e.g. "the blue one") is selected amongst proposed statements (e.g. "none", "the blue one", "the red one") that are also short texts.</p>
<p id="rfc.section.1.p.2">This API is specified as an OAuth 2.0-protected Resource Server accessible with an Access Token.</p>
<p id="rfc.section.1.p.3">The Client can use the API defined in this specification whether the End-User is currently using the Client or not.</p>
<p id="rfc.section.1.p.4">The User Questioning API is an asynchronous API. There are 2 main ways to get the End-User's Statement: the first one requires some polling of the API and the second requires the Client to expose a callback endpoint.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#rnc" id="rnc">Requirements Notation and Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.  </p>
<p id="rfc.section.1.1.p.2">Throughout this document, values are quoted to indicate that they are to be taken literally. When using these values in protocol messages, the quotes MUST NOT be used as part of the value.  </p>
<p id="rfc.section.1.1.p.3">All uses of <a href="#JWS" class="xref">JSON Web Signature (JWS)</a> and <a href="#JWE" class="xref">JSON Web Encryption (JWE)</a> data structures in this specification utilize the JWS Compact Serialization or the JWE Compact Serialization; the JWS JSON Serialization and the JWE JSON Serialization are not used.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.1.2.p.1">This specification uses the terms "Access Token", "Resource Server", and "Client" defined by <a href="#RFC6749" class="xref">OAuth 2.0</a>, the terms "JSON Web Token (JWT)",	"JWT Claims Set", and "Nested JWT" defined by <a href="#JWT" class="xref">JSON Web Token (JWT)</a>, and the terms "Header Parameter" and "JOSE Header" defined by <a href="#JWS" class="xref">JSON Web Signature (JWS)</a>.  This specification also defines the following terms: </p>

<dl>
<dt>Questioned User</dt>
<dd style="margin-left: 8">
<strong></strong> End-User receiving the question and requested to make a statement.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Overview</h1>
<p id="rfc.section.1.3.p.1">The User Questioning API enables a Client to address a question to an end-user and to get his response, called User Statement Token, digitally-signed by the OP.  The Client addresses the question thanks to a <samp>User Questioning Request</samp> sent on the <samp>User Questioning Request Endpoint</samp>.  The <samp>User Statement Token</samp> is contained in a <samp>User Questioning Response</samp>.  </p>
<p id="rfc.section.1.3.p.2">In order to retrieve the <samp>User Questioning Response</samp>, two flows are offered to the Client: a Pulled-By-Client flow and a Pushed-To-Client flow.  In the Pulled-By-Client flow, the Client regularly calls the <samp>User Questioning Polling Endpoint</samp>.  In the Pushed-To-Client flow, the Client is notified on the <samp>Client Notification Endpoint</samp>.  </p>
<p id="rfc.section.1.3.p.3">The User Questioning protocol, in abstract, follows the following steps.</p>
<p></p>

<ol>
<li>The Client sends a User Questioning Request to the OpenID Provider (OP).</li>
<li>The OP interacts with the Questioned User and obtains his Statement.</li>
<li>The OP responds to the Client with a User Questioning Response.</li>
</ol>

<p> </p>
<p>These steps are illustrated in the following diagram: </p>
<pre>
+--------+                                               +--------+
|        |                                               |        |
|        |----(1) User Questioning Request--------------&gt;|        |
|        |                                               |        |
|        |  +--------+                                   |        |
|        |  |        |                                   |        |
| Client |  |  End-  |&lt;--(2) User interactions to get---&gt;|   OP   |
|        |  |  User  |  the Questioned User's Statement  |        |
|        |  |        |                                   |        |
|        |  +--------+                                   |        |
|        |                                               |        |
|        |&lt;----(3) User Questioning Response-------------|        |
|        |                                               |        |
+--------+                                               +--------+
</pre>
<p id="rfc.section.1.3.p.5">About the "(2) User interactions to get the Questioned User's Statement" step, note that the way the OP obtains the Questioned User's Statement is out of the scope of this specification.  </p>
<h1 id="rfc.section.1.4">
<a href="#rfc.section.1.4">1.4.</a> User Questioning flows</h1>
<p id="rfc.section.1.4.p.1">This document specifies two User Questioning flows: </p>

<dl>
<dt>Pulled-By-Client flow:</dt>
<dd style="margin-left: 6">In this flow, after the User Questioning Request, the Client must call the OP in order to get the User Questioning Response. Refer to <a href="#Pulled-By-Client-Flow" class="xref">Section 1.4.1</a> for more details.  </dd>
<dt>Pushed-To-Client  flow:</dt>
<dd style="margin-left: 6">In this flow, after the User Questioning Request, the OP calls the Client to deliver the User Questioning Response. Refer to <a href="#Pushed-To-Client-Flow" class="xref">Section 1.4.2</a> for more details.  </dd>
</dl>

<p> </p>
<p id="rfc.section.1.4.p.2">At registration, a Client is configured with the flow it will use. Refer to <a href="#client_registration" class="xref">Section 3.2</a> for more details.  </p>
<h1 id="rfc.section.1.4.1">
<a href="#rfc.section.1.4.1">1.4.1.</a> <a href="#Pulled-By-Client-Flow" id="Pulled-By-Client-Flow">Pulled-By-Client Flow</a>
</h1>
<p id="rfc.section.1.4.1.p.1">In this flow, the Client will poll the OP to get the User Questioning Response.  </p>
<pre>
+--------+                                               +--------+
|        |---(1a) User Questioning Request--------------&gt;|        |
|        |                                               |        |
|        |&lt;--(1b) Question Created-----------------------|        |
|        |                                               |        |
|        |  +--------+                                   |        |
| Client |  |  End-  |&lt;--(2a) User interactions to get--&gt;|   OP   |
|        |  |  User  |  the Questioned User's Statement  |        |
|        |  +--------+                                   |        |
|        |                                               |        |
|        |--(3a) Get User Questioning Response----------&gt;|        |
|        |                                               |        |
|        |&lt;---(3b) User Questioning Response-------------|        |
+--------+                                               +--------+
</pre>
<h1 id="rfc.section.1.4.2">
<a href="#rfc.section.1.4.2">1.4.2.</a> <a href="#Pushed-To-Client-Flow" id="Pushed-To-Client-Flow">Pushed-To-Client Flow</a>
</h1>
<p id="rfc.section.1.4.2.p.1">In this flow, the OP will send the User Questioning Response to the client_notification_endpoint registered by the Client.  </p>
<pre>
+--------+                                               +--------+
|        |---(1a) User Questioning Request--------------&gt;|        |
|        |                                               |        |
|        |&lt;--(1b) Question Created-----------------------|        |
|        |                                               |        |
|        |  +--------+                                   |        |
| Client |  |  End-  |&lt;--(2a) User interactions to get--&gt;|   OP   |
|        |  |  User  |  the Questioned User's Statement  |        |
|        |  +--------+                                   |        |
|        |                                               |        |
|        |&lt;---(3a) User Questioning Response-------------|        |
|        |                                               |        |
|        |---(3b) Acknowledgement-----------------------&gt;|        |
+--------+                                               +--------+
</pre>
<h1 id="rfc.section.1.5">
<a href="#rfc.section.1.5">1.5.</a> Example of use cases involving the User Questioning API</h1>
<p id="rfc.section.1.5.p.1">The following use cases are non-normative examples to illustrate the usage of the User Questioning API by a Client.</p>
<p></p>

<ol>
<li>The Client can be a bank and the User Questioning API can be used to challenge the End-User when he wants to pay on Internet in order to secure the transaction. This is similar to 3D-Secure. The question could be: "Do you allow a payment of x euros to party y? (Yes) (No)".  </li>
<li>The Client can be a bank and the User Questioning API can be used to challenge the End-User when he wants to add a new payee for a bank transfer. The question could be: "Do you allow party y to be added to your payees? (I accept) (I refuse)".  </li>
<li>The Client can be a drive-in food market and the User Questioning API  can be used to ask the End-User if he accepts the exchange of one missing product by another. The question could be: "Do you agree to get product x instead of product y? (I agree) (I disagree)".  </li>
<li>The Client can be a ticketing platform and the User Questioning API can be used to prevent transactions by bots. The question could be: "Do you confirm that you are currently booking a ticket? (I confirm) (I deny)".  </li>
<li>The Client can be an airline company and the User Questioning API can be used to be sure that the End-User is notified of a delay. The question could be: "Your flight is postponed. Can you confirm that you are aware? (I read this)".  </li>
<li>The Client can be a survey company and the User Questioning API can be used to get the End-User's choice. The question could be: "Which is your favorite brand? (brand_A) (brand_B) (brand_C)".  </li>
</ol>

<p> </p>
<h1 id="rfc.section.1.6">
<a href="#rfc.section.1.6">1.6.</a> When to use the User Questioning API</h1>
<p id="rfc.section.1.6.p.1">The User Questioning API should be used when the following constraints must be fulfilled:</p>
<p></p>

<ol>
<li>The Client needs to have a real-time interaction with an End-User that may not be currently using the Client.  </li>
<li>The Client needs to have the End-User's statement on a given question.  </li>
<li>The Client needs to be sure that the responding End-User has been authenticated before responding.  </li>
<li>The Client needs to have a non-repudiable proof of the End-User's statement.  </li>
<li>The Client needs the End-User's statement to enforce a policy (i.e. take a decision).  </li>
</ol>

<p> </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#user-statement-token" id="user-statement-token">User Statement Token</a>
</h1>
<p id="rfc.section.2.p.1">The User Statement Token is a security token that contains Claims about the statement made by the Questioned User.  The User Statement Token is represented as a <a href="#JWT" class="xref">JSON Web Token (JWT)</a>.  </p>
<p id="rfc.section.2.p.2">The following Claims are used within the User Statement Token in all Questioning API flows.  </p>
<p></p>

<dl>
<dt>question_id</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>question_id</samp> is a unique identifier of the Question. This identifier is created by the OP.  The <samp>question_id</samp> value is a case sensitive string.  </dd>
<dt>iss</dt>
<dd style="margin-left: 8">MANDATORY.  Issuer Identifier for the Issuer of the response. The issuer is the OP.  <samp>iss</samp> is defined in chapter 2 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>.  The <samp>iss</samp> value is a case sensitive URL using the <samp>https</samp> scheme that contains scheme, host, and optionally, port number and path components and no query or fragment components.  </dd>
<dt>sub</dt>
<dd style="margin-left: 8">MANDATORY.  Subject Identifier.  A locally unique and never reassigned identifier within the Issuer for the End-User, which is intended to be consumed by the Client.  <samp>sub</samp> is defined in chapter 2 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>.  The <samp>sub</samp> value MUST NOT exceed 255 ASCII characters in length. The <samp>sub</samp> value is a case sensitive string.  <ul>
<li>If the Access Token is tied with an End-User, the <samp>sub</samp> is RECOMMENDED to be <samp>pairwise</samp> with a value based on the Sector Identifier of the Client. It is assumed that the Sector Identifier has been verified during the Access Token issuance process. The <samp>sub</samp> MAY also be <samp>public</samp>.  </li>
<li>If the Access Token is not tied with an End-User, the <samp>sub</samp> is RECOMMENDED to be <samp>public</samp> with a value based on the <samp>user_id</samp> and <samp>user_id_type</samp>.  A pairwise <samp>sub</samp> MAY be used in this case, but the OP MUST take special care to ensure the Client is entitled to use the associated Sector Identifier as the Client's <samp>redirect_uri</samp> that is usually used for this check is not involved in the flow.  Either <samp>public</samp> or <samp>pairwise</samp>, with such an Access Token, the <samp>sub</samp> is less valuable for the Client than the couple <samp>user_id</samp> and <samp>user_id_type</samp>.  </li>
</ul>
<p> </p>
</dd>
<dt>aud</dt>
<dd style="margin-left: 8">MANDATORY.  Audience(s) that this User Statement Token is intended for.  <samp>aud</samp> is defined in chapter 2 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>.  The <samp>aud</samp> value is an array of case sensitive strings.  </dd>
<dt>user_id</dt>
<dd style="margin-left: 8">OPTIONAL.  The <samp>user_id</samp> is a unique identifier provided in the User Questioning Request and allowing to identify the Questioned User (e.g. Mobile phone, sub, ...).  The <samp>user_id</samp> MUST be present in the User Statement Token if, and only if, the <samp>user_id</samp> and <samp>user_id_type</samp> were present in the User Questioning Request.  When present, this is the identifier actually used to reach the Questioned User.  The <samp>user_id</samp> value is a case sensitive string.  </dd>
<dt>user_id_type</dt>
<dd style="margin-left: 8">OPTIONAL.  The <samp>user_id_type</samp> MUST be present in the User Statement Token if, and only if, the <samp>user_id</samp> and <samp>user_id_type</samp> were present in the User Questioning Request.  The <samp>user_id_type</samp> indicates the type of the End-User's identifier used for User Questioning.  The <samp>user_id_type</samp> value is a case sensitive string.  </dd>
<dt>question_displayed</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>question_displayed</samp> is the question displayed to the Questioned User.  If the <samp>question_to_display</samp> (described in <a href="#user_questioning_request" class="xref">Section 4.1.1</a>) has not been displayed as is, the <samp>question_displayed</samp> MUST be the exact message displayed to Questioned User.  The <samp>question_displayed</samp> value is a case sensitive string.  </dd>
<dt>displayed_statements</dt>
<dd style="margin-left: 8">MANDATORY. List of possible statements displayed to the Questioned User.  The <samp>displayed_statements</samp> MUST be the list of the exact statements displayed to the Questioned User.  The <samp>displayed_statements</samp> value is a JSON array of case sensitive strings.  </dd>
<dt>statement</dt>
<dd style="margin-left: 8">MANDATORY. Statement made by the Questioned User.  The <samp>statement</samp> MUST be the exact statement made by the Questioned User.  The <samp>statement</samp> value is a case sensitive string.  </dd>
<dt>statement_date</dt>
<dd style="margin-left: 8">MANDATORY. Date indicating when the End-User gave his Statement on the Question.  The <samp>statement_date</samp> value is a JSON number representing the number of seconds from 1970-01-01T0:0:0Z as measured in UTC.  </dd>
<dt>used_amr</dt>
<dd style="margin-left: 8">MANDATORY. Authentication Method References.  These are the authentication methods used by the OP to authenticate the Questioned User before he made his statement.  Authentication Method References are defined in chapter 2 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>, where they are named <samp>amr</samp>.  The <samp>used_amr</samp> value is an array of case sensitive strings.  </dd>
<dt>used_acr</dt>
<dd style="margin-left: 8">MANDATORY. Authentication Context Class Reference.  Authentication Context Class Reference value that identifies the Authentication Context Class used by the OP to authenticate the Questioned User before he made his statement.  Authentication Context Class Reference is defined in chapter 2 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>, where it is named <samp>acr</samp>.  The <samp>used_acr</samp> value is a case sensitive string.  </dd>
</dl>

<p> </p>
<p id="rfc.section.2.p.4">User Statement Tokens MUST be signed by the OP using a digital signature as defined in <a href="#JWS" class="xref">JWS</a> providing authentication, integrity and non-repudiation.  Message Authentication Codes (MACs) MUST NOT be used as they do not provide non-repudiation.  User Statement Tokens CAN optionally be both signed and then encrypted using <a href="#JWS" class="xref">JWS</a> and <a href="#JWE" class="xref">JWE</a> respectively, thereby providing authentication, integrity, non-repudiation, and confidentiality, per <a href="#SigningOrder" class="xref">Section 7.3</a>.  If the User Statement Token is encrypted, it MUST be signed then encrypted, with the result being a Nested JWT, as defined in <a href="#JWT" class="xref">[JWT]</a>.  User Statement Tokens MUST NOT use <samp>none</samp>, <samp>HS256</samp>, <samp>HS384</samp> and <samp>HS512</samp> as the <samp>alg</samp> value.  </p>
<p id="rfc.section.2.p.5">User Statement Tokens SHOULD NOT use the JWS or JWE <samp>x5u</samp>, <samp>x5c</samp>, <samp>jku</samp>, or <samp>jwk</samp> Header Parameter fields.  Instead, references to keys used are communicated in advance using Discovery and Registration parameters, per <a href="#SigEnc" class="xref">Section 7.2</a>.  </p>
<p id="rfc.section.2.p.6">The signature MUST be verified by the Client.  </p>
<p>The following is a non-normative example of the set of Claims (the JWT Claims Set) in a User Statement Token: </p>
<pre>
{
    "question_id":"984dcc7d3d4d4b0f9f8022e344f9",
    "iss":"https://server.example.com",
    "aud":["s8V3wm8IXMW6TboazXZX"],
    "sub":"g117YBtCZO3mAKPQKP8o",
    "user_id":"+33612345678",
    "user_id_type":"msisdn",
    "question_displayed":"Which is ...?",
    "displayed_statements":["blue","red","yellow"],
    "statement":"red",
    "statement_date":1311282975,
    "used_acr":"2",
    "used_amr":["CLICK_OK"]
}
</pre>
<p>Signing the User Statement Token with the <samp>RS256</samp> algorithm results in this Object value (with line wraps within values for display purposes only): </p>
<pre>
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImsyYmRjIn0.eyJxdWVzdG
lvbl9pZCI6Ijk4NGRjYzdkM2Q0ZDRiMGY5ZjgwMjJlMzQ0ZjkiLCJpc3MiOiJodHRw
czovL3NlcnZlci5leGFtcGxlLmNvbSIsImF1ZCI6WyJzOFYzd204SVhNVzZUYm9hel
haWCJdLCJzdWIiOiJnMTE3WUJ0Q1pPM21BS1BRS1A4byIsInVzZXJfaWQiOiIrMzM2
MTIzNDU2NzgiLCJ1c2VyX2lkX3R5cGUiOiJtc2lzZG4iLCJxdWVzdGlvbl9kaXNwbG
F5ZWQiOiJXaGljaCBpcyAuLi4_IiwiZGlzcGxheWVkX3N0YXRlbWVudHMiOlsiYmx1
ZSIsInJlZCIsInllbGxvdyJdLCJzdGF0ZW1lbnQiOiJyZWQiLCJzdGF0ZW1lbnRfZG
F0ZSI6MTMxMTI4Mjk3NSwidXNlZF9hY3IiOiIyIiwidXNlZF9hbXIiOlsiQ0xJQ0tf
T0siXX0.bbDeU13rouABOOGrvIdQ4BN6GZtHvf1_oZEtGMrMoF9y2l66Dnyv_LL0ei
p2eCT56N7nH8iACNoJawCG_O2nYfUfJTU8t-tu-MNLe9p69PtUQkxShFzvWXPQfri_
OXQSs1zdtZ5NNVUX0ulPLm7QOniNFvY4sHwAkci4V1Czj72FGsxcUsUS6KUJRY7B2z
nP5ykl7m75iCp0Ydx72NshWCWzQxDfXPdQpuJoB96OXDuuukYIrOY1yZOqkUGE6AqP
cmMUJEWmT7OCHNi0Acsr0jU-fwxoAfYxQ641pW203PfVHXVRd06Ly0xHT3b50FM1jn
JM4tq98j78zu1cxVc2ww
</pre>
<p>The following RSA public key, represented in JWK format, can be used to validate the Object signature in this example (with line wraps within values for display purposes only): </p>
<pre>
{
"kty":"RSA",
"kid":"k2bdc",
"n":"y9Lqv4fCp6Ei-u2-ZCKq83YvbFEk6JMs_pSj76eMkddWRuWX2aBKGHAtKlE5P
7_vn__PCKZWePt3vGkB6ePgzAFu08NmKemwE5bQI0e6kIChtt_6KzT5OaaXDF
I6qCLJmk51Cc4VYFaxgqevMncYrzaW_50mZ1yGSFIQzLYP8bijAHGVjdEFgZa
ZEN9lsn_GdWLaJpHrB3ROlS50E45wxrlg9xMncVb8qDPuXZarvghLL0HzOuYR
adBJVoWZowDNTpKpk2RklZ7QaBO7XDv3uR7s_sf2g-bAjSYxYUGsqkNA9b3xV
W53am_UZZ3tZbFTIh557JICWKHlWj5uzeJXaw",
"e":"AQAB"
}
</pre>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#UserStatementTokenValidation" id="UserStatementTokenValidation">User Statement Token Validation</a>
</h1>
<p id="rfc.section.2.1.p.1">In order to validate the User Statement Token, the Client MUST verify the signature, using <a href="#SigEnc" class="xref">Section 7.2</a>.  </p>
<p id="rfc.section.2.1.p.2">Then, the Client MUST verify the <samp>used_amr</samp>, <samp>used_acr</samp> and <samp>statement_date</samp>.  The Client is responsible to use the <samp>statement_date</samp> to prevent replay.  The Client is responsible to check that the <samp>used_amr</samp> and <samp>used_acr</samp> fit with its security policy.  </p>
<p id="rfc.section.2.1.p.3">Then, the Client MUST verify the <samp>displayed_question</samp> value and the <samp>statement</samp> value, regarding the <samp>question_to_display</samp> value and the <samp>statements_to_display</samp> value sent in the User Questioning Request.  </p>
<p id="rfc.section.2.1.p.4">The Client is responsible of its decision to consider the Questioned User's <samp>statement</samp> regarding the <samp>displayed_question</samp>.  The Client is also responsible of any decision it would take based on this <samp>statement</samp>.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> OP Discovery and Client registration</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#discovery" id="discovery">OP Discovery</a>
</h1>
<p id="rfc.section.3.1.p.1">The OpenID Connect User Questioning API can be discovered within the OpenID Provider Metadata thanks to <a href="#OpenID.Discovery" class="xref">[OpenID.Discovery]</a>.  </p>

<dl>
<dt>scopes_supported</dt>
<dd style="margin-left: 8">The scope <samp>question</samp> MUST be present in the <samp>scopes_supported</samp> array.  </dd>
<dt>user_questioning_request_endpoint</dt>
<dd style="margin-left: 8">The URL of User Questioning Request Endpoint MUST be configured as the value of <samp>user_questioning_request_endpoint</samp>.  </dd>
<dt>user_questioning_polling_endpoint</dt>
<dd style="margin-left: 8">The URL of User Questioning Polling Endpoint MUST be configured as the value of <samp>user_questioning_polling_endpoint</samp>. The <samp>user_questioning_polling_endpoint</samp> MAY contain query parameters, but MUST NOT contain a fragment.  </dd>
<dt>amr_list</dt>
<dd style="margin-left: 8">The array of supported authentication methods (i.e. <samp>AMR</samp>) MUST be configured as the value of <samp>amr_list</samp>.  </dd>
<dt>acr_list</dt>
<dd style="margin-left: 8">The array of supported levels of assurance (i.e. <samp>ACR</samp>) MUST be configured as the value of <samp>acr_list</samp>.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#client_registration" id="client_registration">Client registration</a>
</h1>
<p id="rfc.section.3.2.p.1">In order to use the User Questioning API, the Client MUST have the right to access the User Questioning API.  The right for a Client to access the User Questioning API is the right to use the User Questioning API's scope. This scope value is <samp>question</samp>.  </p>
<p id="rfc.section.3.2.p.2">If the Client wants to be notified of the User Questioning Response (cf. <a href="#Pushed-To-Client-Flow" class="xref">Section 1.4.2</a>), it MUST register its <samp>client_notification_endpoint</samp>.  The <samp>client_notification_endpoint</samp> is a callback URL on the Client.  If the client does not use the client notification, it MUST obtain the result by using the user questioning polling endpoint.  Both mechanisms are mutual exclusive, i.e. a particular <samp>client_id</samp> can only be used with one of these mechanisms.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#endpoints" id="endpoints">Endpoints</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> User Questioning Request Endpoint</h1>
<p id="rfc.section.4.1.p.1">In order to send a question to a Questioned User, the Client MUST send a User Questioning Request to the User Questioning Request Endpoint.  </p>
<p id="rfc.section.4.1.p.2">Communication with the User Questioning Request Endpoint MUST utilize TLS.  See Section 16.17 in <a href="#OpenID.Core" class="xref">[OpenID.Core]</a> for more information on using TLS.  </p>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#user_questioning_request" id="user_questioning_request">User Questioning Request</a>
</h1>
<p id="rfc.section.4.1.1.p.1">The Client sends the User Questioning Request using an HTTP POST Request.  </p>
<p id="rfc.section.4.1.1.p.2">The Client MUST have a valid OAuth 2.0 Access Token for the scope <samp>question</samp>.  The Access Token MAY refer to the Questioned User, as explained in <a href="#processing_user_id" class="xref">Section 4.1.2.2</a>.  The way the Access Token has been obtained by the Client is out of scope of this specification.  </p>
<p id="rfc.section.4.1.1.p.3">The HTTP POST request MUST contain the following header: </p>

<dl>
<dt>Authorization</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>Authorization</samp> value contains an Access Token obtained from an OAuth 2.0 Authorization request and used as a <a href="#RFC6750" class="xref">[RFC6750]</a> Bearer Token.  The <samp>Authorization</samp> value is a case sensitive string.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.1.1.p.4">The User Questioning Request MUST contain a JSON structure in the body of the HTTP POST, with the following attributes: </p>
<p></p>

<dl>
<dt>client_notification_token</dt>
<dd style="margin-left: 8">MANDATORY if the Client uses the Pushed-To-Client Flow described in <a href="#Pushed-To-Client-Flow" class="xref">Section 1.4.2</a>. MUST NOT be used otherwise.  The <samp>client_notification_token</samp> is an opaque token issued by the Client. The Client SHOULD use a random value with a level of entropy high enough to cover its security requirements.  The <samp>client_notification_token</samp> is a Bearer Token used by the Client to authorize the OP when the OP sends the User Questioning Response to the Client Notification Endpoint.  The <samp>client_notification_token</samp> value is a case sensitive string.  </dd>
<dt>user_id</dt>
<dd style="margin-left: 8">MUST NOT be used if the Access Token is tied with an End-User, MANDATORY if the Access Token is not tied with an End-User.  The <samp>user_id</samp> is a unique identifier allowing to identify the Questioned User (e.g. Mobile phone, sub, ...).  The <samp>user_id</samp> value is a case sensitive string.  </dd>
<dt>user_id_type</dt>
<dd style="margin-left: 8">MUST NOT be used if the Access Token is tied with an End-User, MANDATORY if the Access Token is not tied with an End-User.  The <samp>user_id_type</samp> indicates the type of the End-User's identifier used for User Questioning.  The <samp>user_id_type</samp> value is a case sensitive string amongst the values defined in <a href="#processing_user_id" class="xref">Section 4.1.2.2</a>.  </dd>
<dt>question_to_display</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>question_to_display</samp> is the question to be displayed to the Questioned User.  The <samp>question_to_display</samp> SHOULD NOT be modified when displayed to Questioned User, the only exception being restrictions imposed by the Questioning Method.  The <samp>question_to_display</samp> value is a case sensitive string.  </dd>
<dt>statements_to_display</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>statements_to_display</samp> is the list of possible statements to be displayed to the Questioned User.  The <samp>statements_to_display</samp> SHOULD NOT be modified when displayed to Questioned User, the only exception being restrictions imposed by the Questioning Method.  The <samp>statements_to_display</samp> value is a JSON array of case sensitive strings.  </dd>
<dt>wished_amr</dt>
<dd style="margin-left: 8">OPTIONAL. Authentication Method Reference.  The <samp>wished_amr</samp> is the authentication methods to be used by the OP to authenticate the Questioned User before he made his statement.  Authentication Method References are defined in chapter 2 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>, where they are named <samp>amr</samp>.  The <samp>wished_amr</samp> value is an array of case sensitive strings.  </dd>
<dt>wished_acr</dt>
<dd style="margin-left: 8">MANDATORY. Authentication Context Class Reference.  The <samp>wished_acr</samp> is Authentication Context Class Reference value that identifies the Authentication Context Class to be used by the OP to authenticate the Questioned User before he made his statement.  Authentication Context Class Reference is defined in chapter 2 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>, where it is named <samp>acr</samp>.  The <samp>wished_acr</samp> value is a case sensitive string.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.1.1.p.6">As defined by <a href="#RFC4627" class="xref">[RFC4627]</a>, the parameters are included in the entity-body of the HTTP POST	using the "application/json" media type. The parameters are serialized into a JavaScript Object Notation (JSON) structure by adding each parameter at the highest structure level.  Parameter names and string values are included as JSON strings.  Numerical values are included as JSON numbers. The order of parameters does not matter and can vary.  </p>
<p>The following is a non-normative example of the JSON structure.  </p>
<pre>
POST /questions HTTP/1.1
Host: server.example.com
Accept: application/json
Authorization: Bearer SlAV32hkKG 
Content-Type: application/json
Content-Length: xxx

{
    "client_notification_token":"vO4n2DAeRrcWE0VAlo4I",
    "user_id":"+33612345678",
    "user_id_type":"msisdn",
    "question_to_display":"Do you allow ...?",
    "statements_to_display":["Yes","No"],
    "wished_acr":"3",
    "wished_amr":["PIN_OK"]
}    
</pre>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> Processing the User Questioning Request</h1>
<h1 id="rfc.section.4.1.2.1">
<a href="#rfc.section.4.1.2.1">4.1.2.1.</a> Processing the Authorization</h1>
<p id="rfc.section.4.1.2.1.p.1">The <samp>Authorization</samp> value contains an Access Token.  The <samp>client_id</samp> associated with the Access Token MUST be associated with the question. It will be used for the <samp>aud</samp> attribute of the User Statement Token.  If the Access Token is associated with a End-User, the OP MUST use the Access Token to identify the End-User and determine a reachability mean for the End-User.  </p>
<h1 id="rfc.section.4.1.2.2">
<a href="#rfc.section.4.1.2.2">4.1.2.2.</a> <a href="#processing_user_id" id="processing_user_id">Processing user_id</a>
</h1>
<p id="rfc.section.4.1.2.2.p.1">The <samp>user_id</samp> is an identifier used to identify the Questioned User and to retrieve a reachability mean.  </p>
<p id="rfc.section.4.1.2.2.p.2">The <samp>user_id</samp> is determined from the User Questioning Request, either from the <samp>user_id</samp> attribute or from the Access Token.  If the <samp>user_id</samp> is present in the User Questioning Request and the Access Token is associated to a End-User, an error is raised.  If the <samp>user_id</samp> is absent of both the User Questioning Request and the Access Token, an error is also raised.  </p>
<p id="rfc.section.4.1.2.2.p.3">If the <samp>user_id</samp> is a reachability identifier (e.g. MSISDN, email address, ...), it SHOULD be used as reachability mean.  Otherwise, the OP must use the <samp>user_id</samp> to determine a suitable reachability identifier, i.e. an identifier enabling a direct communication with the Questioned User.  </p>
<p><samp>user_id_type</samp> member can take the following values:</p>
<p></p>

<dl>
<dt>msisdn</dt>
<dd style="margin-left: 8">If the <samp>user_id_type</samp> value is <samp>msisdn</samp>, the <samp>user_id</samp> value is the mobile phone number corresponding to the Questioned User.  <a href="#E.164" class="xref">E.164</a> is RECOMMENDED as the format of this Claim, with no bracket, space, or hyphen, for example, <samp>+5626872400</samp>.  </dd>
<dt>email</dt>
<dd style="margin-left: 8">If the <samp>user_id_type</samp> value is <samp>email</samp>, the <samp>user_id</samp> value is the email address corresponding to the Questioned User.  Its value MUST conform to the <a href="#RFC5322" class="xref">RFC 5322</a> addr-spec syntax.  </dd>
<dt>sub</dt>
<dd style="margin-left: 8">If the <samp>user_id_type</samp> value is <samp>sub</samp>, the <samp>user_id</samp> value is the <samp>sub</samp> corresponding to the Questioned User for the requesting <samp>client_id</samp> at the OP.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.1.2.2.p.6">Other <samp>user_id_type</samp> can be specified for specific use cases.  </p>
<h1 id="rfc.section.4.1.2.3">
<a href="#rfc.section.4.1.2.3">4.1.2.3.</a> <a href="#processing_wished_amr" id="processing_wished_amr">Processing wished_amr</a>
</h1>
<p id="rfc.section.4.1.2.3.p.1">In the User Questioning Request, the <samp>wished_amr</samp> value is a list of authentication methods.  The OP SHOULD choose some of these authentication methods in order to achieve the <samp>wished_acr</samp>.  The OP SHOULD consider the first authentication methods of the <samp>wished_amr</samp> list as the more prioritary.  The OP CAN also decide to either use other authentication methods or achieve another Authentication Context Class Reference as the one specified in <samp>wished_acr</samp>.  The authentication methods used MUST be stated in <samp>used_amr</samp> and the achieved Authentication Context Class Reference MUST be stated in <samp>used_acr</samp> of the User Statement Token.  </p>
<h1 id="rfc.section.4.1.2.4">
<a href="#rfc.section.4.1.2.4">4.1.2.4.</a> <a href="#explicitly_refuse" id="explicitly_refuse">Allowing the user to explicitly refuse to answer</a>
</h1>
<p id="rfc.section.4.1.2.4.p.1">The user MAY refuse to answer. To do so, the user can ignore the question and wait for the timeout.  In order to offer a better experience, it is RECOMMENDED that the OP gives the user the opportunity to explicit state this refusal.  A "user_refused_to_answer" error is then returned.  </p>
<h1 id="rfc.section.4.1.3">
<a href="#rfc.section.4.1.3">4.1.3.</a> Successful Response</h1>
<p id="rfc.section.4.1.3.p.1">A successful response to the User Questioning Request is a HTTP 200 OK response.  The response body contains JSON structure, with the following attribute.</p>
<p></p>

<dl>
<dt>question_id</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>question_id</samp> attribute contains the <samp>question_id</samp> value.  The <samp>question_id</samp> value is a case sensitive string.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.1.3.p.3">As defined by <a href="#RFC4627" class="xref">[RFC4627]</a>, the parameters are included in the entity-body of the HTTP 200 OK using the "application/json" media type. The parameters are serialized into a JavaScript Object Notation (JSON) structure by adding each parameter at the highest structure level.  Parameter names and string values are included as JSON strings.  Numerical values are included as JSON numbers. The order of parameters does not matter and can vary.  </p>
<p>The following is a non-normative example of the JSON structure.  </p>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: xxx

{
    "question_id": "984dcc7d3d4d4b0f9f8022e344f9"
}
</pre>
<h1 id="rfc.section.4.1.4">
<a href="#rfc.section.4.1.4">4.1.4.</a> Error Response</h1>
<p id="rfc.section.4.1.4.p.1">The Client receives the error in a HTTP 400 Bad Request.</p>
<p id="rfc.section.4.1.4.p.2">The HTTP body contains the error object, a JSON structure defined in <a href="#errors" class="xref">Section 5</a>.  The error object contains one of the following error codes, defined in <a href="#errors" class="xref">Section 5</a>: </p>

<ul>
<li>server_error</li>
<li>invalid_request</li>
<li>no_suitable_method</li>
<li>unauthorized</li>
<li>unknown_user</li>
<li>unreachable_user</li>
</ul>

<p> </p>
<p>The following is a non-normative example of error in a HTTP 400 Bad Request. This example can occur in the Pulled-By-Client flow (cf. <a href="#Pulled-By-Client-Flow" class="xref">Section 1.4.1</a>) and Pushed-To-Client flow (cf. <a href="#Pushed-To-Client-Flow" class="xref">Section 1.4.2</a>).  </p>
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json
Content-Length: xxx

{
    "error":"invalid_request",
    "error_description":"user_id MUST NOT be used 
        if the Access Token is tied with an End-User",
    "error_uri":"https://server.example.com/errors/invalid_request"
}
</pre>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> User Questioning Polling Endpoint</h1>
<p id="rfc.section.4.2.p.1">In order to detect that the User Questioning Response is ready, the Client MUST request the User Questioning Polling Endpoint.  If the User Questioning Response is ready, it will be returned in the response.  Else, the OP responds with HTTP 304 Not Modified.  </p>
<p id="rfc.section.4.2.p.2">Communication with the User Questioning Polling Endpoint MUST utilize TLS.  See Section 16.17 in <a href="#OpenID.Core" class="xref">[OpenID.Core]</a> for more information on using TLS.  </p>
<p id="rfc.section.4.2.p.3">A Client configured with a <samp>client_notification_endpoint</samp> MUST NOT send a request to the User Questioning Polling Endpoint.  </p>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> Polling Request</h1>
<p id="rfc.section.4.2.1.p.1">The Client gets the User Questioning Response using HTTP GET on the <samp>polling_uri</samp>.</p>
<p id="rfc.section.4.2.1.p.2">The <samp>polling_uri</samp> is the combination of the <samp>user_questioning_polling_endpoint</samp> and the <samp>question_id</samp> as a query string parameter.</p>
<p id="rfc.section.4.2.1.p.3">The <samp>polling_uri</samp> MUST contain the following query string parameter: </p>

<dl>
<dt>question_id</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>question_id</samp> value contains the <samp>question_id</samp> received from the User Questioning Request endpoint.  The <samp>question_id</samp> value is a case sensitive string.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.2.1.p.4">The HTTP GET request MUST contain the following headers: </p>

<dl>
<dt>Authorization</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>Authorization</samp> value contains an Access Token obtained from an OAuth 2.0 Authorization request and used as a <a href="#RFC6750" class="xref">[RFC6750]</a> Bearer Token.  The <samp>Authorization</samp> value is a case sensitive string.  </dd>
<dt>Client-Timeout</dt>
<dd style="margin-left: 8">OPTIONAL.  The <samp>Client-Timeout</samp> indicates how much time, in seconds, the Client will wait for a HTTP response. This header can be used with OP that support long polling. As long polling is an optional feature for OP, the Client must be prepared that the OP ignores this header and responds right away.  The <samp>Client-Timeout</samp> value is a number.  </dd>
</dl>

<p> </p>
<p>The following is a non-normative example.  </p>
<pre>
GET /questions_polling?question_id=984dcc7d3d4d4b0f9f8022e344f9 HTTP/1.1
Host: server.example.com
Accept: application/json
Authorization: Bearer SlAV32hkKG 
Client-Timeout: 10
</pre>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> Processing the Polling Request</h1>
<h1 id="rfc.section.4.2.2.1">
<a href="#rfc.section.4.2.2.1">4.2.2.1.</a> <a href="#processing_authorization" id="processing_authorization">Processing the Authorization</a>
</h1>
<p id="rfc.section.4.2.2.1.p.1">The <samp>Authorization</samp> value contains an Access Token.  The <samp>client_id</samp> associated with the Access Token MUST be equal to the <samp>client_id</samp> associated with the question.  </p>
<h1 id="rfc.section.4.2.3">
<a href="#rfc.section.4.2.3">4.2.3.</a> Pending Response</h1>
<p id="rfc.section.4.2.3.p.1">If the User Questioning Response is not ready, the Client will get a HTTP 304 Not Modified. The Client MUST repeat the polling request, until it receives either a successful response or an error. The Client MUST NOT repeat polling requests too rapidly. A waiting time of at least 1 second after the previous polling request was initiated is RECOMMENDED.  </p>
<p>The following is a non-normative example.  </p>
<pre>
HTTP/1.1 304 Not Modified
</pre>
<h1 id="rfc.section.4.2.4">
<a href="#rfc.section.4.2.4">4.2.4.</a> Successful Response</h1>
<p id="rfc.section.4.2.4.p.1">The Client receives the successful User Questioning Response in a HTTP 200 OK response.</p>
<p id="rfc.section.4.2.4.p.2">The successful User Questioning Response is a JSON object, with the following attribute.</p>
<p></p>

<dl>
<dt>user_statement_token</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>user_statement_token</samp> is a User Statement Token as defined in <a href="#user-statement-token" class="xref">Section 2</a>.  The User Statement Token MUST be validated, as described in <a href="#UserStatementTokenValidation" class="xref">Section 2.1</a>.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.2.4.p.4">As defined by <a href="#RFC4627" class="xref">[RFC4627]</a>, the parameters are included in the entity-body of the HTTP 200 OK using the "application/json" media type. The parameters are serialized into a JavaScript Object Notation (JSON) structure by adding each parameter at the highest structure level.  Parameter names and string values are included as JSON strings.  Numerical values are included as JSON numbers. The order of parameters does not matter and can vary.  </p>
<p id="rfc.section.4.2.4.p.5">The Client SHOULD check that the <samp>question_id</samp> in the User Questioning Response is the same as the <samp>question_id</samp> in the <samp>user_statement_token</samp>.  </p>
<p>The following is a non-normative example.  </p>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: xxx

{
    "user_statement_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtp
    ZCI6ImsyYmRjIn0.eyJxdWVzdGlvbl9pZCI6Ijk4NGRjYzdkM2Q0ZDRiMGY5Zjgw
    MjJlMzQ0ZjkiLCJpc3MiOiJodHRwczovL3NlcnZlci5leGFtcGxlLmNvbSIsImF1
    ZCI6WyJzOFYzd204SVhNVzZUYm9helhaWCJdLCJzdWIiOiJnMTE3WUJ0Q1pPM21B
    S1BRS1A4byIsInVzZXJfaWQiOiIrMzM2MTIzNDU2NzgiLCJ1c2VyX2lkX3R5cGUi
    OiJtc2lzZG4iLCJxdWVzdGlvbl9kaXNwbGF5ZWQiOiJXaGljaCBpcyAuLi4_Iiwi
    ZGlzcGxheWVkX3N0YXRlbWVudHMiOlsiYmx1ZSIsInJlZCIsInllbGxvdyJdLCJz
    dGF0ZW1lbnQiOiJyZWQiLCJzdGF0ZW1lbnRfZGF0ZSI6MTMxMTI4Mjk3NSwidXNl
    ZF9hY3IiOiIyIiwidXNlZF9hbXIiOlsiQ0xJQ0tfT0siXX0.bbDeU13rouABOOGr
    vIdQ4BN6GZtHvf1_oZEtGMrMoF9y2l66Dnyv_LL0eip2eCT56N7nH8iACNoJawCG
    _O2nYfUfJTU8t-tu-MNLe9p69PtUQkxShFzvWXPQfri_OXQSs1zdtZ5NNVUX0ulP
    Lm7QOniNFvY4sHwAkci4V1Czj72FGsxcUsUS6KUJRY7B2znP5ykl7m75iCp0Ydx7
    2NshWCWzQxDfXPdQpuJoB96OXDuuukYIrOY1yZOqkUGE6AqPcmMUJEWmT7OCHNi0
    Acsr0jU-fwxoAfYxQ641pW203PfVHXVRd06Ly0xHT3b50FM1jnJM4tq98j78zu1c
    xVc2ww"
}
</pre>
<h1 id="rfc.section.4.2.5">
<a href="#rfc.section.4.2.5">4.2.5.</a> Error Response</h1>
<p id="rfc.section.4.2.5.p.1">The Client receives the error in a HTTP 400 Bad Request.</p>
<p id="rfc.section.4.2.5.p.2">The HTTP body contains the error object, a JSON structure defined in <a href="#errors" class="xref">Section 5</a>.  The error object contains one of the following error codes, defined in <a href="#errors" class="xref">Section 5</a>: </p>

<ul>
<li>duplicate_requests</li>
<li>forbidden</li>
<li>high_rate_client</li>
<li>high_rate_question</li>
<li>server_error</li>
<li>invalid_question_id</li>
<li>invalid_request</li>
<li>timeout</li>
<li>unauthorized</li>
<li>unreachable_user</li>
<li>user_refused_to_answer</li>
</ul>

<p> </p>
<p>The following is a non-normative example of error in a HTTP 400 Bad Request.  </p>
<pre>
HTTP/1.1 400 Bad Request
Content-Type: application/json
Content-Length: xxx

{
    "error":"duplicate_requests",
    "error_description":"A newer request was sent for this question_id",
    "error_uri":"https://server.example.com/errors/duplicate_requests"
}
</pre>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Client Notification Endpoint</h1>
<p id="rfc.section.4.3.p.1">If the Client registered a client_notification_endpoint, the OP MUST send the User Questioning Response to the Client, using a HTTP POST on the Client Notification Endpoint.  The User Questioning Response is a JSON object.  </p>
<p id="rfc.section.4.3.p.2">Communication with the Client Notification Endpoint MUST utilize TLS.  See Section 16.17 in <a href="#OpenID.Core" class="xref">[OpenID.Core]</a> for more information on using TLS.  </p>
<h1 id="rfc.section.4.3.1">
<a href="#rfc.section.4.3.1">4.3.1.</a> Successful Response</h1>
<p id="rfc.section.4.3.1.p.1">The OP sends the User Questioning Response to the Client using HTTP POST.  </p>
<p id="rfc.section.4.3.1.p.2">The HTTP POST request MUST contain the following header: </p>

<dl>
<dt>Authorization</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>Authorization</samp> value contains the <samp>client_notification_token</samp> specified in the User Questioning Request and used as a <a href="#RFC6750" class="xref">[RFC6750]</a> Bearer Token.  The <samp>Authorization</samp> value is a case sensitive string.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.3.1.p.3">A successful User Questioning Response is a JSON object, with the following attribute.  </p>
<p></p>

<dl>
<dt>user_statement_token</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>user_statement_token</samp> is a User Statement Token as defined in <a href="#user-statement-token" class="xref">Section 2</a>.  The User Statement Token MUST be validated, as described in <a href="#UserStatementTokenValidation" class="xref">Section 2.1</a>.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.3.1.p.5">The Client can retrieve the <samp>question_id</samp> in the <samp>user_statement_token</samp>.  </p>
<p>The following is a non-normative example.  </p>
<pre>
POST /notification HTTP/1.1
Host: client.example.com
Content-Type: application/json
Authorization: Bearer vO4n2DAeRrcWE0VAlo4I 
Content-Length: xxx

{
	"user_statement_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtp
    ZCI6ImsyYmRjIn0.eyJxdWVzdGlvbl9pZCI6Ijk4NGRjYzdkM2Q0ZDRiMGY5Zjgw
    MjJlMzQ0ZjkiLCJpc3MiOiJodHRwczovL3NlcnZlci5leGFtcGxlLmNvbSIsImF1
    ZCI6WyJzOFYzd204SVhNVzZUYm9helhaWCJdLCJzdWIiOiJnMTE3WUJ0Q1pPM21B
    S1BRS1A4byIsInVzZXJfaWQiOiIrMzM2MTIzNDU2NzgiLCJ1c2VyX2lkX3R5cGUi
    OiJtc2lzZG4iLCJxdWVzdGlvbl9kaXNwbGF5ZWQiOiJXaGljaCBpcyAuLi4_Iiwi
    ZGlzcGxheWVkX3N0YXRlbWVudHMiOlsiYmx1ZSIsInJlZCIsInllbGxvdyJdLCJz
    dGF0ZW1lbnQiOiJyZWQiLCJzdGF0ZW1lbnRfZGF0ZSI6MTMxMTI4Mjk3NSwidXNl
    ZF9hY3IiOiIyIiwidXNlZF9hbXIiOlsiQ0xJQ0tfT0siXX0.bbDeU13rouABOOGr
    vIdQ4BN6GZtHvf1_oZEtGMrMoF9y2l66Dnyv_LL0eip2eCT56N7nH8iACNoJawCG
    _O2nYfUfJTU8t-tu-MNLe9p69PtUQkxShFzvWXPQfri_OXQSs1zdtZ5NNVUX0ulP
    Lm7QOniNFvY4sHwAkci4V1Czj72FGsxcUsUS6KUJRY7B2znP5ykl7m75iCp0Ydx7
    2NshWCWzQxDfXPdQpuJoB96OXDuuukYIrOY1yZOqkUGE6AqPcmMUJEWmT7OCHNi0
    Acsr0jU-fwxoAfYxQ641pW203PfVHXVRd06Ly0xHT3b50FM1jnJM4tq98j78zu1c
    xVc2ww"
	
}
</pre>
<h1 id="rfc.section.4.3.2">
<a href="#rfc.section.4.3.2">4.3.2.</a> Error Response</h1>
<p id="rfc.section.4.3.2.p.1">The OP sends the erroneous User Questioning Response to the Client using HTTP POST.  </p>
<p id="rfc.section.4.3.2.p.2">The HTTP POST request MUST contain the following header: </p>

<dl>
<dt>Authorization</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>Authorization</samp> value is the <samp>client_notification_token</samp> specified in the User Questioning Request and used as a <a href="#RFC6750" class="xref">[RFC6750]</a> Bearer Token.  The <samp>Authorization</samp> value is a case sensitive string.  </dd>
</dl>

<p> </p>
<p id="rfc.section.4.3.2.p.3">The HTTP body contains the error object, a JSON structure defined in <a href="#errors" class="xref">Section 5</a>.  The error object contains one of the following error codes, defined in <a href="#errors" class="xref">Section 5</a>: </p>

<ul>
<li>timeout</li>
<li>unreachable_user</li>
<li>user_refused_to_answer</li>
</ul>

<p> </p>
<p id="rfc.section.4.3.2.p.4">In addition, the error object contains the following attribute: </p>

<dl>
<dt>question_id</dt>
<dd style="margin-left: 8">MANDATORY.  The <samp>question_id</samp> is a unique identifier of the Question.  The <samp>question_id</samp> value is a case sensitive string.  </dd>
</dl>

<p> </p>
<p>The following is a non-normative example.  </p>
<pre>
POST /notification HTTP/1.1
Host: client.example.com
Content-Type: application/json
Authorization: Bearer vO4n2DAeRrcWE0VAlo4I 
Content-Length: xxx

{
    "question_id":"984dcc7d3d4d4b0f9f8022e344f9",
    "error":"unknown_user",
    "error_description":"The user is unknown",
    "error_uri":"https://server.example.com/errors/unknown_user"
}
</pre>
<h1 id="rfc.section.4.3.3">
<a href="#rfc.section.4.3.3">4.3.3.</a> Processing the Response</h1>
<h1 id="rfc.section.4.3.3.1">
<a href="#rfc.section.4.3.3.1">4.3.3.1.</a> Processing the Authorization</h1>
<p id="rfc.section.4.3.3.1.p.1">The <samp>Authorization</samp> value contains a Client Notification Token.  The <samp>question_id</samp> associated with the Client Notification Token MUST match with the <samp>question_id</samp> received from the User Questioning Request Endpoint.  </p>
<h1 id="rfc.section.4.3.3.2">
<a href="#rfc.section.4.3.3.2">4.3.3.2.</a> Processing the User Statement Token</h1>
<p id="rfc.section.4.3.3.2.p.1">The signature of the User Statement Token MUST be valid, as defined in <a href="#UserStatementTokenValidation" class="xref">Section 2.1</a>.  </p>
<p id="rfc.section.4.3.3.2.p.2">The <samp>aud</samp> attributes contained in the User Statement Token MUST match with the <samp>client_id</samp> of the Client.  </p>
<h1 id="rfc.section.4.3.4">
<a href="#rfc.section.4.3.4">4.3.4.</a> Acknowledgement</h1>
<p id="rfc.section.4.3.4.p.1">The acknowledgement MUST be a HTTP 200 OK. This HTTP response SHOULD be ignored by the OP. If the response is not a HTTP 200 OK, the processing is up to the OP's implementer.  </p>
<p>The following is a non-normative example.  </p>
<pre>
HTTP/1.1 200 OK
</pre>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#errors" id="errors">Error Object</a>
</h1>
<p id="rfc.section.5.p.1">As defined in section 5.2 of <a href="#RFC6749" class="xref">OAuth 2.0</a>, an error object is a JSON structure which contains the following properties:</p>
<p></p>

<dl>
<dt>error</dt>
<dd style="margin-left: 8">MANDATORY.  A single ASCII error code from the following: <dl>
<dt>duplicate_requests</dt>
<dd style="margin-left: 8">The Client sent simultaneous requests to the User Questioning Polling Endpoint for the same <samp>question_id</samp>. This error is responded to newer requests. The oldest request is processed normally.  </dd>
<dt>forbidden</dt>
<dd style="margin-left: 8">The Client sent a request to the User Questioning Polling Endpoint whereas it is configured with a <samp>client_notification_endpoint</samp>.  </dd>
<dt>high_rate_client</dt>
<dd style="margin-left: 8">The Client sent requests at a too high rate, amongst all <samp>question_id</samp>. Information about the allowed and recommended rates can be included in the <samp>error_description</samp>.  </dd>
<dt>high_rate_question</dt>
<dd style="margin-left: 8">The Client sent requests at a too high rate for a given <samp>question_id</samp>. Information about the allowed and recommended rates can be included in the <samp>error_description</samp>.  </dd>
<dt>server_error</dt>
<dd style="margin-left: 8">The OP encountered an unexpected condition that prevented it from fulfilling its task.  </dd>
<dt>invalid_question_id</dt>
<dd style="margin-left: 8">The Client sent a request to the User Questioning Polling Endpoint for a <samp>question_id</samp> that does not exist or is not valid for the requesting Client.  </dd>
<dt>invalid_request</dt>
<dd style="margin-left: 8">The User Questioning Request is not valid. The request is missing a required parameter, includes an unsupported parameter value, repeats a parameter or is otherwise malformed.  </dd>
<dt>no_suitable_method</dt>
<dd style="margin-left: 8">There is no Questioning Method suitable with the User Questioning Request. The OP can use this error code when it does not implement mechanisms suitable for the wished AMR or ACR.  </dd>
<dt>timeout</dt>
<dd style="margin-left: 8">The Questioned User did not answer in the allowed period of time.  </dd>
<dt>unauthorized</dt>
<dd style="margin-left: 8">The Client is not authorized to use the User Questioning API or did not send a valid Access Token.  </dd>
<dt>unknown_user</dt>
<dd style="margin-left: 8">The Questioned User mentioned in the <samp>user_id</samp> attribute of the User Questioning Request is unknown.  </dd>
<dt>unreachable_user</dt>
<dd style="margin-left: 8">The Questioned User mentioned in the User Questioning Request (either in the Access Token or in the <samp>user_id</samp> attribute) is unreachable.  The OP can use this error when it does not have a reachability identifier (e.g. MSISDN) for the Question User, when the reachability identifier is not operational (e.g. unsubscribed MSISDN or blocked account).  </dd>
<dt>user_refused_to_answer</dt>
<dd style="margin-left: 8">The Questioned User refused to make a statement to the question.  </dd>
</dl>
<p> </p>
</dd>
<dt>error_description</dt>
<dd style="margin-left: 8">OPTIONAL.  Human-readable ASCII encoded text description of the error. Human-readable ASCII <a href="#RFC20" class="xref">[RFC20]</a> text providing additional information, used to assist the client developer in understanding the error that occurred.  Values for the "error_description" parameter MUST NOT include characters outside the set %x20-21 / %x23-5B / %x5D-7E.  </dd>
<dt>error_uri</dt>
<dd style="margin-left: 8">OPTIONAL.  A URI identifying a human-readable web page with information about the error, used to provide the client developer with additional information about the error.  Values for the "error_uri" parameter MUST conform to the URI-reference syntax and thus MUST NOT include characters outside the set %x21 / %x23-5B / %x5D-7E.  </dd>
</dl>

<p> </p>
<p id="rfc.section.5.p.3">The parameters are serialized into a JavaScript Object Notation (JSON) structure by adding each parameter at the highest structure level.  Parameter names and string values are included as JSON strings.  Numerical values are included as JSON numbers. The order of parameters does not matter and can vary.  </p>
<p>The following is a non-normative example.  </p>
<pre>
{
    "error":"unknown_user",
    "error_description":"The user is unknown",
    "error_uri":"https://server.example.com/errors/unknown_user"
}
</pre>
<p id="rfc.section.5.p.4">The error object SHOULD be conveyed as a HTTP body, either in a HTTP POST request or in a HTTP 400 response.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#implementation_considerations" id="implementation_considerations">Implementation Considerations</a>
</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#implementation_of_questioning_methods" id="implementation_of_questioning_methods">Implementation of Questioning Methods</a>
</h1>
<p id="rfc.section.6.1.p.1">In order to interact with the Questioned User, the OP has to implement at least one questioning method.  A questioning method has three purposes: authenticating the Questioned User, displaying the question and collecting the Question User's statement.  </p>
<p id="rfc.section.6.1.p.2">The authentication method and the associated level of assurance are referred by the <samp>AMR</samp> and <samp>ACR</samp> attributes.  </p>
<p id="rfc.section.6.1.p.3">There is no specific attribute to describe how the question was displayed and how the statement was saved.  However, the OP is responsible to display the question as it is. If the question has been modified, the displayed question MUST be returned to the Client as it was displayed, in the <samp>displayed_question</samp> attribute of the User Statement Token.  In the same logic, the Questioned User's statement MUST be returned to the Client as it was displayed, in the <samp>statement</samp> attribute of the User Statement Token.  </p>
<p id="rfc.section.6.1.p.4">The fact that a User Questioning Request and an Authentication Request (as defined in <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>) are handled using the same <samp>AMR</samp> means that the user authentication is enforced using the same authentication method.  However, as a Questioning Method uses an authentication method in combination with questioning mechanisms, having the same <samp>AMR</samp> does not mean that the OP has to use the same component to handle User Questioning Requests and Authentication Requests.  For instance, if the <samp>AMR</samp> value is <samp>SMS_URL</samp>, the user is authenticated thanks to his mobile phone (using a SMS) but the URL contained in the SMS can refer to two different components, one component for the Authentication Request and another for the User Questioning Request .  </p>
<p id="rfc.section.6.1.p.5">If an OP cannot display a question or the statements, it MUST return an error.  To prevent these errors, it can inform the Clients of its limitation and limit the possible questions or statements.  For instance, if the mechanism used for User Questioning can only display a question of limited size with only two predefined statements, the Client SHOULD send a User Questioning Request with a <samp>question_to_display</samp> limited in size and the two predefined statements as <samp>statements_to_display</samp> values.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#security_considerations" id="security_considerations">Security Considerations</a>
</h1>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#NonRepudation" id="NonRepudation">Non Repudiation</a>
</h1>
<p id="rfc.section.7.1.p.1">Non-repudiation is an important feature of User Statement Token. To enable this feature, the asymmetric signatures are the only allowed signatures for User Statement Tokens.  This way, the Client can store the User Statement Token and use it as a proof of the statement made by Questioned User.  This proof engages the signer's responsibility, i.e. the OP's responsibility.  </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#SigEnc" id="SigEnc">Signatures and Encryption</a>
</h1>
<p id="rfc.section.7.2.p.1">Signatures and Encryption should respect the requirements defined in chapter 10 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a> with one restriction: symmetric signatures MUST not be used.  </p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> <a href="#SigningOrder" id="SigningOrder">Signing and Encryption Order</a>
</h1>
<p id="rfc.section.7.3.p.1">Signing and Encryption Order should respect the requirements defined in chapter 16.14 of <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#privacy_considerations" id="privacy_considerations">Privacy Considerations</a>
</h1>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#personal_information" id="personal_information">Personal Information</a>
</h1>
<p id="rfc.section.8.1.p.1">The User Statement Token contains the Questioned User's statement on a question. This information is personal.  If the <samp>user_id</samp> is present in the User Questioning Request, it will also be present in the User Statement Token, therefore Questioned User is directly identifiable.  In order to protect the Questioned User's privacy, Client SHOULD only store encrypted User Statement Tokens.  The encryption can be computed either by the OP or by the Client, using <a href="#SigEnc" class="xref">Section 7.2</a>.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">This document makes no requests of IANA.</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="E.164">[E.164]</b></td>
<td class="top">
<a title="International Telecommunication Union">Union, I. T.</a>, "<a href="http://www.itu.int/rec/T-REC-E.164-201011-I/en">E.164: The international public telecommunication numbering plan</a>", 2010.</td>
</tr>
<tr>
<td class="reference"><b id="JWE">[JWE]</b></td>
<td class="top">
<a title="Microsoft">Jones, M.</a>, <a title="RTFM, Inc.">Rescorla, E.</a> and <a title="Cisco Systems, Inc.">J. Hildebrand</a>, "<a href="https://tools.ietf.org/html/rfc7516">JSON Web Encryption (JWE)</a>", RFC 7516, DOI 10.17487/RFC7516, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="JWS">[JWS]</b></td>
<td class="top">
<a title="Microsoft">Jones, M.</a>, <a title="Ping Identity">Bradley, J.</a> and <a title="Nomura Research Institute, Ltd.">N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="JWT">[JWT]</b></td>
<td class="top">
<a title="Microsoft">Jones, M.</a>, <a title="Ping Identity">Bradley, J.</a> and <a title="Nomura Research Institute, Ltd.">N. Sakimura</a>, "<a href="https://tools.ietf.org/html/draft-ietf-oauth-json-web-token">JSON Web Token (JWT)</a>", Internet-Draft draft-ietf-oauth-json-web-token, May 2013.</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Core">[OpenID.Core]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a>, <a title="Google">de Medeiros, B.</a>, <a title="Salesforce">Mortimore, C.</a> and <a title="Illumila">E. Jay</a>, "<a>OpenID Connect Standard 1.0</a>", December 2013.</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Discovery">[OpenID.Discovery]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a> and <a title="Illumila">E. Jay</a>, "<a>OpenID Connect Discovery 1.0</a>", September 2014.</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Registration">[OpenID.Registration]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a> and <a title="Microsoft">M. Jones</a>, "<a>OpenID Connect Dynamic Client Registration 1.0</a>", December 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC20">[RFC20]</b></td>
<td class="top">
<a title="University California Los Angeles (UCLA)">Cerf, V.</a>, "<a href="https://tools.ietf.org/html/rfc20">ASCII format for Network Interchange</a>", STD 80, RFC 20, DOI 10.17487/RFC0020, October 1969.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4627">[RFC4627]</b></td>
<td class="top">
<a>Crockford, D.</a>, "<a href="https://tools.ietf.org/html/rfc4627">The application/json Media Type for JavaScript Object Notation (JSON)</a>", RFC 4627, DOI 10.17487/RFC4627, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5322">[RFC5322]</b></td>
<td class="top">
<a>Resnick, P.</a>, "<a href="https://tools.ietf.org/html/rfc5322">Internet Message Format</a>", RFC 5322, DOI 10.17487/RFC5322, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6749">[RFC6749]</b></td>
<td class="top">
<a>Hardt, D.</a>, "<a href="https://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6750">[RFC6750]</b></td>
<td class="top">
<a>Jones, M.</a> and <a>D. Hardt</a>, "<a href="https://tools.ietf.org/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>", RFC 6750, DOI 10.17487/RFC6750, October 2012.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.A.p.1">The following have contributed to the development of this specification.</p>
<p></p>

<ul class="empty"><li></ul>

<p> </p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#Notices" id="Notices">Notices</a>
</h1>
<p id="rfc.section.B.p.1">Copyright (c) 2020 The OpenID Foundation.</p>
<p id="rfc.section.B.p.2">The OpenID Foundation (OIDF) grants to any Contributor, developer, implementer, or other interested party a non-exclusive, royalty free, worldwide copyright license to reproduce, prepare derivative works from, distribute, perform and display, this Implementers Draft or Final Specification solely for the purposes of (i) developing specifications, and (ii) implementing Implementers Drafts and Final Specifications based on such documents, provided that attribution be made to the OIDF as the source of the material, but that such attribution does not indicate an endorsement by the OIDF.  </p>
<p id="rfc.section.B.p.3">The technology described in this specification was made available from contributions from various sources, including members of the OpenID Foundation and others.  Although the OpenID Foundation has taken steps to help ensure that the technology is available for distribution, it takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this specification or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any independent effort to identify any such rights.  The OpenID Foundation and the contributors to this specification make no (and hereby expressly disclaim any) warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to this specification, and the entire risk as to implementing this specification is assumed by the implementer.  The OpenID Intellectual Property Rights policy requires contributors to offer a patent promise not to assert certain patent claims against other contributors and against implementers.  The OpenID Foundation invites any interested party to bring to its attention any copyrights, patents, patent applications, or other proprietary rights that may cover technology that may be required to practice this specification.  </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Nicolas Aillery</span> 
	  <span class="n hidden">
		<span class="family-name">Aillery</span>
	  </span>
	</span>
	<span class="org vcardline">Orange</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:nicolas.aillery@orange.com">nicolas.aillery@orange.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Charles Marais</span> 
	  <span class="n hidden">
		<span class="family-name">Marais</span>
	  </span>
	</span>
	<span class="org vcardline">Orange</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:charles.marais@orange.com">charles.marais@orange.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">James Manger</span> 
	  <span class="n hidden">
		<span class="family-name">Manger</span>
	  </span>
	</span>
	<span class="org vcardline">Telstra</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:james.h.manger@team.telstra.com">james.h.manger@team.telstra.com</a></span>

  </address>
</div>

</body>
</html>
