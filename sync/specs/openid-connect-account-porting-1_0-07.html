<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>OpenID Connect Account Porting</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Notation, Conventions, and Terminology"/>
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Porting flow"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Discovery"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Porting data API"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Encrypting &quot;port_token&quot;"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Indicating a previous identity: &quot;aka&quot; member"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Porting check API"/>
<link href="#rfc.section.7" rel="Chapter" title="7 &quot;user_ported&quot; error code"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations"/>
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Impersonation of legitimate user's old OP account"/>
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Trick user into login with attacker's account"/>
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Impersonate old OP/replay migration data"/>
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Bad OP"/>
<link href="#rfc.section.8.5" rel="Chapter" title="8.5 Inject migration data during RP account migration"/>
<link href="#rfc.section.8.6" rel="Chapter" title="8.6 Further Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Privacy Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations"/>
<link href="#rfc.references" rel="Chapter" title="11 References"/>
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Example flow"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Acknowledgements"/>
<link href="#rfc.appendix.C" rel="Chapter" title="C Notices"/>
<link href="#rfc.appendix.D" rel="Chapter" title="D Document history"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2.dev0 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Manger, J., Lodderstedt, T., and A. Gleditsch" />
  <meta name="dct.identifier" content="urn:ietf:id:openid-connect-account-porting-1_0" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-3-6" />
  <meta name="dct.abstract" content="This specification defines mechanisms to support a user porting from one OpenID Connect Provider to another, such that relying parties can automatically recognize and verify the change." />
  <meta name="description" content="This specification defines mechanisms to support a user porting from one OpenID Connect Provider to another, such that relying parties can automatically recognize and verify the change." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left"></td>
  <td class="right">J. Manger</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Telstra</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">T. Lodderstedt</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">YES Europe AG</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">A. Gleditsch</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Telenor</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">March 6, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">OpenID Connect Account Porting<br />
  <span class="filename">openid-connect-account-porting-1_0</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This specification defines mechanisms to support a user porting from one OpenID Connect Provider to another, such that relying parties can automatically recognize and verify the change.</p>
<h1>
  <a>Note</a>
</h1>
<p>Discussions on this draft occur in the <a href="https://openid.net/wg/mobile/">OpenID Foundation MODRNA working group</a>.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Requirements Notation, Conventions, and Terminology</a></li>
<li>1.2.   <a href="#rfc.section.1.2">Porting flow</a></li>
</ul><li>2.   <a href="#rfc.section.2">Discovery</a></li>
<li>3.   <a href="#rfc.section.3">Porting data API</a></li>
<li>4.   <a href="#rfc.section.4">Encrypting "port_token"</a></li>
<li>5.   <a href="#rfc.section.5">Indicating a previous identity: "aka" member</a></li>
<li>6.   <a href="#rfc.section.6">Porting check API</a></li>
<li>7.   <a href="#rfc.section.7">"user_ported" error code</a></li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a></li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Impersonation of legitimate user's old OP account</a></li>
<li>8.2.   <a href="#rfc.section.8.2">Trick user into login with attacker's account</a></li>
<li>8.3.   <a href="#rfc.section.8.3">Impersonate old OP/replay migration data</a></li>
<li>8.4.   <a href="#rfc.section.8.4">Bad OP</a></li>
<li>8.5.   <a href="#rfc.section.8.5">Inject migration data during RP account migration</a></li>
<li>8.6.   <a href="#rfc.section.8.6">Further Considerations</a></li>
</ul><li>9.   <a href="#rfc.section.9">Privacy Considerations</a></li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a></li>
<li>11.   <a href="#rfc.references">References</a></li>
<ul><li>11.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Example flow</a></li>
<li>Appendix B.   <a href="#rfc.appendix.B">Acknowledgements</a></li>
<li>Appendix C.   <a href="#rfc.appendix.C">Notices</a></li>
<li>Appendix D.   <a href="#rfc.appendix.D">Document history</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">OpenID Connect is a federated identity protocol that allows a user to leverage his or her authentication to an OpenID Connect Provider (OP) to login to Relying Parties (RPs). An RP can (and often will) accept logins via many OPs. The primary identifier for a user at an RP is the combination of a Subject Id ("sub" value) and OP identifier ("iss" value). The "sub" value is only defined to be unambiguous within the context of an "iss" value <a href="#OpenID.Core">[OpenID.Core]</a> &#167;5.7. "Claim Stability and Uniqueness".  This design deliberately isolates each OP's user population so one OP cannot adversely affect the security of another OP. One consequence, however, is that a user porting from one OP to another appears to an RP as two unrelated users.</p>
<p id="rfc.section.1.p.2">This specification extends OpenID Connect to enable an RP to recognize when a user logging in via a New OP is the same user who has previously logged in via an Old OP. That is, it enables porting between OPs to be handled automatically by RPs. The central idea is that the user logs into both Old and New OPs in a single session to establish the link between the user's accounts at each. Subsequently, RPs can interact with both OPs to confirm that link, without needing the user to repeat the dual logins.</p>
<p id="rfc.section.1.p.3">OpenID Connect account porting is motivated by (but not limited to) the GSMA Mobile Connect scheme, in which mobile network operators collectively offer federated identity services <a href="#MobileConnect">[MobileConnect]</a>. Most jurisdictions allow users to port their mobile phone number between network operators, and a reasonable expectation of those users will be that their Mobile Connect account (provided by those same operators) can also be ported at the same time. There is a significant difference between phone number and account porting, however. Other parties are generally unaware when number porting occurs; they simply keep using the same phone number to communicate with the user. In contrast, RPs are aware when an OpenID Connect account is ported as they interact with a New OP.</p>
<p><a href="#flow">Section 1.2</a> gives an overview of the message flows during porting.  <a href="#discovery">Section 2</a> defines metadata that indicates an OP supports porting, which can be obtained via <a href="#OpenID.Discovery">[OpenID.Discovery]</a>.  <a href="#port_data">Section 3</a> specifies an API offered by an Old OP that a New OP calls when a user ports to collect a token representing the port.  This API is protected by an OAuth 2.0 exchange to ensure the user consents to the porting process.  <a href="#aka">Section 5</a> specifies how a New OP can identify the Old OP in an id_token presented to an RP. <a href="#port_check">Section 6</a> describes how an RP can confirm the porting information with the Old OP.  <a href="#example">Appendix A</a> provides a example of a complete porting flow.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#rnc" id="rnc">Requirements Notation, Conventions, and Terminology</a></h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.1.1.p.2">Throughout this document, values are quoted to indicate that they are to be taken literally in protocol messages.</p>
<p id="rfc.section.1.1.p.3">Terms such as "OpenID Provider" (OP), "Relying Party" (RP), "Subject Id" (sub), and "Sector Id" are defined in <a href="#OpenID.Core">[OpenID.Core]</a>. This document uses the terms "Old OP" and "New OP" to indicate OpenID Providers that support users porting out and porting in respectively. An OP can support both roles (and hopefully most will).</p>
<h1 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a> <a href="#flow" id="flow">Porting flow</a></h1>
<p id="rfc.section.1.2.p.1">Porting involves a user, their Old OP and New OP, plus any number of RPs.  A sample porting flow is described below.</p>
<p id="rfc.section.1.2.p.2">The first stage for a specific porting event is for the New OP to get confirmation from the Old OP that the user wants to port.  The New OP does so by calling the Old OP's Porting data API on the user's behalf, which first requires orchestrating an approval interaction between the user and the Old OP using OAuth 2.0 <a href="#RFC6749">[RFC6749]</a>.</p>
<p/>

<ol>
  <li>The user browses to the New OP, logs in, and indicates that they want to port from a particular Old OP.</li>
  <li>New OP initiates an OAuth 2.0 flow by redirecting the user's browser to the Old OP's authorization endpoint.  <ol style="list-style-type: upper-alpha"><li>The user authenticates to the Old OP, and confirms they want to port to the New OP.</li><li>Old OP redirects the user's browser back to the New OP.</li><li>New OP completes the OAuth 2.0 flow by getting an access token from the Old OP's token endpoint.</li></ol></li>
  <li>New OP calls the Old OP's Porting data API with the access token; receiving a "port_token".</li>
</ol>
<p id="rfc.section.1.2.p.4">The second stage of the porting process occurs multiple times: once for each RP. It occurs the first time the user visits a given RP after porting.  That is, the first time the user logs in to a given RP via the New OP.  A normal OpenID Connect flow occurs, but the New OP includes extra details in the resulting "id_token" to indicate that the user previously used a particular Old OP.</p>
<p id="rfc.section.1.2.p.5">When an RP does not recognize the New OP's Subject Id for the user, the RP can see whether it knows this user under an id from a previous OP.  The RP does not blindly trust the New OP to identify the account that was ported. Instead, the RP gets confirmation from the Old OP that the user really did port to the New OP. It is only in that confirmation that the Old OP identifies the ported account, enabling the RP to link the user's ids from both OPs.</p>
<p/>

<ol>
  <li>The user browses to the RP, and choses to login via the New OP.</li>
  <li>RP initiates an OpenID Connect login by redirecting the user's browser to the New OP's authorization endpoint.  <ol style="list-style-type: upper-alpha"><li>The user authenticates to the New OP, and consents to being identified to the RP.</li><li>New OP redirects the user's browser back to the RP.</li><li>RP completes the OpenID Connect flow by getting an id_token from the New OP's token endpoint.</li></ol></li>
  <li>New OP included an "aka" member in the id_token listing the user's Old OP, along with an encrypted version of the user's "port_token" obtained in the first stage. Note: the audience for the encryption applied to the "port_token" is the Old OP, not the RP.</li>
  <li>RP prepares to make API calls to the Old OP, by calling the Old OP's token endpoint (with an OAuth 2.0 client credential grant) to get an access token.</li>
  <li>RP calls the Old OP's Porting check API with the access token, passing along the encrypted "port_token"; receiving the Old OP's Subject Id for the user in response.</li>
  <li>RP automatically accepts the two Subject Ids from Old and New OPs as identifiers for the same account at the RP.</li>
</ol>
<p id="rfc.section.1.2.p.7">A user could have ported to the Old OP from an even Older OP.  That can be indicated by the Old OP including an "aka" member in it's Porting check API response (step 5 above). An RP can automatically process that port in the same way that an "aka" value from the New OP is handled.</p>
<p id="rfc.section.1.2.p.8">The porting flow maintains the privacy benefit offered by the use of pairwise Subject Ids, but still works if an OP uses public Subject Ids.</p>
<p id="rfc.section.1.2.p.9">It is possible for an OP to implement the porting flow without maintaining details of the RPs each user has visited.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#discovery" id="discovery">Discovery</a></h1>
<p id="rfc.section.2.p.1">OpenID Discovery offers details about the features supported by an OP <a href="#OpenID.Discovery">[OpenID.Discovery]</a>. The following members MUST be included in the metadata for an Old OP that supports users porting out:</p>
<p/>

<dl>
  <dt>"port_data_endpoint"</dt>
  <dd style="margin-left: 8">Base URL for the Porting data API described in <a href="#port_data">Section 3</a> that a New OP can use to obtain details about an account that is being ported.  The URL MUST use the "https" scheme.</dd>
  <dt>"port_check_endpoint"</dt>
  <dd style="margin-left: 8">Base URL for the Porting check API described in <a href="#port_check">Section 6</a> that an RP can use to confirm that an account has been ported to a specific New OP. The URL MUST use the "https" scheme.</dd>
  <dt>"port_enc_values_supported"</dt>
  <dd style="margin-left: 8">Array of string algorithm names <a href="#IANA.JOSE">[IANA.JOSE]</a> identifying content encryption algorithms supported by the OP that can be used by a New OP to encrypt a "port_token".</dd>
</dl>
<p id="rfc.section.2.p.3">The metadata MUST also include a "jwks_uri" member pointing to the OP's JSON Web Key Set. And that set MUST include at least one encryption public key, indicated with a "use":"enc" member <a href="#RFC7517">[RFC7517]</a>, that can be used to encrypt a port_token.</p>
<p id="rfc.section.2.p.4">Below are sample metadata requests and responses.</p>
<pre>
GET /.well-known/openid-configuration HTTP/1.1
Host: oldop.example.net
</pre>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
                     "issuer": "https://oldop.example.net/",
     "authorization_endpoint": "https://oldop.example.net/connect/authorize",
             "token_endpoint": "https://oldop.example.net/connect/token",
         "port_data_endpoint": "https://oldop.example.net/connect/port_data",
        "port_check_endpoint": "https://oldop.example.net/connect/port_check",
                   "jwks_uri": "https://oldop.example.net/keys.jwks",
  "port_enc_values_supported": [ "A256GCM", "A256CBC-HS512" ],
  &#8230;
}
</pre>
<pre>
GET /keys.jwks HTTP/1.1
Host: oldop.example.net
</pre>
<pre>
HTTP/1.1 200 OK
Content-Type: application/jwk-set+json

{"keys":
  [
    {"kty":"RSA",
       "n": "0vx7agoebGcQSuuPiLJXZptN9nndrQmbXEps2a &#8230; DKgw",
       "e":"AQAB",
     "use":"enc",
     "alg":"RSA-OAEP-256",
     "kid":"2011-04-29"},
    &#8230;
  ]
}
</pre>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#port_data" id="port_data">Porting data API</a></h1>
<p id="rfc.section.3.p.1">The Porting data API (offered by an Old OP and consumed by a New OP) provides a token to represent a porting event. The New OP passes the token (after encrypting it [<a href="#enc">Section 4</a>]) to each RP when the user subsequently logs into that RP [<a href="#aka">Section 5</a>]. The RP, in turn, passes the token to the Porting check API [<a href="#port_check">Section 6</a>] to confirm the port with the Old OP.</p>
<p id="rfc.section.3.p.2">Access to porting data requires the consent of the user to whom it relates.  The Old OP MUST support the OAuth 2.0 authorization code flow for accessing the API <a href="#RFC6749">[RFC6749]</a>. The Old OP MUST support Bearer access tokens <a href="#RFC6750">[RFC6750]</a>. The New OP MUST include the scope "port_data" when requesting access.</p>
<p id="rfc.section.3.p.3">The API provides a single read-only resource per user. It can be read with a "GET" request. The path "/me" appended to the base URL (from the "port_data_endpoint" member in the Old OP discovery metadata) indicates the resource for the user associated with the access token used to make the request.</p>
<p id="rfc.section.3.p.4">The response is a JSON object with a "port_token" member that has a string value. The Old OP needs to be able to identify the user and New OP involved in the porting from the port token. The Old OP MUST choose port token values to have sufficient entropy that they cannot be guessed by other parties, including by New OPs and RPs that have seen other port tokens. All "port_token" values from the Old OP for a given New OP MUST be the same length so the length itself (which is typically preserved by encryption) does not allow correlation across RPs. Consequently, a port token cannot simply be the concatenation of ids for the user and New OP. It could be a combination of the user and New OP ids signed by the Old OP. It could also be a random number used as a reference to porting details recorded by the Old OP.</p>
<p id="rfc.section.3.p.5">Any unrecognized members in the response MUST be ignored (such as "extra_stuff" in the example below).</p>
<p id="rfc.section.3.p.6">Below is a sample porting data request and response:</p>
<pre>
GET /connect/port_data/me HTTP/1.1
Host: oldop.example.net
Authorization: Bearer E3yyDiR5_i8CFCVDo3h8T5qgKpAdu8XkGZBv81vn428
</pre>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "port_token": "3O9YHawMDXLpKb-FVjQ1_qSS9R9wbwb0TWbUxLvqAAI",
  "extra_stuff": 34
}
</pre>
<p id="rfc.section.3.p.7">Only OPs explicitly trusted by the Old OP SHOULD be allowed to use the API (eg to use the "port_data" scope) as it is security and privacy sensitive.  In some situations an Old OP will know via other processes when and to whom a user is  porting (eg when it is combined with porting a phone number).  In such circumstances, the Old OP SHOULD reject requests about a user not known to be in the process of porting, and SHOULD reject requests from any OP other than the known porting destination.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#enc" id="enc">Encrypting "port_token"</a></h1>
<p id="rfc.section.4.p.1">A "port_token" value received by a New OP is encrypted to create an "enc_port_token" value, which is passed to an RP, then back to the Old OP.</p>
<p id="rfc.section.4.p.2">When pairwise Subject Ids are used for enhanced privacy (that is, a user is assigned a separate "sub" value for each collection of related RPs identified by a "sector_id"), any porting information revealed to RPs also needs to be at least pairwise so as not to undermine that privacy. This is achieved by using encrypted versions of the "port_token". Encryption is performed by the New OP, and decryption by the Old OP.</p>
<p id="rfc.section.4.p.3">A separate encryption MUST be used whenever a different "sub" value is involved. The encryptions MUST involve nonces so each ciphertext is different.  The nonces themselves MUST NOT allow extra correlations, which effectively means multiple encryptions of a given "port_token" for multiple RPs MUST NOT be pre-calculated during the porting process if the nonces include a counter or time-based component. Instead, it is safe to perform the encryption for an RP when the user subsequently logs in to that RP.</p>
<p id="rfc.section.4.p.4">It is RECOMMENDED that a fresh "enc_port_token" value be calculated each time one is sent so they can have short lifetimes, hence avoiding requirements for revocation.</p>
<p id="rfc.section.4.p.5">Encryption offers less privacy benefit when the New OP uses public Subject Ids. However, encryption is still used in such cases to avoid introducing additional options to the porting mechanism.</p>
<p id="rfc.section.4.p.6">A "port_token" value is encrypted with the Old OP's public encryption key to create an "enc_port_token" value. The New OP obtains the public key by following the "jwks_uri" member in the Old OP's metadata, then selecting a key with a "use":"enc" member and a supported key type ("kty") and encryption algorithm ("alg"). The Old OP can change keys, which the New OP MUST cope with by periodically re-checking the metadata.  Cache-control details delivered with the metadata indicate how often the New OP ought to re-check (with an expectation that keys will not change more often than daily) <a href="#RFC7234">[RFC7234]</a>.</p>
<p id="rfc.section.4.p.7">The encryption follows the JSON Web Encryption (JWE) process, creating a JWE compact serialization <a href="#RFC7516">[RFC7516]</a>.  The selected public key provides the key id ("kid") and algorithm ("alg").  The content encryption algorithm ("enc") is chosen from the "port_enc_values_supported" list published in the Old OP's discovery metadata.  The plaintext is the "port_token" value.</p>
<p id="rfc.section.4.p.8">The JWE header MUST include a type parameter ("typ") with the value "openid-connect-porting" to explicitly indicate the semantics of the message.  The JWE header MUST include a "sector_id" parameter, holding the host component (that is, a fully-qualified domain name) of the RP's "sector_identifier_uri" or "redirect_uri" <a href="#OpenID.Core">[OpenID.Core]</a> &#167; 8.1. "Pairwise Identifier Algorithm".</p>
<p id="rfc.section.4.p.9">The New OP MUST support "RSA-OAEP-256" for key encryption and MUST support "A256GCM" for content encryption <a href="#RFC7518">[RFC7518]</a>.</p>
<p id="rfc.section.4.p.10">Below is a sample JWE, using keys and tokens from previous sections (with line-breaks just for display purposes only):</p>
<p id="rfc.section.4.p.11">JWE protected header:</p>
<pre>{
        "typ": "openid-connect-porting",
        "alg": "RSA-OAEP-256",
        "enc": "A256GCM",
        "kid": "oldop43",
  "sector_id": "rp.example.org"
}</pre>
<p id="rfc.section.4.p.12">Randomly choose a 256-bit AES content encryption key (CEK) and 96-bit GCM nonce (iv); shown in base64url:</p>
<pre>
          cek: t7gDQpQvlLTYc_1KDgRw-iuUr-AvlBYsNM79zR1LP1g
           iv: 48V1_ALb6US04U3b
</pre>
<p id="rfc.section.4.p.13">Encrypt the CEK with the Old OP's RSA public encryption key:</p>
<pre>
encrypted_key:
  GqwEk3osLFgnGmh6UJsuNUI134QVYKmhtXqfdszQBl70o8-pQLK5eZbun0vFmWhd
  h7VDEUzX3Lxce6CzV80wEH57T-6LlJOjsCTOWmc_I8HUbPfGW4JjxBYv9Woab3Sv
  apSDRne7qJ-ykN_MRYAUVASF5kRGBKLBU6ip3XIagHy0k6M0QnpMhwHdp82AKZl9
  mSc2qwaB7Bhm3zjsPXCklyUUI5ojfEv9jFxYz6IzlMC3a5zObEGHRCIo2Xt21-GQ
  KMBG3fiTd-59GXUupg_aZXECqWcyhSxxMzYMDl8cgrrJXdNMxcuPIywlnR4-JqKz
  9dWVMQNmTdnJ8IqLMjqAwg
</pre>
<p id="rfc.section.4.p.14">The payload is the "port_token" value from the previous section. The additional authenticated data (AAD) is the base64url-encoding of the JWE protected header.</p>
<pre>
    plaintext: 3O9YHawMDXLpKb-FVjQ1_qSS9R9wbwb0TWbUxLvqAAI
          aad: 
  eyJ0eXAiOiJvcGVuaWQtY29ubmVjdC1wb3J0aW5nIiwiYWxnIjoiUlNBLU9BRVAt
  MjU2IiwiZW5jIjoiQTI1NkdDTSIsImtpZCI6Im9sZG9wNDMiLCJzZWN0b3JfaWQi
  OiJycC5leGFtcGxlLm9yZyJ9
</pre>
<p id="rfc.section.4.p.15">Applying AES-GCM encryption gives ciphertext and an authentication tag:</p>
<pre>
    ciphertext:
  IPvR7VRL9tjxZrWMul3v94G4xiyEadCi-nubi0Xg74WIiN4BNbhO58JuuA
           tag: 5JijJVt4bRz7q2C950WH7w
</pre>
<p id="rfc.section.4.p.16">Putting it all together (with eliding and line breaks only for display):</p>
<pre>
"enc_port_token": "eyJ0eX &#8230; 9yZyJ9
                   .GqwEk3 &#8230; MjqAwg
                   .48V1_ALb6US04U3b
                   .IPvR7V &#8230; 58JuuA
                   .5JijJVt4bRz7q2C950WH7w"
</pre>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#aka" id="aka">Indicating a previous identity: "aka" member</a></h1>
<p id="rfc.section.5.p.1">This document defines the "aka" (also known as) member that indicates that the given user has (or had) another identifier from an Old OP.  An "aka" member can be included in an id_token (issued as part of an OpenID Connect login), or in a Porting check API response [<a href="#port_check">Section 6</a>].</p>
<p id="rfc.section.5.p.2">An "aka" value is a JSON object with "enc_port_token" and "iss" members, both with string values. "iss" identifies the Old OP.  "enc_port_token" can be used at the Old OP's Porting check API [<a href="#port_check">Section 6</a>] to confirm the port and obtain the Old OP's "sub" value for the user.</p>
<p id="rfc.section.5.p.3">An "enc_port_token" value is opaque to an RP who receives it: they simply copy it from the "aka" member to an API parameter.  The OP sending an "enc_port_token" MUST construct its value by encrypting a port token as per <a href="#enc">Section 4</a>.</p>
<p id="rfc.section.5.p.4">On receiving an id_token, an RP uses "iss" &amp; "sub" to lookup the user's account in the RP's systems. If no such account is found, but the id_token contains an "aka" member, then the RP MUST process the "aka" value to determine if the RP knows the user via federation from an Old OP. Processing involves: calling the Porting check API for the Old OP with the given "enc_port_token"; looking for an existing account at the RP that matches the Old OP's "sub" value; and linking that account to the New OP's "sub" value.</p>
<p id="rfc.section.5.p.5">Below is a sample payload of an id_token.</p>
<pre>{
  "iss": "https://newop.example.net/",
  "sub": "JRrr09BzhZ6BJ9t0yD8DzyZjg7ziB3a40jeoUvZkUgw",
  "aud": "s6BhdRkqt3"
  "iat": 1471238000
  "exp": 1471238300,
  "at_hash": "mrxuWF8TvnILKqFpZgEYCQ",
  "aka": {
    "iss": "https://oldop.example.net/",
    "enc_port_token": "eyJ0eX &#8230; 50WH7w"
  }
}</pre>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#port_check" id="port_check">Porting check API</a></h1>
<p id="rfc.section.6.p.1">The Porting check API is offered by an Old OP to RPs so they can confirm that a user did port to a specific New OP. The API converts an "enc_port_token" to a Subject Id ("sub" value), which the RP needs to identify the ported user's existing account at the RP.</p>
<p id="rfc.section.6.p.2">Access to the Porting check API requires authentication of the RP.  This enables the Old OP to match the caller of the API to uses of the OpenID Connect authentication process so it can apply any RP-specific policy.  The Old OP and RP MUST support the OAuth 2.0 client credentials flow <a href="#RFC6749">[RFC6749]</a> and Bearer access tokens <a href="#RFC6750">[RFC6750]</a>.  The RP MUST include the scope "port_check" when requesting access.</p>
<p id="rfc.section.6.p.3">An RP makes a "GET" request to the API endpoint (from the "port_check_endpoint" member in the Old OP discovery metadata), adding query parameters identifying the New OP ("iss") and a porting event ("enc_port_token"). A successful response (eg with a status code of 200) conveys a JSON object that can have "sub", "aka", and "remove" members.  A successful response means the user associated with "enc_port_token" has ported from the Old OP to the given New OP. Otherwise an unsuccessful HTTP response status code MUST be returned (eg 400 Bad request).</p>
<p id="rfc.section.6.p.4">The Old OP makes the following checks:</p>
<p/>

<ul>
  <li>MUST decrypt the "enc_port_token", which MUST include verifying that it uses acceptable algorithms (for instance, "alg" and "enc" values are not "none").</li>
  <li>MUST verify that the JWE "typ" member is present with the value "openid-connect-porting", to avoid misinterpretting the meaning of the JWE.</li>
  <li>MUST verify that the "port_token" (the plaintext from the JWE) was issued by the Old OP.</li>
  <li>MUST verify that the "iss" query parameter matches the New OP to whom the port_token was given. This confirms that the RP and Old OP have the same understanding of who the New OP is.</li>
  <li>SHOULD verify that the "sector_id" from the JWE header matches the sector_id for the RP or matches the domain name portion of the RP's redirect_uri.</li>
</ul>
<p id="rfc.section.6.p.6">A successful response is a JSON object that can include the following members (any unrecognized members MUST be ignored):</p>
<p/>

<dl>
  <dt>"sub"</dt>
  <dd style="margin-left: 8">Old OP's Subject Id for the ported user for the RP, as a string.  This member MAY be absent if the Old OP knows the user never logged in to this RP.</dd>
  <dt>"aka"</dt>
  <dd style="margin-left: 8">Another identifier for the same user, with the same syntax and semantics as when it appears in an id_token [<a href="#aka">Section 5</a>].  It indicates that the user ported to the Old OP from an even older OP.</dd>
  <dt>"remove"</dt>
  <dd style="margin-left: 8">A boolean value (false or true) indicating whether or not the RP can expect future logins from the user via the Old OP.</dd>
</dl>
<p id="rfc.section.6.p.8">When the RP does not recognize the "sub" value (in combination with the Old OP's "iss" value), the RP SHOULD process the "aka" value if present as per <a href="#aka">Section 5</a> to determine if the RP knows the user via a login from the even older OP. An RP MUST NOT recursively follow "aka" values indefinitely; a limit of a few recursions is likely to be sufficient for valid use cases.</p>
<p id="rfc.section.6.p.9">"remove": true &#8212; means the RP MUST no longer accept a login from the Old OP with the given "sub" as valid for this user's account at the RP.  Future logins will be via the New OP.</p>
<p id="rfc.section.6.p.10">"remove": false &#8212; means the RP can expect and SHOULD continue to accept logins to this account via the Old OP, in addition to logins via the New OP. It indicates that logins from the Old OP and New OP are linked to the same user, but not that one is being replaced by the other.</p>
<p id="rfc.section.6.p.11">The Old OP MUST include the "remove" member when "sub" is present.</p>
<p id="rfc.section.6.p.12">Below is a sample request with a successful response. [The long request line is wrapped over 4 lines just for display purposes.] The RP would lookup "sub=kY6N6&#8230;" &amp; "iss=https://oldop&#8230;" in its user database to find the existing account that has ported to the New OP.</p>
<pre>
GET /connect/port_check
  ?iss=https://newop.example.net/
  &amp;enc_port_token=eyJ0eX &#8230; 50WH7w
   HTTP/1.1
Host: oldop.example.net
Authorization: Bearer JOpIXW60qfjKQOlQ8trLBTSzwDl8zGgujLxBVTvWMG8
</pre>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
     "sub": "kY6N64H86MBTho9I-JlRnpvaLOwAb5m3yYta6pq1VFM",
  "remove": true
}
</pre>
<p id="rfc.section.6.p.13">Below is a sample response that identifies a previous port. If the RP did not recognize "sub=kY6N6&#8230;" &amp; "iss=https://oldop&#8230;" it can process the "aka" value to see if that leads back to an account known to the RP.</p>
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
     "sub": "kY6N64H86MBTho9I-JlRnpvaLOwAb5m3yYta6pq1VFM",
  "remove": false,
     "aka": {
               "iss": "https://anotherop.example.net/",
    "enc_port_token": "QSfmp2V30cNqKShhyOjQEwDaQzLNhji5w5nD-EZq3ok"
  }
}
</pre>
<p id="rfc.section.6.p.14">Below is a sample unsuccessful response (which happens to use the Problem Details format specified in <a href="#RFC7807">[RFC7807]</a>).</p>
<pre>
HTTP/1.1 400 Bad request
Content-Type: application/problem+json

{
   "type": "https://oldop.example.net/probs/porting_rp",
  "title": "Port_token presented by the wrong RP"
}
</pre>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#err" id="err">"user_ported" error code</a></h1>
<p id="rfc.section.7.p.1">An Old OP MAY return the "user_ported" error code from the authorization endpoint during an OpenID Connect login flow when the user has ported to a New OP. An RP receiving this error code SHOULD remove any cached hints linking the user to the Old OP (eg a cookie), and SHOULD perform its OP discovery process (for instance, by prompting the user to select an OP, invoking a discovery service, or triggering an account chooser).</p>
<p id="rfc.section.7.p.2">The New OP to whom the user ported is not identified in the error response for privacy reasons. It avoids revealing this information before the Old OP has authenticated the RP, and confirmed the user has logged into the RP via the New OP.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.8.p.1">Attacker's goal: get access to the victim's RP accounts either by taking over the respective OP or RP account.  This section analyses the protocol flow along the lines of the migration process for threat vectors. Note: this list is a starting point and not meant to be comprehensive (yet).</p>
<h1 id="rfc.section.8.1"><a href="#rfc.section.8.1">8.1.</a> Impersonation of legitimate user's old OP account</h1>
<p id="rfc.section.8.1.p.1">If the attacker can get hold of the authorization grant issued by the old OP for access to the account migration API, the attacker can impersonate the legitimate user in the migration process at the new OP.  </p>
<p/>

<ul>
  <li>Prevent leakage of authorization grant at old OP (mix up, referrer header, log files, ...)</li>
  <li>Prevent injection at new OP (TBD - state, id_token, nonce, pkce, token binding, ...)</li>
  <li>Audience/purpose restrict access tokens on old OP side, in order to strictly limit access tokens, which can be used for account migration. Combined with a strict limitation (whitelisting) of all clients, which are allowed to request access tokens for account migration shall reduce attack surface.</li>
  <li>idea: use migration specific credential, which is directly entered during migration process at new OP (in turn potentially imposes the risk of men in the middle/phishing)</li>
  <li>old OP should notify user of account migration process via different communication channel.</li>
</ul>
<h1 id="rfc.section.8.2"><a href="#rfc.section.8.2">8.2.</a> Trick user into login with attacker's account</h1>
<p id="rfc.section.8.2.p.1">The attacker could try to cause the legitimate user to login with her new OP with the attacker's account with this new OP. That would cause the new OP to associate the migration data with the attackers account, which in turn allows the attacker to migrate all RP accounts of the legitimate user to his account with the new OP.  </p>
<p/>

<ul>
  <li>Prevent XSRF, session fixation</li>
  <li>Explicitly show user identity data of both user accounts, which she is about to tie together and ask for consent.</li>
  <li>Send information back to old OP about new OP identity? It could inform user of the migration, which just happened (too).</li>
</ul>
<h1 id="rfc.section.8.3"><a href="#rfc.section.8.3">8.3.</a> Impersonate old OP/replay migration data</h1>
<p id="rfc.section.8.3.p.1">If the attacker gets hold of valid migration data of an account at OP1 and "migrates" the account data to his account with OP1. Scenario: The attacker logs into the new OP with her OP account and sends the new OP to the OP under her control. This OP returns migration data obtained from a legitimate OP in a previous step.  </p>
<p/>

<ul>
  <li>audience restriction: verify subject of migration data (migrated_to must be iss of new OP)</li>
  <li>detection: use discovery to match account migration endpoint to endpoint of legitimate OP</li>
</ul>
<h1 id="rfc.section.8.4"><a href="#rfc.section.8.4">8.4.</a> Bad OP</h1>
<p id="rfc.section.8.4.p.1">Attacker could try to trick victim into (unintentionally) migration her OP account to a OP under the attacker's control </p>
<p/>

<ul>
  <li>white listing or blacklisting of OPs for which account migration is supported</li>
  <li>clear wording and consent during release of the account migration authorization grant.</li>
  <li>no SSO and no auto consent: require re-authentication and explicit consent + specific migration credential (just to make the process less convenient and make the victim think about what she is up to.).</li>
  <li>old OP should notify user of account migration process via different communication channel.</li>
</ul>
<h1 id="rfc.section.8.5"><a href="#rfc.section.8.5">8.5.</a> Inject migration data during RP account migration</h1>
<p id="rfc.section.8.5.p.1">Attacker gets hold of valid migration data and injects it into the login response. This would only work for implicit grant, not for grant type code.  </p>
<p/>

<ul>
  <li>use grant type code</li>
  <li>migration data is included in ID Token, so it is signed by the new OP and cannot be modfied by the attacker.</li>
</ul>
<h1 id="rfc.section.8.6"><a href="#rfc.section.8.6">8.6.</a> Further Considerations</h1>
<p id="rfc.section.8.6.p.1">Note: the new OP could also accidentally assign the account migration data to the wrong user account in its database. Care must be taken that the respective functions are thoroughly tested with every change.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#privacy" id="privacy">Privacy Considerations</a></h1>
<p id="rfc.section.9.p.1">A user's OP can see which RPs the user logs in to, and when.  That is the nature of the OpenID Connect federated login protocol.  By porting, a user moves that visibility from the Old OP to the New OP.</p>
<p id="rfc.section.9.p.2">After porting, the Old OP can still see when the user next logs in to each RP, as each RP will contact the Old OP at that time to confirm the port.  This is true even for an RP that the user never accessed via the Old OP, as the RP does not know that this is the case before trying to confirm the port with the Old OP. Subsequent logins to an RP will not be visible to the Old OP.</p>
<p id="rfc.section.9.p.3">The New OP learn nothing about a user's activity before the port.  For instance, an RP accessed via the Old OP but not accessed after porting will not be revealed to the New OP.</p>
<p id="rfc.section.9.p.4">RPs see which Old OP a user has used, which is necessary for continuity of access after porting. Even an RP that a user never accessed before the port learns about the user's Old OP.  An RP that is not accessed after porting does not learn of the port.</p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<p id="rfc.section.10.p.1">This document registers the "aka" claim in the IANA "JSON Web Token Claims" registry <a href="#IANA.JWT_Claims">[IANA.JWT_Claims]</a>.</p>
<p/>

<ul>
  <li>Claim Name: "aka"</li>
  <li>Claim Description: Also Known As</li>
  <li>Change Controller: OpenID Foundation MODRNA working group &lt;https://openid.net/wg/mobile/&gt;</li>
  <li>Specification Document(s): <a href="#aka">Section 5</a> of [[ this specification ]]</li>
</ul>
<p id="rfc.section.10.p.3">This document registers the "sector_id" claim in the IANA "JSON Web Signature and Encryption Header Parameters" registry <a href="#IANA.JOSE">[IANA.JOSE]</a>.</p>
<p/>

<ul>
  <li>Header Parameter Name: "sector_id"</li>
  <li>Header Parameter Description: Sector identifier for a group of websites under common administrative control</li>
  <li>Header Parameter Usage Location: JWE</li>
  <li>Change Controller: OpenID Foundation MODRNA working group &lt;https://openid.net/wg/mobile/&gt;</li>
  <li>Specification Document(s): <a href="#enc">Section 4</a> of [[ this specification ]]</li>
</ul>
<p id="rfc.section.10.p.5">This document registers the "user_ported" error code in the IANA "OAuth Extensions Error Registry" <a href="#IANA.OAUTH">[IANA.OAUTH]</a>.</p>
<p/>

<ul>
  <li>Error name: "user_ported"</li>
  <li>Error usage location: authorization endpoint</li>
  <li>Related protocol extension: </li>
  <li>Change controller: OpenID Foundation</li>
  <li>Specification document: <a href="#err">Section 7</a> of [[ this specification ]]</li>
</ul>
<p id="rfc.section.10.p.7">This document registers the "application/openid-connect-porting" media type in the IANA "Media Types" registry <a href="#IANA.MEDIA">[IANA.MEDIA]</a>.  It identifies a JSON Web Encryption (JWE) compact serialization that is the encryption of a port token.</p>
<p/>

<ul>
  <li>Type name: application</li>
  <li>Subtype name: openid-connect-porting</li>
  <li>Required parameters: N/A</li>
  <li>Optional parameters: N/A</li>
  <li>Encoding considerations: 7bit</li>
  <li>Security considerations: see <a href="#RFC7516">[RFC7516]</a></li>
  <li>Interoperability considerations: N/A</li>
  <li>Published specification: <a href="#enc">Section 4</a> of [[ this specification ]]</li>
  <li>Applications that use this media type: OpenID Connect</li>
  <li>Fragment identifier considerations: N/A</li>
  <li>Additional information: N/A</li>
  <li>Intended usage: COMMON</li>
  <li>Restrictions on usage: N/A</li>
  <li>Change controller: OpenID Foundation</li>
</ul>
<h1 id="rfc.references"><a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="OpenID.Core">[OpenID.Core]</b>
      </td>
      <td class="top"><a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a>, <a title="Google">de Medeiros, B.</a> and <a title="Salesforce">C. Mortimore</a>, "<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a>", November 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OpenID.Discovery">[OpenID.Discovery]</b>
      </td>
      <td class="top"><a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a> and <a title="Illumila">E. Jay</a>, "<a href="http://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a>", November 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="IANA.JWT_Claims">[IANA.JWT_Claims]</b>
      </td>
      <td class="top"><a>IANA</a>, "<a href="https://www.iana.org/assignments/jwt/">JSON Web Token Claims</a>", January 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="IANA.JOSE">[IANA.JOSE]</b>
      </td>
      <td class="top"><a>IANA</a>, "<a href="https://www.iana.org/assignments/jose/">JSON Object Signing and Encryption (JOSE)</a>", January 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="IANA.OAUTH">[IANA.OAUTH]</b>
      </td>
      <td class="top"><a>IANA</a>, "<a href="http://www.iana.org/assignments/oauth-parameters/#extensions-error">OAuth Parameters</a>", July 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="IANA.MEDIA">[IANA.MEDIA]</b>
      </td>
      <td class="top"><a>IANA</a>, "<a href="http://www.iana.org/assignments/media-types/">Media Types</a>", November 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7234">[RFC7234]</b>
      </td>
      <td class="top"><a>Fielding, R.</a>, <a>Nottingham, M.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a>", RFC 7234, DOI 10.17487/RFC7234, June 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7516">[RFC7516]</b>
      </td>
      <td class="top"><a>Jones, M.</a> and <a>J. Hildebrand</a>, "<a href="http://tools.ietf.org/html/rfc7516">JSON Web Encryption (JWE)</a>", RFC 7516, DOI 10.17487/RFC7516, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7517">[RFC7517]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, "<a href="http://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a>", RFC 7517, DOI 10.17487/RFC7517, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7518">[RFC7518]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, "<a href="http://tools.ietf.org/html/rfc7518">JSON Web Algorithms (JWA)</a>", RFC 7518, DOI 10.17487/RFC7518, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6749">[RFC6749]</b>
      </td>
      <td class="top"><a>Hardt, D.</a>, "<a href="http://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6750">[RFC6750]</b>
      </td>
      <td class="top"><a>Jones, M.</a> and <a>D. Hardt</a>, "<a href="http://tools.ietf.org/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>", RFC 6750, DOI 10.17487/RFC6750, October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="MobileConnect">[MobileConnect]</b>
      </td>
      <td class="top"><a>GSMA</a>, "<a href="https://mobileconnect.io/">Mobile Connect</a>", January 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7807">[RFC7807]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a> and <a>E. Wilde</a>, "<a href="http://tools.ietf.org/html/rfc7807">Problem Details for HTTP APIs</a>", RFC 7807, DOI 10.17487/RFC7807, March 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#example" id="example">Example flow</a></h1>
<p id="rfc.section.A.p.1">This example involves a user (Alice), an RP, and 3 OPs (OP1, OP2, and OP3).  Alice originally federated to the RP via OP1; ported to OP2; then (shortly afterwards) ported to OP3. When Alice logs in to RP via OP3 for the first time she is not recognized directly from OP3's id_token. But by following the "aka" trail, the RP automatically establishes the link to an id from OP1 that the RP recognizes as Alice.</p>
<p id="rfc.section.A.p.2">Many details are elided. Dotted arrows represent HTTP redirects.</p>
<pre>
<img src="openid-connect-account-porting-1_0-07.eg.png"/>
</pre>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#ack" id="ack">Acknowledgements</a></h1>
<p id="rfc.section.B.p.1">The following people in particular have contributed to the development of this specification: J&#246;rg Connotte; John Bradley; Axel Nennker.</p>
<h1 id="rfc.appendix.C"><a href="#rfc.appendix.C">Appendix C.</a> <a href="#notices" id="notices">Notices</a></h1>
<p id="rfc.section.C.p.1">Copyright (c) 2017 The OpenID Foundation.</p>
<p id="rfc.section.C.p.2">The OpenID Foundation (OIDF) grants to any Contributor, developer, implementer, or other interested party a non-exclusive, royalty free, worldwide copyright license to reproduce, prepare derivative works from, distribute, perform and display, this Implementers Draft or Final Specification solely for the purposes of (i) developing specifications, and (ii) implementing Implementers Drafts and Final Specifications based on such documents, provided that attribution be made to the OIDF as the source of the material, but that such attribution does not indicate an endorsement by the OIDF.</p>
<p id="rfc.section.C.p.3">The technology described in this specification was made available from contributions from various sources, including members of the OpenID Foundation and others. Although the OpenID Foundation has taken steps to help ensure that the technology is available for distribution, it takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this specification or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any independent effort to identify any such rights. The OpenID Foundation and the contributors to this specification make no (and hereby expressly disclaim any) warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to this specification, and the entire risk as to implementing this specification is assumed by the implementer. The OpenID Intellectual Property Rights policy requires contributors to offer a patent promise not to assert certain patent claims against other contributors and against implementers. The OpenID Foundation invites any interested party to bring to its attention any copyrights, patents, patent applications, or other proprietary rights that may cover technology that may be required to practice this specification.</p>
<h1 id="rfc.appendix.D"><a href="#rfc.appendix.D">Appendix D.</a> <a href="#history" id="history">Document history</a></h1>
<p id="rfc.section.D.p.1">[[ To be removed from the final specification ]]</p>
<p id="rfc.section.D.p.2">-07</p>
<p/>

<ul>
  <li>Change co-author affilliation</li>
</ul>
<p id="rfc.section.D.p.4">-06</p>
<p/>

<ul>
  <li>Privacy considerations</li>
  <li>Example values</li>
</ul>
<p id="rfc.section.D.p.6">-05</p>
<p/>

<ul>
  <li>Public key encryption of the port_token</li>
  <li>Mandate RSA-OAEP-256 and AES256GCM</li>
</ul>
<p id="rfc.section.D.p.8">-04</p>
<p/>

<ul>
  <li>Clarify and reorganize</li>
</ul>
<p id="rfc.section.D.p.10">-03</p>
<p/>

<ul>
  <li>Overview of porting flow</li>
  <li>"remove":true/false signal from Old OP to RP</li>
  <li>user_ported error code</li>
  <li>"oidc_porting" renamed to "openid-connect-porting"</li>
</ul>
<p id="rfc.section.D.p.12">-02</p>
<p/>

<ul>
  <li>Remove unencrypted port tokens</li>
  <li>Authenticate RPs to Old OP</li>
</ul>
<p id="rfc.section.D.p.14">-01</p>
<p/>

<ul>
  <li>Single port_token from Old OP to New OP</li>
  <li>Encrypted port_token from New OP to RP</li>
  <li>Torsten and Arne as additional authors</li>
</ul>
<p id="rfc.section.D.p.16">-00</p>
<p/>

<ul>
  <li>Initial draft</li>
  <li>Proposed as an alternative approach to draft-account-migration-02</li>
</ul>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">James Manger</span> 
	  <span class="n hidden">
		<span class="family-name">Manger</span>
	  </span>
	</span>
	<span class="org vcardline">Telstra</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:james.h.manger@team.telstra.com">james.h.manger@team.telstra.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Torsten Lodderstedt</span> 
	  <span class="n hidden">
		<span class="family-name">Lodderstedt</span>
	  </span>
	</span>
	<span class="org vcardline">YES Europe AG</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:torsten@yes.de">torsten@yes.de</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Arne Georg Gleditsch</span> 
	  <span class="n hidden">
		<span class="family-name">Gleditsch</span>
	  </span>
	</span>
	<span class="org vcardline">Telenor</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:argggh@telenordigital.com">argggh@telenordigital.com</a></span>

  </address>
</div>

</body>
</html>
