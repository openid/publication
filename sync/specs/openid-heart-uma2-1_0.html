<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Health Relationship Trust Profile for User-Managed Access 2.0</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Notation and Conventions">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Conformance">
<link href="#rfc.section.2" rel="Chapter" title="2 Client Profile">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Connection with Authorization Servers">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Connection with Protected Resources">
<link href="#rfc.section.3" rel="Chapter" title="3 Authorization Server Profile">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Connection with Clients">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Discovery">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Claims Gathering">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Connection with Protected Resources">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Tokens">
<link href="#rfc.section.3.3.1" rel="Chapter" title="3.3.1 Protection API Access Token (PAT)">
<link href="#rfc.section.3.3.2" rel="Chapter" title="3.3.2 Requesting Party Token (RPT)">
<link href="#rfc.section.3.3.3" rel="Chapter" title="3.3.3 Persisted Claims Token (PCT)">
<link href="#rfc.section.3.3.4" rel="Chapter" title="3.3.4 Token Lifetimes">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Component Registration">
<link href="#rfc.section.4" rel="Chapter" title="4 Resource Server Profile">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Connection with Authorization Servers">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Resource Authentication">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Connection with Clients">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Privacy Considerations">
<link href="#rfc.references" rel="Chapter" title="7 Normative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements">
<link href="#rfc.appendix.B" rel="Chapter" title="B Notices">
<link href="#rfc.appendix.C" rel="Chapter" title="C Document History">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.16.3 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Richer, J., Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:openid-heart-uma-2_0" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-07-08" />
  <meta name="dct.abstract" content="The User-Managed Access (UMA) 2.0 protocol defines a method for an end user to introduce a resource to an authorization server, define a set of policies governing access to that resource, and for a requesting party to provide claims to fulfill those policies in order to gain access to the resource.This specification profiles the UMA protocol to increase baseline security, provide greater interoperability, and structure deployments in a manner specifically applicable to (but not limited to) the healthcare domain." />
  <meta name="description" content="The User-Managed Access (UMA) 2.0 protocol defines a method for an end user to introduce a resource to an authorization server, define a set of policies governing access to that resource, and for a requesting party to provide claims to fulfill those policies in order to gain access to the resource.This specification profiles the UMA protocol to increase baseline security, provide greater interoperability, and structure deployments in a manner specifically applicable to (but not limited to) the healthcare domain." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left"></td>
<td class="right">J. Richer, Ed.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 8, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Health Relationship Trust Profile for User-Managed Access 2.0<br />
  <span class="filename">openid-heart-uma-2_0</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The User-Managed Access (UMA) 2.0 protocol defines a method for an end user to introduce a resource to an authorization server, define a set of policies governing access to that resource, and for a requesting party to provide claims to fulfill those policies in order to gain access to the resource.</p>
<p>This specification profiles the UMA protocol to increase baseline security, provide greater interoperability, and structure deployments in a manner specifically applicable to (but not limited to) the healthcare domain.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Requirements Notation and Conventions</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Conformance</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Client Profile</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Connection with Authorization Servers</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Connection with Protected Resources</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Authorization Server Profile</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Connection with Clients</a>
</li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Discovery</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Claims Gathering</a>
</li>
</ul><li>3.2.   <a href="#rfc.section.3.2">Connection with Protected Resources</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Tokens</a>
</li>
<ul><li>3.3.1.   <a href="#rfc.section.3.3.1">Protection API Access Token (PAT)</a>
</li>
<li>3.3.2.   <a href="#rfc.section.3.3.2">Requesting Party Token (RPT)</a>
</li>
<li>3.3.3.   <a href="#rfc.section.3.3.3">Persisted Claims Token (PCT)</a>
</li>
<li>3.3.4.   <a href="#rfc.section.3.3.4">Token Lifetimes</a>
</li>
</ul><li>3.4.   <a href="#rfc.section.3.4">Component Registration</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Resource Server Profile</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Connection with Authorization Servers</a>
</li>
<ul><li>4.1.1.   <a href="#rfc.section.4.1.1">Resource Authentication</a>
</li>
</ul><li>4.2.   <a href="#rfc.section.4.2">Connection with Clients</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Privacy Considerations</a>
</li>
<li>7.   <a href="#rfc.references">Normative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">Notices</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.C">Document History</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This document profiles the <a href="#UMA2" class="xref">User-Managed Access 2.0</a> specification for use in the context of securing web-facing application programming interfaces (APIs), particularly Representational State Transfer (RESTful) APIs, in potentially multi-party cross-domain scenarios. Because User-Managed Access is built on OAuth 2.0 and OpenID Connect 1.0, this profile inherits all requirements of the HEART profiles for the use of <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> and <a href="#HEART.OIDC" class="xref">OpenID Connect 1.0</a> where applicable.  All requirements herein are in addition to the OAuth 2.0 and OpenID Connect 1.0 profiles where appropriate. The requirements in this document serve two purposes:</p>
<p></p>

<ol>
<li>Define a mandatory baseline set of security controls suitable for a wide range of use cases, while maintaining reasonable ease of implementation and functionality</li>
<li>Identify optional advanced security controls for sensitive use cases where heightened risks justify more stringent controls that increase the required implementation effort and may reduce or restrict functionality</li>
</ol>
<p id="rfc.section.1.p.3">This UMA profile is intended to be shared broadly, and ideally to influence OAuth implementations in other domains besides health care.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#rnc" id="rnc">Requirements Notation and Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">RFC 2119</a>.</p>
<p id="rfc.section.1.1.p.2">All uses of <a href="#RFC7515" class="xref">JSON Web Signature (JWS)</a> and <a href="#RFC7516" class="xref">JSON Web Encryption (JWE)</a> data structures in this specification utilize the JWS Compact Serialization or the JWE Compact Serialization; the JWS JSON Serialization and the JWE JSON Serialization are not used.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#Terminology" id="Terminology">Terminology</a>
</h1>
<p id="rfc.section.1.2.p.1">This specification uses the terms "Access Token", "Authorization Code", "Authorization Endpoint", "Authorization Grant", "Authorization Server", "Client", "Client Authentication", "Client Identifier", "Client Secret", "Grant Type", "Protected Resource", "Redirection URI", "Refresh Token", "Resource Owner", "Resource Server", "Response Type", and "Token Endpoint" defined by <a href="#RFC6749" class="xref">OAuth 2.0</a>, the terms "Claim Name", "Claim Value", and "JSON Web Token (JWT)" defined by <a href="#RFC7519" class="xref">JSON Web Token (JWT)</a>, the terms defined by <a href="#OpenID.Core" class="xref">OpenID Connect Core 1.0</a>, and the terms defined by <a href="#UMA2" class="xref">UMA</a>.</p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Conformance</h1>
<p id="rfc.section.1.3.p.1">This specification defines requirements for the following components:</p>
<p></p>

<ul>
<li>UMA 2.0 client</li>
<li>UMA 2.0 authorization server</li>
<li>UMA 2.0 resource server</li>
</ul>
<p id="rfc.section.1.3.p.3">The specification also defines features for interaction between these components:</p>
<p></p>

<ul>
<li>Client to authorization server</li>
<li>Protected resource to authorization server</li>
</ul>
<p id="rfc.section.1.3.p.5">When a HEART-compliant component is interacting with other HEART-compliant components, in any valid combination, all components MUST fully conform to the features and requirements of this specification. All interaction with non-HEART components is outside the scope of this specification.</p>
<p id="rfc.section.1.3.p.6">A HEART-compliant UMA authorization server MUST support all features as described in this specification. A general-purpose authorization server MAY support additional features for use with non-HEART clients and protected resources.</p>
<p id="rfc.section.1.3.p.7">All OAuth 2.0 functionality used to implement the UMA protocol MUST conform to the OAuth 2.0 HEART profile.</p>
<p id="rfc.section.1.3.p.8">A HEART-compliant UMA authorization server MAY also provide HEART-compliant OAuth 2.0 authorization server functionality. In such cases, the authorization server MUST fully implement the OAuth 2.0 HEART profile.</p>
<p id="rfc.section.1.3.p.9">A HEART-compliant UMA client MUST use all functions as described in this specification. A general-purpose client library MAY support additional features for use with non-HEART authorization servers and protected resources.</p>
<p id="rfc.section.1.3.p.10">A HEART-compliant UMA resource server MUST use all functions as described in this specification. A general-purpose resource server library MAY support additional features for use with non-HEART authorization servers and clients.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Client Profile</h1>
<p></p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Connection with Authorization Servers</h1>
<p id="rfc.section.2.1.p.1">All clients MUST authenticate to the token endpoint using a private key as described in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile section 2.2.2.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Connection with Protected Resources</h1>
<p id="rfc.section.2.2.p.1">Clients MUST present the RPT as an OAuth 2.0 bearer token as described in <a href="#RFC6750" class="xref">[RFC6750]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Authorization Server Profile</h1>
<p></p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Connection with Clients</h1>
<p></p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#Discovery" id="Discovery">Discovery</a>
</h1>
<p id="rfc.section.3.1.1.p.1">The authorization server MUST implement the UMA discovery mechanism defined in <a href="#UMA2" class="xref">UMA</a> as well as the discovery mechanisms described in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile.</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> Claims Gathering</h1>
<p id="rfc.section.3.1.2.p.1">The authorization server MUST support claims being presented in at least two methods:</p>
<p></p>

<ul>
<li>by redirecting the requesting party to a web page where they can log in to the authorization server using <a href="#HEART.OIDC" class="xref">OpenID Connect</a>
</li>
<li>directly by the client in the form of an OpenID Connect ID Token</li>
</ul>
<p id="rfc.section.3.1.2.p.3">When the ID token is presented directly to the RPT endpoint, the authorization server MUST validate the token, including its audience and signature. Since the audience of an ID token is the client's identifier with the IdP, and this client identifier is known only to the client and the IdP, this restriction effectively means that ID tokens can only be presented at the RPT endpoint in the special case when the authorization server is also the IdP or there is another closely bound relationship between the AS and IdP.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Connection with Protected Resources</h1>
<p id="rfc.section.3.2.p.1">The UMA authorization server MUST implement <a href="#UMA2.Authz" class="xref">UMA 2.0 Federated Authorization</a> to allow for dynamic association with protected resources at runtime. The UMA authorization server MUST implement <a href="#RFC7591" class="xref">OAuth 2.0 Dynamic Client Registration</a> to allow protected resources to register at runtime with the AS.</p>
<p id="rfc.section.3.2.p.2">Since UMA protected resources will act as OAuth clients during parts of the process, all requirements for interaction between OAuth authorization servers and OAuth clients in the <a href="#HEART.OAuth2" class="xref">HEART OAuth 2.0 profile</a> apply to these as well.</p>
<p id="rfc.section.3.2.p.3">The authorization server MUST make its <a href="#RFC7662" class="xref">introspection endpoint</a> accessible to the protected resource by use of the PAT.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#Tokens" id="Tokens">Tokens</a>
</h1>
<p id="rfc.section.3.3.p.1">All issued access tokens (whether PAT or RPT) MUST be <a href="#RFC7519" class="xref">JSON Web Tokens (JWTs)</a> signed with <a href="#RFC7515" class="xref">JSON Web Signatures (JWS)</a> using the authorization server's key as described in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile section 4.2.</p>
<p id="rfc.section.3.3.p.2">PATs MUST be issued using a standard OAuth 2.0 token flow appropriate to the type of application described in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile. As protected resources are web services, they MUST behave as either a full client with user delegation or a direct access client depending on whether they protect individual or bulk resources, respectively.</p>
<h1 id="rfc.section.3.3.1">
<a href="#rfc.section.3.3.1">3.3.1.</a> Protection API Access Token (PAT)</h1>
<p id="rfc.section.3.3.1.p.1">The PAT MUST at minimum define the following fields inside the JWT and return them from the introspection endpoint. Other fields MAY also be defined.</p>

<dl>
<dt>iss</dt>
<dd style="margin-left: 8">The issuer URL of the authorization server.</dd>
<dt>aud</dt>
<dd style="margin-left: 8">An array containing the URL of the introspection endpoint and the URL of the resource set registration endpoint</dd>
<dt>sub</dt>
<dd style="margin-left: 8">The issuer-specific identifier of the user that authorized the PAT.</dd>
<dt>azp</dt>
<dd style="margin-left: 8">The client identifier of the protected resource.</dd>
</dl>
<h1 id="rfc.section.3.3.2">
<a href="#rfc.section.3.3.2">3.3.2.</a> Requesting Party Token (RPT)</h1>
<p id="rfc.section.3.3.2.p.1">The RPT MUST at minimum define the following fields inside the JWT and return them from the introspection endpoint. Other fields MAY also be defined.</p>
<p></p>

<dl>
<dt>iss</dt>
<dd style="margin-left: 8">The issuer URL of the authorization server.</dd>
<dt>aud</dt>
<dd style="margin-left: 8">An array of resource identifiers where this token can be used.</dd>
<dt>sub</dt>
<dd style="margin-left: 8">The issuer-specific identifier of the user that authorized the RPT (the resource owner).</dd>
<dt>azp</dt>
<dd style="margin-left: 8">The client identifier of the authorized client.</dd>
</dl>
<h1 id="rfc.section.3.3.3">
<a href="#rfc.section.3.3.3">3.3.3.</a> Persisted Claims Token (PCT)</h1>
<p id="rfc.section.3.3.3.p.1">The format and content of the PCT is undefined by this specification. PCTs are opaque to all parties in the system except the AS and are interpreted only internally. However, all PCTs:</p>
<p></p>

<ul>
<li>MUST be unguessable</li>
<li>MUST NOT contain any claim information</li>
<li>MUST represent a single RqP</li>
<li>MUST be associated with a single client</li>
</ul>
<h1 id="rfc.section.3.3.4">
<a href="#rfc.section.3.3.4">3.3.4.</a> Token Lifetimes</h1>
<p id="rfc.section.3.3.4.p.1">It is RECOMMENDED that PATs have a lifetimes as specified in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile section 4.3 depending on the nature of the client or protected resource they were issued to. Since the PAT is intended to be used for managing access to resources when the resource owner is no longer present, it SHOULD have a lifetime and lifecycle that allows that use pattern, such as the use of refresh tokens issued alongside the PAT.</p>
<p id="rfc.section.3.3.4.p.2">It is RECOMMENDED that RPTs follow a lifetime of an access token as specified in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile section 4.3 depending on the nature of the client.</p>
<p id="rfc.section.3.3.4.p.3">It is RECOMMENDED that PCTs follow a lifetime similar to that of a refresh token as specified in the <a href="#HEART.OAuth2" class="xref">HEART OAuth 2.0 profile</a> as they are intended to be used across multiple transactions.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> Component Registration</h1>
<p id="rfc.section.3.4.p.1">All UMA clients MUST register with the authorization server as OAuth clients, as described in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile. Since all UMA resource servers also act as OAuth clients, they MUST also register with the authorization server under the same requirements as regular OAuth clients.</p>
<p id="rfc.section.3.4.p.2">The authorization server MUST allow for <a href="#RFC7591" class="xref">dynamic client registration</a>. The authorization server MAY prohibit dynamically registered clients and resource sets from requesting specific scopes, as described in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile.</p>
<p id="rfc.section.3.4.p.3">The authorization server MUST indicate to end users that a client or protected resource was dynamically registered in the UI, such as on the policy editing screen presented to the resource owner.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Resource Server Profile</h1>
<p></p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Connection with Authorization Servers</h1>
<p id="rfc.section.4.1.p.1">Resource servers that allow resource owners to specify their own authorization server MUST be capable of using <a href="#RFC7033" class="xref">webfinger</a> to discover the authorization server's issuer URL.</p>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#ResAuth" id="ResAuth">Resource Authentication</a>
</h1>
<p id="rfc.section.4.1.1.p.1">Resource servers MUST authenticate to the token endpoint of the authorization server using a private key as described in the HEART <a href="#HEART.OAuth2" class="xref">OAuth 2.0</a> profile section 2.2.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Connection with Clients</h1>
<p id="rfc.section.4.2.p.1">Resource servers MUST allow connections from clients in an unauthorized state to start the discovery process. The Resource server MUST return the issuer URL of the authorization server as well as a permission ticket for the client to use.</p>
<p id="rfc.section.4.2.p.2">Resource servers MUST accept RPTs as an OAuth bearer token in the authorization header.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Security Considerations</h1>
<p id="rfc.section.5.p.1">All transactions MUST be protected in transit by TLS as described in <a href="#BCP195" class="xref">BCP195</a>.</p>
<p id="rfc.section.5.p.2">All clients MUST conform to applicable recommendations found in the Security Considerations sections of <a href="#RFC6749" class="xref">[RFC6749]</a> and those found in the <a href="#RFC6819" class="xref">OAuth 2.0 Threat Model and Security Considerations document</a>.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Privacy Considerations</h1>
<p id="rfc.section.6.p.1">When a client makes an unauthenticated call to a medical record protected by UMA, the resource server will respond back with an indicator of which authorization server protects that resource. If the operator of the client knows out-of-band that a particular user owns or controls a given authorization server, such disclosure could inadvertently leak information about the patient without divulging the medical record itself.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="BCP195">[BCP195]</b></td>
<td class="top">
<a>Sheffer, Y.</a>, <a>Holz, R.</a> and <a>P. Saint-Andre</a>, "<a href="https://tools.ietf.org/html/rfc7525">Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)</a>", BCP 195, RFC 7525, DOI 10.17487/RFC7525, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="HEART.OAuth2">[HEART.OAuth2]</b></td>
<td class="top">
<a href="mailto:openid@justin.richer.org">Richer, J.</a>, "<a href="http://openid.net/specs/openid-heart-oauth2-1_0.html">Health Relationship Trust Profile for OAuth 2.0</a>", February 2016.</td>
</tr>
<tr>
<td class="reference"><b id="HEART.OIDC">[HEART.OIDC]</b></td>
<td class="top">
<a href="mailto:openid@justin.richer.org">Richer, J.</a>, "<a href="http://openid.net/specs/openid-heart-openid-connect-1_0.html">Health Relationship Trust Profile for OpenID Connect 1.0</a>", February 2016.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-oauth-pop-architecture">[I-D.ietf-oauth-pop-architecture]</b></td>
<td class="top">
<a>Hunt, P.</a>, <a>Richer, J.</a>, <a>Mills, W.</a>, <a>Mishra, P.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/draft-ietf-oauth-pop-architecture-08">OAuth 2.0 Proof-of-Possession (PoP) Security Architecture</a>", Internet-Draft draft-ietf-oauth-pop-architecture-08, July 2016.</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Core">[OpenID.Core]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a>, <a title="Google">de Medeiros, B.</a> and <a title="Salesforce">C. Mortimore</a>, "<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a>", August 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2246">[RFC2246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>C. Allen</a>, "<a href="https://tools.ietf.org/html/rfc2246">The TLS Protocol Version 1.0</a>", RFC 2246, DOI 10.17487/RFC2246, January 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a>Berners-Lee, T.</a>, <a>Fielding, R.</a> and <a>L. Masinter</a>, "<a href="https://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5322">[RFC5322]</b></td>
<td class="top">
<a>Resnick, P.</a>, "<a href="https://tools.ietf.org/html/rfc5322">Internet Message Format</a>", RFC 5322, DOI 10.17487/RFC5322, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5646">[RFC5646]</b></td>
<td class="top">
<a>Phillips, A.</a> and <a>M. Davis</a>, "<a href="https://tools.ietf.org/html/rfc5646">Tags for Identifying Languages</a>", BCP 47, RFC 5646, DOI 10.17487/RFC5646, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5785">[RFC5785]</b></td>
<td class="top">
<a>Nottingham, M.</a> and <a>E. Hammer-Lahav</a>, "<a href="https://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>", RFC 5785, DOI 10.17487/RFC5785, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6125">[RFC6125]</b></td>
<td class="top">
<a>Saint-Andre, P.</a> and <a>J. Hodges</a>, "<a href="https://tools.ietf.org/html/rfc6125">Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)</a>", RFC 6125, DOI 10.17487/RFC6125, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6749">[RFC6749]</b></td>
<td class="top">
<a>Hardt, D.</a>, "<a href="https://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6750">[RFC6750]</b></td>
<td class="top">
<a>Jones, M.</a> and <a>D. Hardt</a>, "<a href="https://tools.ietf.org/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>", RFC 6750, DOI 10.17487/RFC6750, October 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6819">[RFC6819]</b></td>
<td class="top">
<a>Lodderstedt, T.</a>, <a>McGloin, M.</a> and <a>P. Hunt</a>, "<a href="https://tools.ietf.org/html/rfc6819">OAuth 2.0 Threat Model and Security Considerations</a>", RFC 6819, DOI 10.17487/RFC6819, January 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7009">[RFC7009]</b></td>
<td class="top">
<a>Lodderstedt, T.</a>, <a>Dronia, S.</a> and <a>M. Scurtescu</a>, "<a href="https://tools.ietf.org/html/rfc7009">OAuth 2.0 Token Revocation</a>", RFC 7009, DOI 10.17487/RFC7009, August 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7033">[RFC7033]</b></td>
<td class="top">
<a>Jones, P.</a>, <a>Salgueiro, G.</a>, <a>Jones, M.</a> and <a>J. Smarr</a>, "<a href="https://tools.ietf.org/html/rfc7033">WebFinger</a>", RFC 7033, DOI 10.17487/RFC7033, September 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7515">[RFC7515]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7516">[RFC7516]</b></td>
<td class="top">
<a>Jones, M.</a> and <a>J. Hildebrand</a>, "<a href="https://tools.ietf.org/html/rfc7516">JSON Web Encryption (JWE)</a>", RFC 7516, DOI 10.17487/RFC7516, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7517">[RFC7517]</b></td>
<td class="top">
<a>Jones, M.</a>, "<a href="https://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a>", RFC 7517, DOI 10.17487/RFC7517, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7519">[RFC7519]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7519">JSON Web Token (JWT)</a>", RFC 7519, DOI 10.17487/RFC7519, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7523">[RFC7523]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Campbell, B.</a> and <a>C. Mortimore</a>, "<a href="https://tools.ietf.org/html/rfc7523">JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication and Authorization Grants</a>", RFC 7523, DOI 10.17487/RFC7523, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7591">[RFC7591]</b></td>
<td class="top">
<a>Richer, J.</a>, <a>Jones, M.</a>, <a>Bradley, J.</a>, <a>Machulak, M.</a> and <a>P. Hunt</a>, "<a href="https://tools.ietf.org/html/rfc7591">OAuth 2.0 Dynamic Client Registration Protocol</a>", RFC 7591, DOI 10.17487/RFC7591, July 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7662">[RFC7662]</b></td>
<td class="top">
<a>Richer, J.</a>, "<a href="https://tools.ietf.org/html/rfc7662">OAuth 2.0 Token Introspection</a>", RFC 7662, DOI 10.17487/RFC7662, October 2015.</td>
</tr>
<tr>
<td class="reference"><b id="UMA2">[UMA2]</b></td>
<td class="top">
<a title="ForgeRock">Maler, E.</a>, "<a href="https://docs.kantarainitiative.org/uma/wg/rec-oauth-uma-grant-2.0.html">User-Managed Access (UMA) Profile of OAuth 2.0</a>", April 2015.</td>
</tr>
<tr>
<td class="reference"><b id="UMA2.Authz">[UMA2.Authz]</b></td>
<td class="top">
<a title="ForgeRock">Maler, E.</a>, "<a href="https://docs.kantarainitiative.org/uma/wg/rec-oauth-uma-federated-authz-2.0.html">User-Managed Access (UMA) Profile of OAuth 2.0</a>", April 2015.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.A.p.1">The OpenID Community would like to thank the following people for their contributions to this specification: Dale Moberg, Adrian Gropper, Eve Maler, Danny van Leeuwen, John Moehrke, Aaron Seib, John Bradley, Debbie Bucci, Josh Mandel, and Sarah Squire.</p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#Notices" id="Notices">Notices</a>
</h1>
<p id="rfc.section.B.p.1">Copyright (c) 2018 The OpenID Foundation.</p>
<p id="rfc.section.B.p.2">The OpenID Foundation (OIDF) grants to any Contributor, developer, implementer, or other interested party a non-exclusive, royalty free, worldwide copyright license to reproduce, prepare derivative works from, distribute, perform and display, this Implementers Draft or Final Specification solely for the purposes of (i) developing specifications, and (ii) implementing Implementers Drafts and Final Specifications based on such documents, provided that attribution be made to the OIDF as the source of the material, but that such attribution does not indicate an endorsement by the OIDF.</p>
<p id="rfc.section.B.p.3">The technology described in this specification was made available from contributions from various sources, including members of the OpenID Foundation and others. Although the OpenID Foundation has taken steps to help ensure that the technology is available for distribution, it takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this specification or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any independent effort to identify any such rights. The OpenID Foundation and the contributors to this specification make no (and hereby expressly disclaim any) warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to this specification, and the entire risk as to implementing this specification is assumed by the implementer. The OpenID Intellectual Property Rights policy requires contributors to offer a patent promise not to assert certain patent claims against other contributors and against implementers. The OpenID Foundation invites any interested party to bring to its attention any copyrights, patents, patent applications, or other proprietary rights that may cover technology that may be required to practice this specification.</p>
<h1 id="rfc.appendix.C">
<a href="#rfc.appendix.C">Appendix C.</a> <a href="#History" id="History">Document History</a>
</h1>
<p id="rfc.section.C.p.1">-2018-02-28</p>
<p></p>

<ul><li>Minor text updates from WG comments.</li></ul>
<p id="rfc.section.C.p.3">-2018-02-22</p>
<p></p>

<ul><li>Created UMA2 specification based on UMA1 specification.</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Justin Richer</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Richer</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:openid@justin.richer.org">openid@justin.richer.org</a></span>

<span class="vcardline">URI: <a href="http://justin.richer.org/">http://justin.richer.org/</a></span>

  </address>
</div>

</body>
</html>
