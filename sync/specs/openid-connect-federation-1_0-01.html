<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>OpenID Connect Federation 1.0 - draft 01 </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Requirements Language"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Metadata Statement"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Metadata Common to All Entities"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Specific Client Metadata"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Specific Provider Metadata"/>
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Compounded Metadata Statement"/>
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Conceptual Model"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Trust Model"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Federation Operator"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 The Starting Point"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Constructing a Signed Metadata Statement"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Verifying a Metadata Statement"/>
<link href="#rfc.section.5" rel="Chapter" title="5 OpenID Connect Communication"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Provider Discovery"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Client Registration"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Belonging to Several Federations"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Choosing federation"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Relying Party"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 OpenID Provider"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Timeouts"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements"/>
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations"/>
<link href="#rfc.references" rel="Chapter" title="11 Normative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Example"/>
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 Relying Party joining a federation"/>
<link href="#rfc.appendix.A.1.1" rel="Chapter" title="A.1.1 Step 1 - Developer creates its signing key pair."/>
<link href="#rfc.appendix.A.1.2" rel="Chapter" title="A.1.2 Step 2 - Developer submits registration data to FO"/>
<link href="#rfc.appendix.A.1.3" rel="Chapter" title="A.1.3 Step 3 - FO returns a signed metadata statement"/>
<link href="#rfc.appendix.A.1.4" rel="Chapter" title="A.1.4 Step 4 - The RP gets a signing key"/>
<link href="#rfc.appendix.A.1.5" rel="Chapter" title="A.1.5 Step 5 - RP produces a client registration request"/>
<link href="#rfc.appendix.A.1.6" rel="Chapter" title="A.1.6 Step 6 - Developer produces metadata statement for RP"/>
<link href="#rfc.appendix.A.1.7" rel="Chapter" title="A.1.7 Step 7 - RP sends a client registration request to an OP"/>
<link href="#rfc.appendix.A.1.8" rel="Chapter" title="A.1.8 Step 8 - OP handles metadata statement"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Notices"/>
<link href="#rfc.appendix.C" rel="Chapter" title="C Document History"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2.dev0 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Hedberg, R., Ed., Gulliksson, R., Jones, M., and J. Bradley" />
  <meta name="dct.identifier" content="urn:ietf:id:openid-connect-federation-1_0" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-9-9" />
  <meta name="dct.abstract" content="The OpenID Connect standard specifies how a Relying Party (RP) can discover metadata about an OpenID Provider (OP), and then register to obtain client credentials. During discovery and registration there is no automated mechanism for the OP or the RP to verify the information exchanged during this process. All the information is self-asserted.  " />
  <meta name="description" content="The OpenID Connect standard specifies how a Relying Party (RP) can discover metadata about an OpenID Provider (OP), and then register to obtain client credentials. During discovery and registration there is no automated mechanism for the OP or the RP to verify the information exchanged during this process. All the information is self-asserted.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left"></td>
  <td class="right">R. Hedberg, Ed.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">independent</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">R. Gulliksson</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">UmU</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">M. Jones</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Microsoft</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">J. Bradley</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Ping Identity</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">September 9, 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">OpenID Connect Federation 1.0 - draft 01 <br />
  <span class="filename">openid-connect-federation-1_0</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>The OpenID Connect standard specifies how a Relying Party (RP) can discover metadata about an OpenID Provider (OP), and then register to obtain client credentials. During discovery and registration there is no automated mechanism for the OP or the RP to verify the information exchanged during this process. All the information is self-asserted.  </p>
<p>In an identity federation context this is not sufficient. The participants of the federation must be able to trust information provided about other participants in the federation.  </p>
<p>This document describes how an identity federation can be built around a trusted third party, the federation operator.  </p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Requirements Language</a></li>
<li>3.   <a href="#rfc.section.3">Metadata Statement</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Metadata Common to All Entities</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Specific Client Metadata</a></li>
<li>3.3.   <a href="#rfc.section.3.3">Specific Provider Metadata</a></li>
<li>3.4.   <a href="#rfc.section.3.4">Compounded Metadata Statement</a></li>
<li>3.5.   <a href="#rfc.section.3.5">Conceptual Model</a></li>
</ul><li>4.   <a href="#rfc.section.4">Trust Model</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Federation Operator</a></li>
<li>4.2.   <a href="#rfc.section.4.2">The Starting Point</a></li>
<li>4.3.   <a href="#rfc.section.4.3">Constructing a Signed Metadata Statement</a></li>
<li>4.4.   <a href="#rfc.section.4.4">Verifying a Metadata Statement</a></li>
</ul><li>5.   <a href="#rfc.section.5">OpenID Connect Communication</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Provider Discovery</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Client Registration</a></li>
</ul><li>6.   <a href="#rfc.section.6">Belonging to Several Federations</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Choosing federation</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Relying Party</a></li>
<li>6.3.   <a href="#rfc.section.6.3">OpenID Provider</a></li>
</ul><li>7.   <a href="#rfc.section.7">Timeouts</a></li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a></li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a></li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a></li>
<li>11.   <a href="#rfc.references">Normative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Example</a></li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">Relying Party joining a federation</a></li>
<ul><li>A.1.1.   <a href="#rfc.appendix.A.1.1">Step 1 - Developer creates its signing key pair.</a></li>
<li>A.1.2.   <a href="#rfc.appendix.A.1.2">Step 2 - Developer submits registration data to FO</a></li>
<li>A.1.3.   <a href="#rfc.appendix.A.1.3">Step 3 - FO returns a signed metadata statement</a></li>
<li>A.1.4.   <a href="#rfc.appendix.A.1.4">Step 4 - The RP gets a signing key</a></li>
<li>A.1.5.   <a href="#rfc.appendix.A.1.5">Step 5 - RP produces a client registration request</a></li>
<li>A.1.6.   <a href="#rfc.appendix.A.1.6">Step 6 - Developer produces metadata statement for RP</a></li>
<li>A.1.7.   <a href="#rfc.appendix.A.1.7">Step 7 - RP sends a client registration request to an OP</a></li>
<li>A.1.8.   <a href="#rfc.appendix.A.1.8">Step 8 - OP handles metadata statement</a></li>
</ul></ul><li>Appendix B.   <a href="#rfc.appendix.B">Notices</a></li>
<li>Appendix C.   <a href="#rfc.appendix.C">Document History</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">The OpenID Connect specification defines how a Relying Party and an OpenID Connect Provider can exchange information dynamically about each other. This information is necessary for future successful OIDC communication.  </p>
<p id="rfc.section.1.p.2">One problem with using dynamic discovery and registration is that the correctness of the information that is exchanged can not be easily verified by the recipient since it is self-asserted.  </p>
<p id="rfc.section.1.p.3">Another problem that has been raised is the dependency on TLS as the sole protection against attacks on the transferred information.  These last couple of years a number of problems with OpenSSL, which is probably the most widely used TLS library, has been discovered that puts reasonable doubt into this dependency.  </p>
<p id="rfc.section.1.p.4">This document extends Signed Metadata, as introduced by <a href="#I-D.draft-ietf-oauth-discovery">OAuth 2.0 Authorization Server Metadata</a> <cite title="NONE">[I-D.draft-ietf-oauth-discovery]</cite>, to create so called metadata statements. Metadata statements together with the use of a trusted third party (that verifies and enforces some common policy), can be used to transfer verified data and trust in the data between clients and servers.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> Requirements Language</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.  </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#entity_metadata" id="entity_metadata">Metadata Statement</a></h1>
<p id="rfc.section.3.p.1">A metadata statement asserts metadata values about an entity (client or server).  </p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> Metadata Common to All Entities</h1>
<p id="rfc.section.3.1.p.1">These extra metadata parameters appear in both provider and client metadata statements: </p>
<p/>

<dl>
  <dt>signing_keys</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  A <a href="#RFC7517">JSON Web Key Set (JWKS)</a> <cite title="NONE">[RFC7517]</cite> representing the public part of the entity's signing keys.  </dd>
  <dt>signing_keys_uri</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  Location where a JWKS representing the public part of the entity's signing keys can be found. SHOULD return the Content-Type "application/jose" to indicate that the JWKS is in the form of a <a href="#RFC7515">JSON Web Signature (JWS)</a> <cite title="NONE">[RFC7515]</cite> using the JWS Compact Serialization.  </dd>
  <dt>metadata_statements</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  JSON array containing a list of metadata statements.  </dd>
  <dt>metadata_statement_uris</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  JSON object where the names are the federation identifiers and the values are URLs pointing to metadata statements connected to each federation.  </dd>
  <dt>signed_jwks_uri</dt>
  <dd style="margin-left: 8"><br/> OPTIONAL.  This is the signed version of the <samp>jwks_uri</samp> parameter defined in <a href="#OpenID.Registration">OpenID Connect Dynamic Client Registration 1.0</a> <cite title="NONE">[OpenID.Registration]</cite>.  SHOULD return the Content-Type "application/jose" to indicate that the JWKS is in the form of a JWS using the JWS Compact Serialization.  The key used to sign the JWKS can be found among the keys published in <samp>signing_keys</samp> or fetched from <samp>signing_keys_uri</samp> </dd>
</dl>

<p> </p>
<p id="rfc.section.3.1.p.3">Metadata statements and signing keys can be transferred in two different ways: either by including the information in the statement, or by providing a URI that points to the information.  How metadata statements and signing keys are transferred is independent of each other.  It is NOT allowed to divide the information (metadata statements or signing keys) into two pieces and send one in the statement and leave the rest to be fetched using the URI.  </p>
<p id="rfc.section.3.1.p.4">Along the same line if both <samp>jwks_uri</samp> and <samp>signed_jwks_uri</samp> are present, which they might be for backward compatibility reasons, then <samp>signed_jwks_uri</samp> SHOULD be preferred.  </p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> Specific Client Metadata</h1>
<p id="rfc.section.3.2.p.1">All parameters defined in section 2 of <a href="#OpenID.Registration">OpenID Connect Dynamic Client Registration 1.0 </a> <cite title="NONE">[OpenID.Registration]</cite> are allowed in a metadata statement.  </p>
<p id="rfc.section.3.2.p.2">To that list is added: </p>

<dl>
  <dt>scopes</dt>
  <dd style="margin-left: 8"><br/> RECOMMENDED.  JSON array containing a list of the <a href="#RFC6749">RFC6749</a> <cite title="NONE">[RFC6749]</cite> scope values that this clients expects to use.  </dd>
  <dt>claims</dt>
  <dd style="margin-left: 8"><br/> RECOMMENDED.  JSON array containing a list of the Claim Names of the Claims that the OpenID Client wants values for.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> Specific Provider Metadata</h1>
<p id="rfc.section.3.3.p.1">All parameters defined in section 3 of <a href="#OpenID.Discovery">OpenID Connect Discovery 1.0 </a> <cite title="NONE">[OpenID.Discovery]</cite> </p>
<h1 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4.</a> Compounded Metadata Statement</h1>
<p id="rfc.section.3.4.p.1">The metadata for each entity in the federation is described by one or more metadata statements (for example, MS0, MS1, ..., MSn). MS0 is the most generic, and MS1-MSn would in turn be successively more specific.  To describe an entity belonging to an organization, MS0 would typically contain information that belongs to the organization, for example <samp>tos_uri</samp>, <samp>contacts</samp> and the like while MSn would contain information about the specific entity like <samp>authorization_endpoint</samp> for an OP or <samp>redirect_uris</samp> for a RP.  </p>
<p id="rfc.section.3.4.p.2">The metadata for a specific entity is constructed by starting with the information in MS0 and then adding the information in MS1 to MSn using the rule below.  </p>
<p><strong>If the same claims appear in MSa and MSb (b &gt; a, a=0,..,n, b=0,..,n) then unless the value in MSb is less or equal to the value in MSa then the value in MSb should be ignored.  </strong> </p>

<ul class="empty">
  <li>If the values are strings they are less or equal if they are the same.  </li>
  <li>if the values are lists then for each value in MSb there MUST be a corresponding value in MSa that is less or equal.  </li>
</ul>

<p> </p>
<p id="rfc.section.3.4.p.4">The reason for us to define a compounded metadata statement in this way is so new OIDC entities can be created and described without having to involve all the parties up to and including the FO. Only the party responsible for the entity and the immediate superior party, who has to sign the new information, has to be involved.  </p>
<p id="rfc.section.3.4.p.5">The following is a non-normative example of a set of client-specific metadata statements who together form the metadata for an entity: </p>

<p>MS0 </p>
<pre>
{
  "contacts": ["dev_admin@example.com", "ops_admin@example.com"],
  "logo_uri": "https://example.com/logo.jpg",
  "policy_uri": "https://example.com/policy.html",
  "tos_uri": "https://example.com/tos.html"
}
            </pre>
<p>MS1 </p>
<pre>
{
  "scope": "openid eduperson",
  "response_types": ["code"],
}
            </pre>
<p>MS2 </p>
<pre>
{
  "contacts": ["dev_admin@example.com"],
  "redirect_uris": ["https://example.com/rp1"],
}
            </pre>
<p>sum(MS0...2) </p>
<pre>
{
  "contacts": ["dev_admin@example.com"],
  "logo_uri": "https://example.com/logo.jpg",
  "policy_uri": "https://example.com/policy.html",
  "tos_uri": "https://example.com/tos.html"
  "scope": "openid eduperson",
  "response_types": ["code"],
  "redirect_uris": ["https://example.com/rp1"],
}
            </pre>
<h1 id="rfc.section.3.5"><a href="#rfc.section.3.5">3.5.</a> Conceptual Model</h1>
<p id="rfc.section.3.5.p.1">A set of metadata statements, together describe an entity are brought together using the <samp>metadata_statement</samp> parameter.  </p>

<p>The following is a non-normative example of a compounded metadata statement. Also note that the the metadata_statement MUST be a signed JWT. In this example, the only the parts of the signed JWT payload pertinent to the example are shown.  </p>
<pre>
{
  "redirect_uris": ["https://example.com/rp1"],
  "metadata_statements": [
    {
      "scope": "openid eduperson",
      "response_types": ["code"],
      "metadata_statements" : [
        {
          "contacts": ["dev_admin@example.com"],
          "logo_uri": "https://example.com/logo.jpg",
          "policy_uri": "https://example.com/policy.html",
          "tos_uri": "https://example.com/tos.html"
        }
      ]
    }
  ]
}
            </pre>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Trust Model</h1>
<p id="rfc.section.4.p.1">The trust model is based on linking together signing keys, referred to in the metadata statements and represented as<a href="#RFC7517">JWK Sets</a> <cite title="NONE">[RFC7517]</cite>.  Each signature chain is rooted in the trusted third party's signing keys. By verifying such signature chains, the entities can establish trust in the metadata.  </p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> Federation Operator</h1>
<p id="rfc.section.4.1.p.1">The Federation Operator (FO) is the trusted third party. The FO MUST have a globally unique identifier.  It will publish a JWKS, containing the signing keys that the FO will use for signing metadata submitted to it, at a HTTPS URL which server certificate MUST appear in a well-known <a href="#RFC6962">Certificate Transparency log</a> <cite title="NONE">[RFC6962]</cite>.  The key IDs of the FO's signing keys MUST be globally unique since they are the keys in the metadata_statment_uris object.  </p>
<p id="rfc.section.4.1.p.2">For the following description, this is assumed to be true: A federation consists of a number of members, and each member has one or more representatives registered with the federation.  These representatives are allowed to issue metadata signing requests on behalf of the member to the federation. Below such a representative is called a Level 0 Requester (L0Req).  Within each member unless all entities belonging to the member is handled by the L0Req there may exists parties that are responsible for single or groups of entities. Within these parties we may have further subdivisions such that we end up with Level 0, 1, 2, 3 or more requesters. This document makes no assumption on the number of levels.  </p>
<p id="rfc.section.4.1.p.3">Note that the level N requester is the level N+1 signer.</p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> The Starting Point</h1>
<p id="rfc.section.4.2.p.1">The innermost metadata statement in the nest of metadata statements is the one that the FO has signed.  That statement MUST NOT contain any references to other metadata statements.  All other metadata statements in the nest MUST contain at least one reference to another metadata statement.  </p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> Constructing a Signed Metadata Statement</h1>
<p id="rfc.section.4.3.p.1">These are the steps that are performed to construct a signed metadata statement.  A metadata signing request may be about one specific entity or a group of similar entities.  </p>
<p/>

<ol>
  <li>The <samp>requester</samp> constructs a signing request by collecting the necessary client or provider metadata as described in <a href="#entity_metadata">Section 3</a>.  </li>
  <li>If this is the top most metadata statement (MS0) then no metadata statement will be added to the metadata statement.  If it is a more specific metadata statement (MS1...n) then more general metadata statement/-s MUST be added.  Dependent on setup the metadata statement can be added by the requester or the signer.  </li>
  <li>The signing request is transported to the signing party.  In the case or MS0 this MUST be the FO. If it is MS1 it is the <samp>LOReq</samp>. If it is MS2 it is the L1Req and so on.  </li>
  <li>The signing party verifies the information in the signing request, modifies and/or adds more information according to the applicable policies (e.g. federation policy if the signing request pertains to metadata statement MS0, or organizational policy for metadata statements MS1..n) before signing the statement.  </li>
  <li>Once the signing party has processed the signing request, the metadata statement is returned to the <samp>requester</samp>.  </li>
</ol>

<p> </p>
<p id="rfc.section.4.3.p.3">An example of the construction of a compounded metadata statement.  </p>

<ul class="empty">
  <li>The Level 0 Requester (L0Req) sends a signing request to the federation operator (FO).  </li>
  <li>The FO verifies the information and if the federations policy so demands may add to and/or modify the request </li>
  <li>The FO signs the request (this is now the MS0) and returns it to the L0Req </li>
  <li>Level 1 Requesters (L1Reqs) can now send their signing requests to the L0Req </li>
  <li>The L0Req applies whatever organization policies that applies to such a request and adds MS0.  </li>
  <li>The L0Req signs the modified request (this is now a MS1) and returns it to the L1Req </li>
</ul>

<p> </p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> Verifying a Metadata Statement</h1>
<pre>
def verify(ms, sign_keys):
    keys = []
    pl = get_payload(ms)
    if 'metadata_statements' in pl:
        md = []
        for statement in pl['metadata_statements']:
            _ms, _md = verify(statement, sign_keys)
            if _ms:
                keys.append(get_keys(_ms))
                if _md:
                    md.extend([_ms, _md])
                else:
                    md.append(_ms)
    elif 'metadata_statement_uris' in pl:
        md = []
        for _iss, uri in pl['metadata_statement_uris'].items():
            statement = html_get(uri)
            _ms, _md = verify(statement, sign_keys)
            if _ms:
                keys.append(get_keys(_ms))
                if _md:
                    md.extend([_ms, _md])
                else:
                    md.append(_ms)
    else:
        return verify_signature(ms, pl['iss'], sign_keys), []

    return verify_signature(ms, pl['iss'], keys), md
                        </pre>
<p id="rfc.section.4.4.p.1">Verifying the received metadata statement involves running a function similar to this: </p>
<p id="rfc.section.4.4.p.2">As can be see from the pseudo code the process is that you successively unpack the metadata statements (this involves base64 decoding the JWS payload without verifying the signature) until you reach the inner most MS (MS0). After having verified the signature of MS0 using the FOs signing keys, you can now use the signing keys included in or referenced from MS0 to verify the signature of the next layer (MS1) and so on.  </p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> OpenID Connect Communication</h1>
<p>The trust between the entities is established using the above described extensions in the first two steps of the communication between an RP and an OP.  How the RP found the OP in the first place is out of scope for this document.  </p>
<pre>
------                             ------
|    | &lt;--- 1) Discovery --------&gt; |    |
| RP | &lt;--- 2) Registration -----&gt; | OP |
|    |                             |    |
------                             ------
        
        </pre>
<p>After the discovery and registration is completed a first time, those steps SHOULD only be repeated if any changes occur (see notes in respective sections below).  </p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> Provider Discovery</h1>
<p id="rfc.section.5.1.p.1">The OP MUST publish its provider metadata as specified by <a href="#OpenID.Discovery">OpenID Connect Discovery 1.0</a> <cite title="NONE">[OpenID.Discovery]</cite>.  The RP makes a standard OpenID Provider Configuration Request.  The OP responds with its provider configuration and the additional metadata parameters specified in <a href="#entity_metadata">Section 3</a> </p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> Client Registration</h1>
<p id="rfc.section.5.2.p.1">The OP MUST support dynamic client registration as described in <a href="#OpenID.Registration">OpenID Connect Dynamic Client Registration 1.0 </a> <cite title="NONE">[OpenID.Registration]</cite>. The RP makes a Client Registration Request including the additional metadata specified in <a href="#entity_metadata">Section 3</a> </p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> Belonging to Several Federations</h1>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> Choosing federation</h1>
<p id="rfc.section.6.1.p.1">This draft allows any entity to belong to more then one federation.  During the provider discovery and client registration process the parties has to agree on which federation to use.  </p>
<p/>

<ul class="empty">
  <li>The client asks for the provider information</li>
  <li>The OP, using some rule, may publish one or a several <samp>metadata_statements</samp>.  If it publishes more than one <samp>metadata_statements</samp>, then they should be rooted in different federations.  </li>
  <li>Based on what the OP published, the RP publishes a number of<samp>metadata_statements</samp>, all rooted in federations that the OP belongs to.  </li>
  <li>If the RP published more then one <samp>metadata_statements</samp>, then the OP should/must choose one and make that known in the client registration response.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> Relying Party</h1>
<p id="rfc.section.6.2.p.1">An organization may be a member of more the one federation. The RPs it is responsible for may be members of one or more of these.  </p>
<p id="rfc.section.6.2.p.2">The organization registers and gets metadata staements signed by each federation.  One extreme is that it will mint a new key pair for each federation, the other is that it will use the same key pair for all federations. It does not matter which it chooses, but the end result MUST be that there is one signed RP registration request per signing key.  This is then published using <samp>metadata_statement_uris</samp> or <samp>metadata_statements</samp> the client registration request.  </p>
<p/>

<p>The following is a non-normative example of an absolutely minimal client registration request sent to an OP: </p>
<pre>
{
  "redirect_uris": ["https://example.com/rp2/callback"],
  "metadata_statement_uris": {
      https://swamid.sunet.se/":
        "https://dev.example.com/rp1/idfed/swamid.jws",
      "https://www.incommon.org":
        "https://dev.example.com/rp1/idfed/incommon.jws"
  }
}
            </pre>
<p id="rfc.section.6.2.p.4">As described above, when the OP receives a request like this it will choose which federation it will work within and then signal that by only returning that corresponding information in the <samp>metadata_statements</samp> / <samp>metadata_statement_uris</samp> in the registration response.  </p>
<p/>

<p>The following is a non-normative example of an OPs response on the client registration request above: </p>
<pre>
{
  "client_id": "abcdefgh",
  "client_secret": "0123456789",
  "client_id_issued_at": 1462375583,
  "client_secret_expires_at": 1462379183,
  "redirect_uris": ["https://example.com/rp2/callback"],
  "metadata_statement_uris": {
    "https://swamid.sunet.se/":
      "https://dev.example.com/rp1/idfed/swamid.jws",
  }
}
            </pre>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> OpenID Provider</h1>
<p id="rfc.section.6.3.p.1">An OP has the choice of whether it wants one key pair per federation, one key pair for everyone, or anything in between.  And, like the RP owner, it has to produce one signed metadata statement per key used.  </p>
<p/>

<p>The following is a non-normative example of an OPs response to a provider configuration request: </p>
<pre>
  {
    "issuer": "https://foo.example.org/op/fDTowvP0slEdEAcc",
    "response_types_supported": ["code", "code id_token", "token"],
    "grant_types_supported": ["authorization_code", "implicit",
        "urn:ietf:params:oauth:grant-type:jwt-bearer"],
    "subject_types_supported": ["pairwise", "public"],
    "id_token_signing_alg_values_supported": ["RS256"],
    "metadata_statement_uris": {
      "https://swamid.sunet.se/":
        "https://foo.example.org/op/idfed/swamid.jws",
      "https://www.incommon.org":
        "https://foo.example.org/op/idfed/incommon.jws"
      "https://www.switch.ch":
        "https://foo.example.org/op/idfed/switch.jws"
      "https://www.aco.net/":
        "https://foo.example.org/op/idfed/aconet.jws"
  }
            </pre>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> Timeouts</h1>
<p id="rfc.section.7.p.1">There are a number of timeouts that MUST considered </p>

<ul class="empty">
  <li>Each signature has a timeout.</li>
  <li>A client registration has a timeout.</li>
</ul>

<p> </p>
<p id="rfc.section.7.p.2">Taking this into consideration, an OP MUST NOT assign a lifetime to a client registration that exceeds the lifetime of the metadata statement signatures.  </p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a></h1>
<p/>

<ul class="empty">
  <li>Heather Flanagan</li>
  <li>Michael Schwartz</li>
  <li>Peter Schober</li>
</ul>

<p> </p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#IANA" id="IANA">IANA Considerations</a></h1>
<p id="rfc.section.9.p.1">TBD </p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#Security" id="Security">Security Considerations</a></h1>
<p id="rfc.section.10.p.1">TBD </p>
<h1 id="rfc.references"><a href="#rfc.references">11.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.draft-ietf-oauth-discovery">[I-D.draft-ietf-oauth-discovery]</b>
      </td>
      <td class="top"><a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a> and <a title="Microsoft">M. Jones</a>, "<a href="https://tools.ietf.org/html/draft-ietf-oauth-discovery-04">OAuth 2.0 Authorization Server Metadata</a>", August 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OpenID.Discovery">[OpenID.Discovery]</b>
      </td>
      <td class="top"><a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a> and <a title="Illumila">E. Jay</a>, "<a href="http://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a>", August 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="OpenID.Registration">[OpenID.Registration]</b>
      </td>
      <td class="top"><a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a> and <a title="Microsoft">M. Jones</a>, "<a href="http://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration 1.0</a>", August 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6749">[RFC6749]</b>
      </td>
      <td class="top"><a>Hardt, D.</a>, "<a href="http://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6962">[RFC6962]</b>
      </td>
      <td class="top"><a>Laurie, B.</a>, <a>Langley, A.</a> and <a>E. Kasper</a>, "<a href="http://tools.ietf.org/html/rfc6962">Certificate Transparency</a>", RFC 6962, DOI 10.17487/RFC6962, June 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7515">[RFC7515]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="http://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7517">[RFC7517]</b>
      </td>
      <td class="top"><a>Jones, M.</a>, "<a href="http://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a>", RFC 7517, DOI 10.17487/RFC7517, May 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#app-additional" id="app-additional">Example</a></h1>
<p id="rfc.section.A.p.1">The necessary steps for adding a Relying Party to a federation </p>
<p id="rfc.section.A.p.2">The following JWKS represents the signing key that the Federation Operator is using in the following example: </p>
<pre>
{
  "keys": [
    {
      "d": "DpFZnXz8fcKmOxFPfPdh3aZz44U2ZWm1Mxy6CiqHYcA80KVAY-wrjKFV4e
iSl9JENpoWXax4dpMcyJa2TdAXL9-4WqGNQAPRvdOfHcJM_uaBSGZwsuqAqZi_0sbNxurG
gbjKV38ra-iz42fcSXHCgNdMJjCi3VixS8iASHGU82R6mYyVeMWdX_j2RG--41PDxud4xS
YCKDuR6s2qlLVXyCZqFu_Yzl5zChiNxZJ_ggcxyL6i_hngi1oSbbVjgNKTcJNaIdOfzzcn
Ud5J9GP941-tylwg7NC3gRo1bXlUx6HFx3LkYe1PdroHhQd92RPyJdPqHDfbizJ4sjXN4c
Nq-Q",
      "e": "AQAB",
      "kid": "uZX0-P1-TMsZRqK1SeXpdLgsLoeUNskN2W_rwBNKAtc",
      "kty": "RSA",
      "n": "rqJ_CFECPF2nBD1eXkFonJo5gGcbnCvDudm_-7f1thcQqiuY2Xz0eKqQ2H
P3Nw-wP5q2hKbNVgAQSBbMp_AgNwRFmboJKF4cFEr3ZtmvO94bM6L15vUR2HNyX-4LaZ6S
9u35jSikOVJDt1BK-72w_DKeb8O8qa2dl9k7F6QZJQT6Nfh5rEALQLOZgwBgZAUpu2tQUh
3TFpwe3J_rQtCBbI3r0W1XoM1pD3EXTm9MI_aANRL82rh7_ZqLwGeBprD3F6ns9i5-psQ0
UZ-2eVjN6J1um40U6ysu3QjFUZEwb0yxNVx2D9bzOPMHwo6GAzePhJ46rI8NQ0NwJdB7lN
vrhw",
      "p": "y4VcmM4QZoIjsGlTE7jvkJzYAud9Hz3uexVdeTShHnS-btLySSP70EWdvI
CkHK7Z4KikNZaD3cET978LmkoG03WZcs7iEEg7hQ0N7ePMv7P1w6X1Z2_IeWml0c4iFSMa
GPJk8a65HgBZ8fYPXFtERI7e1M--oqCrsTFikP8wYQU",
      "q": "26pTV-JNgwx3LMrqEKIoIvHwLKfjFouRZXtTnOJP9G9BZ9vhAn1qX06M-x
W02G3qGzhQEpNZKMj54APNcqkg4PH1wMJmJ-cs1T44KoNhhihoHd6awT7PGNMo9I728CwY
fkM3ZW-BsgGBzQcfdI043cV3ebXzIEWwPbqTR44p8Bs",
      "use": "sig"
    }
  ]
}
        </pre>
<h1 id="rfc.appendix.A.1"><a href="#rfc.appendix.A.1">A.1.</a> Relying Party joining a federation</h1>
<h1 id="rfc.appendix.A.1.1"><a href="#rfc.appendix.A.1.1">A.1.1.</a> Step 1 - Developer creates its signing key pair.</h1>
<pre>
{
  "keys": [
    {
      "d": "RJmqe2KiVOShoTMaZBmoMLkmeZY97PW3TOgSGDgZejL6I2qdhNlBAa3e9N
z6ggkWpxEy6IGNGetwNwS9aYA_Z6m45kaaUHXGKol_R_5s4TJryXUppxWDuHScE_dVcfzl
usm9Cq8J-U-xoaoKL36I3rakCJ_dWpsGNDpYSMenXcXuX-gJ5-HvSTETV5Bp23izUF4BH8
TSVWniD8Vk5Hv8EtWVqsqc7YmIG1zW_ctJhK7peymmNIVpcGpIxaT8agUOS-hcNxpN4AlY
rELn2twzq8tXp5bPZNiHHNXgzXANy5BgNFXXnZFqFiNiBn3agQxF2aiu4Ei5k5OidHTV8q
eGWQ",
      "e": "AQAB",
      "kid": "z414hVxt2-nkbqgG3VFYOZGB3Miwuhe75SfWT1BQQTc",
      "kty": "RSA",
      "n": "waDXGJwu9pV3gMY7rtpq3OYSAG1HZy7qilGC3ULMxJxjhSQCJ7M9PBC4uo
F_f5178FebpKBIoT3_YzqETt9Ry_6NA_mGBq6xtjEgnmNv6ktQj8hKI0tYheWRHMJIt2ay
8IwnV-3LD0Q_Nn7E3YgGaJUBlzDgJxQQcRVGFEOcFL-7TiKtVdPmPDGcSF7FivaGJO-MVq
mDkCsZVMTZoqmKeuaqbshsDjxy9GaiImQLe8tyzkhxEoG7qvovlGoV4AE8WroMinx0qWvg
lR8n041qQhrUMtoQMDCI53uLy6ZSR0jbNNEwvDBbiqD4Hm3piAwTUrGKWYLxbeicK_7A6g
F2Sw",
      "p": "3SBEMBmIGztaOpCH-C9vwr80SyXm6M1uwCoKjBOiy_-kJ03jvacztd5CEO
cCvhRLVvl3rEYSP97DR_Eju-jlKWi92tbIECGvWzgszMHLdEdjvVvpJLlOSAfFMYsaPxa1
Sw2HS7RgoAwIxD5HVcdPK-3cJ5Gi0hInbz-ufrH4ru0",
      "q": "4CphaFI0lSGr0HNifXJBN5JkXmCZp6WX06cI4pR_DwZAHTojc8dK1ECMHU
2oP2nPn1pmAVZj4p98vO0MfTxSgNB15EmDRkic_cmS-SenUUf7Pl3avJwpZq_qxYPqDajA
gWHuuci-2zKXRlKS_ZCz1MAmx-gV0We3AnletWV52xc",
      "use": "sig"
    }
  ]
}
</pre>
<p id="rfc.section.A.1.1.p.1">Developer creates its signing key pair.  </p>
<h1 id="rfc.appendix.A.1.2"><a href="#rfc.appendix.A.1.2">A.1.2.</a> Step 2 - Developer submits registration data to FO</h1>
<p id="rfc.section.A.1.2.p.1">The developer submits registration data to Federation Operator (FO).  </p>
<pre>
{
  "contacts": [
    "dev_admin@example.com"
  ],
  "logo_uri": "https://example.com/logo.jpg",
  "policy_uri": "https://example.com/policy.html",
  "signing_key": {
    "e": "AQAB",
    "kid": "z414hVxt2-nkbqgG3VFYOZGB3Miwuhe75SfWT1BQQTc",
    "kty": "RSA",
    "n": "waDXGJwu9pV3gMY7rtpq3OYSAG1HZy7qilGC3ULMxJxjhSQCJ7M9PBC4uoF_
f5178FebpKBIoT3_YzqETt9Ry_6NA_mGBq6xtjEgnmNv6ktQj8hKI0tYheWRHMJIt2ay8I
wnV-3LD0Q_Nn7E3YgGaJUBlzDgJxQQcRVGFEOcFL-7TiKtVdPmPDGcSF7FivaGJO-MVqmD
kCsZVMTZoqmKeuaqbshsDjxy9GaiImQLe8tyzkhxEoG7qvovlGoV4AE8WroMinx0qWvglR
8n041qQhrUMtoQMDCI53uLy6ZSR0jbNNEwvDBbiqD4Hm3piAwTUrGKWYLxbeicK_7A6gF2
Sw",
    "use": "sig"
  },
  "tos_uri": "https://example.com/tos.html"
}
           </pre>
<h1 id="rfc.appendix.A.1.3"><a href="#rfc.appendix.A.1.3">A.1.3.</a> Step 3 - FO returns a signed metadata statement</h1>
<p id="rfc.section.A.1.3.p.1">The FO returns a signed metadata statement containing the submitted registration data, and any applied policy restrictions like response_types, signing/encryption algorithms to be used and additional specific policy parameters like the ones specified above.  </p>
<p id="rfc.section.A.1.3.p.2">This is an example of a metadata statement constructed by the FO before it is signed by the FO: </p>
<pre>
{
  "contacts": [
    "dev_admin@example.com"
  ],
  "exp": 1462438820,
  "iat": 1462438820,
  "iss": "https://swamid.sunet.se/",
  "jti": "e920396fc2cb4ac0aaeb229674fd286a",
  "kid": "uZX0-P1-TMsZRqK1SeXpdLgsLoeUNskN2W_rwBNKAtc",
  "logo_uri": "https://example.com/logo.jpg",
  "policy_uri": "https://example.com/policy.html",
  "response_types": [
    "code",
    "code id_token",
    "token"
  ],
  "scopes": [
    "openid",
    "email",
    "phone"
  ],
  "signing_key": {
    "e": "AQAB",
    "kid": "z414hVxt2-nkbqgG3VFYOZGB3Miwuhe75SfWT1BQQTc",
    "kty": "RSA",
    "n": "waDXGJwu9pV3gMY7rtpq3OYSAG1HZy7qilGC3ULMxJxjhSQCJ7M9PBC4uoF_
f5178FebpKBIoT3_YzqETt9Ry_6NA_mGBq6xtjEgnmNv6ktQj8hKI0tYheWRHMJIt2ay8I
wnV-3LD0Q_Nn7E3YgGaJUBlzDgJxQQcRVGFEOcFL-7TiKtVdPmPDGcSF7FivaGJO-MVqmD
kCsZVMTZoqmKeuaqbshsDjxy9GaiImQLe8tyzkhxEoG7qvovlGoV4AE8WroMinx0qWvglR
8n041qQhrUMtoQMDCI53uLy6ZSR0jbNNEwvDBbiqD4Hm3piAwTUrGKWYLxbeicK_7A6gF2
Sw",
    "use": "sig"
  },
  "token_endpoint_auth_method": "private_key_jwt",
  "tos_uri": "https://example.com/tos.html"
}
            </pre>
<p id="rfc.section.A.1.3.p.3">The signed version of this metadata statement, or a link to it, is then expected to be included in the RPs client registration request before being signed by the level 0 signing key.  </p>
<h1 id="rfc.appendix.A.1.4"><a href="#rfc.appendix.A.1.4">A.1.4.</a> Step 4 - The RP gets a signing key</h1>
<pre>
{
  "keys": [
    {
      "d": "BA0bo5OR3ht2KGDeAUpZsKv-Jjo9IKpYA2x7yQhcIH3bt9T2495pXVAHLQ
XXnZpjMenz7WPx94ajxIh96Bt59AYx4AwAEaBnPzK8vXLIP-A92NP3HV7vk0p8KWsrEdDw
xBaypqRXxz7V5vPGQVnOGg2eKSlP5F4-HoGpU6xDRo8Lptcs5VNx0a9kKVqEu-YpQkc2z2
uLRjl8urOu471sks38U03wRwWDElepUI28jEjhPydVSQw-E5w3yKhHTZeh1mVdNMp7_8LD
zScP1Ah5VCRLFfrmx1bOXxXZWHpMD6vgghmaCQGmyhgEr3XNzHVlH4bfVI_2Vrxp6cxHpe
3iYw",
      "e": "AQAB",
      "kid": "Tvd2gF4mcNtiYx6FyOOH83Xj_MkF-8yn_rD2Gm06RxY",
      "kty": "RSA",
      "n": "2kCKMUluhKV2INV3dS89WQ305J6JL8OJQ1cPk3GQ20Zvraa3DCntNns1xy
9gynGYUQzom7LYAqcmpu7xFGNXH0gN8JyXcCiWl02IuD6lwS6N2d7y6xJm8-mUBiwVrAlh
wWL1Bf8JRycRUQ51c6Y8yYrUf2pjeIFQBQEfUhcjNg13L1OUDoWJizy5QhaTe4p2uezYhK
lKtSHC7T6Brs6kWJA57j8BY5Tx4p6cyWRGsN58XXfmWg1hA1LjVIwgtSBvax7KRGUY6TXO
d5Km2MvJgBOfqAYfh1z0wZRiBdUa0RzsXavf4HGjnwPknYcSY1MwKZCzz_W0_uAiGlHFlN
wLSQ",
      "p": "5279rRhB4IBf5chMgrTVwsAEKWyEsRrIVs5xLFVA5rpOKLN6qGhLO6PU9j
msD7dYEa0IA-eTxVCCuMp09KEfyrRAn0OWpWdndu8IR_n2e4zZxBXbf4WuIeZwxfM5PqKi
5LOnp442CthmzbsVD2OLmlgSViWSAP9SLFOBGfniTqs",
      "q": "8WtasUyu9D9StGJkgolHjofbMnxXzRqpnA-QSV71htsQD3wof-vda8e8Jk
DLPPfAYuVYieCHeJYGsT9EHAG1Nyyr9OMzFeo73N1FdKGIGihWHSuvW6sRr6FTta12ZMN7
Jkm3l2rQoZALgvMtdYdDGJ-D3gwusW5nNS3-xJqMPds",
      "use": "sig"
    }
  ]
}
            </pre>
<p id="rfc.section.A.1.4.p.1">The RP gets a signing key </p>
<h1 id="rfc.appendix.A.1.5"><a href="#rfc.appendix.A.1.5">A.1.5.</a> Step 5 - RP produces a client registration request</h1>
<pre>
{
  "application_type": "web",
  "jwks_uri_signed": "https://example.com/rp1/jwks.jws",
  "redirect_uris": [
    "https://example.com/rp1/callback"
  ],
  "response_types": [
    "code"
  ],
  "signing_key": {
    "e": "AQAB",
    "kid": "Tvd2gF4mcNtiYx6FyOOH83Xj_MkF-8yn_rD2Gm06RxY",
    "kty": "RSA",
    "n": "2kCKMUluhKV2INV3dS89WQ305J6JL8OJQ1cPk3GQ20Zvraa3DCntNns1xy9g
ynGYUQzom7LYAqcmpu7xFGNXH0gN8JyXcCiWl02IuD6lwS6N2d7y6xJm8-mUBiwVrAlhwW
L1Bf8JRycRUQ51c6Y8yYrUf2pjeIFQBQEfUhcjNg13L1OUDoWJizy5QhaTe4p2uezYhKlK
tSHC7T6Brs6kWJA57j8BY5Tx4p6cyWRGsN58XXfmWg1hA1LjVIwgtSBvax7KRGUY6TXOd5
Km2MvJgBOfqAYfh1z0wZRiBdUa0RzsXavf4HGjnwPknYcSY1MwKZCzz_W0_uAiGlHFlNwL
SQ",
    "use": "sig"
  }
}
            </pre>
<p id="rfc.section.A.1.5.p.1">The RP produces a client registration request </p>
<h1 id="rfc.appendix.A.1.6"><a href="#rfc.appendix.A.1.6">A.1.6.</a> Step 6 - Developer produces metadata statement for RP</h1>
<pre>
{
  "application_type": "web",
  "jwks_uri_signed": "https://example.com/rp1/jwks.jws",
  "redirect_uris": [
    "https://example.com/rp1/callback"
  ],
  "response_types": [
    "code"
  ],
  "signing_key": {
    "e": "AQAB",
    "kid": "Tvd2gF4mcNtiYx6FyOOH83Xj_MkF-8yn_rD2Gm06RxY",
    "kty": "RSA",
    "n": "2kCKMUluhKV2INV3dS89WQ305J6JL8OJQ1cPk3GQ20Zvraa3DCntNns1xy9g
ynGYUQzom7LYAqcmpu7xFGNXH0gN8JyXcCiWl02IuD6lwS6N2d7y6xJm8-mUBiwVrAlhwW
L1Bf8JRycRUQ51c6Y8yYrUf2pjeIFQBQEfUhcjNg13L1OUDoWJizy5QhaTe4p2uezYhKlK
tSHC7T6Brs6kWJA57j8BY5Tx4p6cyWRGsN58XXfmWg1hA1LjVIwgtSBvax7KRGUY6TXOd5
Km2MvJgBOfqAYfh1z0wZRiBdUa0RzsXavf4HGjnwPknYcSY1MwKZCzz_W0_uAiGlHFlNwL
SQ",
    "use": "sig"
  },
  "metadata_statements": [
    "eyJraWQiOiJ1WlgwLVAxLVRNc1pScUsxU2VYcGRMZ3NMb2VVTnNrTjJXX3J3Qk5LQ
XRjIiwiYWxnIjoiUlMyNTYifQ.eyJwb2xpY3lfdXJpIjogImh0dHBzOi8vZXhhbXBsZS5j
b20vcG9saWN5Lmh0bWwiLCAidG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2QiOiAicHJpdm
F0ZV9rZXlfand0IiwgImNvbnRhY3RzIjogWyJkZXZfYWRtaW5AZXhhbXBsZS5jb20iXSwg
ImxvZ29fdXJpIjogImh0dHBzOi8vZXhhbXBsZS5jb20vbG9nby5qcGciLCAic2NvcGVzIj
ogWyJvcGVuaWQiLCAiZW1haWwiLCAicGhvbmUiXSwgImlhdCI6IDE0NjI0Mzg4MjAsICJp
c3MiOiAiaHR0cHM6Ly9zd2FtaWQuc3VuZXQuc2UvIiwgImtpZCI6ICJ1WlgwLVAxLVRNc1
pScUsxU2VYcGRMZ3NMb2VVTnNrTjJXX3J3Qk5LQXRjIiwgImp0aSI6ICJlOTIwMzk2ZmMy
Y2I0YWMwYWFlYjIyOTY3NGZkMjg2YSIsICJyZXNwb25zZV90eXBlcyI6IFsiY29kZSIsIC
Jjb2RlIGlkX3Rva2VuIiwgInRva2VuIl0sICJzaWduaW5nX2tleSI6IHsiZSI6ICJBUUFC
IiwgImtpZCI6ICJ6NDE0aFZ4dDItbmticWdHM1ZGWU9aR0IzTWl3dWhlNzVTZldUMUJRUV
RjIiwgImt0eSI6ICJSU0EiLCAidXNlIjogInNpZyIsICJuIjogIndhRFhHSnd1OXBWM2dN
WTdydHBxM09ZU0FHMUhaeTdxaWxHQzNVTE14SnhqaFNRQ0o3TTlQQkM0dW9GX2Y1MTc4Rm
VicEtCSW9UM19ZenFFVHQ5UnlfNk5BX21HQnE2eHRqRWdubU52Nmt0UWo4aEtJMHRZaGVX
UkhNSkl0MmF5OEl3blYtM0xEMFFfTm43RTNZZ0dhSlVCbHpEZ0p4UVFjUlZHRkVPY0ZMLT
dUaUt0VmRQbVBER2NTRjdGaXZhR0pPLU1WcW1Ea0NzWlZNVFpvcW1LZXVhcWJzaHNEanh5
OUdhaUltUUxlOHR5emtoeEVvRzdxdm92bEdvVjRBRThXcm9NaW54MHFXdmdsUjhuMDQxcV
FoclVNdG9RTURDSTUzdUx5NlpTUjBqYk5ORXd2REJiaXFENEhtM3BpQXdUVXJHS1dZTHhi
ZWljS183QTZnRjJTdyJ9LCAidG9zX3VyaSI6ICJodHRwczovL2V4YW1wbGUuY29tL3Rvcy
5odG1sIiwgImV4cCI6IDE0NjI0Mzg4MjB9.ZVnHkrdGqQTP36UXwZhb9hhcIc1hgkYNd8d
GsyS-uHojrr4lYqkAyDjCr39fJnGvRnJvm_-LQDBfaKFHyGjSCi97uQAN72lWC-FRs-wuE
D0abhgSEyrpDBSG0enNvIyOP_BEbo5xx950MJrlcmOT9s2MCI2KPKV4Rt8ZIJUdLO5kWPl
fzaHkRZenCnob7sKYY4mbFosrslT0ny51yFSbZLtvnc04dmR0Q8ccAYJkMfL4t-IIGrrKR
bDB6x52_gqJ8REgbhfiN6StM6jwiv_UydOjLXvFpsl5_5AZWWubNaIzj-4eCIpPFYjxBaO
Gcs0FsmD1irBDIAIQodidYoI6aA"
  ]
}
              </pre>
<p id="rfc.section.A.1.6.p.1">Developer produces metadata statement based on client registration request </p>
<h1 id="rfc.appendix.A.1.7"><a href="#rfc.appendix.A.1.7">A.1.7.</a> Step 7 - RP sends a client registration request to an OP</h1>
<pre>
{
  "redirect_uris": [
    "https://example.com/rp1/callback"
  ],
  "metadata_statement_uris": {
    "https://swamid.sunet.se/":
      "https://dev.example.com/rp1/idfed/swamid.jws",
  }
}
              </pre>
<p id="rfc.section.A.1.7.p.1">The RP sends a client registration request to the OP </p>
<h1 id="rfc.appendix.A.1.8"><a href="#rfc.appendix.A.1.8">A.1.8.</a> Step 8 - OP handles metadata statement</h1>
<p id="rfc.section.A.1.8.p.1">The OP fetches the metadata statement from the URI 'https://dev.example.com/rp1/idfed/swamid.jws' and then goes about unpacking the metadata. At this point in time the OP doesn't have the necessary key to verify the signature of the metadata.  Therefor it has to unpack the JWT without verifying the signature.  It will then get a JSON document looking like whats listed in step 6 above. From this document it can extract the metadata statement which should be signed by a key belonging to the FO.  The OP should have the fetched the public version of that key from the FO at some time prior to this.  It can now verify the signature of the metadata statement and unpack the JWT. The JSON document it then gets is the one listed in step 3. The signing key specified in that document can now be extracted and used to verify the signature of the metadata.  </p>
<p id="rfc.section.A.1.8.p.2">What's remaining now for the OP is to put all the pieces of the client registration request together. It will have one piece from the level 0 request augmented with the federation policy and then another piece from the RP.  </p>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#Notices" id="Notices">Notices</a></h1>
<p id="rfc.section.B.p.1">Copyright (c) 2016 The OpenID Foundation.</p>
<p id="rfc.section.B.p.2">The OpenID Foundation (OIDF) grants to any Contributor, developer, implementer, or other interested party a non-exclusive, royalty free, worldwide copyright license to reproduce, prepare derivative works from, distribute, perform and display, this Implementers Draft or Final Specification solely for the purposes of (i) developing specifications, and (ii) implementing Implementers Drafts and Final Specifications based on such documents, provided that attribution be made to the OIDF as the source of the material, but that such attribution does not indicate an endorsement by the OIDF.  </p>
<p id="rfc.section.B.p.3">The technology described in this specification was made available from contributions from various sources, including members of the OpenID Foundation and others.  Although the OpenID Foundation has taken steps to help ensure that the technology is available for distribution, it takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this specification or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any independent effort to identify any such rights. The OpenID Foundation and the contributors to this specification make no (and hereby expressly disclaim any) warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to this specification, and the entire risk as to implementing this specification is assumed by the implementer. The OpenID Intellectual Property Rights policy requires contributors to offer a patent promise not to assert certain patent claims against other contributors and against implementers. The OpenID Foundation invites any interested party to bring to its attention any copyrights, patents, patent applications, or other proprietary rights that may cover technology that may be required to practice this specification.  </p>
<h1 id="rfc.appendix.C"><a href="#rfc.appendix.C">Appendix C.</a> <a href="#History" id="History">Document History</a></h1>
<p id="rfc.section.C.p.1">[[ To be removed from the approved specification ]]</p>
<p id="rfc.section.C.p.2">-01 </p>

<ul>
  <li>Generalizing the specification</li>
</ul>

<p> </p>
<p id="rfc.section.C.p.3">-00 </p>

<ul>
  <li>Created openid-connect-federation-1_0-00 from draft-hedberg-oidc-fed-01.  </li>
</ul>

<p> </p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Roland Hedberg</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Hedberg</span>
	  </span>
	</span>
	<span class="org vcardline">independent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:roland@catalogix.se">roland@catalogix.se</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Rebecka Gulliksson</span> 
	  <span class="n hidden">
		<span class="family-name">Gulliksson</span>
	  </span>
	</span>
	<span class="org vcardline">Umea University</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rebecka.gulliksson@umu.se">rebecka.gulliksson@umu.se</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael B. Jones</span> 
	  <span class="n hidden">
		<span class="family-name">Jones</span>
	  </span>
	</span>
	<span class="org vcardline">Microsoft</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mbj@microsoft.com">mbj@microsoft.com</a></span>

<span class="vcardline">URI: <a href="http://self-issued.info/">http://self-issued.info/</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">John Bradley</span> 
	  <span class="n hidden">
		<span class="family-name">Bradley</span>
	  </span>
	</span>
	<span class="org vcardline">Ping Identity</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ve7jtb@ve7jtb.com">ve7jtb@ve7jtb.com</a></span>

<span class="vcardline">URI: <a href="http://www.thread-safe.com/">http://www.thread-safe.com/</a></span>

  </address>
</div>

</body>
</html>
