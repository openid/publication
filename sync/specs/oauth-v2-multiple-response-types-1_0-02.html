<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Draft: OAuth 2.0 Multiple Response Type Encoding Practices - draft 02</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="OAuth 2.0 Multiple Response Type Encoding Practices - draft 02">
<meta name="generator" content="xml2rfc v1.36 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Draft</td><td class="header">B. de Medeiros, Ed.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Scurtescu</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Google</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">P. Tarjan</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Facebook</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 14, 2011</td></tr>
</table></td></tr></table>
<h1><br />OAuth 2.0 Multiple Response Type Encoding Practices - draft 02</h1>

<h3>Abstract</h3>

<p>This specification aims to provide guidance on proper encoding of responses to
        OAuth 2.0 Authorization requests, where the request specifies a response type including
        space characters.
</p>
<p>This specification also serves as the registration document for several
        specific new response types, in accordance with the stipulations of
        the OAuth Parameters Registry.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#rnc">1.</a>&nbsp;
Requirements Notation and Conventions<br />
<a href="#terminology">2.</a>&nbsp;
Terminology<br />
<a href="#anchor1">3.</a>&nbsp;
Encoding Multiple-Valued Response Types<br />
<a href="#anchor2">4.</a>&nbsp;
ID Token Response Type<br />
<a href="#anchor3">5.</a>&nbsp;
None Response Type<br />
<a href="#anchor4">6.</a>&nbsp;
Registration of Some Multiple-Valued Response Type Combinations<br />
<a href="#rfc.references1">7.</a>&nbsp;
Normative References<br />
<a href="#anchor6">Appendix&nbsp;A.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor7">Appendix&nbsp;B.</a>&nbsp;
Document History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="rnc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Requirements Notation and Conventions</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> .
</p>
<p>Throughout this document, values are quoted to indicate that they are
      to be taken literally. When using these values in protocol messages, the
      quotes MUST NOT be used as part of the value.
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The following definitions define additional terminology used in this
      specification in addition to those defined in <a class='info' href='#OAuth.2.0'>OAuth 2.0<span> (</span><span class='info'>Hammer-Lahav, E., Ed., Recordon, D., and D. Hardt, &ldquo;OAuth 2.0 Authorization Protocol,&rdquo; September&nbsp;2011.</span><span>)</span></a> [OAuth.2.0].
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Client and Server</dt>
<dd>In the traditional client-server
            authentication model, the client requests an access restricted
            resource (protected resource) on the server by authenticating
            with the server using the resource owner's credentials. 
</dd>
<dt>Authorization Endpoint</dt>
<dd>A web resource maintained by
            the server, and used to obtain authorization (grant) from the
            resource owner via user-agent redirection.
</dd>
<dt>Response Type</dt>
<dd>The client informs the
            authorization server of the desired authorization processing flow using the
            parameter response_type.
</dd>
<dt>Authorization Endpoint Response Type Registry</dt>
<dd>
            Process established by the OAuth 2.0 specification for the registration of new
            response_type parameters.
</dd>
<dt>Multiple-Valued Response Types</dt>
<dd>The OAuth 2.0 specification allows
            for registration of space-separated response_type values. 
            If a response type contains one of more space characters (%20), it is
            compared as a space-delimited list of values in which the order of
            values does not matter.
</dd>
</dl></blockquote>

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Encoding Multiple-Valued Response Types</h3>

<p>This specification does not provide guidance if, in a request, response_type includes
        a value that requires the server to return data partially encoded in the query string
        and partially encoded in the fragment.
</p>
<p>Otherwise, if a multiple-valued response type is defined, then it is RECOMMENDED
        that the following encoding rules be applied for the issued response.
</p>
<p>If, in a request, response_type includes only values that require the server
         to return data fully encoded within the query string then
         the returned data in the response for this multiple-valued response_type
         MUST be fully encoded within the query string. This recommendation
         applies to both success and error responses.
</p>
<p>If, in a request, response_type includes any value that requires the server to
        return data fully encoded within the fragment then the returned data in the
        response for this multiple-valued response_type MUST be fully encoded
        within the fragment. This recommendation applies to both success and error responses.
</p>
<p>Rationale: Whenever response_type values include fragment-encoded parts,
        a user-agent client component must be involved to complete processing of the response.
        If a new query parameter is added to the client URI, it will cause the user-agent
        to re-fetch the client URI,
        causing discontinuity of operation of the user-agent-based client components. If instead
        only fragment encoding is used, the user-agent will simply re-active the client
        component, at which time this component may process the fragment and
        also convey any parameters to a client host as necessary, e.g., via XmlHttpRequest.
        Therefore, full fragment encoding always results in lower latency for response processing.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
ID Token Response Type</h3>

<p>This section registers a new response type, the id_token, in accordance
        with the stipulations in the OAuth 2.0 specification, Section 8.4. The intended purpose of
        the id_token is that it MUST provide an assertion of
        the identity of the resource owner as understood by the server. The assertion MUST 
        specify a targeted audience, e.g. the requesting client. However, the specific semantics of
        the assertion and how it can be validated are not specified in this document.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>id_token</dt>
<dd>If supplied as the response_type parameter in an OAuth 2.0
          Authorization Request, a successful response should include the parameter
          id_token encoded in the fragment of the response URI.
</dd>
</dl></blockquote>

<p>Returning the id_token in a fragment reduces the likelihood that the id_token leaks
        during transport and mitigates the associated risks to the privacy of the user (resource owner).
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
None Response Type</h3>

<p>This section registers the response type none, in accordance
        with the stipulations in the OAuth 2.0 specification, Section 8.4.
        The intended purpose is to enable
        use cases where a party requests the server to register a grant of access to a protected
        resource on behalf of a client but requires
        no access credentials to be returned to the client at that time. The means
        by which the client eventually obtains the access credentials is left unspecified here.
</p>
<p>One scenario is where a user wishes to purchase an
        application from a market, and desires to authorize application installation and grant
        the application access to protected resources in a single step. However, since the user is
        not presently interacting with the (not yet active) application, it is not appropriate
        to return access credentials simultaneously to the authorization step.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>none</dt>
<dd>When supplied as the response_type parameter in an OAuth 2.0 authorization
          request, the Authorization server SHOULD NOT return an OAuth 2.0 code nor a token in a successful
          response to the grant request. If a redirect_uri is supplied, the user-agent SHOULD be redirected
          there after granting or denying access. The request MAY include a state parameter, and if so the
          server MUST echo its value by adding it to the redirect_uri when issuing a successful response.
          Any parameters added to the redirect_uri should be query encoded. This applies to both successful
          responses and error responses.
</dd>
</dl></blockquote>

<p>The response type none SHOULD NOT be combined with other response types.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Registration of Some Multiple-Valued Response Type Combinations</h3>

<p>This section registers combinations of the values code, token, and id_token, which are each
        individually registered response types.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>code token</dt>
<dd>When supplied as the value for the response_type parameter, a successful
          response MUST include both an access token and an authorization code as defined in the OAuth 2.0
          specification. Both successful and error responses SHOULD be fragment-encoded.
</dd>
<dt>code id_token</dt>
<dd>When supplied as the value for the response_type parameter,
          a successful response MUST include both an authorization code as well as an id_token.
          Both success and error responses SHOULD be fragment-encoded.
</dd>
<dt>id_token token</dt>
<dd>When supplied as the value for the response_type parameter,
          a successful response MUST include both an access token as well as an id_token.
          Both success and error responses SHOULD be fragment-encoded.
</dd>
<dt>code id_token token</dt>
<dd>When supplied as the value for the response_type parameter,
          a successful response MUST include an authorization code, an id_token, and an access token.
          Both success and error responses SHOULD be fragment-encoded.
</dd>
</dl></blockquote>

<p>A non-normative request/response example as issued/received by the user-agent:
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>GET https://server.example.com/authorize?
response_type=token%20id_token
&amp;client_id=s6BhdRkqt3
&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
&amp;state=af0ifjsldkj HTTP/1.1
</pre></div><p>

          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>HTTP/1.1 302 Found
Location: https://client.example.com/#
access_token=SlAV32hkKG&amp;
token_type=bearer&amp;
id_token=1234567.SlAV32hkKG.abcde1234&amp;
expires_in=3600&amp;
&amp;state=af0ifjsldkj</pre></div><p>

    
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="OAuth.2.0">[OAuth.2.0]</a></td>
<td class="author-text">Hammer-Lahav, E., Ed., Recordon, D., and D. Hardt, &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2">OAuth 2.0 Authorization Protocol</a>,&rdquo; September&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgements</h3>

<p>The OpenID Community would like to thank the following people for the
      work they've done in the drafting and editing of this specification.
</p>
<p></p>
<blockquote class="text">
<p>Naveen Agarwal (naa@google.com), Google
</p>
<p>Breno de Medeiros (breno@google.com), Google
</p>
<p>David Recordon (dr@fb.com), Facebook
</p>
<p>Marius Scurtescu (mscurtescu@google.com), Google
</p>
<p>Paul Tarjan (pt@fb.com), Facebook
</p>
</blockquote>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Document History</h3>

<p>[[ To be removed from the final specification ]]
</p>
<p>-02 </p>
<ul class="text">
<li>Editorial corrections
</li>
</ul>

<p>-01 </p>
<ul class="text">
<li>Initial draft
</li>
</ul>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Breno (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Google, Inc.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:breno@google.com">breno@google.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Marius</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Google, Inc.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mscurtescu@google.com">mscurtescu@google.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Paul</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Facebook</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pt@fb.com">pt@fb.com</a></td></tr>
</table>
</body></html>
