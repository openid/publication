<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Draft: OpenID Connect
    Session Management 1.0 - draft 30</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="OpenID Connect
    Session Management 1.0 - draft 30">
<meta name="generator" content="xml2rfc v1.37pre1 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Draft</td><td class="header">B. de Medeiros</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Google</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">N. Agarwal</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Microsoft</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">N. Sakimura</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">NAT.Consulting</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Bradley</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Yubico</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Jones</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Microsoft</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">August 7, 2020</td></tr>
</table></td></tr></table>
<h1><br />OpenID Connect
    Session Management 1.0 - draft 30</h1>

<h3>Abstract</h3>

<p>OpenID Connect 1.0 is a simple identity layer on top of the OAuth 2.0
      protocol. It enables Clients to verify the identity of the End-User based
      on the authentication performed by an Authorization Server, as well as to
      obtain basic profile information about the End-User in an interoperable and
      REST-like manner.
</p>
<p>
	This document describes how to manage sessions for OpenID Connect,
	including when to log out the End-User.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rnc">1.1.</a>&nbsp;
Requirements Notation and Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Terminology">1.2.</a>&nbsp;
Terminology<br />
<a href="#CreatingUpdatingSessions">2.</a>&nbsp;
Creating and Updating Sessions<br />
<a href="#ChangeNotification">3.</a>&nbsp;
Session Status Change Notification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#RPiframe">3.1.</a>&nbsp;
RP iframe<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#OPiframe">3.2.</a>&nbsp;
OP iframe<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#OPMetadata">3.3.</a>&nbsp;
OpenID Provider Discovery Metadata<br />
<a href="#Validation">4.</a>&nbsp;
Validation<br />
<a href="#ImplementationConsiderations">5.</a>&nbsp;
Implementation Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ThirdPartyContent">5.1.</a>&nbsp;
User Agents Blocking Access to Third-Party Content<br />
<a href="#Security">6.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">7.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#OAuthParams">7.1.</a>&nbsp;
OAuth Parameters Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ParametersContents">7.1.1.</a>&nbsp;
Registry Contents<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ASMetadataRegistry">7.2.</a>&nbsp;
OAuth Authorization Server Metadata Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#MetadataContents">7.2.1.</a>&nbsp;
Registry Contents<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#Acknowledgements">Appendix&nbsp;A.</a>&nbsp;
Acknowledgements<br />
<a href="#Notices">Appendix&nbsp;B.</a>&nbsp;
Notices<br />
<a href="#History">Appendix&nbsp;C.</a>&nbsp;
Document History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
	OpenID Connect 1.0 is a simple identity layer on top of the OAuth 2.0
	<a class='info' href='#RFC6749'>[RFC6749]<span> (</span><span class='info'>Hardt, D., Ed., &ldquo;The OAuth 2.0 Authorization Framework,&rdquo; October&nbsp;2012.</span><span>)</span></a>
	protocol. It enables Clients to verify the identity of the End-User based
	on the authentication performed by an Authorization Server, as well as to
	obtain basic profile information about the End-User in an interoperable and
	REST-like manner.
      
</p>
<p>
	This specification complements the
	<a class='info' href='#OpenID.Core'>OpenID Connect Core 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;OpenID Connect Core 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Core] specification
	by defining how to monitor the End-User's
	login status at the OpenID Provider on an ongoing basis so
	that the Relying Party can log out an End-User who has
	logged out of the OpenID Provider.
      
</p>
<p>
	Both this specification and the
	<a class='info' href='#OpenID.FrontChannel'>OpenID Connect Front-Channel Logout 1.0<span> (</span><span class='info'>Jones, M., &ldquo;OpenID Connect Front-Channel Logout 1.0,&rdquo; August&nbsp;2020.</span><span>)</span></a> [OpenID.FrontChannel]
	specification use front-channel communication,
	which communicate logout requests from the OP to RPs via the User Agent.
	In contrast, the
	<a class='info' href='#OpenID.BackChannel'>OpenID Connect Back-Channel Logout 1.0<span> (</span><span class='info'>Jones, M. and J. Bradley, &ldquo;OpenID Connect Back-Channel Logout 1.0,&rdquo; August&nbsp;2020.</span><span>)</span></a> [OpenID.BackChannel]
	specification uses direct back-channel
	communication between the OP and RPs being logged out.
	The
	<a class='info' href='#OpenID.RPInitiated'>OpenID Connect RP-Initiated Logout 1.0<span> (</span><span class='info'>Jones, M., de Medeiros, B., Agarwal, N., Sakimura, N., and J. Bradley, &ldquo;OpenID Connect RP-Initiated Logout 1.0,&rdquo; August&nbsp;2020.</span><span>)</span></a> [OpenID.RPInitiated]
	specification complements these specifications by defining a mechanism for a Relying Party
	to request that an OpenID Provider log out the End-User.
	This specification can be used separately from or in combination with
	these other three specifications.
      
</p>
<a name="rnc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Notation and Conventions</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p>
	  In the .txt version of this document,
	  values are quoted to indicate that they are to be taken literally.
	  When using these values in protocol messages,
	  the quotes MUST NOT be used as part of the value.
	  In the HTML version of this document,
	  values to be taken literally are indicated by
	  the use of <tt>this fixed-width font</tt>.
	
</p>
<a name="Terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>

<p>
	  This specification uses the terms
	  "Authorization Endpoint", "Authorization Server",
	  "Client", and "Client Identifier"
	  defined by <a class='info' href='#RFC6749'>OAuth 2.0<span> (</span><span class='info'>Hardt, D., Ed., &ldquo;The OAuth 2.0 Authorization Framework,&rdquo; October&nbsp;2012.</span><span>)</span></a> [RFC6749],
	  the term "User Agent" defined by <a class='info' href='#RFC7230'>RFC 7230<span> (</span><span class='info'>Fielding, R., Ed. and J. Reschke, Ed., &ldquo;Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing,&rdquo; June&nbsp;2014.</span><span>)</span></a> [RFC7230],
	  and the terms defined by
	  <a class='info' href='#OpenID.Core'>OpenID Connect Core 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;OpenID Connect Core 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Core].
	
</p>
<p>
	  This specification also defines the following term:
	  </p>
<blockquote class="text"><dl>
<dt>Session</dt>
<dd>
	      
	      Continuous period of time during which an End-User
	      accesses a Relying Party relying on the Authentication
	      of the End-User performed by the OpenID Provider.
	    
</dd>
</dl></blockquote><p>
	
</p>
<p>
	  IMPORTANT NOTE TO READERS: The terminology definitions in
	  this section are a normative portion of this specification,
	  imposing requirements upon implementations.  All the
	  capitalized words in the text of this specification, such as
	  "Session", reference these defined terms.
	  Whenever the reader encounters them, their definitions
	  found in this section must be followed.
	
</p>
<a name="CreatingUpdatingSessions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Creating and Updating Sessions</h3>

<p>
	In OpenID Connect, the session at the RP typically starts when the RP
	validates the End-User's ID Token.
	Refer to the OpenID Connect Core 1.0 <a class='info' href='#OpenID.Core'>[OpenID.Core]<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;OpenID Connect Core 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a>
	specification to find
	out how to obtain an ID Token and validate it.
	When the OP supports session management, it MUST also return the Session State
	as an additional <tt>session_state</tt> parameter
	in the Authentication Response and SHOULD also return the Session State
	as an additional <tt>session_state</tt> parameter
	in the Authentication Error Response.
	The OpenID Connect Authentication Response is specified in Section 3.1.2.5 of
	OpenID Connect Core 1.0.
	The OpenID Connect Authentication Error Response is specified in Section 3.1.2.6 of
	OpenID Connect Core 1.0.
      
</p>
<p>This parameter is:
</p>
<p>
	</p>
<blockquote class="text"><dl>
<dt>session_state</dt>
<dd>
	    
	    Session State.
	    JSON <a class='info' href='#RFC7159'>[RFC7159]<span> (</span><span class='info'>Bray, T., Ed., &ldquo;The JavaScript Object Notation (JSON) Data Interchange Format,&rdquo; March&nbsp;2014.</span><span>)</span></a> string that represents the End-User's login state
	    at the OP.
	    It MUST NOT contain the space (" ") character.
	    This value is opaque to the RP.
	    This is REQUIRED if session management is supported.
	  
</dd>
</dl></blockquote><p>
      
</p>
<p>
	The Session State value is initially calculated on the server.
	The same Session State value is also recalculated by the OP iframe in the User Agent.
	The generation of suitable Session State values is specified in <a class='info' href='#OPiframe'>Section&nbsp;3.2<span> (</span><span class='info'>OP iframe</span><span>)</span></a>,
	and is based on a salted cryptographic hash of Client ID, origin URL, and OP User Agent state.
	For the origin URL, the server can use the origin URL of the Authentication Response,
	following the algorithm specified in Section 4 of <a class='info' href='#RFC6454'>RFC 6454<span> (</span><span class='info'>Barth, A., &ldquo;The Web Origin Concept,&rdquo; December&nbsp;2011.</span><span>)</span></a> [RFC6454].
      
</p>
<a name="ChangeNotification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Session Status Change Notification</h3>

<p>
	It is
	highly desirable to be able to determine the login status of the End-User at
	the OP.
	To do so, it is possible to repeat the Authentication Request with
	<tt>prompt=none</tt>.
	However, this causes network traffic and this is
	problematic on the mobile devices that are becoming increasingly
	popular. Therefore, once the session is established with the
	Authentication Request and Response, it is desirable to be able to check
	the login status at the OP without causing network traffic by polling
	a hidden OP iframe from an RP iframe with an origin restricted postMessage
	as follows.
      
</p>
<a name="RPiframe"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
RP iframe</h3>

<p>
	  The RP loads an invisible iframe from itself.
	  This iframe MUST know:
	  </p>
<ul class="text">
<li>
	      the ID of the OP iframe,
	      as described in <a class='info' href='#OPiframe'>Section&nbsp;3.2<span> (</span><span class='info'>OP iframe</span><span>)</span></a>, so that it can
	      postMessage to the OP iframe, and
	    
</li>
<li>
	      the origin URL of the OP iframe, so that it can
	      ensure messages are dispatched to and only processed when originating
	      from the OP.
	    
</li>
</ul><p>
	  The RP iframe polls the OP iframe with postMessage at an interval
	  suitable for the RP application. With each postMessage, it sends the
	  session state defined in <a class='info' href='#OPiframe'>Section&nbsp;3.2<span> (</span><span class='info'>OP iframe</span><span>)</span></a>.
	  The RP iframe MUST enforce that it only processes messages
	  from the origin of the OP frame. It MUST reject postMessage
	  requests from any other source origin,
	  to prevent cross-site scripting attacks.
	
</p>
<p>
	  The postMessage from the RP iframe delivers the
	  following concatenation as the data:

	  </p>
<ul class="text">
<li>Client ID + " " + Session State
</li>
</ul><p>
	
</p>
<p>
	  It also has to be able to
	  receive the postMessage back from the OP iframe. The received data
	  will either be <tt>changed</tt> or
	  <tt>unchanged</tt>
	  unless the syntax of the message sent was determined by the OP to be malformed,
	  in which case the received data will be <tt>error</tt>.
	  Upon receipt of
	  <tt>changed</tt>, the RP MUST perform re-authentication with
	  <tt>prompt=none</tt> to obtain the current
	  session state at the OP.
	  Upon receipt of
	  <tt>error</tt>, the RP MUST NOT perform re-authentication
	  with <tt>prompt=none</tt>, so as to not cause potential
	  infinite loops that generate network traffic to the OP.
	
</p>
<p>
	  Following is non-normative example pseudo-code for the RP iframe:
	
</p>
<p>
	  </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  var stat = "unchanged";
  var mes = client_id + " " + session_state;
  var targetOrigin = "https://server.example.com"; // Validates origin
  var opFrameId = "op";
  var timerID;

  function check_session()   {
    var win = window.parent.frames[opFrameId].contentWindow
    win.postMessage(mes, targetOrigin);
  }

  function setTimer() {
    check_session();
    timerID = setInterval(check_session, 5 * 1000);
  }

  window.addEventListener("message", receiveMessage, false);

  function receiveMessage(e) {
    if (e.origin !== targetOrigin) {
      return;
    }
    stat = e.data;

    if (stat === "changed") {
      clearInterval(timerID);
      // then take the actions below...
    }
  }

  setTimer();
</pre></div><p>

	
</p>
<p>
	  When the RP detects a session state change, it SHOULD first
	  try a <tt>prompt=none</tt> request
	  within an iframe to obtain a
	  new ID Token and session state, sending the old ID Token as
	  the <tt>id_token_hint</tt>.
	  If the RP receives an ID token for the same End-User, it SHOULD
	  simply update the value of the session state.  If it does not
	  receive an ID token or receives an ID token for another
	  End-User, then it needs to handle this case as a logout for the
	  original End-User.
	  If the original End-User is already logged out at the RP when
	  the state changes indicate that End-User should be logged out,
	  the logout is considered to have succeeded.
	
</p>
<p>
	  Note that the session state is origin bound.
	  In deployments with multiple subdomains sharing the same RP session,
	  it is important that the parent window and the RP iframe both set the same
	  <tt>document.domain</tt> to comply with same-origin restrictions.
	  This will allow the RP iframe to target the parent window's embedded OP iframe.
	
</p>
<a name="OPiframe"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
OP iframe</h3>

<p>
	  The RP also loads an invisible OP iframe into itself from the OP's
	  <tt>check_session_iframe</tt>.
	  The RP MUST assign an <tt>id</tt> attribute to the iframe so that it can
	  address it, as described above.
	  The OP iframe MUST enforce that the caller is from an expected origin.
	  It MUST reject postMessage requests from any other source origin
	  to prevent cross-site scripting attacks.
	
</p>
<p>
	  As specified in <a class='info' href='#RPiframe'>Section&nbsp;3.1<span> (</span><span class='info'>RP iframe</span><span>)</span></a>,
	  the postMessage from the RP iframe delivers the
	  following concatenation as the data:

	  </p>
<ul class="text">
<li>Client ID + " " + Session State
</li>
</ul><p>
	
</p>
<p>
	  The OP iframe has access to User Agent state at the OP (in a
	  cookie or in HTML5 storage) that it uses to calculate and
	  compare with the OP session state that was passed by the RP.
	  The OP iframe MUST recalculate it from the previously
	  obtained Client ID, the source origin URL (from the
	  postMessage), and the current OP User Agent state.
	  The session state includes all of this information for privacy reasons,
	  so that different clients active in the same User Agent
	  have distinct session state values.
	
</p>
<p>
	  If the postMessage received is syntactically malformed in such a way
	  that the posted Client ID and origin URL cannot be determined
	  or are syntactically invalid, then the OP iframe SHOULD
	  postMessage the string <tt>error</tt> back to the source.
	  If the received value and the
	  calculated value do not match, then the OP iframe MUST postMessage
	  the string <tt>changed</tt> back to the source.
	  If it matched, then it MUST postMessage the string
	  <tt>unchanged</tt>.
	
</p>
<p>
	  Following is non-normative example pseudo-code for the OP iframe:
	
</p>
<p>
	  </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  window.addEventListener("message", receiveMessage, false);

  function receiveMessage(e){ // e.data has client_id and session_state

    var client_id = e.data.split(' ')[0];
    var session_state = e.data.split(' ')[1];
    var salt = session_state.split('.')[1];

    // if message is syntactically invalid
    //     postMessage('error', e.origin) and return

    // if message comes an unexpected origin
    //     postMessage('error', e.origin) and return

    // get_op_user_agent_state() is an OP defined function
    // that returns the User Agent's login status at the OP.
    // How it is done is entirely up to the OP.
    var opuas = get_op_user_agent_state();

    // Here, the session_state is calculated in this particular way,
    // but it is entirely up to the OP how to do it under the
    // requirements defined in this specification.
    var ss = CryptoJS.SHA256(client_id + ' ' + e.origin + ' ' +
      opuas + ' ' + salt) + "." + salt;

    var stat = '';
    if (session_state === ss) {
      stat = 'unchanged';
    } else {
      stat = 'changed';
    }

    e.source.postMessage(stat, e.origin);
  };
</pre></div><p>

	
</p>
<p>
	  The OP User Agent state is typically going to be stored in a
	  cookie or HTML5 local storage.  It is origin bound to the
	  Authorization Server.  It captures meaningful events such as
	  logins, logouts, change of user,
	  change of authentication status for Clients being used by the End-User,
	  etc.  Thus, the OP SHOULD
	  update the value of the User Agent state in response to such
	  meaningful events. As a result, the next call to
	  check_session() after such an event will return the
	  value <tt>changed</tt>.
	  It is RECOMMENDED that the OP not update
	  the User Agent state too frequently in the absence of
	  meaningful events so as to spare excessive network traffic
	  at the Client in response to spurious <tt>changed</tt> events.
	
</p>
<p>
	  The computation of the session state returned in response to
	  unsuccessful Authentication Requests SHOULD, in addition to
	  the User Agent state, incorporate sufficient randomness in the
	  form of a salt so as to prevent identification of an End-User
	  across successive calls to the OP's Authorization Endpoint.
	
</p>
<p>
	  In the case of an authorized Client (successful
	  Authentication Response), the OP SHOULD change the value of
	  the session state returned to the Client under one of the
	  following events:

	  </p>
<ul class="text">
<li>
	      The set of users authenticated to the User Agent changes
	      (login, logout, session add).
	    
</li>
<li>
	      The authentication status of Clients being used by the End-User changes.
	    
</li>
</ul><p>
	
</p>
<p>
	  In addition, the User Agent state used to verify the session state
	  SHOULD change with such events.
	  Calls to check_session() will return <tt>changed</tt>
	  against earlier versions of session state after such events.
	  It is RECOMMENDED that the User Agent state SHOULD NOT vary too
	  frequently in the absence of such events to minimize network
	  traffic caused by the Client's response to <tt>changed</tt>
	  notifications.
	
</p>
<p>
	  In the case of an unsuccessful Authentication Request
	  that results in an Authentication Error Response
	  as specified in Section 3.1.2.6 of OpenID Connect Core 1.0, the
	  value of the session state returned SHOULD vary with each
	  request. However, the User Agent session state need not change
	  unless a meaningful event happens. In particular, many
	  values of session state can be simultaneously valid, for
	  instance by the introduction of random salt in the session
	  states issued in response to unsuccessful Authentication Requests.
	
</p>
<p>
	  If a cookie is used to maintain the OP User Agent state,
	  the HttpOnly flag likely cannot be set for this cookie
	  because it needs to be accessed from JavaScript.
	  Therefore, information that can be used for identifying the user
	  should not be put into the cookie, as it could be read by unrelated JavaScript.
	
</p>
<p>
	  In some implementations, <tt>changed</tt>
	  notifications will occur only when changes to the End-User's
	  session occur, whereas in other implementations, they might
	  also occur as a result of changes to other sessions between
	  the User Agent and the OP.
	  RPs need to be prepared for either eventuality,
	  silently handling any false positives that might occur.
	
</p>
<a name="OPMetadata"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
OpenID Provider Discovery Metadata</h3>

<p>
	  To support OpenID Connect Session Management, the RP needs to obtain
	  the Session Management related OP metadata.
	  This OP metadata is normally obtained via the OP's Discovery response,
	  as described in <a class='info' href='#OpenID.Discovery'>OpenID Connect Discovery 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., and E. Jay, &ldquo;OpenID Connect Discovery 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Discovery],
	  or MAY be learned via other mechanisms.
	
</p>
<p>
	  This OpenID Provider Metadata parameter MUST be included in
	  the Server's discovery responses
	  when Session Management and Discovery are supported:
	
</p>
<p>
	  </p>
<blockquote class="text"><dl>
<dt>check_session_iframe</dt>
<dd>
	      
	      REQUIRED.
	      URL of an OP iframe that supports cross-origin communications
	      for session state information with the RP Client,
	      using the HTML5 postMessage API.
	      This URL MUST use the <tt>https</tt> scheme
	      and MAY contain port, path, and query parameter components.
	      The page is loaded from an invisible iframe embedded in
	      an RP page so that it can run in the OP's security context.
	      It accepts postMessage requests from the relevant RP iframe and
	      uses postMessage to post back the login status of the End-User at the OP.
	    
</dd>
</dl></blockquote><p>
	
</p>
<a name="Validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Validation</h3>

<p>
	If any of the validation procedures defined in this specification fail, any operations requiring
	the information that failed to correctly validate MUST be aborted and
	the information that failed to validate MUST NOT be used.
      
</p>
<a name="ImplementationConsiderations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Implementation Considerations</h3>

<p>
	This specification defines features used by both Relying Parties and
	OpenID Providers that choose to implement Session Management.
	All of these Relying Parties and OpenID Providers
	MUST implement the features that are listed
	in this specification as being "REQUIRED" or are described with a "MUST".
      
</p>
<a name="ThirdPartyContent"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
User Agents Blocking Access to Third-Party Content</h3>

<p>
	  Note that at the time of this writing,
	  some User Agents (browsers) are starting to block access to third-party content by default
	  to block some mechanisms used to track the End-User's activity across sites.
	  Specifically, the third-party content being blocked is
	  website content with an origin different that the origin of the focused User Agent window.
	  Site data includes cookies and any web storage APIs (sessionStorage, localStorage, etc.).
	
</p>
<p>
	  This can prevent the ability for notifications from the OP at the RP
	  from being able to access the RP's User Agent state to implement local logout actions.
	  In particular, cookies and web storage APIs may not be available in the OP frame loaded in the RP context.
	  The side effect here is that, depending on the used mechanism (cookies or web storage),
	  the data needed to recalculate <tt>session_state</tt> might not be available.
	  Cookie based implementations might then return <tt>changed</tt> for every single call,
	  resulting in infinite loops of re-authentications.
	  Therefore, deployments of this specification are recommended to include defensive code to detect this situation,
	  and if possible, notify the End-User that the requested RP logouts could not be performed.
	  The details of the defensive code needed are beyond the scope of this specification;
	  it may vary per User Agent and may vary over time,
	  as the User Agent tracking prevention situation is fluid and continues to evolve.
	
</p>
<p>
	  <a class='info' href='#OpenID.BackChannel'>OpenID Connect Back-Channel Logout 1.0<span> (</span><span class='info'>Jones, M. and J. Bradley, &ldquo;OpenID Connect Back-Channel Logout 1.0,&rdquo; August&nbsp;2020.</span><span>)</span></a> [OpenID.BackChannel] is not known to be affected by these developments.
	
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
	The OP iframe MUST enforce that the caller is from an expected origin.
	It MUST reject postMessage requests from any other source origin
	to prevent cross-site scripting attacks.
      
</p>
<p>
	The RP iframe MUST enforce that it only processes messages
	from the origin of the OP frame. It MUST reject postMessage
	requests from any other source origin
	to prevent cross-site scripting attacks.
      
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<a name="OAuthParams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
OAuth Parameters Registry</h3>

<p>
	  This specification registers the following parameter
	  in the IANA
	  "OAuth Parameters" registry <a class='info' href='#IANA.OAuth.Parameters'>[IANA.OAuth.Parameters]<span> (</span><span class='info'>IANA, &ldquo;OAuth Parameters,&rdquo; .</span><span>)</span></a>
	  established by <a class='info' href='#RFC6749'>RFC 6749<span> (</span><span class='info'>Hardt, D., Ed., &ldquo;The OAuth 2.0 Authorization Framework,&rdquo; October&nbsp;2012.</span><span>)</span></a> [RFC6749].
	
</p>
<a name="ParametersContents"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
Registry Contents</h3>

<p> 
	    </p>
<ul class="text">
<li>Parameter name: <tt>session_state</tt>
</li>
<li>Parameter usage location: Authorization Response,
	      Access Token Response
</li>
<li>Change controller: OpenID Foundation Artifact Binding Working Group - openid-specs-ab@lists.openid.net
</li>
<li>Specification document(s): <a class='info' href='#CreatingUpdatingSessions'>Section&nbsp;2<span> (</span><span class='info'>Creating and Updating Sessions</span><span>)</span></a> of this document
</li>
<li>Related information: None
</li>
</ul><p>
	  
</p>
<a name="ASMetadataRegistry"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
OAuth Authorization Server Metadata Registry</h3>

<p>
	  This specification registers the following metadata name in the
	  IANA "OAuth Authorization Server Metadata" registry <a class='info' href='#IANA.OAuth.Parameters'>[IANA.OAuth.Parameters]<span> (</span><span class='info'>IANA, &ldquo;OAuth Parameters,&rdquo; .</span><span>)</span></a>
	  established by <a class='info' href='#RFC8414'>[RFC8414]<span> (</span><span class='info'>Jones, M., Sakimura, N., and J. Bradley, &ldquo;OAuth 2.0 Authorization Server Metadata,&rdquo; June&nbsp;2018.</span><span>)</span></a>.
	
</p>
<a name="MetadataContents"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.1"></a><h3>7.2.1.&nbsp;
Registry Contents</h3>

<p>
	    
            </p>
<ul class="text">
<li>
                Metadata Name: <tt>check_session_iframe</tt>
              
</li>
<li>
                Metadata Description:
		URL of an OP iframe that supports cross-origin communications
		for session state information with the RP Client,
		using the HTML5 postMessage API
              
</li>
<li>
                Change Controller: OpenID Foundation Artifact Binding Working Group - openid-specs-ab@lists.openid.net
              
</li>
<li>
                Specification Document(s): <a class='info' href='#OPMetadata'>Section&nbsp;3.3<span> (</span><span class='info'>OpenID Provider Discovery Metadata</span><span>)</span></a> of this document
              
</li>
</ul><p>
	  
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IANA.OAuth.Parameters">[IANA.OAuth.Parameters]</a></td>
<td class="author-text">IANA, &ldquo;<a href="http://www.iana.org/assignments/oauth-parameters">OAuth Parameters</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="OpenID.BackChannel">[OpenID.BackChannel]</a></td>
<td class="author-text">Jones, M. and J. Bradley, &ldquo;<a href="http://openid.net/specs/openid-connect-backchannel-1_0.html">OpenID Connect Back-Channel Logout 1.0</a>,&rdquo; August&nbsp;2020.</td></tr>
<tr><td class="author-text" valign="top"><a name="OpenID.Core">[OpenID.Core]</a></td>
<td class="author-text">Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a>,&rdquo; November&nbsp;2014.</td></tr>
<tr><td class="author-text" valign="top"><a name="OpenID.Discovery">[OpenID.Discovery]</a></td>
<td class="author-text">Sakimura, N., Bradley, J., Jones, M., and E. Jay, &ldquo;<a href="http://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a>,&rdquo; November&nbsp;2014.</td></tr>
<tr><td class="author-text" valign="top"><a name="OpenID.FrontChannel">[OpenID.FrontChannel]</a></td>
<td class="author-text">Jones, M., &ldquo;<a href="http://openid.net/specs/openid-connect-frontchannel-1_0.html">OpenID Connect Front-Channel Logout 1.0</a>,&rdquo; August&nbsp;2020.</td></tr>
<tr><td class="author-text" valign="top"><a name="OpenID.RPInitiated">[OpenID.RPInitiated]</a></td>
<td class="author-text">Jones, M., de Medeiros, B., Agarwal, N., Sakimura, N., and J. Bradley, &ldquo;<a href="http://openid.net/specs/openid-connect-rpinitiated-1_0.html">OpenID Connect RP-Initiated Logout 1.0</a>,&rdquo; August&nbsp;2020.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="https://www.rfc-editor.org/info/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, DOI&nbsp;10.17487/RFC2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC6454">[RFC6454]</a></td>
<td class="author-text">Barth, A., &ldquo;<a href="https://www.rfc-editor.org/info/rfc6454">The Web Origin Concept</a>,&rdquo; RFC&nbsp;6454, DOI&nbsp;10.17487/RFC6454, December&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC6749">[RFC6749]</a></td>
<td class="author-text">Hardt, D., Ed., &ldquo;<a href="https://www.rfc-editor.org/info/rfc6749">The OAuth 2.0 Authorization Framework</a>,&rdquo; RFC&nbsp;6749, DOI&nbsp;10.17487/RFC6749, October&nbsp;2012.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC7159">[RFC7159]</a></td>
<td class="author-text">Bray, T., Ed., &ldquo;<a href="https://www.rfc-editor.org/info/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>,&rdquo; RFC&nbsp;7159, DOI&nbsp;10.17487/RFC7159, March&nbsp;2014.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC7230">[RFC7230]</a></td>
<td class="author-text">Fielding, R., Ed. and J. Reschke, Ed., &ldquo;<a href="https://www.rfc-editor.org/info/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>,&rdquo; RFC&nbsp;7230, DOI&nbsp;10.17487/RFC7230, June&nbsp;2014.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC8414">[RFC8414]</a></td>
<td class="author-text">Jones, M., Sakimura, N., and J. Bradley, &ldquo;<a href="https://www.rfc-editor.org/info/rfc8414">OAuth 2.0 Authorization Server Metadata</a>,&rdquo; RFC&nbsp;8414, DOI&nbsp;10.17487/RFC8414, June&nbsp;2018.</td></tr>
</table>

<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgements</h3>

<p>
	The OpenID Community would like to thank the following people for
	their contributions to this specification:
      
</p>
<p>
        </p>
<blockquote class="text">
<p>Naveen Agarwal (Naveen.Agarwal@microsoft.com), Microsoft
</p>
<p>Amanda Anganes (aanganes@mitre.org), MITRE
</p>
<p>John Bradley (ve7jtb@ve7jtb.com), Yubico
</p>
<p>Breno de Medeiros (breno@google.com), Google
</p>
<p>Vladimir Dzhuvinov (vladimir@connect2id.com), Connect2id
</p>
<p>George Fletcher (george.fletcher@corp.aol.com), AOL
</p>
<p>Edmund Jay (ejay@mgi1.com), Illumila
</p>
<p>Michael B. Jones (mbj@microsoft.com), Microsoft
</p>
<p>Tom Jones (thomasclinganjones@gmail.com), Independent
</p>
<p>Todd Lainhart (lainhart@us.ibm.com), IBM
</p>
<p>Torsten Lodderstedt (torsten@lodderstedt.net), yes.com
</p>
<p>Anthony Nadalin (tonynad@microsoft.com), Microsoft
</p>
<p>Axel Nennker (axel.nennker@telekom.de), Deutsche Telekom
</p>
<p>Justin Richer (justin@bspk.io), Bespoke Engineering
</p>
<p>Nat Sakimura (nat@nat.consulting), NAT.Consulting
</p>
<p>Filip Skokan (panva.ip@gmail.com), Auth0
</p>
<p>Hans Zandbelt (hans.zandbelt@zmartzone.eu), ZmartZone
</p>
</blockquote><p>
      
</p>
<a name="Notices"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Notices</h3>

<p>Copyright (c) 2020 The OpenID Foundation.
</p>
<p>The OpenID Foundation (OIDF) grants to any Contributor, developer,
      implementer, or other interested party a non-exclusive, royalty free,
      worldwide copyright license to reproduce, prepare derivative works from,
      distribute, perform and display, this Implementers Draft or Final
      Specification solely for the purposes of (i) developing specifications,
      and (ii) implementing Implementers Drafts and Final Specifications based
      on such documents, provided that attribution be made to the OIDF as the
      source of the material, but that such attribution does not indicate an
      endorsement by the OIDF.
</p>
<p>The technology described in this specification was made available
      from contributions from various sources, including members of the OpenID
      Foundation and others. Although the OpenID Foundation has taken steps to
      help ensure that the technology is available for distribution, it takes
      no position regarding the validity or scope of any intellectual property
      or other rights that might be claimed to pertain to the implementation
      or use of the technology described in this specification or the extent
      to which any license under such rights might or might not be available;
      neither does it represent that it has made any independent effort to
      identify any such rights. The OpenID Foundation and the contributors to
      this specification make no (and hereby expressly disclaim any)
      warranties (express, implied, or otherwise), including implied
      warranties of merchantability, non-infringement, fitness for a
      particular purpose, or title, related to this specification, and the
      entire risk as to implementing this specification is assumed by the
      implementer. The OpenID Intellectual Property Rights policy requires
      contributors to offer a patent promise not to assert certain patent
      claims against other contributors and against implementers. The OpenID
      Foundation invites any interested party to bring to its attention any
      copyrights, patents, patent applications, or other proprietary rights
      that may cover technology that may be required to practice this
      specification.
</p>
<a name="History"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Document History</h3>

<p>[[ To be removed from the final specification ]]
</p>
<p>
        -30
        </p>
<ul class="text">
<li>
	    Fixed #1038 - Add RP iframe / parent window communication cross-origin note.
	  
</li>
<li>
	    Fixed #1011 - Replaced uses of "Browser" with "User Agent".
	  
</li>
<li>
	    Fixed #1033 - Removed misleading statement about ID Token expiration.
	    Note that the fix to #1071 already addressed the main point of this issue.
	  
</li>
<li>
	    Fixed #1030 - Specify the use of HTTPS URIs.
	  
</li>
<li>
	    Fixed #1003 - Document possible impacts of disabling access to third-party content.
	  
</li>
<li>
	    Fixed #1133 - Clarify that logout notifications to RPs are idempotent.
	  
</li>
<li>
	    Fixed #1022 - Session Management OP Frame message origin assertion.
	  
</li>
<li>
	    Fixed #1047 - session_state - upon authentication failure?
	  
</li>
</ul><p>
      
</p>
<p>
        -29
        </p>
<ul class="text">
<li>
	    Fixed #1085 - Split RP-Initiated Logout into its own specification.
	  
</li>
<li>
	    Registered the AS metadata value <tt>check_session_iframe</tt>.
	  
</li>
<li>
	    Updated affiliations and acknowledgements.
	  
</li>
<li>
	    Moved metadata section to a more logical location.
	  
</li>
</ul><p>
      
</p>
<p>
        -28
        </p>
<ul class="text">
<li>
	    Stated why the client_id is included in the session state calculation,
	    addressing issue #969.
	  
</li>
</ul><p>
      
</p>
<p>
        -27
        </p>
<ul class="text">
<li>
	    Removed references to terms that are not used.
	  
</li>
</ul><p>
      
</p>
<p>
        -26
        </p>
<ul class="text">
<li>
	    Referenced Front-Channel Logout and Back-Channel Logout specifications.
	  
</li>
</ul><p>
      
</p>
<p>
        -25
        </p>
<ul class="text">
<li>
	    Changed instances of http://server.example.com to https://server.example.com.
	  
</li>
<li>
	    Tracked terminology changes made in the referenced IETF specs since errata set 1.
	  
</li>
<li>
	    Registered the <tt>post_logout_redirect_uris</tt>
	    client metadata value.
	  
</li>
</ul><p>
      
</p>
<p>
        -24
        </p>
<ul class="text">
<li>
	    Stated that post-logout redirection is only done when the logout
	    is RP-initiated and that otherwise it is not done.
          
</li>
<li>
	    Fixed #967 - Errors in the Javascript example for the OP iframe
	  
</li>
</ul><p>
      
</p>
<p>
        -23
        </p>
<ul class="text">
<li>
	    Fixed issue #915 - Computation of OP session_state in the IdP requires origin URI.
	  
</li>
<li>
            Updated the RFC 2616 reference to RFC 7230.
          
</li>
</ul><p>
      
</p>
<p>
        -22
        </p>
<ul class="text">
<li>
            Referenced specification versions incorporating errata set 1.
          
</li>
</ul><p>
      
</p>
<p>
	-21
        </p>
<ul class="text">
<li>
	    Updated dates for specs containing errata updates.
	  
</li>
<li>
	    Fixed #930 - Added "error" return from OP iframe to respond to
	    syntactically invalid postMessage values received.
	  
</li>
<li>
	    Fixed #954 - Added "NOT RECOMMENDED" to the list of RFC 2119 terms.
	  
</li>
</ul><p>
      
</p>
<p>
	-20
        </p>
<ul class="text">
<li>
	    Fixed #917 - Session state must not contain the space character.
	  
</li>
<li>
	    Fixed #927 - Added "state" parameter to RP-initiated logout messages.
	  
</li>
</ul><p>
      
</p>
<p>
	-19
        </p>
<ul class="text">
<li>
	    Updated dates for final OpenID Connect specifications.
	  
</li>
</ul><p>
      
</p>
<p>
	-18
        </p>
<ul class="text">
<li>
	    Described that logout requests without a valid
	    <tt>id_token_hint</tt> are a potential means
	    of denial of service.
	  
</li>
</ul><p>
      
</p>
<p>
	-17
        </p>
<ul class="text">
<li>
	    Fixed #883 - Moved the RP iframe description ahead of the OP iframe description.
	  
</li>
<li>
	    Fixed #873 - Clarified that the HttpOnly flag can't be set for cookies
	    used to maintain OP browser state.
	  
</li>
</ul><p>
      
</p>
<p>
	-16
        </p>
<ul class="text">
<li>
	    Replaced uses of the OpenID Connect Messages and OpenID Connect Standard
	    specifications with OpenID Connect Core.
	  
</li>
<li>
	    Added section headings for Discovery and Registration parameters
	    defined for use when Session Management is supported.
	  
</li>
</ul><p>
      
</p>
<p>
	-15
        </p>
<ul class="text">
<li>
	    Fixed #842 - Made <tt>post_logout_redirect_uri</tt>
	    treatment parallel to <tt>redirect_uri</tt>.
	  
</li>
<li>
	    Fixed #859 - Added IMPORTANT NOTE TO READERS about the terminology
	    definitions being a normative part of the specification.
	  
</li>
</ul><p>
      
</p>
<p>-14
        </p>
<ul class="text">
<li>
	    Clarified RP-initiated logout description.
	  
</li>
<li>
	    Added an <tt>id_token_hint</tt> parameter to logout requests.
	  
</li>
<li>
	    Stated that RPs should gracefully any false positive
	    <tt>changed</tt> notifications that may occur.
	  
</li>
</ul><p>
      
</p>
<p>-13
        </p>
<ul class="text">
<li>
	    Added OpenID Connect Working Group declaration to the document metadata.
	  
</li>
</ul>

<p>-12
        </p>
<ul class="text">
<li>
	    Fixed #364 - Term "Session" not defined.
	  
</li>
<li>
	    State that when any validations fail, any operations requiring
	    the information that failed to correctly validate MUST be aborted and
	    the information that failed to validate MUST NOT be used.
	  
</li>
<li>
	    Fixed #779 - Parameters missing from IANA Considerations.
	  
</li>
<li>
	    Fixed #782 - Changed uses of "_url" in identifiers to "_uri".
	  
</li>
</ul>

<p>-11
        </p>
<ul class="text">
<li>
	    Applied changes from October 24, 2012 editing session at the
	    Internet Identity Workshop (IIW).
	    This separates the session state from the ID Token,
	    adding the new <tt>session_state</tt> parameter
	    to the authorization response.
	    These identifiers also changed:
	    <tt>check_session_endpoint</tt> to
	    <tt>check_session_iframe_url</tt> and
	    <tt>end_session_endpoint</tt> to
	    <tt>end_session_endpoint_url</tt>.
	  
</li>
<li>
	    Fixed #605 - op_logout_url description.
	  
</li>
<li>
	    Added Implementation Considerations section.
	  
</li>
<li>
	    Fixed #698 - Inconsistent use of articles.
	  
</li>
<li>
	    Naming consistency changes.  Renamed
	    <tt>check_session_iframe_url</tt> to
	    <tt>check_session_iframe</tt> and
	    <tt>end_session_endpoint_url</tt> back to
	    <tt>end_session_endpoint</tt>.
	  
</li>
</ul>

<p>-10
        </p>
<ul class="text">
<li>
	    Fixed #689 - Track JWT change that allows JWTs to have multiple audiences.
	  
</li>
</ul>

<p>-09
        </p>
<ul class="text">
<li>
	    Changed <tt>user_hint</tt> to
	    <tt>id_token_hint</tt> for consistency with Messages.
	  
</li>
<li>Fixed #666 - JWS signature validation vs. verification.
</li>
<li>Referenced OAuth 2.0 RFC -- RFC 6749.
</li>
</ul>

<p>-08
        </p>
<ul class="text">
<li>Complete rewrite based on the decisions made at the
	  May 5, 2012 face to face working group meeting.
</li>
</ul>

<p>-07 </p>
<ul class="text">
<li>Added warning about the significant revisions planned to session
          management to the abstract and introduction.
</li>
<li>Changed client.example.com to client.example.org, per issue
          #251
</li>
<li>Listed author of ISO29115 as "International Telecommunication
          Union and International Organization for Standardization", per issue
          #589
</li>
<li>Use standards track version of JSON Web Token spec
          (draft-ietf-oauth-json-web-token)
</li>
</ul>

<p>-06 </p>
<ul class="text">
<li>Updated Notices
</li>
<li>Updated References
</li>
</ul>

<p>-05 </p>
<ul class="text">
<li>Removed Check Session Endpoint
</li>
<li>Updated ID Token claims to reflect changes in Messages
</li>
</ul>

<p>-04 </p>
<ul class="text">
<li>Changes associated with renaming "Lite" to "Basic Client" and
          replacing "Core" and "Framework" with "Messages" and "Standard".
</li>
<li>Numerous cleanups, including updating references.
</li>
</ul>

<p>-03 </p>
<ul class="text">
<li>Corrected examples.
</li>
</ul>

<p>-02 </p>
<ul class="text">
<li>Correct issues raised by Johnny Bufu and discussed on the
          7-Jul-11 working group call.
</li>
</ul>

<p>-01 </p>
<ul class="text">
<li>Consistency and cleanup pass, including removing unused
          references.
</li>
</ul>

<p>-00 </p>
<ul class="text">
<li>Split from core when all optional features were removed.
</li>
</ul>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Breno de Medeiros</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Google</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:breno@google.com">breno@google.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://stackoverflow.com/users/311376/breno">http://stackoverflow.com/users/311376/breno</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Naveen Agarwal</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Microsoft</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Naveen.Agarwal@microsoft.com">Naveen.Agarwal@microsoft.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.linkedin.com/in/nvnagr">http://www.linkedin.com/in/nvnagr</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nat Sakimura</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NAT.Consulting</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:nat@nat.consulting">nat@nat.consulting</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://nat.sakimura.org/">http://nat.sakimura.org/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">John Bradley</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yubico</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ve7jtb@ve7jtb.com">ve7jtb@ve7jtb.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.thread-safe.com/">http://www.thread-safe.com/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael B. Jones</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Microsoft</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mbj@microsoft.com">mbj@microsoft.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://self-issued.info/">http://self-issued.info/</a></td></tr>
</table>
</body></html>
