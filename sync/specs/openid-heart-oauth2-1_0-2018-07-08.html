<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Health Relationship Trust Profile for OAuth 2.0</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Notation and Conventions">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Conformance">
<link href="#rfc.section.2" rel="Chapter" title="2 Client Profiles">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Client Types">
<link href="#rfc.section.2.1.1" rel="Chapter" title="2.1.1 Full Client with User Delegation">
<link href="#rfc.section.2.1.2" rel="Chapter" title="2.1.2 Native Client with User Delegation">
<link href="#rfc.section.2.1.3" rel="Chapter" title="2.1.3 Browser-embedded Client with User Delegation">
<link href="#rfc.section.2.1.4" rel="Chapter" title="2.1.4 Direct Access Client">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Connection to the Authorization Server">
<link href="#rfc.section.2.2.1" rel="Chapter" title="2.2.1 Requests to the Authorization Endpoint">
<link href="#rfc.section.2.2.2" rel="Chapter" title="2.2.2 Requests to the Token Endpoint">
<link href="#rfc.section.2.2.3" rel="Chapter" title="2.2.3 Client Registration">
<link href="#rfc.section.2.2.3.1" rel="Chapter" title="2.2.3.1 Redirect URI">
<link href="#rfc.section.2.2.4" rel="Chapter" title="2.2.4 Client keys">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Connection to the Protected Resource">
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 Requests to the Protected Resource">
<link href="#rfc.section.3" rel="Chapter" title="3 Authorization Server Profile">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Connections with clients">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Grant types">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Client authentication">
<link href="#rfc.section.3.1.3" rel="Chapter" title="3.1.3 Dynamic Registration">
<link href="#rfc.section.3.1.4" rel="Chapter" title="3.1.4 Client Approval">
<link href="#rfc.section.3.1.5" rel="Chapter" title="3.1.5 Discovery">
<link href="#rfc.section.3.1.6" rel="Chapter" title="3.1.6 Revocation">
<link href="#rfc.section.3.1.7" rel="Chapter" title="3.1.7 PKCE">
<link href="#rfc.section.3.1.8" rel="Chapter" title="3.1.8 Redirect URIs">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Connections with protected resources">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 JWT Bearer Tokens">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 Introspection">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Token Lifetimes">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Scopes">
<link href="#rfc.section.4" rel="Chapter" title="4 Protected Resource Profile">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Connections with Clients">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Connections with Authorization Servers">
<link href="#rfc.section.5" rel="Chapter" title="5 Advanced OAuth Security Options">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Proof of Possession Tokens">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="7 Normative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements">
<link href="#rfc.appendix.B" rel="Chapter" title="B Notices">
<link href="#rfc.appendix.C" rel="Chapter" title="C Document History">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.16.3 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Richer, J., Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:openid-heart-oauth2-1_0" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-07-08" />
  <meta name="dct.abstract" content="The OAuth 2.0 protocol framework defines a mechanism to allow a resource owner to delegate access to a protected resource for a client application.This specification profiles the OAuth 2.0 protocol framework to increase baseline security, provide greater interoperability, and structure deployments in a manner specifically applicable to (but not limited to) the healthcare domain." />
  <meta name="description" content="The OAuth 2.0 protocol framework defines a mechanism to allow a resource owner to delegate access to a protected resource for a client application.This specification profiles the OAuth 2.0 protocol framework to increase baseline security, provide greater interoperability, and structure deployments in a manner specifically applicable to (but not limited to) the healthcare domain." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left"></td>
<td class="right">J. Richer, Ed.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 8, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Health Relationship Trust Profile for OAuth 2.0<br />
  <span class="filename">openid-heart-oauth2-1_0</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The OAuth 2.0 protocol framework defines a mechanism to allow a resource owner to delegate access to a protected resource for a client application.</p>
<p>This specification profiles the OAuth 2.0 protocol framework to increase baseline security, provide greater interoperability, and structure deployments in a manner specifically applicable to (but not limited to) the healthcare domain.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Requirements Notation and Conventions</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Conformance</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Client Profiles</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Client Types</a>
</li>
<ul><li>2.1.1.   <a href="#rfc.section.2.1.1">Full Client with User Delegation</a>
</li>
<li>2.1.2.   <a href="#rfc.section.2.1.2">Native Client with User Delegation</a>
</li>
<li>2.1.3.   <a href="#rfc.section.2.1.3">Browser-embedded Client with User Delegation</a>
</li>
<li>2.1.4.   <a href="#rfc.section.2.1.4">Direct Access Client</a>
</li>
</ul><li>2.2.   <a href="#rfc.section.2.2">Connection to the Authorization Server</a>
</li>
<ul><li>2.2.1.   <a href="#rfc.section.2.2.1">Requests to the Authorization Endpoint</a>
</li>
<li>2.2.2.   <a href="#rfc.section.2.2.2">Requests to the Token Endpoint</a>
</li>
<li>2.2.3.   <a href="#rfc.section.2.2.3">Client Registration</a>
</li>
<ul><li>2.2.3.1.   <a href="#rfc.section.2.2.3.1">Redirect URI</a>
</li>
</ul><li>2.2.4.   <a href="#rfc.section.2.2.4">Client keys</a>
</li>
</ul><li>2.3.   <a href="#rfc.section.2.3">Connection to the Protected Resource</a>
</li>
<ul><li>2.3.1.   <a href="#rfc.section.2.3.1">Requests to the Protected Resource</a>
</li>
</ul></ul><li>3.   <a href="#rfc.section.3">Authorization Server Profile</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Connections with clients</a>
</li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Grant types</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Client authentication</a>
</li>
<li>3.1.3.   <a href="#rfc.section.3.1.3">Dynamic Registration</a>
</li>
<li>3.1.4.   <a href="#rfc.section.3.1.4">Client Approval</a>
</li>
<li>3.1.5.   <a href="#rfc.section.3.1.5">Discovery</a>
</li>
<li>3.1.6.   <a href="#rfc.section.3.1.6">Revocation</a>
</li>
<li>3.1.7.   <a href="#rfc.section.3.1.7">PKCE</a>
</li>
<li>3.1.8.   <a href="#rfc.section.3.1.8">Redirect URIs</a>
</li>
</ul><li>3.2.   <a href="#rfc.section.3.2">Connections with protected resources</a>
</li>
<ul><li>3.2.1.   <a href="#rfc.section.3.2.1">JWT Bearer Tokens</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">Introspection</a>
</li>
</ul><li>3.3.   <a href="#rfc.section.3.3">Token Lifetimes</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Scopes</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Protected Resource Profile</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Connections with Clients</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Connections with Authorization Servers</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Advanced OAuth Security Options</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Proof of Possession Tokens</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.references">Normative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">Notices</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.C">Document History</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This document profiles the OAuth 2.0 web authorization framework for use in the context of securing web-facing application programming interfaces (APIs), particularly Representational State Transfer (RESTful) APIs. The OAuth 2.0 specifications accommodate a wide range of implementations with varying security and usability considerations, across different types of software clients. To achieve this flexibility, the standard makes many security controls optional. OAuth implementations using only the minimum mandatory security measures require minimal effort on the part of developers and users, but they also fail to prevent known attacks and are unsuitable for protecting sensitive data. The OAuth 2.0 client, protected resource, and authorization server profiles defined in this document serve two purposes:</p>
<p></p>

<ol>
<li>Define a mandatory baseline set of security controls suitable for a wide range of use cases, while maintaining reasonable ease of implementation and functionality</li>
<li>Identify optional advanced security controls for sensitive use cases where heightened risks justify more stringent controls that increase the required implementation effort and may reduce or restrict functionality</li>
</ol>
<p id="rfc.section.1.p.3">This OAuth profile is intended to be shared broadly, and ideally to influence OAuth implementations in other domains besides health care.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#rnc" id="rnc">Requirements Notation and Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">RFC 2119</a>.</p>
<p id="rfc.section.1.1.p.2">All uses of <a href="#RFC7515" class="xref">JSON Web Signature (JWS)</a> and <a href="#RFC7516" class="xref">JSON Web Encryption (JWE)</a> data structures in this specification utilize the JWS Compact Serialization or the JWE Compact Serialization; the JWS JSON Serialization and the JWE JSON Serialization are not used.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#Terminology" id="Terminology">Terminology</a>
</h1>
<p id="rfc.section.1.2.p.1">This specification uses the terms "Access Token", "Authorization Code", "Authorization Endpoint", "Authorization Grant", "Authorization Server", "Client", "Client Authentication", "Client Identifier", "Client Secret", "Grant Type", "Protected Resource", "Redirection URI", "Refresh Token", "Resource Owner", "Resource Server", "Response Type", and "Token Endpoint" defined by <a href="#RFC6749" class="xref">OAuth 2.0</a>, the terms "Claim Name", "Claim Value", and "JSON Web Token (JWT)" defined by <a href="#RFC7519" class="xref">JSON Web Token (JWT)</a>, and the terms defined by <a href="#OpenID.Core" class="xref">OpenID Connect Core 1.0</a>.</p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Conformance</h1>
<p id="rfc.section.1.3.p.1">This specification defines requirements for the following components:</p>
<p></p>

<ul>
<li>OAuth 2.0 clients</li>
<li>OAuth 2.0 authorization servers</li>
<li>OAuth 2.0 protected resources</li>
</ul>
<p id="rfc.section.1.3.p.3">The specification also defines features for interaction between these components:</p>
<p></p>

<ul>
<li>Client to authorization server</li>
<li>Protected resource to authorization server</li>
</ul>
<p id="rfc.section.1.3.p.5">When a HEART-compliant component is interacting with other HEART-compliant components, in any valid combination, all components MUST fully conform to the features and requirements of this specification. All interaction with non-HEART components is outside the scope of this specification.</p>
<p id="rfc.section.1.3.p.6">A HEART-compliant OAuth 2.0 authorization server MUST support all features as described in this specification. A general-purpose authorization server MAY support additional features for use with non-HEART clients and protected resources.</p>
<p id="rfc.section.1.3.p.7">A HEART-compliant OAuth 2.0 client MUST use all functions as described in this specification. A general-purpose client library MAY support additional features for use with non-HEART authorization servers and protected resources.</p>
<p id="rfc.section.1.3.p.8">A HEART-compliant OAuth 2.0 protected resource MUST use all functions as described in this specification. A general-purpose protected resource library MAY support additional features for use with non-HEART authorization servers and clients.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#ClientProfiles" id="ClientProfiles">Client Profiles</a>
</h1>
<p></p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#ClientTypes" id="ClientTypes">Client Types</a>
</h1>
<p id="rfc.section.2.1.p.1">The following profile descriptions give patterns of deployment for use in different types of client applications based on the OAuth grant type. The resource owner password credentials grant type defined in <a href="#RFC6749" class="xref">[RFC6749]</a> is intentionally omitted from this discussion, and MUST NOT be used under these profiles. Additional grant types, such as assertions, chained tokens, or other mechanisms, are out of scope of this profile and must be covered separately by appropriate profile documents.</p>
<h1 id="rfc.section.2.1.1">
<a href="#rfc.section.2.1.1">2.1.1.</a> <a href="#FullClient" id="FullClient">Full Client with User Delegation</a>
</h1>
<p id="rfc.section.2.1.1.p.1">This client type applies to clients that act on behalf of a particular resource owner and require delegation of that user&#8217;s authority to access the protected resource.  Furthermore, these clients are capable of interacting with a separate web browser application to facilitate the resource owner's interaction with the authentication endpoint of the authorization server.</p>
<p id="rfc.section.2.1.1.p.2">These clients MUST use the authorization code flow of OAuth 2 by sending the resource owner to the authorization endpoint to obtain authorization. The user MUST authenticate to the authorization endpoint. The user&#8217;s web browser is then redirected back to a URI hosted by the client, from which the client can obtain an authorization code passed as a query parameter. The client then presents that authorization code along with its own credentials to the authorization server's token endpoint to obtain an access token.</p>
<p id="rfc.section.2.1.1.p.3">These clients MUST be associated with a unique public key, as described in <a href="#ClientKeys" class="xref">Section 2.2.4</a>.</p>
<p id="rfc.section.2.1.1.p.4">This client type MAY request and be issued a refresh token if the security parameters of the access request allow for it.</p>
<h1 id="rfc.section.2.1.2">
<a href="#rfc.section.2.1.2">2.1.2.</a> <a href="#NativeClients" id="NativeClients">Native Client with User Delegation</a>
</h1>
<p id="rfc.section.2.1.2.p.1">This client type applies to clients that act on behalf of a particular resource owner and require delegation of that user's authority to access the protected resource. Furthermore, these clients are capable of interacting with a separate web browser application to facilitate the resource owner's interaction with the authentication endpoint of the authorization server. In particular, this client type runs natively on the resource owner's device, often leading to many identical instances of a piece of software operating in different environments and running simultaneously for different end users.</p>
<p id="rfc.section.2.1.2.p.2">Native clients MUST use the authorization code flow of OAuth 2 by sending the resource owner to the authorization endpoint to obtain authorization. The user MUST authenticate to the authorization endpoint. The user&#8217;s web browser is then redirected back to a URI hosted by the client, from which the client can obtain an authorization code passed as a query parameter. The client then presents that authorization code along to the authorization server's token endpoint to obtain an access token.</p>
<p id="rfc.section.2.1.2.p.3">Confidential native clients MUST be associated with a unique public key, as described in <a href="#ClientKeys" class="xref">Section 2.2.4</a>. Native clients MUST use dynamic client registration to obtain a separate client id for each instance, and MUST use their client key to protect calls to the token endpoint. Native applications using dynamic registration SHOULD generate a unique public and private key pair on the device and register that public key value with the authorization server. Alternatively, an authorization server MAY issue a public and private key pair to the client as part of the registration process. In such cases, the authorization server MUST discard its copy of the private key. Client credentials MUST NOT be shared among instances of client software.</p>
<p id="rfc.section.2.1.2.p.4">Public native clients MUST use <a href="#RFC7636" class="xref">PKCE</a>, using the <samp>S256</samp> code challenge mechanism. Confidential native clients MAY use PKCE as well.</p>
<p id="rfc.section.2.1.2.p.5">This client type MAY request and be issued a refresh token if the security parameters of the access request allow for it.</p>
<h1 id="rfc.section.2.1.3">
<a href="#rfc.section.2.1.3">2.1.3.</a> <a href="#BrowserClient" id="BrowserClient">Browser-embedded Client with User Delegation</a>
</h1>
<p id="rfc.section.2.1.3.p.1">This client type applies to clients that act on behalf of a particular resource owner and require delegation of that user&#8217;s authority to access the protected resource.  Furthermore, these clients are embedded within a web browser and effectively share an active session between systems.</p>
<p id="rfc.section.2.1.3.p.2">These clients use the implicit flow of OAuth 2 by sending a resource owner to the authorization endpoint to obtain authorization. The user MUST authenticate to the authorization endpoint. The user&#8217;s web browser is then redirected back to a URI hosted by the client, from which the client can directly obtain an access token. Since the client itself never authenticates to the server and the token is made available directly to the browser, this flow is appropriate only for clients embedded within a web browser, such as a JavaScript client with no back-end server component.  Wherever possible, it is preferable to use the authorization code flow due to its superior security properties.</p>
<p id="rfc.section.2.1.3.p.3">This client type MUST NOT request or be issued a refresh token.  Access tokens issued to this type of client MUST be short lived and SHOULD be discarded when the user's authenticated session with the client expires.</p>
<h1 id="rfc.section.2.1.4">
<a href="#rfc.section.2.1.4">2.1.4.</a> <a href="#DirectClient" id="DirectClient">Direct Access Client</a>
</h1>
<p id="rfc.section.2.1.4.p.1">This profile applies to clients that connect directly to protected resources and do not act on behalf of a particular resource owner, such as those clients that facilitate bulk transfers.</p>
<p id="rfc.section.2.1.4.p.2">These clients use the client credentials flow of OAuth 2 by sending a request to the token endpoint with the client's credentials and obtaining an access token in the response. Since this profile does not involve an authenticated user, this flow is appropriate only for trusted applications, such as those that would traditionally use a developer key. For example, a partner system that performs bulk data transfers between two systems would be considered a direct access client.</p>
<p id="rfc.section.2.1.4.p.3">This client type MUST NOT request or be issued a refresh token.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Connection to the Authorization Server</h1>
<h1 id="rfc.section.2.2.1">
<a href="#rfc.section.2.2.1">2.2.1.</a> <a href="#RequestsToAuthorizationEndpoint" id="RequestsToAuthorizationEndpoint">Requests to the Authorization Endpoint</a>
</h1>
<p id="rfc.section.2.2.1.p.1">Full clients and browser-embedded clients making a request to the authorization endpoint MUST use an unpredictable value for the state parameter with at least 128 bits of entropy. Clients MUST validate the value of the <samp>state</samp> parameter upon return to the redirect URI and MUST ensure that the state value is securely tied to the user&#8217;s current session (e.g., by relating the state value to a session identifier issued by the client software to the browser).</p>
<p id="rfc.section.2.2.1.p.2">Clients MUST include their full redirect URIs in the authorization request. To prevent open redirection and other injection attacks, the authorization server MUST match the entire redirect URI using a direct string comparison against registered values and MUST reject requests with invalid or missing redirect URIs.</p>
<p id="rfc.section.2.2.1.p.3">The following is a sample response from a web-based client to the end user&#8217;s browser for the purpose of redirecting the end user to the authorization server's authorization endpoint:</p>
<pre>HTTP/1.2 302 Found
Cache-Control: no-cache
Connection: close
Content-Type: text/plain; charset=UTF-8
Date: Wed, 07 Jan 2015 20:24:15 GMT
Location: https://idp-p.example.com/authorize?client_id=55f9f559-2496-49d4-b6c3-351a586b7484&amp;nonce=cd567ed4d958042f721a7cdca557c30d&amp;response_type=code&amp;scope=openid+email 
Status: 302 Found
</pre>
<p id="rfc.section.2.2.1.p.4">This causes the browser to send the following request to the authorization endpoint:</p>
<pre>GET /authorize?client_id=55f9f559-2496-49d4-b6c3-351a586b7484&amp;nonce=cd567ed4d958042f721a7cdca557c30d&amp;response_type=code&amp;scope=openid+email HTTP/1.1 
Host: idp-p.example.com 
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Firefox/31.0 Iceweasel/31.2.0 
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 
Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate 
Referer: https://ehr-va.example.com/portal/signin 
Cookie: JSESSIONID=706D5B3A7B3AB3FCE8C6AA7201B8B9CF 
Connection: keep-alive</pre>
<p></p>
<p id="rfc.section.2.2.1.p.6">Native clients (using PKCE) MUST send the code_challenge parameter.</p>
<h1 id="rfc.section.2.2.2">
<a href="#rfc.section.2.2.2">2.2.2.</a> <a href="#RequestsToTokenEndpoint" id="RequestsToTokenEndpoint">Requests to the Token Endpoint</a>
</h1>
<p id="rfc.section.2.2.2.p.1">Full clients and direct access clients as defined above MUST authenticate to the authorization server's token endpoint using a JWT assertion as defined by the <a href="#RFC7523" class="xref">JWT Profile for OAuth 2.0 Client Authentication and Authorization Grants</a> and the <samp>private_key_jwt</samp> method defined in <a href="#OpenID.Core" class="xref">OpenID Connect Core</a>. The assertion MUST use the claims as follows:</p>
<p></p>

<dl>
<dt>iss</dt>
<dd style="margin-left: 8">the client ID of the client creating the token</dd>
<dt>sub</dt>
<dd style="margin-left: 8">the client ID of the client creating the token</dd>
<dt>aud</dt>
<dd style="margin-left: 8">the URL of the authorization server's token endpoint</dd>
<dt>iat</dt>
<dd style="margin-left: 8">the time that the token was created by the client</dd>
<dt>exp</dt>
<dd style="margin-left: 8">the expiration time, after which the token MUST be considered invalid</dd>
<dt>jti</dt>
<dd style="margin-left: 8">a unique identifier generated by the client for this authentication. This identifier MUST contain at least 128 bits of entropy and MUST NOT be re-used by any subsequent authentication token.</dd>
</dl>

<p>The following sample claim set illustrates the use of the required claims for a client authentication JWT as defined in this profile; additional claims MAY be included in the claim set.</p>
<pre>{
   "iss": "55f9f559-2496-49d4-b6c3-351a586b7484",
   "sub": "55f9f559-2496-49d4-b6c3-351a586b7484",
   "aud": "https://idp-p.example.com/token",
   "iat": 1418698788,
   "exp": 1418698848,
   "jti": "1418698788/107c4da5194df463e52b56865c5af34e5595"
}
</pre>
<p id="rfc.section.2.2.2.p.3">The JWT assertion MUST be signed by the client using the client's private key. See <a href="#ClientRegistration" class="xref">Section 2.2.3</a> for mechanisms by which the client can make its public key known to the server. The authorization server MUST support the RS256 signature method (the Rivest, Shamir, and Adleman (RSA) signature algorithm with a 256-bit hash) and MAY use other asymmetric signature methods listed in the JSON Web Algorithms (<a href="#RFC7518" class="xref">JWA</a>) specification.</p>
<p id="rfc.section.2.2.2.p.4">The following sample JWT contains the above claims and has been signed using the RS256 JWS algorithm and the client's own private key (with line breaks for display purposes only):</p>
<pre>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.ew0KICAgImlzcyI6ICI1NWY5ZjU1OS0yNDk2LTQ5Z
DQtYjZjMy0zNTFhNTg2Yjc0ODQiLA0KICAgInN1YiI6ICI1NWY5ZjU1OS0yNDk2LTQ5ZDQtYjZjMy0
zNTFhNTg2Yjc0ODQiLA0KICAgImF1ZCI6ICJodHRwczovL2lkcC1wLmV4YW1wbGUuY29tL3Rva2VuI
iwNCiAgICJpYXQiOiAxNDE4Njk4Nzg4LA0KICAgImV4cCI6IDE0MTg2OTg4NDgsDQogICAianRpIjo
gIjE0MTg2OTg3ODgvMTA3YzRkYTUxOTRkZjQ2M2U1MmI1Njg2NWM1YWYzNGU1NTk1Ig0KfQ.t-_gX8
JQGq3G2OEc2kUCQ8zVj7pqff87Sua5nktLIHj28l5onO5VpsL4sRHIGOvrpo7XO6jgtPWy3iLXv3-N
Lyo1TWHbtErQEGpmf7nKiNxVCXlGYJXSDJB6shP3OfvdUc24urPJNUGBEDptIgT7-Lhf6BbwQNlMQu
bNeOPRFDqQoLWqe7UxuI06dKX3SEQRMqcxYSIAfP7CQZ4WLuKXb6oEbaqz6gL4l6p83G7wKGDeLETO
THszt-ZjKR38v4F_MnSrx8e0iIqgZwurW0RtetEWvynOCJXk-p166T7qZR45xuCxgOotXY6O3et4n7
7GtgspMgOEKj3b_WpCiuNEwQ</pre>
<p id="rfc.section.2.2.2.p.5">This is sent in the request to the token endpoint as in the following example:</p>
<pre>POST /token HTTP/1.1
Content-Type: application/x-www-form-urlencoded
User-Agent: Rack::OAuth2 (1.0.8.7) (2.5.3.2, ruby 2.1.3 (2014-09-19))
Accept: */*
Date: Tue, 16 Dec 2014 02:59:48 GMT
Content-Length: 884
Host: idp-p.example.com

grant_type=authorization_code&amp;code=sedaFh&amp;scope=openid+email
&amp;client_id=55f9f559-2496-49d4-b6c3-351a586b7484
&amp;client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer
&amp;client_assertion=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.ew0KICAgImlzcyI6ICI1NWY
5ZjU1OS0yNDk2LTQ5ZDQtYjZjMy0zNTFhNTg2Yjc0ODQiLA0KICAgInN1YiI6ICI1NWY5ZjU1OS0yN
Dk2LTQ5ZDQtYjZjMy0zNTFhNTg2Yjc0ODQiLA0KICAgImF1ZCI6ICJodHRwczovL2lkcC1wLmV4YW1
wbGUuY29tL3Rva2VuIiwNCiAgICJpYXQiOiAxNDE4Njk4Nzg4LA0KICAgImV4cCI6IDE0MTg2OTg4N
DgsDQogICAianRpIjogIjE0MTg2OTg3ODgvMTA3YzRkYTUxOTRkZjQ2M2U1MmI1Njg2NWM1YWYzNGU
1NTk1Ig0KfQ.t-_gX8JQGq3G2OEc2kUCQ8zVj7pqff87Sua5nktLIHj28l5onO5VpsL4sRHIGOvrpo
7XO6jgtPWy3iLXv3-NLyo1TWHbtErQEGpmf7nKiNxVCXlGYJXSDJB6shP3OfvdUc24urPJNUGBEDpt
IgT7-Lhf6BbwQNlMQubNeOPRFDqQoLWqe7UxuI06dKX3SEQRMqcxYSIAfP7CQZ4WLuKXb6oEbaqz6g
L4l6p83G7wKGDeLETOTHszt-ZjKR38v4F_MnSrx8e0iIqgZwurW0RtetEWvynOCJXk-p166T7qZR45
xuCxgOotXY6O3et4n77GtgspMgOEKj3b_WpCiuNEwQ
</pre>
<p></p>
<p id="rfc.section.2.2.2.p.7">Native clients (using PKCE) MUST send the code_verifier to the token endpoint. Native clients MAY authenticate using a public key as described in this section and MUST NOT use another authentication mechanism.</p>
<h1 id="rfc.section.2.2.3">
<a href="#rfc.section.2.2.3">2.2.3.</a> <a href="#ClientRegistration" id="ClientRegistration">Client Registration</a>
</h1>
<p id="rfc.section.2.2.3.p.1">All clients MUST register with the authorization server. Clients registering multiple instances with the authorization server MUST each receive a unique client identifier.</p>
<h1 id="rfc.section.2.2.3.1">
<a href="#rfc.section.2.2.3.1">2.2.3.1.</a> <a href="#RedirectURI" id="RedirectURI">Redirect URI</a>
</h1>
<p id="rfc.section.2.2.3.1.p.1">Clients using the authorization code or implicit grant types MUST register their full redirect URIs. The Authorization Server MUST validate the redirect URI given by the client at the authorization endpoint using strict string comparison.</p>
<p id="rfc.section.2.2.3.1.p.2">A client MUST protect the values passed back to its redirect URI by ensuring that the redirect URI is one of the following:</p>
<p></p>

<ul>
<li>Hosted on a website with Transport Layer Security (TLS) protection (a Hypertext Transfer Protocol &#8211; Secure (HTTPS) URI)</li>
<li>Hosted on the local domain of the client (e.g., http://localhost/)</li>
<li>Hosted on a client-specific non-remote-protocol URI scheme (e.g., myapp:/)</li>
</ul>
<p id="rfc.section.2.2.3.1.p.4">Clients MUST NOT have URIs in more than one category and SHOULD NOT have multiple redirect URIs on different domains.</p>
<p id="rfc.section.2.2.3.1.p.5">Clients MUST NOT forward values passed back to their redirect URIs to other arbitrary or user-provided URIs (a practice known as an "open redirector&#8221;).</p>
<h1 id="rfc.section.2.2.4">
<a href="#rfc.section.2.2.4">2.2.4.</a> <a href="#ClientKeys" id="ClientKeys">Client keys</a>
</h1>
<p id="rfc.section.2.2.4.p.1">Full clients using the authorization code grant type or direct access clients using the client credentials grant type MUST have a public and private key pair for use in authentication to the token endpoint. These clients MUST register their public keys in their client registration metadata by either sending the public key directly in the <samp>jwks</samp> field or by registering a <samp>jwks_uri</samp> that MUST be reachable by the authorization server. It is RECOMMENDED that clients use a <samp>jwks_uri</samp> if possible as this allows for key rotation more easily.</p>
<p id="rfc.section.2.2.4.p.2">The <samp>jwks</samp> field or the content available from the <samp>jwks_uri</samp> of a client MUST contain a public key in <a href="#RFC7517" class="xref">JSON Web Key Set (JWK Set)</a> format. The authorization server MUST validate the content of the client's registered jwks_uri document and verify that it contains a JWK Set. The following example is of a 2048-bit RSA key:</p>
<pre>{
   "keys": [
     {
       "alg": "RS256",
       "e": "AQAB",
       "n": "kAMYD62n_f2rUcR4awJX4uccDt0zcXRssq_mDch5-ifcShx9aTtTVza23P
Tn3KaKrsBXwWcfioXR6zQn5eYdZQVGNBfOR4rxF5i7t3hfb4WkS50EK1gBYk2lO9NSrQ-xG
9QsUsAnN6RHksXqsdOqv-nxjLexDfIJlgbcCN9h6TB-C66ZXv7PVhl19gIYVifSU7liHkLe
0l0fw7jUI6rHLHf4d96_neR1HrNIK_xssr99Xpv1EM_ubxpktX0T925-qej9fMEpzzQ5HLm
cNt1H2_VQ_Ww1JOLn9vRn-H48FDj7TxlIT74XdTZgTv31w_GRPAOfyxEw_ZUmxhz5Z-gTlQ",
       "kty": "RSA",
       "kid": "oauth-client"
     }
   ]
}
</pre>
<p id="rfc.section.2.2.4.p.3">For reference, the corresponding public/private key pair for this public key is the following (in JWK format):</p>
<pre>{
   "alg": "RS256",
   "d": "PjIX4i2NsBQuOVIw74ZDjqthYsoFvaoah9GP-cPrai5s5VUIlLoadEAdGbBrss
_6dR58x_pRlPHWh04vLQsFBuwQNc9SN3O6TAaai9Jg5TlCi6V0d4O6lUoTYpMR0cxFIU-xF
MwII--_OZRgmAxiYiAXQj7TKMKvgSvVO7-9-YdhMwHoD-UrJkfnZckMKSs0BoAbjReTski3
IV9f1wVJ53_pmr9NBpiZeHYmmG_1QDSbBuY35Zummut4QShF-fey2gSALdp9h9hRk1p1fsT
ZtH2lwpvmOcjwDkSDv-zO-4Pt8NuOyqNVPFahROBPlsMVxc_zjPck8ltblalBHPo6AQ",
   "e": "AQAB",
   "n": "kAMYD62n_f2rUcR4awJX4uccDt0zcXRssq_mDch5-ifcShx9aTtTVza23PTn3K
aKrsBXwWcfioXR6zQn5eYdZQVGNBfOR4rxF5i7t3hfb4WkS50EK1gBYk2lO9NSrQ-xG9QsU
sAnN6RHksXqsdOqv-nxjLexDfIJlgbcCN9h6TB-C66ZXv7PVhl19gIYVifSU7liHkLe0l0f
w7jUI6rHLHf4d96_neR1HrNIK_xssr99Xpv1EM_ubxpktX0T925-qej9fMEpzzQ5HLmcNt1
H2_VQ_Ww1JOLn9vRn-H48FDj7TxlIT74XdTZgTv31w_GRPAOfyxEw_ZUmxhz5Z-gTlQ",
   "kty": "RSA",
   "kid": "oauth-client" 
}
</pre>
<p id="rfc.section.2.2.4.p.4">Note that the second example contains both the public and private keys, while the first example contains the public key only.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> Connection to the Protected Resource</h1>
<h1 id="rfc.section.2.3.1">
<a href="#rfc.section.2.3.1">2.3.1.</a> <a href="#RequestsToProtectedResource" id="RequestsToProtectedResource">Requests to the Protected Resource</a>
</h1>
<p id="rfc.section.2.3.1.p.1">Clients SHOULD send bearer tokens passed in the Authentication header as defined by <a href="#RFC6750" class="xref">[RFC6750]</a>. Clients MAY use the form-parameter or query-parameter methods in <a href="#RFC6750" class="xref">[RFC6750]</a>. Authorized requests MUST be made over TLS, and clients MUST validate the protected resource server's certificate.</p>
<p id="rfc.section.2.3.1.p.2">An example of an OAuth-protected call to the OpenID Connect UserInfo endpoint, sending the token in the Authorization header, follows:</p>
<pre>GET /userinfo HTTP/1.1
Authorization: Bearer eyJhbGciOiJSUzI1NiJ9.eyJleHAiOjE0MTg3MDI0MTIsImF1ZCI6WyJjMWJjOD
RlNC00N2VlLTRiNjQtYmI1Mi01Y2RhNmM4MWY3ODgiXSwiaXNzIjoiaHR0cHM6XC9cL2lkcC1wLmV4YW1wbGU
uY29tXC8iLCJqdGkiOiJkM2Y3YjQ4Zi1iYzgxLTQwZWMtYTE0MC05NzRhZjc0YzRkZTMiLCJpYXQiOjE0MTg2
OTg4MTJ9.iHMz_tzZ90_b0QZS-AXtQtvclZ7M4uDAs1WxCFxpgBfBanolW37X8h1ECrUJexbXMD6rrj_uuWEq
PD738oWRo0rOnoKJAgbF1GhXPAYnN5pZRygWSD1a6RcmN85SxUig0H0e7drmdmRkPQgbl2wMhu-6h2Oqw-ize
4dKmykN9UX_2drXrooSxpRZqFVYX8PkCvCCBuFy2O-HPRov_SwtJMk5qjUWMyn2I4Nu2s-R20aCA-7T5dunr0
iWCkLQnVnaXMfA22RlRiU87nl21zappYb1_EHF9ePyq3Q353cDUY7vje8m2kKXYTgc_bUAYuW-W3SMSw5UlKa
HtSZ6PQICoA
Accept: text/plain, application/json, application/*+json, */*
Host: idp-p.example.com
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.2.3 (java 1.5)
</pre>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#ServerProfile" id="ServerProfile">Authorization Server Profile</a>
</h1>
<p id="rfc.section.3.p.1">All servers MUST conform to applicable recommendations found in the Security Considerations sections of <a href="#RFC6749" class="xref">[RFC6749]</a> and those found in the <a href="#RFC6819" class="xref">OAuth Threat Model Document</a>.</p>
<p id="rfc.section.3.p.2">The authorization server MUST protect all communications to and from its OAuth endpoints using TLS.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Connections with clients</h1>
<p></p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> Grant types</h1>
<p id="rfc.section.3.1.1.p.1">The authorization server MUST support the <samp>authorization_code</samp>, <samp>implicit</samp>, and <samp>client_credentials</samp> grant types as described in <a href="#ClientProfiles" class="xref">Section 2</a>. The authorization server MUST limit each registered client (identified by a client ID) to a single grant type only, since a single piece of software will be functioning at runtime in only one of the modes described in <a href="#ClientProfiles" class="xref">Section 2</a>. Clients that have multiple modes of operation MUST have a separate client ID for each mode.</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> Client authentication</h1>
<p id="rfc.section.3.1.2.p.1">The authorization server MUST enforce client authentication as described above for the authorization code and client credentials grant types. The authorization server MUST validate all redirect URIs for authorization code and implicit grant types.</p>
<h1 id="rfc.section.3.1.3">
<a href="#rfc.section.3.1.3">3.1.3.</a> <a href="#DynamicRegistration" id="DynamicRegistration">Dynamic Registration</a>
</h1>
<p id="rfc.section.3.1.3.p.1">Authorization servers MUST support dynamic client registration, and clients MAY register using the <a href="#RFC7591" class="xref">Dynamic Client Registration Protocol</a> for authorization code or implicit grant types. Clients MUST NOT dynamically register for the client credentials grant type. Authorization servers MAY limit the scopes available to dynamically registered clients.</p>
<p id="rfc.section.3.1.3.p.2">Authorization servers MUST signal to end users that a client was dynamically registered on the authorization screen. Authorization servers MAY accept signed software statements as described in <a href="#RFC7591" class="xref">[RFC7591]</a> issued to client software developers from a trusted registration entity. The software statement can be used to tie together many instances of the same client software that will be run, dynamically registered, and authorized separately at runtime.  The software statement MUST include the following client metadata parameters:</p>
<p></p>

<dl>
<dt>redirect_uris</dt>
<dd style="margin-left: 8">array of redirect URIs used by the client; subject to the requirements listed in <a href="#RedirectURI" class="xref">Section 2.2.3.1</a>
</dd>
<dt>grant_types</dt>
<dd style="margin-left: 8">grant type used by the client; must be "authorization_code&#8221; or "implicit&#8221;</dd>
<dt>jwks_uri or jwks</dt>
<dd style="margin-left: 8">client's public key in JWK Set format; if jwks_uri is used it MUST be reachable by the Authorization Server and point to the client's public key set</dd>
<dt>client_name</dt>
<dd style="margin-left: 8">human-readable name of the client</dd>
<dt>client_uri</dt>
<dd style="margin-left: 8">URL of a web page containing further information about the client</dd>
</dl>
<h1 id="rfc.section.3.1.4">
<a href="#rfc.section.3.1.4">3.1.4.</a> Client Approval</h1>
<p id="rfc.section.3.1.4.p.1">When prompting the end user with an interactive approval page, the authorization server MUST indicate to the user:</p>
<p></p>

<ul>
<li>Whether the client was dynamically registered, or else statically registered by a trusted administrator</li>
<li>Whether the client is associated with a software statement, and in which case provide information about the trusted issuer of the software statement</li>
<li>What kind of access the client is requesting (including scope, target resource, etc.)</li>
</ul>
<h1 id="rfc.section.3.1.5">
<a href="#rfc.section.3.1.5">3.1.5.</a> <a href="#Discovery" id="Discovery">Discovery</a>
</h1>
<p id="rfc.section.3.1.5.p.1">The authorization server MUST provide an <a href="#OpenID.Discovery" class="xref">OpenID Connect service discovery</a> endpoint listing the components relevant to the OAuth protocol: </p>

<dl>
<dt>issuer</dt>
<dd style="margin-left: 8">The fully qualified issuer URL of the server</dd>
<dt>authorization_endpoint</dt>
<dd style="margin-left: 8">The fully qualified URL of the server's authorization endpoint defined by <a href="#RFC6749" class="xref">OAuth 2.0</a>
</dd>
<dt>token_endpoint</dt>
<dd style="margin-left: 8">The fully qualified URL of the server's token endpoint defined by <a href="#RFC6749" class="xref">OAuth 2.0</a>
</dd>
<dt>introspection_endpoint</dt>
<dd style="margin-left: 8">The fully qualified URL of the server's introspection endpoint defined by <a href="#RFC7662" class="xref">OAuth Token Introspection</a>
</dd>
<dt>revocation_endpoint</dt>
<dd style="margin-left: 8">The fully qualified URL of the server's revocation endpoint defined by <a href="#RFC7009" class="xref">OAuth 2.0 Token Revocation</a>
</dd>
<dt>jwks_uri</dt>
<dd style="margin-left: 8">The fully qualified URI of the server's public key in <a href="#RFC7517" class="xref">JWK Set</a> format</dd>
</dl>
<p id="rfc.section.3.1.5.p.2">If the authorization server is also an OpenID Connect Provider, it MUST provide a discovery endpoint meeting the requirements listed in Section 3.5 of the HEART OpenID Connect profile.</p>
<p id="rfc.section.3.1.5.p.3">The following example shows the JSON document found at a discovery endpoint for an authorization server:</p>
<pre>{
  "request_parameter_supported": true,
  "registration_endpoint": "https://idp-p.example.com/register",
  "userinfo_signing_alg_values_supported": [
    "HS256", "HS384", "HS512", "RS256", "RS384", "RS512"
  ],
  "token_endpoint": "https://idp-p.example.com/token",
  "request_uri_parameter_supported": false,
  "request_object_encryption_enc_values_supported": [
    "A192CBC-HS384", "A192GCM", "A256CBC+HS512",
    "A128CBC+HS256", "A256CBC-HS512",
    "A128CBC-HS256", "A128GCM", "A256GCM"
  ],
  "token_endpoint_auth_methods_supported": [
    "client_secret_post",
    "client_secret_basic",
    "client_secret_jwt",
    "private_key_jwt",
    "none"
  ],
  "jwks_uri": "https://idp-p.example.com/jwk",
  "authorization_endpoint": "https://idp-p.example.com/authorize",
  "require_request_uri_registration": false,
  "introspection_endpoint": "https://idp-p.example.com/introspect",
  "request_object_encryption_alg_values_supported": [
    "RSA-OAEP", ?RSA1_5", "RSA-OAEP-256"
  ],
  "service_documentation": "https://idp-p.example.com/about",
  "response_types_supported": [
    "code", "token"
  ],
  "token_endpoint_auth_signing_alg_values_supported": [
    "HS256", "HS384", "HS512", "RS256", "RS384", "RS512"
  ],
  "revocation_endpoint": "https://idp-p.example.com/revoke",
  "request_object_signing_alg_values_supported": [
    "HS256", "HS384", "HS512", "RS256", "RS384", "RS512"
  ],
  "grant_types_supported": [
    "authorization_code",
    "implicit",
    "urn:ietf:params:oauth:grant-type:jwt-bearer",
    "client_credentials",
    "urn:ietf:params:oauth:grant_type:redelegate"
  ],
  "scopes_supported": [
    "profile", "openid", "email", "address", "phone", "offline_access"
  ],
  "op_tos_uri": "https://idp-p.example.com/about",
  "issuer": "https://idp-p.example.com/",
  "op_policy_uri": "https://idp-p.example.com/about"
}
</pre>
<p id="rfc.section.3.1.5.p.4">Clients and protected resources SHOULD cache this discovery information. It is RECOMMENDED that servers provide cache information through HTTP headers and make the cache valid for at least one week.</p>
<p id="rfc.section.3.1.5.p.5">The server MUST provide its public key in JWK Set format. The key MUST contain the following fields:</p>
<p></p>

<dl>
<dt>kid</dt>
<dd style="margin-left: 8">The key ID of the key pair used to sign this token</dd>
<dt>kty</dt>
<dd style="margin-left: 8">The key type</dd>
<dt>alg</dt>
<dd style="margin-left: 8">The default algorithm used for this key</dd>
</dl>
<p id="rfc.section.3.1.5.p.7">The following is an example of a 2048-bit RSA public key:</p>
<pre>{
  "keys": [
    {
      "alg": "RS256",
      "e": "AQAB",
      "n": "o80vbR0ZfMhjZWfqwPUGNkcIeUcweFyzB2S2T-hje83IOVct8gVg9FxvHPK1R
eEW3-p7-A8GNcLAuFP_8jPhiL6LyJC3F10aV9KPQFF-w6Eq6VtpEgYSfzvFegNiPtpMWd7C43
EDwjQ-GrXMVCLrBYxZC-P1ShyxVBOzeR_5MTC0JGiDTecr_2YT6o_3aE2SIJu4iNPgGh9Mnyx
dBo0Uf0TmrqEIabquXA1-V8iUihwfI8qjf3EujkYi7gXXelIo4_gipQYNjr4DBNlE0__RI0kD
U-27mb6esswnP2WgHZQPsk779fTcNDBIcYgyLujlcUATEqfCaPDNp00J6AbY6w",
      "kty": "RSA",
      "kid": "rsa1"
    }
  ]
}
</pre>
<p id="rfc.section.3.1.5.p.8">Clients and protected resources SHOULD cache this key. It is RECOMMENDED that servers provide cache information through HTTP headers and make the cache valid for at least one week.</p>
<h1 id="rfc.section.3.1.6">
<a href="#rfc.section.3.1.6">3.1.6.</a> Revocation</h1>
<p id="rfc.section.3.1.6.p.1">Token revocation allows a client to signal to an authorization server that a given token will no longer be used.</p>
<p id="rfc.section.3.1.6.p.2">An authorization server MUST revoke the token if the client requesting the revocation is the client to which the token was issued, the client has permission to revoke tokens, and the token is revocable.</p>
<p id="rfc.section.3.1.6.p.3">A client MUST immediately discard the token and not use it again after revoking it.</p>
<h1 id="rfc.section.3.1.7">
<a href="#rfc.section.3.1.7">3.1.7.</a> PKCE</h1>
<p id="rfc.section.3.1.7.p.1">An authorization server MUST support the Proof Key for Code Exchange (PKCE) extension to the authorization code flow, including support for the S256 code challenge method. The authorization server MUST NOT allow a HEART client to use the <samp>plain</samp> code challenge method.</p>
<h1 id="rfc.section.3.1.8">
<a href="#rfc.section.3.1.8">3.1.8.</a> Redirect URIs</h1>
<p id="rfc.section.3.1.8.p.1">The authorization server MUST compare a client's registered redirect URIs with the redirect URI presented during an authorization request using an exact string match.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Connections with protected resources</h1>
<p id="rfc.section.3.2.p.1">Unlike the core OAuth protocol, the HEART profile intends to allow compliant protected resources to connect to compliant authorization servers.</p>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#JWTBearerTokens" id="JWTBearerTokens">JWT Bearer Tokens</a>
</h1>
<p id="rfc.section.3.2.1.p.1">In order to facilitate interoperability with multiple protected resources, all HEART-compliant authorization servers issue cryptographically signed tokens in the JSON Web Token (JWT) format.  The information carried in the JWT is intended to allow a protected resource to quickly test the integrity of the token without additional network calls, and to allow the protected resource to determine which authorization server issued the token. When combined with discovery, this information is sufficient to programmatically locate the token introspection service, which is in turn used for conveying additional security information about the token.</p>
<p id="rfc.section.3.2.1.p.2">The server MUST issue tokens as JWTs with, at minimum, the following claims:</p>
<p></p>

<dl>
<dt>iss</dt>
<dd style="margin-left: 8">The issuer URL of the server that issued the token</dd>
<dt>azp</dt>
<dd style="margin-left: 8">The client id of the client to whom this token was issued</dd>
<dt>exp</dt>
<dd style="margin-left: 8">The expiration time (integer number of seconds since from 1970-01-01T00:00:00Z UTC), after which the token MUST be considered invalid</dd>
<dt>jti</dt>
<dd style="margin-left: 8">A unique JWT Token ID value with at least 128 bits of entropy. This value MUST NOT be re-used in another token. Clients MUST check for reuse of jti values and reject all tokens issued with duplicate jti values.</dd>
</dl>
<p id="rfc.section.3.2.1.p.4">The server MAY issue tokens with additional fields, including the following as defined here:</p>
<p></p>

<dl>
<dt>sub</dt>
<dd style="margin-left: 8">The identifier of the end-user that authorized this client, or the client id of a client acting on its own behalf (such as a bulk transfer). Since this information could potentially leak private user information, it should be used only when needed.</dd>
<dt>aud</dt>
<dd style="margin-left: 8">The audience of the token, an array containing the identifier(s) of protected resource(s) for which the token is valid, if this information is known. The identifiers SHOULD be URIs representing the resource servers. The aud claim may contain multiple values if the token is valid for multiple protected resources. Note that at runtime, the authorization server may not know the identifiers of all possible protected resources at which a token may be used.</dd>
</dl>
<p id="rfc.section.3.2.1.p.6">The following sample claim set illustrates the use of the required claims for an access token as defined in this profile; additional claims MAY be included in the claim set:</p>
<pre>{
   "exp": 1418702388,
   "azp": "55f9f559-2496-49d4-b6c3-351a586b7484",
   "iss": "https://idp-p.example.com/",
   "jti": "2402f87c-b6ce-45c4-95b0-7a3f2904997f",
   "iat": 1418698788
}
</pre>
<p id="rfc.section.3.2.1.p.7">The access tokens MUST be signed with <a href="#RFC7515" class="xref">JWS</a>. The authorization server MUST support the RS256 signature method for tokens and MAY use other asymmetric signing methods as defined in the <a href="#JWS.JWE.Algs" class="xref">IANA JSON Web Signatures and Encryption Algorithms registry</a>. The JWS header MUST contain the following fields:</p>
<p></p>

<dl>
<dt>kid</dt>
<dd style="margin-left: 8">The key ID of the key pair used to sign this token</dd>
</dl>
<p id="rfc.section.3.2.1.p.9">This example access token has been signed with the server's private key using RS256:</p>
<pre>eyJhbGciOiJSUzI1NiJ9.ew0KICAgImV4cCI6IDE0MTg3MDIzODgsDQogICAiYXpwIjo
gIjU1ZjlmNTU5LTI0OTYtNDlkNC1iNmMzLTM1MWE1ODZiNzQ4NCIsDQogICAiaXNzIjo
gImh0dHBzOi8vaWRwLXAuZXhhbXBsZS5jb20vIiwNCiAgICJqdGkiOiAiMjQwMmY4N2M
tYjZjZS00NWM0LTk1YjAtN2EzZjI5MDQ5OTdmIiwNCiAgICJpYXQiOiAxNDE4Njk4Nzg
4LA0KICAgImtpZCI6ICJyc2ExIg0KfQ.iB6Ix8Xeg-L-nMStgE1X75w7zgXabzw7znWU
ECOsXpHfnYYqb-CET9Ah5IQyXIDZ20qEyN98UydgsTpiO1YJDDcZV4f4DgY0ZdG3yBW3
XqwUQwbgF7Gwza9Z4AdhjHjzQx-lChXAyfL1xz0SBDkVbJdDjtXbvaSIyfF7ueWF3M1C
M70-GXuRY4iucKbuytz9e7eW4Egkk4Aagl3iTk9-l5V-tvL6dYu8IlR93GKsaKE8bng0
EZ04xcnq8s4V5Yykuc_NARBJENiKTJM8w3wh7xWP2gvMp39Y0XnuCOLyIx-J1ttX83xm
pXDaLyyY-4HT9XHT9V73fKF8rLWJu9grrA</pre>
<p id="rfc.section.3.2.1.p.10">Refresh tokens SHOULD be signed with <a href="#RFC7515" class="xref">JWS</a> using the same public key and contain the same set of claims as the access tokens.</p>
<p id="rfc.section.3.2.1.p.11">The authorization server MAY encrypt access tokens and refresh tokens using <a href="#RFC7516" class="xref">JWE</a>. Encrypted access tokens MUST be encrypted using the public key of the protected resource. Encrypted refresh tokens MUST be encrypted using the authorization server's public key.</p>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> Introspection</h1>
<p id="rfc.section.3.2.2.p.1">Token introspection allows a protected resource to query the authorization server for metadata about a token. The protected resource makes a request like the following to the token introspection endpoint:</p>
<pre>POST /introspect HTTP/1.1
User-Agent: Faraday v0.9.0
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3
Accept: */*
Connection: close
Host: as-va.example.com
Content-Length: 1412

client_assertion=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJpc3M
iOiJhMmMzNjkxOS0wMWZmLTQ4MTAtYTgyOS00MDBmYWQzNTczNTEiLCJzdWIi
OiJhMmMzNjkxOS0wMWZmLTQ4MTAtYTgyOS00MDBmYWQzNTczNTEiLCJhdWQiO
iJodHRwczovL2FzLXZhLmV4YW1wbGUuY29tL3Rva2VuIiwiaWF0IjoxNDE4Nj
k4ODE0LCJleHAiOjE0MTg2OTg4NzQsImp0aSI6IjE0MTg2OTg4MTQvZmNmNDQ
2OGY2MDVjNjE1NjliOWYyNGY5ODJlMTZhZWY2OTU4In0.md7mFdNBaGhiJfE_
pFkAAWA5S-JBvDw9Dk7pOOJEWcL08JGgDFoi9UDbg3sHeA5DrrCYGC_zw7fCG
c9ovpfMB7W6YN53hGU19LtzzFN3tv9FNRq4KIzhK15pns9jckKtui3HZ25L_B
-BnxHe7xNo3kA1M-p51uYYIM0hw1SRi2pfwBKG5O8WntybLjuJ0R3X97zvqHn
2Q7xdVyKlInyNPA8gIZK0HVssXxHOI6yRrAqvdMn_sneDTWPrqVpaR_c7rt8D
dd7drf_nTD1QxESVhYqKTax5Qfd-aq8gZz8gJCzS0yyfQh6DmdhmwgrSCCRC6
BUQkeFNvjMVEYHQ9fr0NA
&amp;client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer
&amp;client_id=a2c36919-01ff-4810-a829-400fad357351
&amp;token=eyJhbGciOiJSUzI1NiJ9.eyJleHAiOjE0MTg3MDI0MTQsImF1ZCI6W
yJlNzFmYjcyYS05NzRmLTQwMDEtYmNiNy1lNjdjMmJjMDAzN2YiXSwiaXNzIj
oiaHR0cHM6XC9cL2FzLXZhLmV4YW1wbGUuY29tXC8iLCJqdGkiOiIyMWIxNTk
2ZC04NWQzLTQzN2MtYWQ4My1iM2YyY2UyNDcyNDQiLCJpYXQiOjE0MTg2OTg4
MTR9.FXDtEzDLbTHzFNroW7w27RLk5m0wprFfFH7h4bdFw5fR3pwiqejKmdfA
bJvN3_yfAokBv06we5RARJUbdjmFFfRRW23cMbpGQCIk7Nq4L012X_1J4IewO
QXXMLTyWQQ_BcBMjcW3MtPrY1AoOcfBOJPx1k2jwRkYtyVTLWlff6S5gK-ciY
f3b0bAdjoQEHd_IvssIPH3xuBJkmtkrTlfWR0Q0pdpeyVePkMSI28XZvDaGnx
A4j7QI5loZYeyzGR9h70xQLVzqwwl1P0-F_0JaDFMJFO1yl4IexfpoZZsB3Hh
F2vFdL6D_lLeHRy-H2g2OzF59eMIsM_Ccs4G47862w
</pre>
<p id="rfc.section.3.2.2.p.2">The client assertion parameter is structured as described in <a href="#RequestsToTokenEndpoint" class="xref">Section 2.2.2</a>.</p>
<p id="rfc.section.3.2.2.p.3">The server responds to an introspection request with a JSON object representing the token containing the following fields as defined in the token introspection specification:</p>
<p></p>

<dl>
<dt>active</dt>
<dd style="margin-left: 8">Boolean value indicating whether or not this token is currently active at this authorization server.  Tokens that have been revoked, have expired, or were not issued by this authorization server are considered non-active.</dd>
<dt>scope</dt>
<dd style="margin-left: 8">Space-separated list of OAuth 2.0 scope values represented as a single string.</dd>
<dt>exp</dt>
<dd style="margin-left: 8">Timestamp of when this token expires (integer number of seconds since from 1970-01-01T00:00:00Z UTC)</dd>
<dt>sub</dt>
<dd style="margin-left: 8">An opaque string that uniquely identifies the user who authorized this token at this authorization server (if applicable)</dd>
<dt>client_id</dt>
<dd style="margin-left: 8">An opaque string that uniquely identifies the OAuth 2.0 client that requested this token</dd>
</dl>
<p id="rfc.section.3.2.2.p.5">The following example is a response from the introspection endpoint:</p>
<pre>HTTP/1.1 200 OK
Date: Tue, 16 Dec 2014 03:00:14 GMT
Access-Control-Allow-Origin: *
Content-Type: application/json;charset=ISO-8859-1
Content-Language: en-US
Content-Length: 266
Connection: close

{
   "active": true,
   "scope": "patient/*.* sens/ETH sens/PSY btg",
   "exp": 1418702414,
   "sub": "{sub\u003d6WZQPpnQxV, iss\u003dhttps://idp-p.example.com/}",
   "client_id": "e71fb72a-974f-4001-bcb7-e67c2bc0037f",
   "token_type": "Bearer"
}
</pre>
<p id="rfc.section.3.2.2.p.6">The authorization server MUST require authentication for both the revocation and introspection endpoints as described in <a href="#RequestsToTokenEndpoint" class="xref">Section 2.2.2</a>. Protected resources calling the introspection endpoint MUST use credentials distinct from any other OAuth client registered at the server.</p>
<p id="rfc.section.3.2.2.p.7">A protected resource MAY cache the response from the introspection endpoint for a period of time no greater than half the lifetime of the token. A protected resource MUST NOT accept a token that is not active according to the response from the introspection endpoint.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#TokenLifetimes" id="TokenLifetimes">Token Lifetimes</a>
</h1>
<p id="rfc.section.3.3.p.1">This profile provides RECOMMENDED lifetimes for different types of tokens issued to different types of clients. Specific applications MAY issue tokens with different lifetimes. Any active token MAY be revoked at any time.</p>
<p id="rfc.section.3.3.p.2">For clients using the authorization code grant type, access tokens SHOULD have a valid lifetime no greater than one hour, and refresh tokens (if issued) SHOULD have a valid lifetime no greater than twenty-four hours.</p>
<p id="rfc.section.3.3.p.3">For clients using the implicit grant type, access tokens SHOULD have a valid lifetime no greater than fifteen minutes.</p>
<p id="rfc.section.3.3.p.4">For clients using the client credentials grant type, access tokens SHOULD have a valid lifetime no greater than six hours.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#Scopes" id="Scopes">Scopes</a>
</h1>
<p id="rfc.section.3.4.p.1">Scopes define individual pieces of authority that can be requested by clients, granted by resource owners, and enforced by protected resources. Specific scope values will be highly dependent on the specific types of resources being protected in a given interface.  OpenID Connect, for example, defines scope values to enable access to different attributes of user profiles.</p>
<p id="rfc.section.3.4.p.2">Authorization servers SHOULD define and document default scope values that will be used if an authorization request does not specify a requested set of scopes.</p>
<p id="rfc.section.3.4.p.3">To facilitate general use across a wide variety of protected resources, authorization servers SHOULD allow for the use of arbitrary scope values at runtime, such as allowing clients or protected resources to use arbitrary scope strings upon registration.  Authorization servers MAY restrict certain scopes from use by dynamically registered systems.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Protected Resource Profile</h1>
<p></p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Connections with Clients</h1>
<p id="rfc.section.4.1.p.1">A protected resource MUST accept bearer tokens passed in the authorization header as described in <a href="#RFC6750" class="xref">[RFC6750]</a>. A protected resource MAY also accept bearer tokens passed in the form parameter or query parameter methods.</p>
<p id="rfc.section.4.1.p.2">Protected resources MUST define and document which scopes are required for access to the resource.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Connections with Authorization Servers</h1>
<p id="rfc.section.4.2.p.1">Protected resources MUST interpret access tokens using either JWT, token introspection, or a combination of the two.</p>
<p id="rfc.section.4.2.p.2">The protected resource MUST check the <samp>aud</samp> (audience) claim, if it exists in the token, to ensure that it includes the protected resource's identifier. The protected resource MUST ensure that the rights associated with the token are sufficient to grant access to the resource. For example, this can be accomplished by querying the scopes associated with the token from the authorization server's token introspection endpoint.</p>
<p id="rfc.section.4.2.p.3">A protected resource MUST limit which authorization servers it will accept valid tokens from. A resource server MAY accomplish this using a whitelist of trusted servers, a dynamic policy engine, or other means.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#AdvancedSecurity" id="AdvancedSecurity">Advanced OAuth Security Options</a>
</h1>
<p id="rfc.section.5.p.1">The preceding portions of this OAuth profile provide a level of security adequate for a wide range of use cases, while still maintaining relative ease of implementation and usability for developers, system administrators, and end users. The following are some additional security measures that can be employed for use cases where elevated risks justify the use of additional controls at the expense of implementation effort and usability. This section also addresses future security capabilities, currently in the early draft stages, being added to the OAuth standard suite.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#PoPTokens" id="PoPTokens">Proof of Possession Tokens</a>
</h1>
<p id="rfc.section.5.1.p.1">OAuth proof of possession tokens are currently defined in a set of drafts under active development in the Internet Engineering Task Force (IETF) OAuth Working Group. While a bearer token can be used by anyone in possession of the token, a proof of possession token is bound to a particular symmetric or asymmetric key issued to, or already possessed by, the client. The association of the key to the token is also communicated to the protected resource; a variety of mechanisms for doing this are outlined in the draft <a href="#I-D.ietf-oauth-pop-architecture" class="xref">OAuth 2.0 Proof-of-Possession (PoP) Security Architecture</a>. When the client presents the token to the protected resource, it is also required to demonstrate possession of the corresponding key (e.g., by creating a cryptographic hash or signature of the request).</p>
<p id="rfc.section.5.1.p.2">Proof of Possession tokens are somewhat analogous to the Security Assertion Markup Language's (SAML's) Holder-of-Key mechanism for binding assertions to user identities. Proof of possession could prevent a number of attacks on OAuth that entail the interception of access tokens by unauthorized parties. The attacker would need to obtain the legitimate client's cryptographic key along with the access token to gain access to protected resources. Additionally, portions of the HTTP request could be protected by the same signature used in presentation of the token. Proof of possession tokens may not provide all of the same protections as PKI authentication, but they are far less challenging to implement on a distributed scale.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Security Considerations</h1>
<p id="rfc.section.6.p.1">All transactions MUST be protected in transit by TLS as described in <a href="#BCP195" class="xref">BCP195</a>.</p>
<p id="rfc.section.6.p.2">All clients MUST conform to applicable recommendations found in the Security Considerations sections of <a href="#RFC6749" class="xref">[RFC6749]</a> and those found in the <a href="#RFC6819" class="xref">OAuth 2.0 Threat Model and Security Considerations document</a>.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="BCP195">[BCP195]</b></td>
<td class="top">
<a>Sheffer, Y.</a>, <a>Holz, R.</a> and <a>P. Saint-Andre</a>, "<a href="https://tools.ietf.org/html/rfc7525">Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)</a>", BCP 195, RFC 7525, DOI 10.17487/RFC7525, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-oauth-pop-architecture">[I-D.ietf-oauth-pop-architecture]</b></td>
<td class="top">
<a>Hunt, P.</a>, <a>Richer, J.</a>, <a>Mills, W.</a>, <a>Mishra, P.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/draft-ietf-oauth-pop-architecture-08">OAuth 2.0 Proof-of-Possession (PoP) Security Architecture</a>", Internet-Draft draft-ietf-oauth-pop-architecture-08, July 2016.</td>
</tr>
<tr>
<td class="reference"><b id="JWS.JWE.Algs">[JWS.JWE.Algs]</b></td>
<td class="top">"<a>JSON Web Signature and Encryption Algorithms registry</a>", August 2016.</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Core">[OpenID.Core]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a>, <a title="Google">de Medeiros, B.</a> and <a title="Salesforce">C. Mortimore</a>, "<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a>", August 2015.</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Discovery">[OpenID.Discovery]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a> and <a title="IllumilaJSON">E. Jay</a>, "<a href="http://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a>", August 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2246">[RFC2246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>C. Allen</a>, "<a href="https://tools.ietf.org/html/rfc2246">The TLS Protocol Version 1.0</a>", RFC 2246, DOI 10.17487/RFC2246, January 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a>Berners-Lee, T.</a>, <a>Fielding, R.</a> and <a>L. Masinter</a>, "<a href="https://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5322">[RFC5322]</b></td>
<td class="top">
<a>Resnick, P.</a>, "<a href="https://tools.ietf.org/html/rfc5322">Internet Message Format</a>", RFC 5322, DOI 10.17487/RFC5322, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5646">[RFC5646]</b></td>
<td class="top">
<a>Phillips, A.</a> and <a>M. Davis</a>, "<a href="https://tools.ietf.org/html/rfc5646">Tags for Identifying Languages</a>", BCP 47, RFC 5646, DOI 10.17487/RFC5646, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5785">[RFC5785]</b></td>
<td class="top">
<a>Nottingham, M.</a> and <a>E. Hammer-Lahav</a>, "<a href="https://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>", RFC 5785, DOI 10.17487/RFC5785, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6125">[RFC6125]</b></td>
<td class="top">
<a>Saint-Andre, P.</a> and <a>J. Hodges</a>, "<a href="https://tools.ietf.org/html/rfc6125">Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)</a>", RFC 6125, DOI 10.17487/RFC6125, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6749">[RFC6749]</b></td>
<td class="top">
<a>Hardt, D.</a>, "<a href="https://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6750">[RFC6750]</b></td>
<td class="top">
<a>Jones, M.</a> and <a>D. Hardt</a>, "<a href="https://tools.ietf.org/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a>", RFC 6750, DOI 10.17487/RFC6750, October 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6819">[RFC6819]</b></td>
<td class="top">
<a>Lodderstedt, T.</a>, <a>McGloin, M.</a> and <a>P. Hunt</a>, "<a href="https://tools.ietf.org/html/rfc6819">OAuth 2.0 Threat Model and Security Considerations</a>", RFC 6819, DOI 10.17487/RFC6819, January 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7009">[RFC7009]</b></td>
<td class="top">
<a>Lodderstedt, T.</a>, <a>Dronia, S.</a> and <a>M. Scurtescu</a>, "<a href="https://tools.ietf.org/html/rfc7009">OAuth 2.0 Token Revocation</a>", RFC 7009, DOI 10.17487/RFC7009, August 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7033">[RFC7033]</b></td>
<td class="top">
<a>Jones, P.</a>, <a>Salgueiro, G.</a>, <a>Jones, M.</a> and <a>J. Smarr</a>, "<a href="https://tools.ietf.org/html/rfc7033">WebFinger</a>", RFC 7033, DOI 10.17487/RFC7033, September 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7159">[RFC7159]</b></td>
<td class="top">
<a>Bray, T.</a>, "<a href="https://tools.ietf.org/html/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>", RFC 7159, DOI 10.17487/RFC7159, March 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7515">[RFC7515]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature (JWS)</a>", RFC 7515, DOI 10.17487/RFC7515, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7516">[RFC7516]</b></td>
<td class="top">
<a>Jones, M.</a> and <a>J. Hildebrand</a>, "<a href="https://tools.ietf.org/html/rfc7516">JSON Web Encryption (JWE)</a>", RFC 7516, DOI 10.17487/RFC7516, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7517">[RFC7517]</b></td>
<td class="top">
<a>Jones, M.</a>, "<a href="https://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a>", RFC 7517, DOI 10.17487/RFC7517, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7518">[RFC7518]</b></td>
<td class="top">
<a>Jones, M.</a>, "<a href="https://tools.ietf.org/html/rfc7518">JSON Web Algorithms (JWA)</a>", RFC 7518, DOI 10.17487/RFC7518, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7519">[RFC7519]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Bradley, J.</a> and <a>N. Sakimura</a>, "<a href="https://tools.ietf.org/html/rfc7519">JSON Web Token (JWT)</a>", RFC 7519, DOI 10.17487/RFC7519, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7523">[RFC7523]</b></td>
<td class="top">
<a>Jones, M.</a>, <a>Campbell, B.</a> and <a>C. Mortimore</a>, "<a href="https://tools.ietf.org/html/rfc7523">JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication and Authorization Grants</a>", RFC 7523, DOI 10.17487/RFC7523, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7591">[RFC7591]</b></td>
<td class="top">
<a>Richer, J.</a>, <a>Jones, M.</a>, <a>Bradley, J.</a>, <a>Machulak, M.</a> and <a>P. Hunt</a>, "<a href="https://tools.ietf.org/html/rfc7591">OAuth 2.0 Dynamic Client Registration Protocol</a>", RFC 7591, DOI 10.17487/RFC7591, July 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7636">[RFC7636]</b></td>
<td class="top">
<a>Sakimura, N.</a>, <a>Bradley, J.</a> and <a>N. Agarwal</a>, "<a href="https://tools.ietf.org/html/rfc7636">Proof Key for Code Exchange by OAuth Public Clients</a>", RFC 7636, DOI 10.17487/RFC7636, September 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7662">[RFC7662]</b></td>
<td class="top">
<a>Richer, J.</a>, "<a href="https://tools.ietf.org/html/rfc7662">OAuth 2.0 Token Introspection</a>", RFC 7662, DOI 10.17487/RFC7662, October 2015.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.A.p.1">The OpenID Community would like to thank the following people for their contributions to this specification: Mark Russel, Mary Pulvermacher, David Hill, Dale Moberg, Adrian Gropper, Eve Maler, Danny van Leeuwen, John Moehrke, Aaron Seib, John Bradley, Debbie Bucci, Josh Mandel, and Sarah Squire.</p>
<p id="rfc.section.A.p.2">The original version of this specification was part of the Secure RESTful Interfaces project from The MITRE Corporation, available online at http://secure-restful-interface-profile.github.io/pages/</p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#Notices" id="Notices">Notices</a>
</h1>
<p id="rfc.section.B.p.1">Copyright (c) 2018 The OpenID Foundation.</p>
<p id="rfc.section.B.p.2">The OpenID Foundation (OIDF) grants to any Contributor, developer, implementer, or other interested party a non-exclusive, royalty free, worldwide copyright license to reproduce, prepare derivative works from, distribute, perform and display, this Implementers Draft or Final Specification solely for the purposes of (i) developing specifications, and (ii) implementing Implementers Drafts and Final Specifications based on such documents, provided that attribution be made to the OIDF as the source of the material, but that such attribution does not indicate an endorsement by the OIDF.</p>
<p id="rfc.section.B.p.3">The technology described in this specification was made available from contributions from various sources, including members of the OpenID Foundation and others. Although the OpenID Foundation has taken steps to help ensure that the technology is available for distribution, it takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this specification or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any independent effort to identify any such rights. The OpenID Foundation and the contributors to this specification make no (and hereby expressly disclaim any) warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to this specification, and the entire risk as to implementing this specification is assumed by the implementer. The OpenID Intellectual Property Rights policy requires contributors to offer a patent promise not to assert certain patent claims against other contributors and against implementers. The OpenID Foundation invites any interested party to bring to its attention any copyrights, patents, patent applications, or other proprietary rights that may cover technology that may be required to practice this specification.</p>
<h1 id="rfc.appendix.C">
<a href="#rfc.appendix.C">Appendix C.</a> <a href="#History" id="History">Document History</a>
</h1>
<p id="rfc.section.C.p.1">-2018-02-19</p>
<p></p>

<ul>
<li>Clarified audience value in tokens</li>
<li>Codified public clients for native applications using PKCE</li>
</ul>
<p id="rfc.section.C.p.3">-2017-05-25</p>
<p></p>

<ul><li>Fixed spec cross-reference</li></ul>
<p id="rfc.section.C.p.5">-2017-04-18</p>
<p></p>

<ul><li>Changed example to use scopes from HEART OAuth FHIR document</li></ul>
<p id="rfc.section.C.p.7">-2017-04-10</p>
<p></p>

<ul>
<li>Require native clients to have unique client IDs (restores previous requirement)</li>
<li>Clarified PKCE requirements</li>
</ul>
<p id="rfc.section.C.p.9">-2017-02-08</p>
<p></p>

<ul>
<li>Clarified that RS's need to limit which AS's they take tokens from.</li>
<li>Added section and requirements for native applications.</li>
</ul>
<p id="rfc.section.C.p.11">-2016-09-19</p>
<p></p>

<ul><li>Reorganized document against different conformance aspects.</li></ul>
<p id="rfc.section.C.p.13">-2016-08-10</p>
<p></p>

<ul>
<li>Added PKCE requirement for native application support.</li>
<li>Removed client TLS auth.</li>
<li>Added reference to JWS/JWE algs registry.</li>
<li>Clarified approval UX guidelines.</li>
<li>Clarified client types restrictions.</li>
</ul>
<p id="rfc.section.C.p.15">-2016-04-30</p>
<p></p>

<ul>
<li>Added conformance statements.</li>
<li>Clarified optionality of "sub" and "aud" claims in JWTs.</li>
<li>Add justification for JWT and introspection.</li>
<li>Fixed "kid" location information.</li>
</ul>
<p id="rfc.section.C.p.17">-2016-02-15</p>
<p></p>

<ul><li>Implementer's Draft 1</li></ul>
<p id="rfc.section.C.p.19">-2015-11-30</p>
<p></p>

<ul>
<li>Clarified client instances.</li>
<li>Replaced "mitre.org" with "example.com" (JWTs need to be regenerated).</li>
<li>Fixed specification references to new RFCs.</li>
<li>Clarified scope flexibility.</li>
<li>Clarified dynamic registration requirement.</li>
<li>Added some UX requirements and guidance.</li>
<li>Added security considerations section and TLS BCP reference.</li>
</ul>
<p id="rfc.section.C.p.21">-2015-04-24</p>
<p></p>

<ul><li>Fixed references to make it compile</li></ul>
<p id="rfc.section.C.p.23">-2015-04-01</p>
<p></p>

<ul><li>Imported content from Secure RESTful OAuth profile.</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Justin Richer</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Richer</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:openid@justin.richer.org">openid@justin.richer.org</a></span>

<span class="vcardline">URI: <a href="http://justin.richer.org/">http://justin.richer.org/</a></span>

  </address>
</div>

</body>
</html>
