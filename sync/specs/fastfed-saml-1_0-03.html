<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>FastFed Enterprise SAML Profile 1.0 - draft 03</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Notation and Conventions">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Overview">
<link href="#rfc.section.3" rel="Chapter" title="3 Protocol Extensions">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 FastFed Metadata">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Authentication Profile URN">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Application Metadata">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 FastFed Handshake">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 FastFed Registration Request">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 FastFed Registration Response">
<link href="#rfc.section.4" rel="Chapter" title="4 Schema Binding">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 SCIM-to-SAML Attribute Mapping">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 SAML Subject">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 SAML Attributes">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Privacy Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Interoperability Requirements">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Identity Provider Requirements">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Application Provider Requirements">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Login Hint">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Certificate Rotation">
<link href="#rfc.section.5.4.1" rel="Chapter" title="5.4.1 Certificate Rotation Requirements for an Identity Provider">
<link href="#rfc.section.5.4.2" rel="Chapter" title="5.4.2 Certificate Rotation Requirements for an Application                 Provider">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="8 Normative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements">
<link href="#rfc.appendix.B" rel="Chapter" title="B Notices">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.47.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="McAdams, D." />
  <meta name="dct.identifier" content="urn:ietf:id:fastfed-saml-1_0" />
  <meta name="dct.issued" scheme="ISO8601" content="2020-10-07" />
  <meta name="dct.abstract" content="This specification defines the requirements to implement the FastFed Enterprise SAML Profile.   " />
  <meta name="description" content="This specification defines the requirements to implement the FastFed Enterprise SAML Profile.   " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left"></td>
<td class="right">D. McAdams</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Amazon</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 7, 2020</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">FastFed Enterprise SAML Profile 1.0 - draft 03<br />
  <span class="filename">fastfed-saml-1_0</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This specification defines the requirements to implement the FastFed Enterprise SAML Profile.  </p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Requirements Notation and Conventions</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Overview</a>
</li>
<li>3.   <a href="#rfc.section.3">Protocol Extensions</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">FastFed Metadata</a>
</li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Authentication Profile URN</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Application Metadata</a>
</li>
</ul><li>3.2.   <a href="#rfc.section.3.2">FastFed Handshake</a>
</li>
<ul><li>3.2.1.   <a href="#rfc.section.3.2.1">FastFed Registration Request</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">FastFed Registration Response</a>
</li>
</ul></ul><li>4.   <a href="#rfc.section.4">Schema Binding</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">SCIM-to-SAML Attribute Mapping</a>
</li>
<ul><li>4.1.1.   <a href="#rfc.section.4.1.1">SAML Subject</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">SAML Attributes</a>
</li>
</ul><li>4.2.   <a href="#rfc.section.4.2">Privacy Considerations</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Interoperability Requirements</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Identity Provider Requirements</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Application Provider Requirements</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Login Hint</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Certificate Rotation</a>
</li>
<ul><li>5.4.1.   <a href="#rfc.section.5.4.1">Certificate Rotation Requirements for an Identity Provider</a>
</li>
<li>5.4.2.   <a href="#rfc.section.5.4.2">Certificate Rotation Requirements for an Application                 Provider</a>
</li>
</ul></ul><li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.references">Normative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.B">Notices</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This specification defines the functionality which a provider must implement to satisfy the Enterprise SAMLProfile for FastFed.  </p>
<p id="rfc.section.1.p.2">It consists of the following extensions to the <a href="#FastFed.Core" class="xref">FastFed Core</a> specification: </p>

<ul>
<li>Additional metadata in the FastFed Handshake Flows to exchange SAML Metadata URLs.  </li>
<li>Mapping rules for generating SAML Attributes from a SCIM 2.0 schema.  </li>
<li>An interoperability profile describing the subset of the SAML specifications which must be implemented in order to be FastFed Compatible.  </li>
<li>The mechanics of certifcate rotation for SAML.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#rnc" id="rnc">Requirements Notation and Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">RFC 2119</a>.  </p>
<p id="rfc.section.1.1.p.2">In the .txt version of this specification, values are quoted to indicate that they are to be taken literally.  When using these values in protocol messages, the quotes MUST NOT be used as part of the value.  In the HTML version of this specification, values to be taken literally are indicated by the use of <samp>this fixed-width font</samp>.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#Terminology" id="Terminology">Terminology</a>
</h1>
<p id="rfc.section.1.2.p.1">This FastFed Profile uses the terminology defined in Section 1.2 of the <a href="#FastFed.Core" class="xref">FastFed Core</a> specification.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#Overview" id="Overview">Overview</a>
</h1>
<p id="rfc.section.2.p.1">When using the SAML protocol, the FastFed Identity Provider and Application Provider have various responsibilities to comply with the protocol.  </p>
<p id="rfc.section.2.p.2">The Identity Provider fulfills the role of a SAML Identity Provider. It has a responsibility to host a SAML Metadata file as described in <a href="#SAMLInteroperabilityIdentityProviderReqs" class="xref">Section 5.1</a>.  </p>
<p id="rfc.section.2.p.3">The Application Provider fulfills the role of a SAML Application Provider. It has a responsibility to host a SAML Metadata file as described in <a href="#SAMLInteroperabilityApplicationProviderReqs" class="xref">Section 5.2</a> </p>
<p id="rfc.section.2.p.4">This specification extends the <a href="#FastFed.Core" class="xref">FastFed Core</a> handshake messages with the additional attributes necessary for each party to fulfill their respective obligations under SAML.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#ProtocolExtensions" id="ProtocolExtensions">Protocol Extensions</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#FastFedMetadata" id="FastFedMetadata">FastFed Metadata</a>
</h1>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#FastFedMetadataAuthenticationProfile" id="FastFedMetadataAuthenticationProfile">Authentication Profile URN</a>
</h1>
<p id="rfc.section.3.1.1.p.1">This specification extends the <a href="#FastFed.Core" class="xref">FastFed Core</a> Provider Metadata (Section 3.3.1) with the following value for <samp>authentication_profiles</samp>: </p>

<dl>
<dt>urn:ietf:params:fastfed:1.0:authentication:saml:2.0:enterprise</dt>
<dd style="margin-left: 8">A Provider who includes this URN in their list of capabilities MUST comply with the requirements described in this specification.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.1.1.p.2">The following is a non-normative example of Provider Metadata showing the usage of the value: </p>
<pre>
 {
   "application_provider": {
     "capabilities": {
       "authentication_profiles": ["urn:ietf:params:fastfed:1.0:authentication:saml:2.0:enterprise"],
   ...
 }
</pre>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#FastFedMetadataApplicationMetadata" id="FastFedMetadataApplicationMetadata">Application Metadata</a>
</h1>
<p id="rfc.section.3.1.2.p.1">This specification extends the Application Provider Metadata defined in Section 3.3.9 of <a href="#FastFed.Core" class="xref">FastFed Core</a> with an additional member having the name: <br><br><samp>"urn:ietf:params:fastfed:1.0:authentication:saml:2.0:enterprise"</samp>.  </p>
<p id="rfc.section.3.1.2.p.2">The value of the element is a structure containing the following members: </p>

<dl>
<dt>saml_subject</dt>
<dd style="margin-left: 8">REQUIRED. A structure describing the attribute to use as the SAML Subject. The format of the structure is a "User Attribute" as defined in Section 3.3.6 of <a href="#FastFed.Core" class="xref">FastFed Core</a>. The usage of the structure in this profile, including contraints upon the contents, is described in <a href="#SchemaBindingScimToSamlSubject" class="xref">Section 4.1.1</a>.  </dd>
<dt>desired_attributes</dt>
<dd style="margin-left: 8">OPTIONAL. A structure specifying the values to be included in the SAML Attributes. The format of the structure is described in Section 3.3.5 of <a href="#FastFed.Core" class="xref">FastFed Core</a>. The usage of the structure in this profile, including constraints upon the contents, is described in <a href="#SchemaBindingScimToSamlAttributes" class="xref">Section 4.1.2</a>.  <br><br>Groups are not supported by this SAML profile. Therefore, the following MUST be omitted from the desired attributes: <ul>
<li>
<samp>required_group_attributes</samp> </li>
<li>
<samp>optional_group_attributes</samp> </li>
</ul>
<p> </p>
</dd>
</dl>

<p> </p>
<p id="rfc.section.3.1.2.p.3">The following is a non-normative example of Application Provider Metadata with the profile extensions: </p>
<pre>
 {
   "application_provider": {
     "entity_id": "https://tenant-67890.app.example.com/"
     "provider_domain": "example.com",
     "provider_contact_information": {
       "organization": "Example Inc.",
       "phone": "+1-800-555-5555",
       "email": "support@example.com"
     },
     "display_settings": {
       "display_name": "Example Application Provider",
       "logo_uri": "https://app.example.com/images/logo.png",
       "icon_uri": "https://app.example.com/images/icon.png",
       "license": "https://openid.net/intellectual-property/licenses/fastfed/1.0/"
     }
     "capabilities": {
       "provisioning_profiles": [
         "urn:ietf:params:fastfed:1.0:provisioning:saml:2.0:enterprise"
       ],
       "schema_grammars": [
         "urn:ietf:params:fastfed:1.0:schemas:scim:2.0"
       ],
       "signing_algorithms": [
         "ES512",
         "RS256"
       ]
     },
     "fastfed_handshake_register_uri": "https://tenant-67890.app.example.com/fastfed/register",

     "urn:ietf:params:fastfed:1.0:provisioning:saml:2.0:enterprise": {
       "saml_subject": {
         "urn:ietf:params:fastfed:1.0:schemas:scim:2.0": 
           "userName"
       },
       "desired_attributes": {
         "urn:ietf:params:fastfed:1.0:schemas:scim:2.0": {
           "required_user_attributes": [
             "displayName"
           ],
           "optional_user_attributes": [
             "phoneNumbers[primary eq true].value"
           ]
         }
      }
   }
 }
</pre>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#FastFedHandshake" id="FastFedHandshake">FastFed Handshake</a>
</h1>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#FastFedHandshakeRegistrationRequest" id="FastFedHandshakeRegistrationRequest">FastFed Registration Request</a>
</h1>
<p id="rfc.section.3.2.1.p.1">This specification extends the JWT contents of the FastFed Registration Request (Section 7.2.3.1 of <a href="#FastFed.Core" class="xref">FastFed Core</a>) with an additional member sharing the same name as the profile: <br><br><samp>"urn:ietf:params:fastfed:1.0:authentication:saml:2.0:enterprise"</samp>.  </p>
<p id="rfc.section.3.2.1.p.2">The value of the element is a structure with the following members: </p>

<dl>
<dt>saml_metadata_uri</dt>
<dd style="margin-left: 8">REQUIRED. Contains the URL of the Identity Provider's SAML Metadata document.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.2.1.p.3">The following is a non-normative example of the contents of a registration request message prior to serialization: </p>
<pre>
 {
   "iss": "https://tenant-12345.idp.example.com",
   "aud": "https://tenant-67890.app.example.com",
   "exp": 1234567890,
   "authentication_profiles": [
     "urn:ietf:params:fastfed:1.0:authentication:saml:2.0:enterprise"
   ],
   "urn:ietf:params:fastfed:1.0:authentication:saml:2.0:enterprise": {
     "saml_metadata_uri": "https://tenant-12345.idp.example.com/saml-metadata.xml"
   }
 }
</pre>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#FastFedHandshakeRegistrationResponse" id="FastFedHandshakeRegistrationResponse">FastFed Registration Response</a>
</h1>
<p id="rfc.section.3.2.2.p.1">This specification extends the contents of the FastFed Registration Response (Section 7.2.3.3 of <a href="#FastFed.Core" class="xref">FastFed Core</a>) with an additional member sharing the same name as the profile: <br><br><samp>"urn:ietf:params:fastfed:1.0:authentication:saml:2.0:enterprise"</samp>.  </p>
<p id="rfc.section.3.2.2.p.2">The value of the element is a structure with the following members: </p>

<dl>
<dt>saml_metadata_uri</dt>
<dd style="margin-left: 8">REQUIRED. Contains the URL of the Application Provider's SAML Metadata document.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.2.2.p.3">The following is a non-normative example of the contents of a registration response message: </p>
<pre>
 {
   "urn:ietf:params:fastfed:1.0:authentication:saml:2.0:enterprise": {
     "saml_metadata_uri": "https://tenant-56789.app.example.com/saml-metadata.xml"
   }
 }
</pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#SchemaBinding" id="SchemaBinding">Schema Binding</a>
</h1>
<p id="rfc.section.4.p.1">FastFed recommmends SCIM for user schemas. However, neither SAML nor SCIM specify how to represent SCIM attributes in the context of SAML assertions.  </p>
<p id="rfc.section.4.p.2">This specification fills the gap and defines how FastFed compatible Providers can use the SCIM 2.0 Schema Grammar (Section 3.3.4.1 of <a href="#FastFed.Core" class="xref">FastFed Core</a>) with the SAML 2.0 protocol.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#SchemaBindingScimToSaml" id="SchemaBindingScimToSaml">SCIM-to-SAML Attribute Mapping</a>
</h1>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#SchemaBindingScimToSamlSubject" id="SchemaBindingScimToSamlSubject">SAML Subject</a>
</h1>
<p id="rfc.section.4.1.1.p.1">A SAML Response document contains a <samp>Subject</samp> element which identifies the authenticated user.  </p>
<p id="rfc.section.4.1.1.p.2">The Application Provider declares the attribute to populate in the SAML Subject via the <samp>saml_subject</samp> element in <a href="#FastFedMetadataApplicationMetadata" class="xref">Section 3.1.2</a> </p>
<p id="rfc.section.4.1.1.p.3">The value of the <samp>saml_subject</samp> MUST be one of the SCIM Attributes in the table below.  </p>
<p id="rfc.section.4.1.1.p.4">Note: In the table, SCIM attributes refer to the "User" Resource Schema defined in Section 4.1 of the <a href="#RFC7643" class="xref">SCIM Core Specification</a>. Individual members of a JSON structure are referenced in the table using the JSON path syntax defined in Section 3.5.2 of the <a href="#RFC7644" class="xref">SCIM Protocol</a>.  </p>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">SCIM Attribute</th>
<th class="left">SAML NameID Format</th>
</tr></thead>
<tbody>
<tr>
<td class="left">externalId</td>
<td class="left">urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</td>
</tr>
<tr>
<td class="left">userName</td>
<td class="left">urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified</td>
</tr>
<tr>
<td class="left">emails[primary eq true].value</td>
<td class="left">urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.1.1.p.5">As a reference to implementors, the following considerations can be taken into account when choosing a SAML subject: </p>

<ul>
<li>The format of <samp>externalId</samp> is defined in section 3.1 of the SCIM Core specification <a href="#RFC7643" class="xref">[RFC7643]</a>.  It is a persistent identifier, often a GUID, which is intended to reliably identify a user within the Identity Provider. However, it will vary between Identity Providers. Therefore, if an Application anticipates that Administrators may occasionally switch Identity Providers (as can happen in commercial settings, for example), additional matching rules may be necessary to reconcile provisioning events arriving from different sources.  <br><br> Note that while the SCIM Core specification defines the <samp>externalId</samp> as optional, this profile requires Identity Providers to support it, and hence Applications can depend upon it being available.  <br><br> </li>
<li>The format of <samp>userName</samp> is defined in section 4.1.1 of the SCIM Core specification <a href="#RFC7643" class="xref">[RFC7643]</a>.  It is a displayable, user-friendly identifier for a user. In practice, the userName can often be an email, but other formats occur.  No assumptions should be made about the format of the userName other than it being a string that the end-user typically enters as a login when authenticating.  <br><br> If the Administrator switches Identity Providers, it is usually the case that the <samp>userName</samp> remains consistent across providers, making it easier to correlate authentication and provisioning events to a single user when events are arriving from different sources.  <br><br> Note that <samp>userName</samp> is mutable, meaning an end-user can change their <samp>userName</samp>. In addition <samp>userName</samp> can be recycled and reassigned to other end-users. Therefore, Applications should consider how such situations will be handled. The ability to be notified when <samp>userName</samp> is changed or recycled, such as via the SCIM profile <a href="#FastFedProfile.EnterpriseSCIM" class="xref">[FastFedProfile.EnterpriseSCIM]</a>, can help keep an Application Provider up-to-date with changes.  <br><br> </li>
<li>The attribute "<samp>emails[primary eq true].value"</samp> represents the primary email address of the user, where <samp>emails</samp> is defined in section 4.1.2 of the SCIM Core specification <a href="#RFC7643" class="xref">[RFC7643]</a>.  <br><br> If an end-user does not have a value for email defined within the Identity Provider, the end-user will be unable to authenticate to the Application. As a result, choosing email as a SAML Subject is appropriate only when an Application requires an email address and is willing to reject end-users who lack it.  <br><br> In addition, emails can be changed or recycled in the same manner as the <samp>userName</samp>. Therefore, similar mechanisms are necessary to handle such events.  <br><br> </li>
<li>In some circumstances, it may be necessary to use multiple attributes to best match a SAML Authentication response against a specific end-user in the Application. If this occurs, it is acceptable to use both the SAML Subject and the SAML Attributes in combination to perform the matching. In this scenario, the choice of SAML Subject becomes somewhat flexible, and one may choose whichever option is most likely to be available and useful.  </li>
</ul>

<p> </p>
<p id="rfc.section.4.1.1.p.6">When generating a SAML Response, the Identity Provider MUST populate the SAML Subject with a NameID containing the attribute requested by the Application Provider, and the associated NameID Format from the table above.  </p>
<p id="rfc.section.4.1.1.p.7">The Identity Provider MUST be able to provide a value of <samp>externalId</samp> and <samp>userName</samp> for all end-users. Email address is optional.  </p>
<p id="rfc.section.4.1.1.p.8">If a value for an optional attribute is not defined for an end-user, the Identity Provider MUST NOT perform any authentication activity into the Application Provider for the affected end-user. To assist with diagnostics, the Identity Provider SHOULD signal to the end-user that the attribute is missing and is required by the Application. The means of doing so are outside the scope of the specification, but could include displaying an informative error message when the end-user attempts to authenticate into the application, or making error logs available to the administrators of the Identity Provider.  </p>
<p id="rfc.section.4.1.1.p.9">The following is a non-normative example of the use of <samp>"externalId"</samp> as the SAML Subject: </p>
<pre>
 &lt;saml:Subject&gt;
   &lt;saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"&gt;1fc58220-7213-47bb-9161-bbd39ad75937&lt;/saml:NameID&gt;
 &lt;/saml:Subject&gt;
</pre>
<p id="rfc.section.4.1.1.p.10">The following is a non-normative example of the use of <samp>"userName"</samp> as the SAML Subject: </p>
<pre>
  &lt;saml:Subject&gt;
    &lt;saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:unspecified"&gt;bjensen&lt;/saml:NameID&gt;
  &lt;/saml:Subject&gt;
</pre>
<p id="rfc.section.4.1.1.p.11">The following is a non-normative example of the use of <samp>"email[primary eq true].value"</samp> as the SAML Subject: </p>
<pre>                                                                                          
 &lt;saml:Subject&gt;
   &lt;saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:emailAddress"&gt;babs@example.com&lt;/saml:NameID&gt;               
 &lt;/saml:Subject&gt;
</pre>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> <a href="#SchemaBindingScimToSamlAttributes" id="SchemaBindingScimToSamlAttributes">SAML Attributes</a>
</h1>
<p id="rfc.section.4.1.2.p.1">If users have been pre-provisioned into the Application through mechanisms such as SCIM, the SAML Subject alone can be sufficient to correlate the incoming SAML message with the appropriate pre-existing user. However, there can be circumstances when additional user attributes are necessary.  </p>
<p id="rfc.section.4.1.2.p.2">One such situation occurs when an application is using Just-In-Time provisioning instead of pre-provisioning. In this mode of behavior, the incoming user attributes are used to auto-instantiate a user in the Application.  </p>
<p id="rfc.section.4.1.2.p.3">To support these scenarios, FastFed allows a subset of user attributes to be included in SAML response messages according to the mapping rules below. Any attributes not in the mapping table are only accessible via SCIM provisioning and cannot be included in SAML response messages.  </p>
<p id="rfc.section.4.1.2.p.4">Attributes are requested by populating the member <samp>"desired_attributes"</samp> in the Application Provider Metadata (<a href="#FastFedMetadataApplicationMetadata" class="xref">Section 3.1.2</a>).  </p>
<p id="rfc.section.4.1.2.p.5">If attributes are requested, and values exist for the user, then the Identity Provider MUST include SAML Attribute elements in the response message with the following properties: </p>

<ul>
<li>
<samp>Name</samp> set to the value in the mapping table below.  </li>
<li>
<samp>NameFormat</samp> set to <samp>"urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"</samp>.  </li>
<li>
<samp>AttributeValue</samp> element with <samp>xsi:type="xs:string"</samp> and the value from the SCIM object according to the mapping table below.  </li>
</ul>

<p> </p>
<p id="rfc.section.4.1.2.p.6">Note: In the table below, SCIM attributes refer to the "User" Resource Schema defined in Section 4.1 of the <a href="#RFC7643" class="xref">SCIM Core Specification</a>. Individual members of a JSON structure are referenced in the table using the JSON path syntax defined in Section 3.5.2 of the <a href="#RFC7644" class="xref">SCIM Protocol</a>.  </p>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">SCIM Attribute</th>
<th class="left">SAML Attribute Name</th>
</tr></thead>
<tbody>
<tr>
<td class="left">externalId</td>
<td class="left">externalId</td>
</tr>
<tr>
<td class="left">userName</td>
<td class="left">userName</td>
</tr>
<tr>
<td class="left">displayName</td>
<td class="left">displayName</td>
</tr>
<tr>
<td class="left">name.givenName</td>
<td class="left">givenName</td>
</tr>
<tr>
<td class="left">name.familyName</td>
<td class="left">familyName</td>
</tr>
<tr>
<td class="left">name.middleName</td>
<td class="left">middleName</td>
</tr>
<tr>
<td class="left">emails[primary eq true].value</td>
<td class="left">email</td>
</tr>
<tr>
<td class="left">phoneNumbers[primary eq true].value</td>
<td class="left">phoneNumber</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.1.2.p.7">The following is a non-normative example demonstrating a transformation from a SCIM User to SAML Attributes: </p>
<pre>
 &lt;saml:AttributeStatement&gt;
   &lt;saml:Attribute Name="externalId" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml:AttributeValue xsi:type="xs:string"&gt;1fc58220-7213-47bb-9161-bbd39ad75937&lt;/saml:AttributeValue&gt;
   &lt;/saml:Attribute&gt;
   &lt;saml:Attribute Name="userName" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml:AttributeValue xsi:type="xs:string"&gt;bjensen&lt;/saml:AttributeValue&gt;
   &lt;/saml:Attribute&gt;
   &lt;saml:Attribute Name="displayName" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml:AttributeValue xsi:type="xs:string"&gt;Babs Jensen&lt;/saml:AttributeValue&gt;
   &lt;/saml:Attribute&gt;
   &lt;saml:Attribute Name="givenName" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml:AttributeValue xsi:type="xs:string"&gt;Barbara&lt;/saml:AttributeValue&gt;
   &lt;/saml:Attribute&gt;
   &lt;saml:Attribute Name="familyName" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml:AttributeValue xsi:type="xs:string"&gt;Jensen&lt;/saml:AttributeValue&gt;
   &lt;/saml:Attribute&gt;
   &lt;saml:Attribute Name="middleName" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml:AttributeValue xsi:type="xs:string"&gt;Jane&lt;/saml:AttributeValue&gt;
   &lt;/saml:Attribute&gt;
   &lt;saml:Attribute Name="email" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml:AttributeValue xsi:type="xs:string"&gt;bjensen@example.com&lt;/saml:AttributeValue&gt;
   &lt;/saml:Attribute&gt;
   &lt;saml:Attribute Name="phoneNumber" NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"&gt;
        &lt;saml:AttributeValue xsi:type="xs:string"&gt;1-555-555-5555&lt;/saml:AttributeValue&gt;
   &lt;/saml:Attribute&gt;
 &lt;/saml:AttributeStatement&gt;

</pre>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#SchemaBindingPrivacyConsiderations" id="SchemaBindingPrivacyConsiderations">Privacy Considerations</a>
</h1>
<p id="rfc.section.4.2.p.1">When exposing user information through SAML Attributes, FastFed Identity Providers MUST NOT expose any attributes which were not in the <samp>desired_attributes</samp> or <samp>saml_subject</samp> elements of the Application Provider Metadata (<a href="#FastFedMetadataApplicationMetadata" class="xref">Section 3.1.2</a>).  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Interoperability" id="Interoperability">Interoperability Requirements</a>
</h1>
<p id="rfc.section.5.p.1">Each identity standard defines a set of optional features to enable usage in a wide variety of circumstances.  </p>
<p id="rfc.section.5.p.2">However, a consequence of the flexibility is that two Providers may find themselves incompabitible despite sharing the same protocols.  </p>
<p id="rfc.section.5.p.3">To deliver the simplified experience that is the goal of FastFed, it is important that two FastFed-enabled Providers have confidence that they can interoperate when sharing the same protocols.  </p>
<p id="rfc.section.5.p.4">The following sections describe the subset of the SAML specifications that Providers MUST implement to be compatible with this profile.  Providers MAY support additional functionality, but MUST NOT require the additional functionality when configuring federation with another Provider using FastFed specifications.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#SAMLInteroperabilityIdentityProviderReqs" id="SAMLInteroperabilityIdentityProviderReqs">Identity Provider Requirements</a>
</h1>
<p></p>

<ul>
<li>MUST implement the required functionality of a SAML Identity Provider as defined in the SAML Web Browser SSO Profile (Section 4.1 of <a href="#SAML.Profiles" class="xref">[SAML.Profiles]</a>).  </li>
<li>MUST use the HTTP POST bindings for the authentication response of the Web Browswer SSO Profile.  </li>
<li>MUST use X509 Certificates for the Signature elements within the SAML Response object.  </li>
<li>MUST include a Signature element for the Assertion in the SAML Response, and in addition, MAY include a Signature element for the overall Response.  </li>
<li>The minimum algorithm stregth for the Signature elements SHOULD be SHA-256 for the hash digest, and either RSA with 2048 bit keys, or ECDSA with Curve P-256, for the signature.  </li>
<li>MUST include a "Conditions" element on the Assertion with NotBefore and NotOnOrAfter properties that constrain the validity period of the Assertion to the shortest feasible duration. As a reference to implementors, a 10 minute window is often sufficient to reduce the risk of replays while still allowing a small degree of clock skew between participants.  </li>
<li>MUST host a SAML Metadata document at the location specified by the <samp>saml_metadata_uri</samp> exchanged during the FastFed Handshake.  </li>
<li>MUST include an IDPSSODescriptor element in the SAML Metadata document as specified in <a href="#SAML.Metadata" class="xref">[SAML.Metadata]</a>.  </li>
<li>MUST populate the IDPSSODescriptor element with all values needed by a SAML Service Provider to integrate with this SAML Identity Provider using the capabilities described in this section.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#SAMLInteroperabilityApplicationProviderReqs" id="SAMLInteroperabilityApplicationProviderReqs">Application Provider Requirements</a>
</h1>
<p id="rfc.section.5.2.p.1">SAML Requirements for Application Providers: </p>

<ul>
<li>MUST implement the required functionality of a SAML Service Provider as defined in the SAML Web Browser SSO Profile (Section 4.1 of <a href="#SAML.Profiles" class="xref">[SAML.Profiles]</a>).  </li>
<li>MUST use the HTTP Redirect binding for the authentication request of the Web Browswer SSO Profile.  </li>
<li>MUST accept X509 Certificates for the Signature elements containined within the SAML Response object.  </li>
<li>SHOULD support Signature elements generated using the SHA-256 algorithm for the hash digest, and either RSA with 2048 bit keys, or ECDSA with Curve P-256, for the signature.  </li>
<li>MUST host a SAML Metadata document at the location specified by the <samp>saml_metadata_uri</samp> exchanged during the FastFed Handshake.  </li>
<li>MUST include an SPSSODescriptor element in the SAML Metadata document as specified in <a href="#SAML.Metadata" class="xref">[SAML.Metadata]</a>.  </li>
<li>MUST populate the SPSSODescriptor with all values needed by a SAML Identity Provider to integrate with this SAML Service Provider using the capabilities described in this section.  </li>
<li>MAY use the information in the Identity Provider's corresponding SAML Metadata document to decide whether to use additional SAML capabilities, above and beyond the FastFed minimum interoperablity requirements. The additional capabilities must be optional and the federation MUST still succeed if one Provider does not support the additional capabilities.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#LoginHint" id="LoginHint">Login Hint</a>
</h1>
<p id="rfc.section.5.3.p.1">The Application Provider MAY include the URL-encoded query parameter <samp>LoginHint={hint}</samp> when initiating an authentication request via the SAML HTTP Redirect binding.  </p>
<p id="rfc.section.5.3.p.2">The value is a hint to the Identity Provider about the login identifier the end-user might use to log in. This hint can be known to the Application Provider, for example, if it first asks the end-user for their e-mail address (or other identifier) in order to discover the authentication provider to be used for sign-in. It is RECOMMENDED that the hint value match the value used for discovery.  </p>
<p id="rfc.section.5.3.p.3">The use of this parameter is left to the Identity Provider's discretion.  </p>
<p id="rfc.section.5.3.p.4">The LoginHint MUST NOT be included in request signature for the HTTP Redirect Binding.  </p>
<p id="rfc.section.5.3.p.5">The Identity Provider MUST ignore the LoginHint parameter if the SAML Authentication Request message contains a <samp>Subject</samp> with an identifier.  </p>
<p id="rfc.section.5.3.p.6">The following is a non-normative example of a SAML HTTP Redirect request with a LoginHint: </p>
<pre>
 HTTP/1.1 302 Found
 Location http://idp.example.com/SAML?LoginHint=bjensen%40example.org&amp;SAMLRequest=[...omitted for brevity...]
</pre>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#SAMLCertificateRotationRequirements" id="SAMLCertificateRotationRequirements">Certificate Rotation</a>
</h1>
<p id="rfc.section.5.4.p.1">While the full SAML specification supports a variety of key types, the FastFed Profile defined herein restricts Providers to only X509 Keys for signing SAML Assertions in Web Browser SSO response messages from the Identity Provider.  </p>
<p id="rfc.section.5.4.p.2">FastFed Providers MUST implement automatic rotation of the X509 Certificates. This section describes the interoperability requirements for certificate rotation.  </p>
<h1 id="rfc.section.5.4.1">
<a href="#rfc.section.5.4.1">5.4.1.</a> <a href="#SAMLKeyPublicationRequirements" id="SAMLKeyPublicationRequirements">Certificate Rotation Requirements for an Identity Provider</a>
</h1>
<p id="rfc.section.5.4.1.p.1">To rotate and publish new SAML signing certificates, the following requirements apply to the Identity Provider: </p>

<ul>
<li>MUST include new certificates in the response to queries against the SAML Metadata URL that was exchanged during the FastFed Handshake.  </li>
<li>MUST publish the new certificate in the SAML Metadata at least 14 days before the currently active certificate will expire or be revoked, where the expiration date is specified by the <samp>notAfter</samp> attribute within the X.509 certificate.  </li>
<li>MUST include the new certificate in the SAML Metadata, alongside the currently active certificate, using the recommended technique for multiple certificates defined in the <a href="#SAML.Interoperability" class="xref">SAML Metadata Interoperability Profile</a>. As a reference, this Interopability Profile specifies that each certificate MUST be placed within its own <samp>&lt;KeyDescriptor&gt;</samp> element.  </li>
<li>SHOULD continue using the original key for signing SAML Assertions for at least 7 days after publishing the new certificate, to give consumers time to read the new certificate from the SAML Metadata and be ready to receive the new key.  </li>
<li>SHOULD begin signing assertions with the new key if less than 7 days remains until the old certificate expires. MAY continue using the old key if problems arise with the new key, to give time for diagnosis of the problems.  </li>
<li>SHOULD stop using the old key for signing assertions when less than 1 day remains until the old certificate expires.  </li>
<li>MUST support HTTP 1.1 ETag semantics <a href="#RFC2616" class="xref">[RFC2616]</a> for all requests to the SAML Metadata URL, including: <ul>
<li>Returning an ETag response header </li>
<li>Accepting an If-None-Match request header, and returning an HTTP 304 response if the SAML Metadata is unmodified.  </li>
</ul>
<p> </p>
</li>
<li>MAY return an HTTP 301 response code to indicate the SAML Metadata has moved to a new location.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.4.2">
<a href="#rfc.section.5.4.2">5.4.2.</a> <a href="#SAMLKeyConsumptionRequirements" id="SAMLKeyConsumptionRequirements">Certificate Rotation Requirements for an Application                 Provider</a>
</h1>
<p id="rfc.section.5.4.2.p.1">To consume rotated SAML signing certificates, the following options are available to the Application Provider: </p>

<ul>
<li>MAY retrieve new keys on demand by reloading the Identity Provider's SAML Metadata file upon detecting a SAML authentication response signed with an unrecognized key.  </li>
<li>Alternatively, MAY preemptively retrieve new keys by querying the Identity Provider's SAML Metadata file on a recurring basis to check for updates.  </li>
</ul>

<p> </p>
<p id="rfc.section.5.4.2.p.2">When preemptively querying for updates on a recurring basis, the following requirements apply to the Application Provider: </p>

<ul>
<li>MUST re-query the Identity Provider's SAML Metadata URL to check for new certificates at least once every 24 hours. Because certificates can be rotated at any time, the Application Provider MUST NOT wait for the expiration date to check for updated certificates.  </li>
<li>MUST include the If-None-Match header in the request to download the SAML Metadata, populated with the value of the ETag response header received when previously downloading the SAML Metadata.  </li>
<li>SHOULD alert the Administrator if the Identity Provider has not published a new certificate and less than 14 days remains until expiration of the current certificate. The alert mechanism is an implementation detail that is outside the scope of the specification.  </li>
<li>MUST handle an HTTP 304 response code which indicates that the SAML Metadata is unchanged.  </li>
<li>SHOULD handle an HTTP 301 response code and use the new location for all future downloads of the Identity Provider's SAML Metadata.  </li>
</ul>

<p> </p>
<p id="rfc.section.5.4.2.p.3">In all cases of certificate refresh, both on-demand and preemptive, the following requirements apply to the Application Provider: </p>

<ul>
<li>MUST support the consumption of multiple certificates using the recommended techniques defined in the <a href="#SAML.Interoperability" class="xref">SAML Metadata Interoperability Profile</a>. As a reference, this Interopability Profile specifies that each certificate MUST be placed within its own <samp>&lt;KeyDescriptor&gt;</samp> element.  </li>
<li>MUST ignore any changes in the SAML Metadata except for <samp>&lt;KeyDescriptor&gt;</samp> elements.  </li>
<li>MUST accept SAML assertions signed using any of the valid certificates specified within the <samp>&lt;KeyDescriptor&gt;</samp> elements of the Identity Provider SAML Metadata.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">For SAML security considerations, see <a href="#SAML.SecurityConsiderations" class="xref">SAML Security and Privacy Considerations</a>.  </p>
<p id="rfc.section.6.p.2">For FastFed security considerations, see Section 8 of <a href="#FastFed.Core" class="xref">FastFed Core</a>.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">Pending </p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="FastFed.Core">[FastFed.Core]</b></td>
<td class="top">
<a title="Amazon">McAdams, K.</a>, "<a href="http://openid.net/specs/fastfed-core-1_0.html">FastFed Core 1.0</a>", October 2020.</td>
</tr>
<tr>
<td class="reference"><b id="FastFedProfile.EnterpriseSCIM">[FastFedProfile.EnterpriseSCIM]</b></td>
<td class="top">
<a title="Amazon">McAdams, K.</a>, "<a href="http://openid.net/specs/fastfed-scim-1_0.html">FastFed Enterprise SCIM Profile 1.0</a>", October 2020.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a>Fielding, R.</a>, <a>Gettys, J.</a>, <a>Mogul, J.</a>, <a>Frystyk, H.</a>, <a>Masinter, L.</a>, <a>Leach, P.</a> and <a>T. Berners-Lee</a>, "<a href="https://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, DOI 10.17487/RFC2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7643">[RFC7643]</b></td>
<td class="top">
<a>Hunt, P.</a>, <a>Grizzle, K.</a>, <a>Wahlstroem, E.</a> and <a>C. Mortimore</a>, "<a href="https://tools.ietf.org/html/rfc7643">System for Cross-domain Identity Management: Core Schema</a>", RFC 7643, DOI 10.17487/RFC7643, September 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7644">[RFC7644]</b></td>
<td class="top">
<a>Hunt, P.</a>, <a>Grizzle, K.</a>, <a>Ansari, M.</a>, <a>Wahlstroem, E.</a> and <a>C. Mortimore</a>, "<a href="https://tools.ietf.org/html/rfc7644">System for Cross-domain Identity Management: Protocol</a>", RFC 7644, DOI 10.17487/RFC7644, September 2015.</td>
</tr>
<tr>
<td class="reference"><b id="SAML.Interoperability">[SAML.Interoperability]</b></td>
<td class="top">
<a title="Internet2">Cantor, S.</a>, <a title="Nokia">Kemp, J.</a>, <a title="RSA Security">Philpott, R.</a> and <a title="Sun Microsystems">E. Maler</a>, "<a href="https://www.oasis-open.org/committees/download.php/36645/draft-sstc-metadata-iop-2.0-01.pdf">SAML V2.0 Metadata Interoperability Profile Version 1.0</a>", August 2009.</td>
</tr>
<tr>
<td class="reference"><b id="SAML.Metadata">[SAML.Metadata]</b></td>
<td class="top">
<a title="Internet2">Cantor, S.</a>, <a title="Sigaba">Moreh, J.</a>, <a title="RSA Security">Philpott, R.</a> and <a title="Sun Microsystems">E. Maler</a>, "<a href="http://docs.oasis-open.org/security/saml/v2.0/saml-metadata-2.0-os.pdf">Metadata for the OASIS Security Assertion Markup Language (SAML) V2.0</a>", March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="SAML.Profiles">[SAML.Profiles]</b></td>
<td class="top">
<a title="Atos Origin">Hughes, J.</a>, <a title="Internet2">Cantor, S.</a>, <a title="Neustar">Hodges, J.</a>, <a title="Nokia">Hirsch, F.</a>, <a title="Principal Identity">Mishra, P.</a>, <a title="RSA Security">Philpott, R.</a> and <a title="Sun Microsystems">E. Maler</a>, "<a href="http://docs.oasis-open.org/security/saml/v2.0/saml-profiles-2.0-os.pdf">Profiles for the OASIS Security Assertion Markup Language (SAML) V2.0"</a>", March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="SAML.SecurityConsiderations">[SAML.SecurityConsiderations]</b></td>
<td class="top">
<a title="Nokia">Hirsch, F.</a>, <a title="RSA Security">Philpott, R.</a> and <a title="Sun Microsystems">E. Maler</a>, "<a href="http://docs.oasis-open.org/security/saml/v2.0/saml-sec-consider-2.0-os.pdf">Security and Privacy Considerations for the OASIS Security Assertion Markup Language (SAML) V2.0</a>", March 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.A.p.1">The OpenID Community would like to thank the following people for their contributions to this specification: </p>
<p></p>

<ul class="empty">
<li>Brian Campbell (bcampbell@pingidentity.com), Ping Identity </li>
<li>Zhen Chien Chia (chiazhenchien@outlook.com), Microsoft </li>
<li>Pamela Dingle (pamela.dingle@microsoft.com), Microsoft </li>
<li>Matt Domsch (matt.domsch@sailpoint.com), SailPoint </li>
<li>Wesley Dunnington (wesleydunnington@pingidentity.com), Ping Identity </li>
<li>Erik Gustavson (erikgustavson@google.com), Google </li>
<li>Dick Hardt (dick.hardt@gmail.com), Independent </li>
<li>Romain Lenglet (rlenglet@google.com), Google </li>
<li>Karl McGuinness (kmcguinness@okta.com), Okta </li>
<li>Chuck Mortimore (cmortimore@salesforce.com), Salesforce </li>
<li>Brian Rose (brian.rose@sailpoint.com), SailPoint </li>
</ul>

<p> </p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#Notices" id="Notices">Notices</a>
</h1>
<p id="rfc.section.B.p.1">Copyright (c) 2020 The OpenID Foundation.</p>
<p id="rfc.section.B.p.2">The OpenID Foundation (OIDF) grants to any Contributor, developer, implementer, or other interested party a non-exclusive, royalty free, worldwide copyright license to reproduce, prepare derivative works from, distribute, perform and display, this Implementers Draft or Final Specification solely for the purposes of (i) developing specifications, and (ii) implementing Implementers Drafts and Final Specifications based on such documents, provided that attribution be made to the OIDF as the source of the material, but that such attribution does not indicate an endorsement by the OIDF.</p>
<p id="rfc.section.B.p.3">The technology described in this specification was made available from contributions from various sources, including members of the OpenID Foundation and others. Although the OpenID Foundation has taken steps to help ensure that the technology is available for distribution, it takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this specification or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any independent effort to identify any such rights. The OpenID Foundation and the contributors to this specification make no (and hereby expressly disclaim any) warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to this specification, and the entire risk as to implementing this specification is assumed by the implementer. The OpenID Intellectual Property Rights policy requires contributors to offer a patent promise not to assert certain patent claims against other contributors and against implementers. The OpenID Foundation invites any interested party to bring to its attention any copyrights, patents, patent applications, or other proprietary rights that may cover technology that may be required to practice this specification.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Darin K. McAdams</span> 
	  <span class="n hidden">
		<span class="family-name">McAdams</span>
	  </span>
	</span>
	<span class="org vcardline">Amazon</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:darinm@amazon.com">darinm@amazon.com</a></span>

  </address>
</div>

</body>
</html>
