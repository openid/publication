<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>OpenID Connect MODRNA Discovery Profile 1.0 draft-05</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Notation and Conventions">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Overview">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Redirect-based flow">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 POST-based flow">
<link href="#rfc.section.3" rel="Chapter" title="3 Mobile Issuer Discovery Service">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 User Interaction Endpoint">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Request">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Response">
<link href="#rfc.section.3.1.3" rel="Chapter" title="3.1.3 Error Response">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Issuer Endpoint">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 Request">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 Response">
<link href="#rfc.section.3.2.3" rel="Chapter" title="3.2.3 Error Response">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Privacy Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Account Chooser">
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 AC Client">
<link href="#rfc.appendix.A.2" rel="Chapter" title="A.2 AC Identity Provider">
<link href="#rfc.appendix.B" rel="Chapter" title="B Acknowledgements">
<link href="#rfc.appendix.C" rel="Chapter" title="C Notices">
<link href="#rfc.appendix.D" rel="Chapter" title="D Document History">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.44.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Lodderstedt, T. and J. Bradley" />
  <meta name="dct.identifier" content="urn:ietf:id:openid-connect-modrna-discovery-05" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-11-12" />
  <meta name="dct.abstract" content="OpenID Connect Discovery 1.0 section 2.1 specifies a way to normalize a user identifier to derive a resource and especially a host for OpenID Provider Issuer Discovery.  While this works well for identifiers as email addresses and urls, it does not work for typical identifiers from the mobile network space. In a mobile environment, MSISDN's or ip-addresses are typical resources identifying a user or the respective mobile network operator (MNO). The structure of those identifiers does not allow for an algorithmic normalization. Thus it will be necessary to have a specific service to perform the normalization. The OpenID Connect Mobile Discovery Profile specifies the interface of this service. Part of the interface specification will be the identification of possible user input identifier types relevant in the Mobile Connect scenario. Remark: Some of those user input identifier types may not identify a single user/device but may be sufficient to identify the right mobile operator. An example for this is the MNC/MCC tuple (mobile network code/ mobile contry code) or the IP address range. " />
  <meta name="description" content="OpenID Connect Discovery 1.0 section 2.1 specifies a way to normalize a user identifier to derive a resource and especially a host for OpenID Provider Issuer Discovery.  While this works well for identifiers as email addresses and urls, it does not work for typical identifiers from the mobile network space. In a mobile environment, MSISDN's or ip-addresses are typical resources identifying a user or the respective mobile network operator (MNO). The structure of those identifiers does not allow for an algorithmic normalization. Thus it will be necessary to have a specific service to perform the normalization. The OpenID Connect Mobile Discovery Profile specifies the interface of this service. Part of the interface specification will be the identification of possible user input identifier types relevant in the Mobile Connect scenario. Remark: Some of those user input identifier types may not identify a single user/device but may be sufficient to identify the right mobile operator. An example for this is the MNC/MCC tuple (mobile network code/ mobile contry code) or the IP address range. " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left"></td>
<td class="right">T. Lodderstedt</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">yes.com</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J. Bradley</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Yubico</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">November 12, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">OpenID Connect MODRNA Discovery Profile 1.0 draft-05<br />
  <span class="filename">openid-connect-modrna-discovery-05</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p><a href="#OpenID.Discovery" class="xref">OpenID Connect Discovery 1.0</a> section 2.1 specifies a way to normalize a user identifier to derive a resource and especially a host for OpenID Provider Issuer Discovery.  While this works well for identifiers as email addresses and urls, it does not work for typical identifiers from the mobile network space. In a mobile environment, MSISDN's or ip-addresses are typical resources identifying a user or the respective mobile network operator (MNO). The structure of those identifiers does not allow for an algorithmic normalization. Thus it will be necessary to have a specific service to perform the normalization.</p>
<p>The OpenID Connect Mobile Discovery Profile specifies the interface of this service. Part of the interface specification will be the identification of possible user input identifier types relevant in the Mobile Connect scenario. Remark: Some of those user input identifier types may not identify a single user/device but may be sufficient to identify the right mobile operator. An example for this is the MNC/MCC tuple (mobile network code/ mobile contry code) or the IP address range.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Requirements Notation and Conventions</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Overview</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Redirect-based flow</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">POST-based flow</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Mobile Issuer Discovery Service</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">User Interaction Endpoint</a>
</li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Request</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Response</a>
</li>
<li>3.1.3.   <a href="#rfc.section.3.1.3">Error Response</a>
</li>
</ul><li>3.2.   <a href="#rfc.section.3.2">Issuer Endpoint</a>
</li>
<ul><li>3.2.1.   <a href="#rfc.section.3.2.1">Request</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">Response</a>
</li>
<li>3.2.3.   <a href="#rfc.section.3.2.3">Error Response</a>
</li>
</ul></ul><li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">Privacy Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<ul><li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Account Chooser</a>
</li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">AC Client</a>
</li>
<li>A.2.   <a href="#rfc.appendix.A.2">AC Identity Provider</a>
</li>
</ul><li>Appendix B.   <a href="#rfc.appendix.B">Acknowledgements</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.C">Notices</a>
</li>
<li>Appendix D.   <a href="#rfc.appendix.D">Document History</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">OpenID Connect Mobile Discovery Profile 1.0 is a profile of the <a href="#OpenID.Discovery" class="xref">OpenID Connect Discovery 1.0</a> specification that stipulates how a OpenID Connect relying party (RP) can use mobile network specific identifiers to determine the OpenID OP authoritive for a certain mobile subscription.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#rnc" id="rnc">Requirements Notation and Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<p id="rfc.section.1.1.p.2">Throughout this document, values are quoted to indicate that they are to be taken literally. When using these values in protocol messages, the quotes MUST NOT be used as part of the value.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.1.2.p.1">This specification uses the terms "Refresh Token", "Client Identifier",and "Client Secret" defined by <a href="#RFC6749" class="xref">OAuth 2.0</a>. This specification uses the terms "OpenID Provider (OP)" and Relying Party (RP) defined by OpenID Connect Core <a href="#OpenID.Core" class="xref">[OpenID.Core]</a>.</p>
<p id="rfc.section.1.2.p.2">This specification also defines the following terms:</p>
<p></p>

<ul class="empty"><li>Mobile Network Operator (MNO): is a provider of wireless communication services. For the purpose of this specification, the MNO also offers identity services for its subscribers represented by a OpenID Connect OP.</li></ul>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Overview</h1>
<p id="rfc.section.2.p.1">This specification defines two different discovery flows intended to fit the needs of both server-based web as well as native applications residing on mobile devices.</p>
<p id="rfc.section.2.p.2">The protocol design is guided by to following requirements:</p>
<p></p>

<ul>
<li>A user's MSISDN can be used to determine the respective MNO. In order to preserve privacy of the user's MSISDN, it is assumed that it is typically entered in the user interface provided by the trusted discovery service. From a practial perspective, some RPs will either already are in posession of MSISDNs or may obtain it from the mobile device's operating system (which tyically also requires user consent). Therefore this specification will allow RPs to pass MSISDNs to the discovery service in general. It is at the discretion of the respective discovery service to authorize certain RPs to use this feature.</li>
<li>Due to privacy reasons and the cost risk for MNOs associated with it, it must be ensured that the discovery service cannot be abused as a mobile phone number lookup service by unauthorized parties.</li>
</ul>
<p id="rfc.section.2.p.4">This specification assumes the RP established a trust relationship with the discovery service before the actual discovery flow starts. The RP is required to send a client_id with every requests.  A mechanism similar to <a href="#OpenID.Registration" class="xref">[OpenID.Registration]</a> could be utilized automatically setup the client.</p>
<p id="rfc.section.2.p.5">Depending on the client type, it might also be required to authenticate towards the Issuer Endpoint. Any client authentication method defined for OAuth and OpenID Connect could be used to authenticate.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Redirect-based flow</h1>
<p id="rfc.section.2.1.p.1">This section gives an overview on the redirect-based flow, which is intended to be used by server-side web application. The design of this flow is inspired by the OAuth 2.0 authorization code flow <a href="#RFC6749" class="xref">[RFC6749]</a>.</p>
<p id="rfc.section.2.1.p.2">Note: This flow, in contrast to the POST-based flow, does support lookup of the MNO based on the user's MSISDN.</p>
<p>The following figure shows the message flow during the discovery process.</p>
<pre> 
     +---------+                               +---------------------------------+   
     |         |                               | Mobile Issuer Discovery Service |
     |         |                               |                                 | 
     |         |                               +------------------+              |
     |         |--(A)-- Discovery Request ----&gt;| User Interaction |              |
     | Relying |&lt;-(B)----- Code ---------------|     Endpoint     |              |
     | Party   |                               +------------------+              |
     |         |                               +------------------+              |          
     |         |--(C)----- Code --------------&gt;|   Issuer         |              |
     |         |&lt;-(D)--- Issuer ---------------|   Endpoint       |              |
     |         |                               +------------------+              |
     |         |                               +---------------------------------+                                 
     |         |                               +---------------+
     |         |--(E)----- Issuer ------------&gt;|   MNO's OP    |
     |         |&lt;-(F)--- openid configuration -|               |
     +---------+                               +---------------+
</pre>
<p>Figure 1 Redirect-based flow (Abstract Protocol Flow)</p>
<p></p>

<ul class="empty">
<li>(A) The RP starts the issuer discovery by sending a discovery request to the User Interaction endpoint of the Mobile Issuer Discovery Service.  The RP identifies itself by way of an client id and indicates the URI the user interaction service shall send the user agent to after processing the request. Moreover, the RP may pass MCC/MNC, IMSI, or MSISDN as part of the discovery request. If this data is available, it is used to determine the MNO. Otherwise or if this attempt fails, the user interaction service first tries to deduce the MNO from source IP address range of the request. If that's impossible, the user is asked for her MSISDN, which is used to lookup the respective MNO from a database.</li>
<li>(B) The User Interaction Endpoint does not directly respond to the RP with the Issuer of the MNO's OP. Instead, it creates a code, which is associated with the ongoing transaction and sends it back to the RP using the redirect URI passed by the RP. This indirection allows to authenticate and authorize the RP at the Issuer endpoint before the process is completed.</li>
<li>(C) The RP sends the code along with its credentials to the Issuer Endpoint.</li>
<li>(D) The endpoint validates the client credentials and responds with the OpenID Issuer associated with the user's MNO. If the user provided the discovery service with her MSISDN in order to determine the MNO, this MSISDN is encrypted and also returned to the RP. The RP is supposed to pass this encrypted MSISDN as additional hint to the authentication process in order to spare the user to enter the MSISDN twice.</li>
<li>(E) The RP builds the URL refering to the OpenID configuration of the MNO's OpenID server by appending ".well-known/openid-configuration" to the issuer URL (see <a href="#OpenID.Discovery" class="xref">[OpenID.Discovery]</a>) and sends a GET request to it.</li>
<li>(F) The OP provides the RP with a JSON document containing meta data regarding endpoints, capabilities and policies. The RP is now fully equipped to start interaction with the respective OP.</li>
</ul>
<p id="rfc.section.2.1.p.4">The User Interaction and Issuer Endpoints are specified in sections <a href="#ui_endpoint" class="xref">Section 3.1</a> and <a href="#discovery_endpoint" class="xref">Section 3.2</a> , respectively.</p>
<p id="rfc.section.2.1.p.5">Access to the OP's meta data (steps (E) and (F)) is defined in <a href="#OpenID.Discovery" class="xref">[OpenID.Discovery]</a>, section 4, and is therefore outside of the scope of this specification.</p>
<p id="rfc.section.2.1.p.6">Note: After the RP logged the user in sucessfully with a particular OP (and has remembered the respective Issuer URL), there is no need to conduct the full issuer process again. The RP can instead directly obtain the OP's meta data using the openid configuration (steps G and H).</p>
<p id="rfc.section.2.1.p.7">Deployments may consider to use the <a href="#Account.Chooser" class="xref">OpenID Account chooser service</a> as described in <a href="#Account_Chooser" class="xref">Appendix A</a> in order to bypass steps (A) to (D) for users that already have account information cached. Alternatively, a discovery service implementation may also maintain an account list internally and let the users pick a user account identifier instead of entering a MSISDN.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> POST-based flow</h1>
<p id="rfc.section.2.2.p.1">This section gives an overview on the POST-based flow, which is intended to be used by native apps residing on mobile devices. The rationale is to allow apps to conduct issuer discovery without the need to use a web browser, which would degrade user experience and increase complexity and implementation effort. The assumption is that such apps cannot reliably be authenticated and authorized, so MSISDN-based lookup is not offered.</p>
<p>The following figure shows the message flow during the discovery process.</p>
<pre>     +---------+                               +---------------------------------+   
     |         |                               | Mobile Issuer Discovery Service |
     |         |                               +------------------+              |          
     |         |--(A)---discovery data -------&gt;|   Issuer         |              |
     |         |&lt;-(B)--- Issuer ---------------|   Endpoint       |              |
     | Relying |                               +------------------+              |
     | Party   |                               +---------------------------------+                                 
     |         |                               +---------------+
     |         |--(C)----- Issuer ------------&gt;|   MNO's OP    |
     |         |&lt;-(D)--- openid configuration -|               |
     +---------+                               +---------------+</pre>
<p>Figure 2 POST-based flow (Abstract Protocol Flow)</p>
<p></p>

<ul class="empty">
<li>(A) In contrast to the web-based flow, the RP typically provides data (MNC/MCC,IMSI, or MSISDN) to determine the user's MNO to the discovery process. The service tries to determine the MNO based on this data. If this data is not present, the discovery service attempts to determine the MNO based on the RP's IP address. If that fails, the discovery process fails.</li>
<li>(B) The Issuer Endpoint responds with the OpenID Issuer or an error message.</li>
<li>(C) The RP builds the URL refering to the OpenID configuration of the MNO and sends a GET request to it.</li>
<li>(D) The OP provides the RP with a JSON document containing meta data regarding endpoints, capabilities and policies. The RP is now fully equipped to start interaction with the respective OP.</li>
</ul>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#mobile-issuer-discovery-service" id="mobile-issuer-discovery-service">Mobile Issuer Discovery Service</a>
</h1>
<p id="rfc.section.3.p.1">The Mobile Issuer Discovery Service exposes the user interaction and issuer endpoint, which are specified in this section.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#ui_endpoint" id="ui_endpoint">User Interaction Endpoint</a>
</h1>
<p id="rfc.section.3.1.p.1">The User Interaction Endpoint provides the user interface to the discovery service. It is used to enter the MSISDN, let the user select her MNO and automatically determining the RP device's IP address. The RP is supposed to redirect the user agent to this endpoint. If the interactive process succeeds, the RP is provided with a code, which it then exchanges at the Issuer Endpoint for the actual Issuer data and (optionally) user-specific data.</p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#user-discovery-service-req" id="user-discovery-service-req">Request</a>
</h1>
<p id="rfc.section.3.1.1.p.1">The request to the User Interaction endpoint contains the following parameters: </p>

<dl>
<dt>client_id</dt>
<dd style="margin-left: 8">REQUIRED. The identifier of the respective RP. This RP must be known to the discovery service in advance.</dd>
<dt>redirect_uri</dt>
<dd style="margin-left: 8">REQUIRED. The URI the user agent shall be sent to after the discovery process has been completed.  The RP must register its URIs in advance, the redirect_uri parameter must exactly match one of those URIs.</dd>
<dt>state</dt>
<dd style="margin-left: 8">OPTIONAL. Value used by the RP to preserve state of a discovery transaction and to prevent XSRF attacks.  The discovery service includes this value when redirecting the user-agent back to the RP.</dd>
<dt>mcc</dt>
<dd style="margin-left: 8">OPTIONAL. The Mobile Country Code as defined by ITU-T E.212</dd>
<dt>mnc</dt>
<dd style="margin-left: 8">REQUIRED. If the parameter "mcc" is present.  The Mobile Network Code as defined by ITU-T E.212</dd>
<dt>imsi</dt>
<dd style="margin-left: 8">OPTIONAL. The International Mobile Subscriber Identity.</dd>
<dt>msisdn</dt>
<dd style="margin-left: 8">OPTIONAL. Mobile phone number of the subscriber.</dd>
</dl>
<p></p>
<p>For example, the RP could ask for discovery with the following request (line breaks are for display purposes only):</p>
<pre>  GET /discovery_ui?client_id=example_client&amp;
      redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fdiscovery&amp;
      state=xy&amp;mcc=901&amp;mnc=99 HTTP/1.1
  Host: discovery.example.com
</pre>
<p></p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#user-discovery-service-resp" id="user-discovery-service-resp">Response</a>
</h1>
<p id="rfc.section.3.1.2.p.1">The discovery service returns the following parameters:</p>
<p></p>

<dl>
<dt>code</dt>
<dd style="margin-left: 8">REQUIRED. The code is a temporary credential associated with the ongoing discovery transaction. The RP is supposed to exchange this code for the actual discovery results at the issuer endpoint.</dd>
<dt>state</dt>
<dd style="margin-left: 8">REQUIRED if the "state" parameter was present in the discovery request. The exact value received from the RP.</dd>
</dl>
<p>The following shows how the discovery service redirects the user agent back to the RP:</p>
<pre> HTTP/1.1 302 Found
     Location: https://client.example.com/discovery?code=SplxlOBeZQQYbYS6WxSbIA
               &amp;state=xyz</pre>
<h1 id="rfc.section.3.1.3">
<a href="#rfc.section.3.1.3">3.1.3.</a> <a href="#user-discovery-service-err" id="user-discovery-service-err">Error Response</a>
</h1>
<p id="rfc.section.3.1.3.p.1">If the request fails due to a missing, invalid, or mismatching redirection URI, or if the client identifier is missing or invalid, the discovery server SHOULD inform the end-user of the error and MUST NOT automatically redirect the user-agent to the invalid redirection URI. If the request fails for reasons other than a missing or invalid redirection URI, the discovery server informs the RP by adding the following parameters to the query component of the redirection URI using the "application/x-www-form-urlencoded" format:</p>
<p></p>

<dl>
<dt>error</dt>
<dd style="margin-left: 8">REQUIRED. A single US ASCII error code from the following:<dl>
<dt>invalid_request</dt>
<dd style="margin-left: 8">The request is missing a required parameter, includes an invalid parameter value, includes a parameter more than once, or is otherwise malformed.</dd>
<dt>unauthorized_client</dt>
<dd style="margin-left: 8">The RP is not authorized to request disovery using this method.</dd>
<dt>access_denied</dt>
<dd style="margin-left: 8">The discovery server denied the request.</dd>
<dt>server_error</dt>
<dd style="margin-left: 8">The discovery server encountered an unexpected condition that prevented it from fulfilling the request. (This error code is needed because a 500 Internal Server Error HTTP status code cannot be returned to the client via an HTTP redirect.)</dd>
<dt>temporarily_unavailable</dt>
<dd style="margin-left: 8">The discovery server is currently unable to handle the request due to a temporary overloading or maintenance of the server. (This error code is needed because a 503 Service Unavailable HTTP status code cannot be returned to the client via an HTTP redirect.)</dd>
<dt>Values for the "error" parameter MUST NOT include characters          outside the set %x20-21 / %x23-5B / %x5D-7E.</dt>
<dd style="margin-left: 8"></dd>
</dl>
</dd>
<dt>error_description</dt>
<dd style="margin-left: 8">OPTIONAL. Human-readable US ASCII [USASCII] text providing additional information, used to assist the RP developer in understanding the error that occurred. Values for the "error_description" parameter MUST NOT include characters outside the set %x20-21 / %x23-5B / %x5D-7E.</dd>
<dt>error_uri</dt>
<dd style="margin-left: 8">OPTIONAL. A URI identifying a human-readable web page with information about the error, used to provide the client developer with additional information about the error. Values for the "error_uri" parameter MUST conform to the URI-reference syntax and thus MUST NOT include characters outside the set %x21 / %x23-5B / %x5D-7E.</dd>
<dt>state</dt>
<dd style="margin-left: 8">REQUIRED if the "state" parameter was present in the discovery request. The exact value received from the RP.</dd>
</dl>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#discovery_endpoint" id="discovery_endpoint">Issuer Endpoint</a>
</h1>
<p id="rfc.section.3.2.p.1">This endpoint provides the RP with issuer data. It supports two use cases:</p>
<p></p>

<ol>
<li>It exchanges the code created by the User Interaction Endpoint for issuer data.</li>
<li>RPs may directly request issuer data by passing mobile network data.</li>
</ol>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> Request</h1>
<p id="rfc.section.3.2.1.p.1">This is reflected in the "signature" of the request: </p>

<dl>
<dt>client_id</dt>
<dd style="margin-left: 8">REQUIRED. The identifier of the respective RP. This RP must be known to the discovery service in advance.</dd>
<dt>code</dt>
<dd style="margin-left: 8">OPTIONAL. code value issued by the User Interaction Endpoint to this particular RP.</dd>
<dt>redirect_uri</dt>
<dd style="margin-left: 8">REQUIRED. If the parameter "code is present. The actual URI used to invoke the user interaction endpoint.</dd>
<dt>mcc</dt>
<dd style="margin-left: 8">OPTIONAL. The Mobile Country Code as defined by ITU-T E.212</dd>
<dt>mnc</dt>
<dd style="margin-left: 8">REQUIRED. If the parameter "mcc" is present.  The Mobile Network Code as defined by ITU-T E.212</dd>
<dt>imsi</dt>
<dd style="margin-left: 8">OPTIONAL. The International Mobile Subscriber Identity.</dd>
<dt>msisdn</dt>
<dd style="margin-left: 8">OPTIONAL. Mobile phone number of the subscriber.</dd>
</dl>
<p id="rfc.section.3.2.1.p.2">Either code, mcc, imsi, or msisdn must be present in the request.  The discovery service first validates the client credentials and the RP's authorization to perform the request.</p>
<p id="rfc.section.3.2.1.p.3">If code is present, the discovery service verifies, whether (1) this code had been issued to this RP and (2) whether "redirect_uri" matches the redirect URI used in the original request to the User Interaction Endpoint.</p>
<p id="rfc.section.3.2.1.p.4">If "msisdn" is present, this parameter takes precedence and is used to determine the MNO. Otherwise and if "mcc" and "mnc" are present, the discovery service tries to determine the MNO based on this data. If neiter "msisdn" nor "mcc" is present but "imsi", then this parameter is used to determine the MNO.</p>
<p id="rfc.section.3.2.1.p.5">Depending on the client authentication method, the client will be required to send additional parameters in header or body of the request. For example, if the RP is setup as confidential client with a client secret, it MUST authenticate using a Basic authorization header as defined in <a href="#RFC6749" class="xref">[RFC6749]</a>.</p>
<p>For example, the RP could send the following request (line breaks are for display purposes only):</p>
<pre>POST /discovery_issuer HTTP/1.1
Host: discovery.example.com
Authorization: Basic czZCaGRSa3F0Mzo3RmpmcDBaQnIxS3REUmJuZlZkbUl3

client_id=example_client&amp;code=SplxlOBeZQQYbYS6WxSbIA&amp;
redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fdiscovery</pre>
<p></p>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#user-discovery-endpoint-resp" id="user-discovery-endpoint-resp">Response</a>
</h1>
<p id="rfc.section.3.2.2.p.1">The response from the issuer endpoint is a JSON object containing the following top level elements: </p>

<dl>
<dt>iss</dt>
<dd style="margin-left: 8">The Issuer URI "iss" for the user who has authorized discovery.</dd>
<dt>login_hint_token</dt>
<dd style="margin-left: 8">A Encrypted JSON web token (JWE) that contains the user hint for the issuer. This token is returned, if the user has entered her MSISDN in the user interaction endpoint. The token MUST be encrypted with the public key of the issuer. This token is passed to the issuer in the authentication request. Usage, structure, and processing rules of the login hint token are specified in <a href="#MODRNA.Authentication" class="xref">[MODRNA.Authentication]</a>
</dd>
</dl>
<p>The following is a non-normative example of the Issuer response:</p>
<pre>HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
   "iss": "https://example_provider.com",
   "login_hint_token": "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
     OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
     ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
     Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
     mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
     1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
     6UklfCpIMfIjf7iGdXKHzg.
     48V1_ALb6US04U3b.
     5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
     SdiwkIr3ajwQzaBtQD_A.
     XFBoMYUZodetZdvTiFvSkQ"
}</pre>
<h1 id="rfc.section.3.2.3">
<a href="#rfc.section.3.2.3">3.2.3.</a> Error Response</h1>
<p id="rfc.section.3.2.3.p.1">The discovery server respondes with an HTTP 401 status code if the client credentials are invalid and an HTTP 403 status code if the RP is not authorized to request the particular service.</p>
<p id="rfc.section.3.2.3.p.2">In all other error conditions, the discovery server responds with an HTTP 400 (Bad Request) status code and includes a JSON object containing the following top level elements:</p>
<p></p>

<dl>
<dt>error</dt>
<dd style="margin-left: 8">REQUIRED. A single US ASCII error code from the following:<dl>
<dt>invalid_request</dt>
<dd style="margin-left: 8">The request is missing a required parameter, includes an invalid parameter value, includes a parameter more than once, or is otherwise malformed.</dd>
<dt>server_error</dt>
<dd style="margin-left: 8">The discovery server encountered an unexpected condition that prevented it from fulfilling the request. (This error code is needed because a 500 Internal Server Error HTTP status code cannot be returned to the client via an HTTP redirect.)</dd>
<dt>temporarily_unavailable</dt>
<dd style="margin-left: 8">The discovery server is currently unable to handle the request due to a temporary overloading or maintenance of the server. (This error code is needed because a 503 Service Unavailable HTTP status code cannot be returned to the client via an HTTP redirect.)</dd>
<dt>invalid_code</dt>
<dd style="margin-left: 8">RP tried to exchange an invalid code for discovery data (TBD: better HTTP status code 403?)</dd>
<dt>discovery_failed</dt>
<dd style="margin-left: 8">TBD</dd>
<dt>Values for the "error" parameter MUST NOT include characters          outside the set %x20-21 / %x23-5B / %x5D-7E.</dt>
<dd style="margin-left: 8"></dd>
</dl>
</dd>
<dt>error_description</dt>
<dd style="margin-left: 8">OPTIONAL. Human-readable US ASCII [USASCII] text providing additional information, used to assist the RP developer in understanding the error that occurred. Values for the "error_description" parameter MUST NOT include characters outside the set %x20-21 / %x23-5B / %x5D-7E.</dd>
<dt>error_uri</dt>
<dd style="margin-left: 8">OPTIONAL. A URI identifying a human-readable web page with information about the error, used to provide the client developer with additional information about the error. Values for the "error_uri" parameter MUST conform to the URI-reference syntax and thus MUST NOT include characters outside the set %x21 / %x23-5B / %x5D-7E.</dd>
</dl>
<p>The following is a non-normative example of a error response:</p>
<pre>HTTP/1.1 400 Bad Request
Content-Type: application/json;charset=UTF-8 
Cache-Control: no-store 
Pragma: no-cache 

{ 
   "error":"invalid_request" 
}</pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#security_considerations" id="security_considerations">Security Considerations</a>
</h1>
<p id="rfc.section.4.p.1">The user interaction endpoint of the discovery service could be subject to open redirection attacks. The discovery service MUST take precautions to prevent this threat.  Based on its risk assessment the discovery service needs to decide whether it can trust the redirect URI or not and SHOULD only automatically redirect the user agent, if it trusts the redirect URI.  If not, it MAY inform the user that it is about to redirect her to the another site and rely on the user to decide or MAY just inform the user about the error.</p>
<p id="rfc.section.4.p.2">The RP's redirect endpoint could be subject to CSRF attacks. It MUST therefore implement suitable countermeasures. It is recommended to use the state parameter for that purpose. The RP shall bind the state value to the particular user agent before it sends the user agent to the discovery services and check this binding when it receives a response.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#privacy_considerations" id="privacy_considerations">Privacy Considerations</a>
</h1>
<p id="rfc.section.5.p.1">The privacy of MSISDNs is ensured by this specification by not exposing it to the RP. If a RP is entitled to handle the MSISDN it MUST ensure its privacy preserving handling.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This document makes no requests of IANA.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="MODRNA.Authentication">[MODRNA.Authentication]</b></td>
<td class="top">
<a title="Deutsche Telekom">Connotte, J.</a> and <a title="Ping Identity">J. Bradley</a>, "<a href="https://openid.net/specs/openid-connect-modrna-authentication-1_0.html">OpenID Connect Mobile Authentication Profile 1.0</a>", March 2017.</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Core">[OpenID.Core]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a>, <a title="Google">de Medeiros, B.</a> and <a title="Salesforce">C. Mortimore</a>, "<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a>", November 2014.</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Discovery">[OpenID.Discovery]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a>, <a title="Microsoft">Jones, M.</a> and <a title="Illumila">E. Jay</a>, "<a href="http://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a>", November 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6749">[RFC6749]</b></td>
<td class="top">
<a>Hardt, D.</a>, "<a href="https://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, DOI 10.17487/RFC6749, October 2012.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="Account.Chooser">[Account.Chooser]</b></td>
<td class="top">"<a href="http://accountchooser.net/developers">Account Chooser Developer Guide</a>"</td>
</tr>
<tr>
<td class="reference"><b id="OpenID.Registration">[OpenID.Registration]</b></td>
<td class="top">
<a title="Nomura Research Institute, Ltd.">Sakimura, N.</a>, <a title="Ping Identity">Bradley, J.</a> and <a title="Microsoft">M. Jones</a>, "<a href="https://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration 1.0</a>", November 2014.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#Account_Chooser" id="Account_Chooser">Account Chooser</a>
</h1>
<p id="rfc.section.A.p.1">This section describes how MODRNA RPs and OPs could utilize the account chooser.</p>
<p id="rfc.section.A.p.2">The account chooser allows users to, with the support of the OPs, maintain a list of their accounts in a certain user agent.  With the support of the RP the user then may select one of them for subsequent logins without the need to determine the IDP or to enter the user id again. </p>
<p id="rfc.section.A.p.3">Note: In addition or as an alternative, deployments of the discovery service may also decide to maintain such a list within the discovery service.</p>
<h1 id="rfc.appendix.A.1">
<a href="#rfc.appendix.A.1">A.1.</a> <a href="#Account_chooser_client" id="Account_chooser_client">AC Client</a>
</h1>
<p id="rfc.section.A.1.p.1">It is recommended that Web server clients use the Account Chooser Central Data Store (CDS) for discovering the users preferred account.</p>
<p><a href="#Account.Chooser" class="xref">Account Chooser</a> is invoked with the following script:</p>
<pre>
&lt;script type="text/javascript"
     src="https://www.accountchooser.com/ac.js" /&gt;
&lt;script&gt;
 accountchooser.CONFIG.uiConfig = { 
	title: 'Sign in to Example.com', 
	favicon: 'http://example.com/favicon.ico', 
	branding: 'http://example.com/branding/ac-blurb.html' 
     };
&lt;/script&gt;
		 </pre>
<p id="rfc.section.A.1.p.3">If the user clicks on one of the accounts, ac.js sends an HTTP POST to a status checker (userStatusUrl:/account-status) that the client has to to implement. The status checker will receive up to five arguments as URL query parameters.</p>
<p id="rfc.section.A.1.p.4">The paramaters if available are:</p>
<p></p>

<dl>
<dt>email</dt>
<dd style="margin-left: 8">
<br> x</dd>
<dt>displayName</dt>
<dd style="margin-left: 8">
<br> x</dd>
<dt>photoUrl</dt>
<dd style="margin-left: 8">
<br> x</dd>
<dt>providerId</dt>
<dd style="margin-left: 8">
<br> x</dd>
<dt>login_hint_token</dt>
<dd style="margin-left: 8">
<br> x</dd>
</dl>
<p>For example (with line wraps within values for display purposes only):</p>
<pre>
POST /token HTTP/1.1
  Host: server.example.com
  Content-Type: application/x-www-form-urlencoded

    email=555-1212@babytel.com&amp;
    displayName=i1WsRn1uB1&amp;
    photoUrl=s6BhdRkqt3&amp;
    providerId=babytel.com&amp;
    login_hint_token=eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
     OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
     ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
     Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
     mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
     1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
     6UklfCpIMfIjf7iGdXKHzg.
     48V1_ALb6US04U3b.
     5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
     SdiwkIr3ajwQzaBtQD_A.
     XFBoMYUZodetZdvTiFvSkQ
		 </pre>
<h1 id="rfc.appendix.A.2">
<a href="#rfc.appendix.A.2">A.2.</a> <a href="#Account_chooser_idp" id="Account_chooser_idp">AC Identity Provider</a>
</h1>
<p id="rfc.section.A.2.p.1">Identity providers will populate the account information in Account Chooser's browser local storrage as the result of a successful loggin before redirecting the user back to the RP.</p>
<p id="rfc.section.A.2.p.2">If the user account has not been provisioned in the Browsers local storage, the OP MUST offer to store the account before redirecting the user back to the RP.</p>
<p id="rfc.section.A.2.p.3">The following is an example of the script elements invoking ac.js offering to store an account:</p>
<pre>
&lt;script type="text/javascript" 
	src="https://www.accountchooser.com/ac.js" /&gt;
&lt;script type="text/javascript"&gt; 
	accountchooser.CONFIG = { 
	// Sets the home-page URL to "/top" 
	homeUrl: '/top', 
 
	// Instructs ac.js to offer storage of an account via 
	// accountchooser.com 
	storeAccount: { 
		email: "555-1212@babytel.com", 
		displayName: "Santa Claus",
		providerId: : "babytel.com",
		login_hint_token: 
		"eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
     OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
     ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
     Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
     mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
     1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
     6UklfCpIMfIjf7iGdXKHzg.
     48V1_ALb6US04U3b.
     5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
     SdiwkIr3ajwQzaBtQD_A.
     XFBoMYUZodetZdvTiFvSkQ",
		providerId: "babytel.com"
	} 
}; 
&lt;/script&gt;
		 </pre>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.B.p.1">The OpenID Community would like to thank the following people for their contributions to the development of this specification:</p>
<p></p>

<ul class="empty">
<li>Sebastian Ebling (s.ebling@telekom.de), Deutsche Telekom</li>
<li>Philippe Clement (philippe.clement@orange.com), Orange</li>
<li>Matthieu Verdier (matthieu.verdier@orange.com), Orange</li>
</ul>
<h1 id="rfc.appendix.C">
<a href="#rfc.appendix.C">Appendix C.</a> <a href="#Notices" id="Notices">Notices</a>
</h1>
<p id="rfc.section.C.p.1">Copyright (c) 2020 The OpenID Foundation.</p>
<p id="rfc.section.C.p.2">The OpenID Foundation (OIDF) grants to any Contributor, developer, implementer, or other interested party a non-exclusive, royalty free, worldwide copyright license to reproduce, prepare derivative works from, distribute, perform and display, this Implementers Draft or Final Specification solely for the purposes of (i) developing specifications, and (ii) implementing Implementers Drafts and Final Specifications based on such documents, provided that attribution be made to the OIDF as the source of the material, but that such attribution does not indicate an endorsement by the OIDF.</p>
<p id="rfc.section.C.p.3">The technology described in this specification was made available from contributions from various sources, including members of the OpenID Foundation and others. Although the OpenID Foundation has taken steps to help ensure that the technology is available for distribution, it takes no position regarding the validity or scope of any intellectual property or other rights that might be claimed to pertain to the implementation or use of the technology described in this specification or the extent to which any license under such rights might or might not be available; neither does it represent that it has made any independent effort to identify any such rights. The OpenID Foundation and the contributors to this specification make no (and hereby expressly disclaim any) warranties (express, implied, or otherwise), including implied warranties of merchantability, non-infringement, fitness for a particular purpose, or title, related to this specification, and the entire risk as to implementing this specification is assumed by the implementer. The OpenID Intellectual Property Rights policy requires contributors to offer a patent promise not to assert certain patent claims against other contributors and against implementers. The OpenID Foundation invites any interested party to bring to its attention any copyrights, patents, patent applications, or other proprietary rights that may cover technology that may be required to practice this specification.</p>
<h1 id="rfc.appendix.D">
<a href="#rfc.appendix.D">Appendix D.</a> <a href="#History" id="History">Document History</a>
</h1>
<p id="rfc.section.D.p.1">[[ To be removed from the final specification ]]</p>
<p id="rfc.section.D.p.2">-05 </p>

<ul>
<li>moved section on use of account chooser to appendix</li>
<li>updated author's affiliations</li>
<li>removed account chooser steps from sequence diagram</li>
<li>added note on use of account chooser and alternatives to flow description</li>
<li>replaced section on client registration by text regarding need to establish trust relationship upfront including pointer to dynamic client registration</li>
<li>added text to security and privacy considerations</li>
</ul>

<p> </p>
<p id="rfc.section.D.p.3">-04 </p>

<ul><li>added MSISDN as parameter to both endpoints</li></ul>

<p> </p>
<p id="rfc.section.D.p.4">-03 </p>

<ul>
<li>corrected typos</li>
<li>cleaned up terminology section</li>
<li>cleaned up and repaired references (e.g. URLs now work)</li>
<li>replaced all occurrences of IDP, Authorization Server, and client by OP and RP, respectively</li>
</ul>

<p> </p>
<p id="rfc.section.D.p.5">-02 </p>

<ul>
<li>completely reworked document to reflect latest discovery design and support for different flows</li>
<li>extended Overview section to describe overall flows for web and native apps</li>
<li>split discovery service into different endpoints and adopted the document structure accordingly</li>
<li>added example requests and responses</li>
<li>added reference to authentication profile</li>
</ul>

<p> </p>
<p id="rfc.section.D.p.6">-01 </p>

<ul>
<li>Initial draft</li>
<li>Added OIDF Standard Notice</li>
<li>moved the definition of the encrypted id_token_int to login</li>
</ul>

<p> </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Torsten Lodderstedt</span> 
	  <span class="n hidden">
		<span class="family-name">Lodderstedt</span>
	  </span>
	</span>
	<span class="org vcardline">yes.com</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:torsten@lodderstedt.net">torsten@lodderstedt.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">John Bradley</span> 
	  <span class="n hidden">
		<span class="family-name">Bradley</span>
	  </span>
	</span>
	<span class="org vcardline">Yubico</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ve7jtb@ve7jtb.com">ve7jtb@ve7jtb.com</a></span>

  </address>
</div>

</body>
</html>
