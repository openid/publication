<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Draft: OpenID Connect
    Token Bound Authentication 1.0 - draft 03</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="OpenID Connect
    Token Bound Authentication 1.0 - draft 03">
<meta name="generator" content="xml2rfc v1.37pre1 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Draft</td><td class="header">M. Jones</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Microsoft</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Bradley</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Yubico</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">B. Campbell</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Ping Identity</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 1, 2018</td></tr>
</table></td></tr></table>
<h1><br />OpenID Connect
    Token Bound Authentication 1.0 - draft 03</h1>

<h3>Abstract</h3>

<p>OpenID Connect 1.0 is a simple identity layer on top of the OAuth 2.0
      protocol. It enables Clients to verify the identity of the End-User based
      on the authentication performed by an Authorization Server, as well as to
      obtain basic profile information about the End-User in an interoperable and
      REST-like manner.
</p>
<p>
	This specification enables OpenID Connect implementations to apply
	Token Binding to the OpenID Connect ID Token.
	This cryptographically binds the ID Token to the TLS connections
	over which the authentication occurred.
	This use of Token Binding protects the authentication flow
	from man-in-the-middle and token export and replay attacks.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rnc">1.1.</a>&nbsp;
Requirements Notation and Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Terminology">1.2.</a>&nbsp;
Terminology<br />
<a href="#Representation">2.</a>&nbsp;
OpenID Connect Token Binding Representation<br />
<a href="#Actions">3.</a>&nbsp;
OpenID Connect Token Binding Actions<br />
<a href="#Phasing">4.</a>&nbsp;
Phasing in Token Binding<br />
<a href="#Metadata">5.</a>&nbsp;
Token Binding Metadata<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#RPMetadata">5.1.</a>&nbsp;
Token Binding RP Metadata<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#OPMetadata">5.2.</a>&nbsp;
Token Binding OP Metadata<br />
<a href="#Security">6.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">7.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CnfReg">7.1.</a>&nbsp;
JWT Confirmation Methods Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ClaimsContents">7.1.1.</a>&nbsp;
Registry Contents<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DynRegRegistration">7.2.</a>&nbsp;
OAuth Dynamic Client Registration Metadata Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DynRegContents">7.2.1.</a>&nbsp;
Registry Contents<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ASMetadataRegistration">7.3.</a>&nbsp;
OAuth Authorization Server Metadata Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DiscContents">7.3.1.</a>&nbsp;
Registry Contents<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#Examples">Appendix&nbsp;A.</a>&nbsp;
Token Bound Authentication Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#example-id_token-post">A.1.</a>&nbsp;
Example Implicit Flow using Form Post Response Mode<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#example-code">A.2.</a>&nbsp;
Example Code Flow<br />
<a href="#Acknowledgements">Appendix&nbsp;B.</a>&nbsp;
Acknowledgements<br />
<a href="#Notices">Appendix&nbsp;C.</a>&nbsp;
Notices<br />
<a href="#History">Appendix&nbsp;D.</a>&nbsp;
Document History<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
	OpenID Connect 1.0 is a simple identity layer on top of the OAuth 2.0
	<a class='info' href='#RFC6749'>[RFC6749]<span> (</span><span class='info'>Hardt, D., Ed., &ldquo;The OAuth 2.0 Authorization Framework,&rdquo; October&nbsp;2012.</span><span>)</span></a>
	protocol. It enables Clients to verify the identity of the End-User based
	on the authentication performed by an Authorization Server, as well as to
	obtain basic profile information about the End-User in an interoperable and
	REST-like manner.
      
</p>
<p>
	This specification enables OpenID Connect implementations to apply
	Token Binding
	<a class='info' href='#I-D.ietf-tokbind-protocol'>The Token Binding Protocol Version 1.0<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., and J. Hodges, &ldquo;The Token Binding Protocol Version 1.0,&rdquo; May&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;protocol]
	<a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https]
	to the OpenID Connect ID Token
	defined by <a class='info' href='#OpenID.Core'>OpenID Connect Core 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;OpenID Connect Core 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Core].
	This cryptographically binds the ID Token to the TLS connections
	over which the authentication occurred.
	Token Binding is applied to OpenID Connect in the manner described in
	Section 5 (Federation Use Cases) of
	<a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https].
	As described in Section 7.4 (Securing Federated Sign-On Protocols) of
	<a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https],
	this use of Token Binding protects the authentication flow
	from man-in-the-middle and token export and replay attacks.
      
</p>
<a name="rnc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Notation and Conventions</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p>
	  In the .txt version of this specification,
	  values are quoted to indicate that they are to be taken literally.
	  When using these values in protocol messages,
	  the quotes MUST NOT be used as part of the value.
	  In the HTML version of this specification,
	  values to be taken literally are indicated by
	  the use of <tt>this fixed-width font</tt>.
	
</p>
<a name="Terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>

<p>
	  This specification uses the terms 
	  "Authorization Endpoint", "Authorization Server",
	  "Client", "Response Type", and "Token Endpoint"
	  defined by <a class='info' href='#RFC6749'>OAuth 2.0<span> (</span><span class='info'>Hardt, D., Ed., &ldquo;The OAuth 2.0 Authorization Framework,&rdquo; October&nbsp;2012.</span><span>)</span></a> [RFC6749],
	  the terms "Claim", "JSON Web Token (JWT)",
	  and "JWT Claims Set"
	  defined by <a class='info' href='#JWT'>JSON Web Token (JWT)<span> (</span><span class='info'>Jones, M., Bradley, J., and N. Sakimura, &ldquo;JSON Web Token (JWT),&rdquo; May&nbsp;2015.</span><span>)</span></a> [JWT],
	  the term "User Agent" defined by <a class='info' href='#RFC7230'>RFC 7230<span> (</span><span class='info'>Fielding, R., Ed. and J. Reschke, Ed., &ldquo;Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing,&rdquo; June&nbsp;2014.</span><span>)</span></a> [RFC7230],
	  the terms "Provided", "Referred", "Token Binding" and "Token Binding ID"
	  defined by <a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https],
	  and the terms defined by
	  <a class='info' href='#OpenID.Core'>OpenID Connect Core 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;OpenID Connect Core 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Core].
	
</p>
<a name="Representation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
OpenID Connect Token Binding Representation</h3>

<p>
	Section 5 (Federation Use Cases) of
	<a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https]
	outlines how Token Binding is used with federation protocols in the abstract.
	This section defines the concrete data structures for using Token Binding
	with OpenID Connect.
      
</p>
<p>
	Section 5.2 of
	<a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https]
	suggests placing the Token Binding ID of the Token Binding
	used to communicate with the Relying Party in the ID Token.
	A representation of this key is communicated to the OpenID Provider
	in its Referred Token Binding ID.
	This specification utilizes a variant of this approach in which
	a cryptographic hash of the Token Binding ID
	using the SHA-256 hash function <a class='info' href='#SHS'>[SHS]<span> (</span><span class='info'>National Institute of Standards and             Technology, &ldquo;Secure Hash Standard (SHS),&rdquo; March&nbsp;2012.</span><span>)</span></a>
	is instead added to the ID Token.
	This has the benefit of significantly reducing the size of the information
	added to the ID Token from what it would otherwise have been were the
	Token Binding ID to be included directly - particularly in the RSA key case.
      
</p>
<p>
	The recipient MUST verify that the SHA-256 hash
	of the Provided Token Binding ID
	matches the SHA-256 hash contained in the ID Token.
      
</p>
<p>
	This specification defines the new JWT Confirmation Method
	<a class='info' href='#RFC7800'>RFC 7800<span> (</span><span class='info'>Jones, M., Bradley, J., and H. Tschofenig, &ldquo;Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs),&rdquo; April&nbsp;2016.</span><span>)</span></a> [RFC7800]
	member <tt>tbh</tt> (token binding hash) 
	to represent the SHA-256 hash of a Token Binding ID
	in an ID Token.
	The value of the <tt>tbh</tt> member is the
	base64url encoding of the SHA-256 hash of the Token Binding ID.
	Base64url encoding is base64 encoding using the URL and filename safe alphabet
	defined in Section 5 of <a class='info' href='#RFC4648'>RFC 4648<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a> [RFC4648], with all trailing '='
	characters omitted and without the
	inclusion of any line breaks, whitespace, or other additional
	characters.
	  
</p>
<p>
	The following example demonstrates the JWT Claims Set of an ID Token
	containing the base64url encoding of the SHA-256 hash of a Token Binding ID
	as the value of the <tt>tbh</tt> (token binding hash)
	element in the <tt>cnf</tt> (confirmation) claim:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  {
   "iss": "https://server.example.com",
   "sub": "0f6LkoE3KsPyxQ",
   "aud": "0d8f597e-bc45-46b2-97cf-043c88aa5ecc",
   "iat": 1467151051,
   "exp": 1467151651,
   "nonce": "1KjVsFnQRd4V2XC6",
   "cnf":{
     "tbh": "l1X0aVlpikNqDhaH92VwGgrFdAY0tSackYis1r_-fPo"
    }
  }
</pre></div>
<p>
  If, in the future, the cryptographic hash of the Token Binding ID
  needs to be computed using hash functions other than SHA-256, it is
  suggested that additional related JWT confirmation methods members
  be defined for that purpose.
  For example, a new <tt>tbh#S512</tt>
  (token binding hash using SHA-512) confirmation method member could
  be defined by registering it in the the IANA "JWT Confirmation Methods"
  registry <a class='info' href='#IANA.JWT.Claims'>[IANA.JWT.Claims]<span> (</span><span class='info'>IANA, &ldquo;JSON Web Token Claims,&rdquo; .</span><span>)</span></a> for JWT
  <tt>cnf</tt> member values established by
  <a class='info' href='#RFC7800'>[RFC7800]<span> (</span><span class='info'>Jones, M., Bradley, J., and H. Tschofenig, &ldquo;Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs),&rdquo; April&nbsp;2016.</span><span>)</span></a>.
      
</p>
<a name="Actions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
OpenID Connect Token Binding Actions</h3>

<p>
	This specification maps the abstract Token Binding actions specified in
	Section 5 (Federation Use Cases) of
	<a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https]
	into concrete actions added to the authentication steps specified in
	Section 3 (Authentication) of
	<a class='info' href='#OpenID.Core'>OpenID Connect Core 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;OpenID Connect Core 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Core].
	Mapping the terminologies used in the two specifications,
	the Relying Party is the Token Consumer and
	the OpenID Provider is the Token Provider.
      
</p>
<p>
	For OpenID Connect flows returning the ID Token directly from the Authorization Endpoint --
	the Implicit Flow defined in Section 3.2 of
	<a class='info' href='#OpenID.Core'>OpenID Connect Core 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;OpenID Connect Core 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Core]
	and the Hybrid Flow defined in Section 3.3 of OpenID Connect Core 1.0 when using the
	<tt>code&nbsp;id_token</tt> or
	<tt>code&nbsp;id_token&nbsp;token</tt> Response Types --
	the actions described in Section 5.5 of
	<a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https]
	are performed as described.
	The one difference, as previously described, is that
	a cryptographic hash
	using the SHA-256 hash function <a class='info' href='#SHS'>[SHS]<span> (</span><span class='info'>National Institute of Standards and             Technology, &ldquo;Secure Hash Standard (SHS),&rdquo; March&nbsp;2012.</span><span>)</span></a>
	of the Token Binding ID is instead added to the ID Token,
	rather than the Token Binding ID itself.
      
</p>
<p>
	For OpenID Connect flows returning the ID Token from the Token Endpoint --
	the Authorization Code Flow defined in Section 3.1 of
	<a class='info' href='#OpenID.Core'>OpenID Connect Core 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;OpenID Connect Core 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Core]
	and the Hybrid Flow defined in Section 3.3 of OpenID Connect Core 1.0 --
	an additional step is necessary beyond those in the previous case.
	That step is for the RP to record the Token Binding ID
	used when communicating between the User Agent and the RP,
	saving it for later use after the Token Response containing the ID Token
	returned from the Token Endpoint is received.
	This is needed because the ID Token will contain Token Binding information
	from the TLS connection between the User Agent and the Relying Party --
	not information from the TLS connection between the RP and the Token Endpoint.
	In this case, even though the ID Token is returned from the Token Endpoint,
	the Token Binding validation steps are performed using
	the saved Token Binding ID,
	rather than the Token Binding ID
	used when communicating with the Token Endpoint.
      
</p>
<p>
  See <a class='info' href='#Examples'>Appendix&nbsp;A<span> (</span><span class='info'>Token Bound Authentication Examples</span><span>)</span></a> for examples demonstrating token bound OpenID
  Connect authentication flows.
      
</p>
<a name="Phasing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Phasing in Token Binding</h3>

<p>
	Many OpenID Connect implementations will be deployed in situations in which
	not all participants support Token Binding.
	Any of combination of the Relying Party, the OpenID Provider,
	and the User Agent may not yet support Token Binding,
	in which case it will not work end-to-end.
      
</p>
<p>
	It is a context-dependent deployment choice whether to allow
	authentications to proceed in which Token Binding is not supported
	or whether to treat the omission of Token Binding at any step as a fatal error.
	In dynamic deployment environments in which End Users have choices
	of Relying Parties, the OpenID Providers, and/or User Agents,
	it is recommended that, for some reasonable period of time during which
	Token Binding technology is being adopted, authentications using one or more components
	that do not implement Token Binding be allowed to successfully proceed.
	This enables different components to be upgraded to supporting Token Binding
	at different times, providing a smooth transition path for
	phasing in Token Binding.
	However, when Token Binding has been performed,
	any Token Binding key mismatches MUST be treated as fatal errors.
      
</p>
<p>
	In more controlled deployment environments where all the
	participants in an OpenID Connect authentication
	flow are known or expected to support Token
	Binding and yet one or more of them does not use it, the
	authentication SHOULD be aborted with an error.
	For instance, if the RP knows that the OP and the User Agent both
	support Token Binding and yet the ID Token received does not contain
	Token Binding information, the ID Token should be rejected.
      
</p>
<p>
	The OP and RP can determine whether the other supports Token Binding
	using the metadata values defined in the next section.
	They can determine whether the User Agent supports Token Binding
	by whether it negotiated Token Binding for the TLS connection.
	However, due to the possibility of mismatched support of Token Binding
	key parameters across participants, there are potential cases
	where all participant support Token Binding yet Token Binding information
	is missing from a step in the authentication flow.
      
</p>
<a name="Metadata"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Token Binding Metadata</h3>

<a name="RPMetadata"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Token Binding RP Metadata</h3>

<p>
	  Relying Parties supporting Token Binding that also support
	  <a class='info' href='#OpenID.Registration'>OpenID Connect Dynamic Client Registration 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., and M. Jones, &ldquo;OpenID Connect Dynamic Client Registration 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Registration]
	  use this metadata parameter to register their support for Token Binding and indicate
	  the expected JWT Confirmation Method member name used to bind the ID Token:
	
</p>
<p>
	  </p>
<blockquote class="text"><dl>
<dt>id_token_token_binding_cnf</dt>
<dd>
	      
	      OPTIONAL.
	      String value specifying the JWT Confirmation Method member name
	      (e.g. <tt>tbh</tt>) that the Relying Party expects when
	      receiving Token Bound ID Tokens. The presence of this parameter indicates that
	      the Relying Party supports Token Binding of ID Tokens. If omitted,
	      the default is that the Relying Party does not support Token Binding of ID Tokens.
	    
</dd>
</dl></blockquote><p>
	
</p>
<a name="OPMetadata"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Token Binding OP Metadata</h3>

<p>
	  OpenID Providers supporting Token Binding that also support
	  <a class='info' href='#OpenID.Discovery'>OpenID Connect Discovery 1.0<span> (</span><span class='info'>Sakimura, N., Bradley, J., Jones, M., and E. Jay, &ldquo;OpenID Connect Discovery 1.0,&rdquo; November&nbsp;2014.</span><span>)</span></a> [OpenID.Discovery]
	  use this metadata parameter to indicate their support for Token Binding and
	  specify the JWT Confirmation Methods they support for binding the ID Token.
	
</p>
<p>
	  </p>
<blockquote class="text"><dl>
<dt>id_token_token_binding_cnf_values_supported</dt>
<dd>
	      
	      OPTIONAL.
	      JSON array containing a list of the JWT Confirmation Method member names
	      supported by the OP for Token Binding of ID Tokens. The presence of this parameter
	      indicates that the OpenID Provider supports Token Binding of ID Tokens.
	      If omitted, the default is that the OpenID Provider does not support Token
	      Binding of ID Tokens.
	    
</dd>
</dl></blockquote><p>
	
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
	OpenID Connect implementations employing Token Binding benefit from the protections
	described in Section 7 (Security Considerations) of
	<a class='info' href='#I-D.ietf-tokbind-protocol'>The Token Binding Protocol Version 1.0<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., and J. Hodges, &ldquo;The Token Binding Protocol Version 1.0,&rdquo; May&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;protocol].
	Obtaining these protections requires performing the proofs of possession
	described in Section 7.4 (Securing Federated Sign-On Protocols) of
	<a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https].
      
</p>
<p>
       Because of the possibility of mismatched Token Binding key parameters type support
       across the OP, RP, and User Agent, an indeterminate state can occur when the RP has
       negotiated token binding and sends a referred Token Binging to an OP that supports
       Token Binging but receives an unbound ID token. How to handle such a situation is
       ultimately at the discretion of the RP, however,
       <a class='info' href='#I-D.ietf-tokbind-https'>Token Binding over HTTP<span> (</span><span class='info'>Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;Token Binding over HTTP,&rdquo; June&nbsp;2018.</span><span>)</span></a> [I&#8209;D.ietf&#8209;tokbind&#8209;https] recommends that
       providers support all the Token Binding key parameters so the situation should be
       uncommon and it is RECOMMENDED that an RP treat that indeterminate state as a fatal error.
      
</p>
<p>
	ID Tokens are not the only security tokens used by OpenID Connect that can be token bound.
	Browsers implementing token binding can transparently token bind browser cookies.
	The <a class='info' href='#OAuth.TokenBinding'>OAuth 2.0 Token Binding<span> (</span><span class='info'>Jones, M., Campbell, B., Bradley, J., and W. Denniss, &ldquo;OAuth 2.0 Token Binding,&rdquo; October&nbsp;2017.</span><span>)</span></a> [OAuth.TokenBinding] specification
	defines mechanisms for token binding of access tokens, refresh tokens, and authorization codes.
	There are demonstrable security benefits to using token binding to transform
	all of these tokens that were originally bearer tokens
	into proof-of-possession tokens protected by token binding.
      
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<a name="CnfReg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
JWT Confirmation Methods Registration</h3>

<p>
	  This specification registers the following confirmation method member
	  in the IANA "JWT Confirmation Methods" registry
	  <a class='info' href='#IANA.JWT.Claims'>[IANA.JWT.Claims]<span> (</span><span class='info'>IANA, &ldquo;JSON Web Token Claims,&rdquo; .</span><span>)</span></a>
	  for JWT <tt>cnf</tt> member values
	  established by <a class='info' href='#RFC7800'>[RFC7800]<span> (</span><span class='info'>Jones, M., Bradley, J., and H. Tschofenig, &ldquo;Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs),&rdquo; April&nbsp;2016.</span><span>)</span></a>:
	
</p>
<a name="ClaimsContents"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
Registry Contents</h3>

<p> 
	    </p>
<ul class="text">
<li>
		Confirmation Method Value: <tt>tbh</tt>
	      
</li>
<li>
		Confirmation Method Description: Token Binding Hash
	      
</li>
<li>
		Change Controller: IESG
	      
</li>
<li>
		Specification Document(s): <a class='info' href='#Representation'>Section&nbsp;2<span> (</span><span class='info'>OpenID Connect Token Binding Representation</span><span>)</span></a> of [[ this specification ]]
	      
</li>
</ul><p>
	  
</p>
<a name="DynRegRegistration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
OAuth Dynamic Client Registration Metadata Registration</h3>

<p>
	  This specification registers the following client metadata definition
	  in the IANA "OAuth Dynamic Client Registration Metadata" registry
	  <a class='info' href='#IANA.OAuth.Parameters'>[IANA.OAuth.Parameters]<span> (</span><span class='info'>IANA, &ldquo;OAuth Parameters,&rdquo; .</span><span>)</span></a>
	  established by <a class='info' href='#RFC7591'>[RFC7591]<span> (</span><span class='info'>Richer, J., Ed., Jones, M., Bradley, J., Machulak, M., and P. Hunt, &ldquo;OAuth 2.0 Dynamic Client Registration Protocol,&rdquo; July&nbsp;2015.</span><span>)</span></a>:
	
</p>
<a name="DynRegContents"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.1"></a><h3>7.2.1.&nbsp;
Registry Contents</h3>

<p> 
	    </p>
<ul class="text">
<li>
		Client Metadata Name: <tt>id_token_token_binding_cnf</tt>
	      
</li>
<li>
		Client Metadata Description:
		String value specifying the JWT Confirmation Method member name
		the Relying Party expects when receiving Token Bound ID Tokens
	      
</li>
<li>
		Change Controller: OpenID Foundation Extended Authentication Profile (EAP) Working Group
		- openid-specs-eap@lists.openid.net
	      
</li>
<li>
		Specification Document(s): <a class='info' href='#RPMetadata'>Section&nbsp;5.1<span> (</span><span class='info'>Token Binding RP Metadata</span><span>)</span></a> of [[ this specification ]]
	      
</li>
</ul><p>
	  
</p>
<a name="ASMetadataRegistration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
OAuth Authorization Server Metadata Registration</h3>

<p>
	  This specification registers the following metadata definition
	  in the IANA "OAuth Authorization Server Metadata" registry
	  
	  established by <a class='info' href='#OAuth.AuthorizationMetadata'>[OAuth.AuthorizationMetadata]<span> (</span><span class='info'>Jones, M., Sakimura, N., and J. Bradley, &ldquo;OAuth 2.0 Authorization Server Metadata,&rdquo; March&nbsp;2017.</span><span>)</span></a>:
	
</p>
<a name="DiscContents"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1"></a><h3>7.3.1.&nbsp;
Registry Contents</h3>

<p> 
	    </p>
<ul class="text">
<li>
		Metadata Name: <tt>id_token_token_binding_cnf_values_supported</tt>
	      
</li>
<li>
		Metadata Description:
		JSON array listing the JWT Confirmation Method member names
		supported by the OP for Token Binding of ID Tokens
	      
</li>
<li>
		Change Controller: OpenID Foundation Extended Authentication Profile (EAP) Working Group
		- openid-specs-eap@lists.openid.net
	      
</li>
<li>
		Specification Document(s): <a class='info' href='#OPMetadata'>Section&nbsp;5.2<span> (</span><span class='info'>Token Binding OP Metadata</span><span>)</span></a> of [[ this specification ]]
	      
</li>
</ul><p>
	  
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tokbind-https">[I-D.ietf-tokbind-https]</a></td>
<td class="author-text">Popov, A., Nystrom, M., Balfanz, D., Langley, A., Harper, N., and J. Hodges, &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-tokbind-https-17">Token Binding over HTTP</a>,&rdquo; draft-ietf-tokbind-https-17 (work in progress), June&nbsp;2018 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tokbind-https-17.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tokbind-protocol">[I-D.ietf-tokbind-protocol]</a></td>
<td class="author-text">Popov, A., Nystrom, M., Balfanz, D., Langley, A., and J. Hodges, &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-tokbind-protocol-19">The Token Binding Protocol Version 1.0</a>,&rdquo; draft-ietf-tokbind-protocol-19 (work in progress), May&nbsp;2018 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tokbind-protocol-19.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IANA.JWT.Claims">[IANA.JWT.Claims]</a></td>
<td class="author-text">IANA, &ldquo;<a href="http://www.iana.org/assignments/jwt">JSON Web Token Claims</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="IANA.OAuth.Parameters">[IANA.OAuth.Parameters]</a></td>
<td class="author-text">IANA, &ldquo;<a href="http://www.iana.org/assignments/oauth-parameters">OAuth Parameters</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="JWT">[JWT]</a></td>
<td class="author-text">Jones, M., Bradley, J., and N. Sakimura, &ldquo;<a href="http://tools.ietf.org/html/rfc7519">JSON Web Token (JWT)</a>,&rdquo; RFC&nbsp;7519, DOI&nbsp;10.17487/RFC7519, May&nbsp;2015.</td></tr>
<tr><td class="author-text" valign="top"><a name="OpenID.Core">[OpenID.Core]</a></td>
<td class="author-text">Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and C. Mortimore, &ldquo;<a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0</a>,&rdquo; November&nbsp;2014.</td></tr>
<tr><td class="author-text" valign="top"><a name="OpenID.Discovery">[OpenID.Discovery]</a></td>
<td class="author-text">Sakimura, N., Bradley, J., Jones, M., and E. Jay, &ldquo;<a href="http://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery 1.0</a>,&rdquo; November&nbsp;2014.</td></tr>
<tr><td class="author-text" valign="top"><a name="OpenID.Registration">[OpenID.Registration]</a></td>
<td class="author-text">Sakimura, N., Bradley, J., and M. Jones, &ldquo;<a href="http://openid.net/specs/openid-connect-registration-1_0.html">OpenID Connect Dynamic Client Registration 1.0</a>,&rdquo; November&nbsp;2014.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="https://www.rfc-editor.org/info/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, DOI&nbsp;10.17487/RFC2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4648">[RFC4648]</a></td>
<td class="author-text">Josefsson, S., &ldquo;<a href="https://www.rfc-editor.org/info/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>,&rdquo; RFC&nbsp;4648, DOI&nbsp;10.17487/RFC4648, October&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC6749">[RFC6749]</a></td>
<td class="author-text">Hardt, D., Ed., &ldquo;<a href="https://www.rfc-editor.org/info/rfc6749">The OAuth 2.0 Authorization Framework</a>,&rdquo; RFC&nbsp;6749, DOI&nbsp;10.17487/RFC6749, October&nbsp;2012.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC7230">[RFC7230]</a></td>
<td class="author-text">Fielding, R., Ed. and J. Reschke, Ed., &ldquo;<a href="https://www.rfc-editor.org/info/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>,&rdquo; RFC&nbsp;7230, DOI&nbsp;10.17487/RFC7230, June&nbsp;2014.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC7800">[RFC7800]</a></td>
<td class="author-text">Jones, M., Bradley, J., and H. Tschofenig, &ldquo;<a href="https://www.rfc-editor.org/info/rfc7800">Proof-of-Possession Key Semantics for JSON Web Tokens (JWTs)</a>,&rdquo; RFC&nbsp;7800, DOI&nbsp;10.17487/RFC7800, April&nbsp;2016.</td></tr>
<tr><td class="author-text" valign="top"><a name="SHS">[SHS]</a></td>
<td class="author-text">National Institute of Standards and
            Technology, &ldquo;<a href="http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf">Secure Hash Standard (SHS)</a>,&rdquo; FIPS&nbsp;PUB 180-4, March&nbsp;2012 (<a href="http://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf">PDF</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="OAuth.AuthorizationMetadata">[OAuth.AuthorizationMetadata]</a></td>
<td class="author-text"><a href="mailto:mbj@microsoft.com">Jones, M.</a>, <a href="mailto:n-sakimura@nri.co.jp">Sakimura, N.</a>, and <a href="mailto:ve7jtb@ve7jtb.com">J. Bradley</a>, &ldquo;<a href="http://tools.ietf.org/html/draft-ietf-oauth-discovery-10">OAuth 2.0 Authorization Server Metadata</a>,&rdquo; draft-ietf-oauth-discovery-10 (work in progress), March&nbsp;2017.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth.Post">[OAuth.Post]</a></td>
<td class="author-text">Jones, M. and B. Campbell, &ldquo;<a href="http://openid.net/specs/oauth-v2-form-post-response-mode-1_0.html">OAuth 2.0 Form Post Response Mode</a>,&rdquo; April&nbsp;2015.</td></tr>
<tr><td class="author-text" valign="top"><a name="OAuth.TokenBinding">[OAuth.TokenBinding]</a></td>
<td class="author-text"><a href="mailto:mbj@microsoft.com">Jones, M.</a>, <a href="mailto:brian.d.campbell@gmail.com">Campbell, B.</a>, <a href="mailto:ve7jtb@ve7jtb.com">Bradley, J.</a>, and <a href="mailto:wdenniss@google.com">W. Denniss</a>, &ldquo;<a href="https://tools.ietf.org/html/draft-ietf-oauth-token-binding-07">OAuth 2.0 Token Binding</a>,&rdquo; draft-ietf-oauth-token-binding-07 (work in progress), October&nbsp;2017.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC7517">[RFC7517]</a></td>
<td class="author-text">Jones, M., &ldquo;<a href="https://www.rfc-editor.org/info/rfc7517">JSON Web Key (JWK)</a>,&rdquo; RFC&nbsp;7517, DOI&nbsp;10.17487/RFC7517, May&nbsp;2015.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC7591">[RFC7591]</a></td>
<td class="author-text">Richer, J., Ed., Jones, M., Bradley, J., Machulak, M., and P. Hunt, &ldquo;<a href="https://www.rfc-editor.org/info/rfc7591">OAuth 2.0 Dynamic Client Registration Protocol</a>,&rdquo; RFC&nbsp;7591, DOI&nbsp;10.17487/RFC7591, July&nbsp;2015.</td></tr>
</table>

<a name="Examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Token Bound Authentication Examples</h3>

<p>
        Examples of token bound OpenID Connect authentication flows are provided in this
        section.
        Extra line breaks and whitespace has been added to the example figures for
        display and formatting purposes.
      
</p>
<a name="example-id_token-post"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Example Implicit Flow using Form Post Response Mode</h3>

<p>
        The End-User using a User Agent makes an unauthenticated request to the Relying Party.
        The HTTP request is made over a TLS connection where Token Binding has been negotiated
        so the <tt>Sec-Token-Binding</tt> header is present in the request,
        which contains an encoded Token Binding message that has the Token Binding the
        User Agent uses with the Relying Party.
      
</p><br /><hr class="insert" />
<a name="ex-post-a"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 GET / HTTP/1.1
 Host: rp.example.io
 Sec-Token-Binding: AIkAAgBBQKzyIrmcY_YCtHVoSHBut69vrGfFdy1_YKTZfFJv
  6BjrZsKD9b9FRzSBxDs1twTqnAS71M1RBumuihhI9xqxXKkAQIMi9gthwFtmF1lpXi
  oRsIlQA8vZOKQ0hrJE1_610h0h-IX-O_WllivUBoyLV7ypArE15whKaDrfwsolflmW
  fPsAAA
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Unauthenticated Request to Relying Party&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
        The Relying Party redirects the user to the OpenID Provider for
        authentication, which is a normal OpenID Connect Authentication Request
        asking for an ID Token to be sent using the
        <a class='info' href='#OAuth.Post'>Form Post Response Mode<span> (</span><span class='info'>Jones, M. and B. Campbell, &ldquo;OAuth 2.0 Form Post Response Mode,&rdquo; April&nbsp;2015.</span><span>)</span></a> [OAuth.Post]. Note, however,
        that the response includes the
        <tt>Include-Referred-Token-Binding-ID</tt>
        header, which signals to the User Agent that
        it should reveal the Token Binding ID used on the TLS connection between
        itself and the Relying Party to the OpenID Provider.
      
</p><br /><hr class="insert" />
<a name="ex-post-b"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 HTTP/1.1 302 Authenticating
 Location: https://idp.example.com:443/as/authorization.oauth2?
  response_type=id_token&amp;
  response_mode=form_post&amp;
  client_id=example-client-id&amp;
  redirect_uri=https%3A%2F%2Frp.example.io%2Fpa%2Foidc%2Fcb&amp;
  state=eyJ6aXAiOiJERUYiLCJzdWZmaXgiOiJMTFNBOEIiLCJhbGciOiJkaXIiLCJl
  bmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiMXkifQ..rr-niSUBYsRbXCz6X4JdIw
  .27rWRLVUJuJsDUAbhWUTAH5xL1tHsV7GLAm91I9gQGTLFe5FfbE_dQ_7ksE8FF8Ej
  EVk66db-KmQSuzITlLpeg.X8YnveCYW7_-0rZTIuza5A&amp;nonce=i87yhOySCQCGYQw
  XbFKK7aDhqDIyERH0G2AfDaWSCYg&amp;scope=openid%20profile%20email
 Content-Length: 0
 Cache-Control: no-cache, no-store
 Set-Cookie: nonce.LLSA8B=a70cea0796b148eabfa3fdbb4ea7058d; Path=/;
  Secure; HttpOnly
 Include-Referred-Token-Binding-ID: true
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Redirect with Authentication Request&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
        The User Agent follows the redirect and delivers the Authentication Request
        to the OpenID Provider. The HTTP request is made over a TLS connection where
        Token Binding has been negotiated so the "Sec-Token-Binding" header is present
        in the request, which contains an encoded Token Binding message. Because
        of the <tt>Include-Referred-Token-Binding-ID</tt> header in
        the response that resulted in this request, the Token Binding message
        contains two Token Bindings: (1) the provided Token Binding used with the
        OpenID Provider, and (2) the referred Token Binding used with the Relying
        Party.
      
</p><br /><hr class="insert" />
<a name="ex-post-c"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 GET /as/authorization.oauth2?response_type=id_token&amp;
  response_mode=form_post&amp;client_id=example-client-id&amp;
  redirect_uri=https%3A%2F%2Frp.example.io%2Fpa%2Foidc%2Fcb&amp;
  state=eyJ6aXAiOiJERUYiLCJzdWZmaXgiOiJMTFNBOEIiLCJhbGciOiJkaXIiLCJl
  bmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiMXkifQ..rr-niSUBYsRbXCz6X4JdIw
  .27rWRLVUJuJsDUAbhWUTAH5xL1tHsV7GLAm91I9gQGTLFe5FfbE_dQ_7ksE8FF8Ej
  EVk66db-KmQSuzITlLpeg.X8YnveCYW7_-0rZTIuza5A&amp;nonce=i87yhOySCQCGYQw
  XbFKK7aDhqDIyERH0G2AfDaWSCYg&amp;
  scope=openid%20profile%20email HTTP/1.1
 Host: idp.example.com
 Sec-Token-Binding: ARIAAgBBQCfsI1D1sTq5mvT_2H_dihNIvuHJCHGjHPJchPav
  NbGrOo26-2JgT_IsbvZd4daDFbirYBIwJ-TK1rh8FzrC-psAQO4Au9xPupLSkhwT9Y
  n9aSvHXFsMLh4d4cEBKGP1clJtsfUFGDw-8HQSKwgKFN3WfZGq27y8NB3NAM1oNzvq
  VOIAAAECAEFArPIiuZxj9gK0dWhIcG63r2-sZ8V3LX9gpNl8Um_oGOtmwoP1v0VHNI
  HEOzW3BOqcBLvUzVEG6a6KGEj3GrFcqQBA9YxqHPBIuDui_aQ1SoRGKyBEhaG2i-Wk
  e3erRb1YwC7nTgrpqqJG3z1P8bt7cjZN6TpOyktdSSK7OJgiApwG7AAA
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Authentication Request to OpenID Provider&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
        After the OpenID Provider authenticates the End-User it	issues an
        Authorization Response using the From Post Response Mode
        where the parameters are encoded as HTML form values that will be
        auto-submitted by the User Agent.
        The OpenID Provider binds the ID Token to the referred Token Binding
        from the header of the Authentication Request using the token binding hash
        confirmation method (see the ID Token claims in <a class='info' href='#ex-post-f'>Figure&nbsp;6<span> (</span><span class='info'>JWT Claims in the ID Token</span><span>)</span></a>).
        This binds the ID Token to the TLS connection the
        User Agent has with the Relying Party.
      
</p><br /><hr class="insert" />
<a name="ex-post-d"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 HTTP/1.1 200 OK
 Cache-Control: no-cache, no-store
 Content-Type: text/html;charset=utf-8
 Content-Length: 1223

 &lt;html&gt;
 &lt;head&gt;&lt;title&gt;Submit This Form&lt;/title&gt;&lt;/head&gt;
 &lt;body onload="javascript:document.forms[0].submit()"&gt;
 &lt;form method="post" action="https://rp.example.io/pa/oidc/cb"&gt;
  &lt;input type="hidden" name="id_token" value="eyJhbGciOiJFUzUxMiIsIm
    tpZCI6Ik5oNWdtTTBYR3QyY0UzcHhfUGZwOEIifQ.eyJzdWIiOiI0X2x0YzFBQ0M
    yZXNjM0JXQzQtIiwibmFtZSI6IkJyaWFuIENhbXBiZWxsIiwiZW1haWwiOiJicml
    hbkBleGFtcGxlLmNvbSIsImF1ZCI6ImV4YW1wbGUtY2xpZW50LWlkIiwianRpIjo
    iZlJEWTBwZmcyVU9Lc0E1UXRNMnNEVSIsImlzcyI6Imh0dHBzOlwvXC9pZHAuZXh
    hbXBsZS5jb20iLCJpYXQiOjE0OTI3MjgyNjAsImV4cCI6MTQ5MjcyODMyMCwibm9
    uY2UiOiJpODd5aE95U0NRQ0dZUXdYYkZLSzdhRGhxREl5RVJIMEcyQWZEYVdTQ1l
    nIiwiYXV0aF90aW1lIjoxNDkyNzIzMTYxLCJjbmYiOnsidGJoIjoic3VNdXhoX0l
    sclAtWnJqMzNMdVFPUTVyWDAzOWNtQmUtd3QyZGYzQnJVUSJ9fQ.AcVnr9j52J16
    w--ijQKlgOABfijr8oQ17nUsAMAFjRgdODWI9lb4n527yQSZtSGlO4xKS_Vpo1g2
    HUacA77Wbp7AABnPBu5rkWSPYCOSgonoISQGohSKOj6uSETElNJQeAG6g2JU4lBN
    TwX1RPyOSnUXQ2YGQA4WiH0KnEd79P8r3CC0"/&gt;
  &lt;input type="hidden" name="state" value="eyJ6aXAiOiJERUYiLCJzdWZma
   XgiOiJMTFNBOEIiLCJhbGciOiJkaXIiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2
   lkIjoiMXkifQ..rr-niSUBYsRbXCz6X4JdIw.27rWRLVUJuJsDUAbhWUTAH5xL1tH
   sV7GLAm91I9gQGTLFe5FfbE_dQ_7ksE8FF8EjEVk66db-KmQSuzITlLpeg.X8Ynve
   CYW7_-0rZTIuza5A"/&gt;
 &lt;/form&gt;
 &lt;/body&gt;
 &lt;/html&gt;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Authentication Response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
        The Authorization Response is transmitted via the HTTP POST
        method to the Relying Party with the parameters being
        <tt>application/x-www-form-urlencoded</tt>
        encoded in the body.
        The "Sec-Token-Binding" header in the request has an encoded
        Token Binding message, which contains the Token Binding
        the User Agent uses with the Relying Party.
      
</p><br /><hr class="insert" />
<a name="ex-post-e"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 POST /pa/oidc/cb HTTP/1.1
 Host: rp.example.io
 Content-Length: 952
 Content-Type: application/x-www-form-urlencoded
 Cookie: nonce.LLSA8B=a70cea07-96b1-48ea-bfa3-fdbb4ea7058d
 Sec-Token-Binding: AIkAAgBBQKzyIrmcY_YCtHVoSHBut69vrGfFdy1_YKTZfFJv
  6BjrZsKD9b9FRzSBxDs1twTqnAS71M1RBumuihhI9xqxXKkAQIMi9gthwFtmF1lpXi
  oRsIlQA8vZOKQ0hrJE1_610h0h-IX-O_WllivUBoyLV7ypArE15whKaDrfwsolflmW
  fPsAAA

 id_token=eyJhbGciOiJFUzUxMiIsImtpZCI6Ik5oNWdtTTBYR3QyY0UzcHhfUGZwOE
  IifQ.eyJzdWIiOiI0X2x0YzFBQ0MyZXNjM0JXQzQtIiwibmFtZSI6IkJyaWFuIENhb
  XBiZWxsIiwiZW1haWwiOiJicmlhbkBleGFtcGxlLmNvbSIsImF1ZCI6ImV4YW1wbGU
  tY2xpZW50LWlkIiwianRpIjoiZlJEWTBwZmcyVU9Lc0E1UXRNMnNEVSIsImlzcyI6I
  mh0dHBzOlwvXC9pZHAuZXhhbXBsZS5jb20iLCJpYXQiOjE0OTI3MjgyNjAsImV4cCI
  6MTQ5MjcyODMyMCwibm9uY2UiOiJpODd5aE95U0NRQ0dZUXdYYkZLSzdhRGhxREl5R
  VJIMEcyQWZEYVdTQ1lnIiwiYXV0aF90aW1lIjoxNDkyNzIzMTYxLCJjbmYiOnsidGJ
  oIjoic3VNdXhoX0lsclAtWnJqMzNMdVFPUTVyWDAzOWNtQmUtd3QyZGYzQnJVUSJ9f
  Q.AcVnr9j52J16w--ijQKlgOABfijr8oQ17nUsAMAFjRgdODWI9lb4n527yQSZtSGl
  O4xKS_Vpo1g2HUacA77Wbp7AABnPBu5rkWSPYCOSgonoISQGohSKOj6uSETElNJQeA
  G6g2JU4lBNTwX1RPyOSnUXQ2YGQA4WiH0KnEd79P8r3CC0&amp;
 state=eyJ6aXAiOiJERUYiLCJzdWZmaXgiOiJMTFNBOEIiLCJhbGciOiJkaXIiLCJlb
 mMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiMXkifQ..rr-niSUBYsRbXCz6X4JdIw.2
 7rWRLVUJuJsDUAbhWUTAH5xL1tHsV7GLAm91I9gQGTLFe5FfbE_dQ_7ksE8FF8EjEVk
 66db-KmQSuzITlLpeg.X8YnveCYW7_-0rZTIuza5A
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Authentication Response posted to the Relying Party&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
      The Relying Party validates the ID Token, the claims of which are
      shown in <a class='info' href='#ex-post-f'>Figure&nbsp;6<span> (</span><span class='info'>JWT Claims in the ID Token</span><span>)</span></a>, as normal but also
      checks that the provided Token Binding ID from the
      <tt>Sec-Token-Binding</tt> header matches
      the Token Binding ID referenced by the <tt>tbh</tt>
      member of the <tt>cnf</tt> claim.
    
</p><br /><hr class="insert" />
<a name="ex-post-f"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 {
  "sub": "4_ltc1ACC2esc3BWC4-",
  "name": "Brian Campbell",
  "email": "brian@example.com",
  "aud": "example-client-id",
  "jti": "fRDY0pfg2UOKsA5QtM2sDU",
  "iss": "https://idp.example.com",
  "iat": 1492728260,
  "exp": 1492728320,
  "nonce": "i87yhOySCQCGYQwXbFKK7aDhqDIyERH0G2AfDaWSCYg",
  "auth_time": 1492723161,
  "cnf": {
   "tbh": "suMuxh_IlrP-Zrj33LuQOQ5rX039cmBe-wt2df3BrUQ"
  }
 }
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: JWT Claims in the ID Token&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
      The base64url-encoded
      representation of the exported keying material (EKM), which can
      be used to validate the Token Binding Message, from the TLS
      connection between the User Agent and the Relying Party is shown
      in <a class='info' href='#ex-rp-ekm'>Figure&nbsp;7<span> (</span><span class='info'>EKM from TLS connection with Relying Party</span><span>)</span></a> while the EKM from the TLS
      connection between the User Agent and the OpenID Provider is
      shown in <a class='info' href='#ex-idp-ekm'>Figure&nbsp;8<span> (</span><span class='info'>EKM from TLS connection with OpenID Provider</span><span>)</span></a>.
    
</p><br /><hr class="insert" />
<a name="ex-rp-ekm"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 1mOiLC0IFA5SMBQQVvd48VSKNuF89USGw2_UBbWik34
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: EKM from TLS connection with Relying Party&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="ex-idp-ekm"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 r4FNRMOUG_0gQQKyDGwEiCE6v8lmpsV99GZddteFIYQ
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: EKM from TLS connection with OpenID Provider&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
      The public key corresponding to the private key that
      signed the ID Token, which can be used to verify the signature on the ID Token,
      is represented as a <a class='info' href='#RFC7517'>JSON Web Key<span> (</span><span class='info'>Jones, M., &ldquo;JSON Web Key (JWK),&rdquo; May&nbsp;2015.</span><span>)</span></a> [RFC7517]
      in <a class='info' href='#ex-jwk'>Figure&nbsp;9<span> (</span><span class='info'>JSON Web Key</span><span>)</span></a>.
    
</p><br /><hr class="insert" />
<a name="ex-jwk"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 {
  "kty":"EC",
  "crv":"P-521",
  "kid":"Nh5gmM0XGt2cE3px_Pfp8B",
  "use":"sig",
  "x":"AWlGZ4vb50cAxuGKJvHoUTVKIREeMsk6MycRslLoWzX_fV_XlWX3zEu5Ujhwo
    2YF9RVELulHAYSqxgwW3503WC76",
  "y":"Abtom9zO4sCP9T-6W8C847j7Qbif5_ZiHwQcccwZBuK60rl15pbn1NNtkLTgK
    YFd6tc6Wuo1IIvFjHE6YPp1ZtSc"
 }
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: JSON Web Key&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="example-code"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Example Code Flow</h3>

<p>
          The End-User using a User Agent makes an unauthenticated request to the Relying Party.
          The HTTP request is made over a TLS connection where Token Binding has been negotiated
          so the <tt>Sec-Token-Binding</tt> header is present in the request,
          which contains an encoded Token Binding message that has the Token Binding the
          User Agent uses with the Relying Party.
        
</p><br /><hr class="insert" />
<a name="ex-code-a"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 GET / HTTP/1.1
 Host: rp.example.io
 Sec-Token-Binding: AIkAAgBBQKzyIrmcY_YCtHVoSHBut69vrGfFdy1_YKTZfFJv
  6BjrZsKD9b9FRzSBxDs1twTqnAS71M1RBumuihhI9xqxXKkAQEtxe4jeUJU0WezxlQ
  XWVSBFeHxFMdXRBIH_LKOSAuSMOJ0XEw1Q8DE248qkOiRKzw3KdSNYukYEPmO21bQi
  3YYAAA
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: Unauthenticated Request to Relying Party&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          The Relying Party redirects the user to the OpenID Provider for
          authentication, which is a normal OpenID Connect Authentication Request
          asking for an authorization code. Note, however,
          that the response includes the
          <tt>Include-Referred-Token-Binding-ID</tt>
          header, which signals to the User Agent that
          it should reveal the Token Binding ID used on the TLS connection between
          itself and the Relying Party to the OpenID Provider.
        
</p><br /><hr class="insert" />
<a name="ex-code-b"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 HTTP/1.1 302 Authenticating
 Content-Length: 0
 Cache-Control: no-cache, no-store
 Location: https://idp.example.com:443/as/authorization.oauth2?
  response_type=code&amp;
  client_id=example-client-id&amp;
  redirect_uri=https%3A%2F%2Frp.example.io%2Fpa%2Foidc%2Fcb&amp;
  state=eyJ6aXAiOiJERUYiLCJzdWZmaXgiOiJVNUk0SHciLCJhbGciOiJkaXIiLCJl
  bmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiMmEifQ..QxbDOX-VQ9KVL0RAdtvJNA
  .IlF6-KnlXTsrcqyeB52e4qRKkrQyDCkPqaVoVfkT_BbretWoTw401JmgFMttipwva
  dUSuua-hDFLgjD0Kj5LFQ.N2mcRcYRr8ynEC70yf0_0A&amp;nonce=AH34XsFUVdieZU-
  joDxNFx4TmYOCpMo-Klik3Z6CV2k&amp;
  scope=openid%20profile%20email
 Set-Cookie: nonce.U5I4Hw=209d13851204477cb8ac88893370dd3d; Path=/;
  Secure; HttpOnly
 Include-Referred-Token-Binding-ID: true
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: Redirect with Authentication Request&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          The User Agent follows the redirect and delivers the Authentication Request
          to the OpenID Provider. The HTTP request is made over a TLS connection where
          Token Binding has been negotiated so the "Sec-Token-Binding" header is present
          in the request, which contains an encoded Token Binding message. Because
          of the <tt>Include-Referred-Token-Binding-ID</tt> header in
          the response that resulted in this request, the Token Binding message
          contains two Token Bindings: (1) the provided Token Binding used with the
          OpenID Provider, and (2) the referred Token Binding used with the Relying
          Party.
        
</p><br /><hr class="insert" />
<a name="ex-code-c"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 GET /as/authorization.oauth2?response_type=code&amp;
  client_id=example-client-id&amp;
  redirect_uri=https%3A%2F%2Frp.example.io%2Fpa%2Foidc%2Fcb&amp;
  state=eyJ6aXAiOiJERUYiLCJzdWZmaXgiOiJVNUk0SHciLCJhbGciOiJkaXIiLCJl
  bmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiMmEifQ..QxbDOX-VQ9KVL0RAdtvJNA
  .IlF6-KnlXTsrcqyeB52e4qRKkrQyDCkPqaVoVfkT_BbretWoTw401JmgFMttipwva
  dUSuua-hDFLgjD0Kj5LFQ.N2mcRcYRr8ynEC70yf0_0A&amp;nonce=AH34XsFUVdieZU-
  joDxNFx4TmYOCpMo-Klik3Z6CV2k
  &amp;scope=openid%20profile%20email HTTP/1.1
 Host: idp.example.com
 Sec-Token-Binding: ARIAAgBBQCfsI1D1sTq5mvT_2H_dihNIvuHJCHGjHPJchPav
  NbGrOo26-2JgT_IsbvZd4daDFbirYBIwJ-TK1rh8FzrC-psAQMyYIqXj7djGPev1dk
  jV9XxLYGCyqOrBVEtBHrMUCeo22ymLg3OiFcl_fmOPxJbjxI6lKcF0lyfy-dSQmPIe
  zQ0AAAECAEFArPIiuZxj9gK0dWhIcG63r2-sZ8V3LX9gpNl8Um_oGOtmwoP1v0VHNI
  HEOzW3BOqcBLvUzVEG6a6KGEj3GrFcqQBAHQm0pzgUTXKLRamuKE1pmmP9I3UBVpoe
  1DBCe9H2l1VPpsImakUa6crAqZ-0CGBmji7bYzQogpKcyxTTFk5zdwAA
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: Authentication Request to OpenID Provider&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          After the OpenID Provider authenticates the End-User it	issues an
          Authorization Response as an HTTP redirect to the
          redirect_uri with an authorization code and state as query parameters.
          The OpenID Provider binds the ID Token associated with the code
          to the referred Token Binding
          from the header of the Authentication Request using the token binding hash
          confirmation method (see the ID Token claims in <a class='info' href='#ex-code-claims'>Figure&nbsp;17<span> (</span><span class='info'>JWT Claims in the ID Token</span><span>)</span></a>).
          This binds the ID Token to the TLS connection the
          User Agent has with the Relying Party.
        
</p><br /><hr class="insert" />
<a name="ex-code-d"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 HTTP/1.1 302 Found
 Cache-Control: no-cache, no-store
 Content-Length: 0
 Location: https://rp.example.io/pa/oidc/cb?
  code=Gs-gGKE5IxDIHeb6l2273g7T6TkcABghgIuSZ5YB60Q&amp;
  state=eyJ6aXAiOiJERUYiLCJzdWZmaXgiOiJVNUk0SHciLCJhbGciOiJkaXIiLCJl
  bmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiMmEifQ..QxbDOX-VQ9KVL0RAdtvJNA
  .IlF6-KnlXTsrcqyeB52e4qRKkrQyDCkPqaVoVfkT_BbretWoTw401JmgFMttipwva
  dUSuua-hDFLgjD0Kj5LFQ.N2mcRcYRr8ynEC70yf0_0A
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;13: Authentication Response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          The User Agent follows the redirect and delivers the
          Authorization Response with the code to Relying Party.
          The "Sec-Token-Binding" header in the request has an encoded
          Token Binding message, which contains the Token Binding
          the User Agent uses with the Relying Party.
        
</p><br /><hr class="insert" />
<a name="ex-code-e"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 GET /pa/oidc/cb?code=Gs-gGKE5IxDIHeb6l2273g7T6TkcABghgIuSZ5YB60Q&amp;
  state=eyJ6aXAiOiJERUYiLCJzdWZmaXgiOiJVNUk0SHciLCJhbGciOiJkaXIiLCJl
  bmMiOiJBMTI4Q0JDLUhTMjU2Iiwia2lkIjoiMmEifQ..QxbDOX-VQ9KVL0RAdtvJNA
  .IlF6-KnlXTsrcqyeB52e4qRKkrQyDCkPqaVoVfkT_BbretWoTw401JmgFMttipwva
  dUSuua-hDFLgjD0Kj5LFQ.N2mcRcYRr8ynEC70yf0_0A HTTP/1.1
 Host: rp.example.io
 Cookie: nonce.U5I4Hw=209d1385-1204-477c-b8ac-88893370dd3d
 Sec-Token-Binding: AIkAAgBBQKzyIrmcY_YCtHVoSHBut69vrGfFdy1_YKTZfFJv
  6BjrZsKD9b9FRzSBxDs1twTqnAS71M1RBumuihhI9xqxXKkAQEtxe4jeUJU0WezxlQ
  XWVSBFeHxFMdXRBIH_LKOSAuSMOJ0XEw1Q8DE248qkOiRKzw3KdSNYukYEPmO21bQi
  3YYAAA
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;14: Authentication Response sent to the Relying Party&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          The Relying Party makes an access token request directly to the
          OpenID Provider
          providing the authorization code as a parameter.
        
</p><br /><hr class="insert" />
<a name="ex-code-f"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 POST /token HTTP/1.1
 Host: idp.example.com
 Authorization:
  Basic ZXhhbXBsZS1jbGllbnQtaWQ6eW91LXJlYWxseS1kZWNvZGVkLWl0JTNG
 Content-Type: application/x-www-form-urlencoded

 grant_type=authorization_code&amp;
 code=Gs-gGKE5IxDIHeb6l2273g7T6TkcABghgIuSZ5YB60Q&amp;
 redirect_uri=https%3A%2F%2Frp.example.io%2Fpa%2Foidc%2Fcb
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;15: Code Access Token Request&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          The OpenID Provider returns the ID Token to the Relying Party
          in the access token response.
        
</p><br /><hr class="insert" />
<a name="ex-code-g"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

 HTTP/1.1 200 OK
 Content-Type: application/json
 Cache-Control: no-cache, no-store

 {
  "id_token":"eyJhbGciOiJFUzI1NiIsImtpZCI6ImZNM1YtTmMtdXZRa05xRGROdm
     k2V08ifQ.eyJzdWIiOiI0X2x0YzFBQ0MyZXNjM0JXQzQtIiwibmFtZSI6IkJyaW
     FuIENhbXBiZWxsIiwiZW1haWwiOiJicmlhbkBleGFtcGxlLmNvbSIsImF1ZCI6I
     mV4YW1wbGUtY2xpZW50LWlkIiwianRpIjoieElQSlBIcUI4RDNlZm5CRW9oaEZQ
     RyIsImlzcyI6Imh0dHBzOlwvXC9pZHAuZXhhbXBsZS5jb20iLCJpYXQiOjE0OTM
     wNDUyMjUsImV4cCI6MTQ5MzA0NTI4NSwibm9uY2UiOiJBSDM0WHNGVVZkaWVaVS
     1qb0R4TkZ4NFRtWU9DcE1vLUtsaWszWjZDVjJrIiwiYXV0aF90aW1lIjoxNDkzM
     DQ0MjkwLCJjbmYiOnsidGJoIjoic3VNdXhoX0lsclAtWnJqMzNMdVFPUTVyWDAz
     OWNtQmUtd3QyZGYzQnJVUSJ9fQ.rGSWsATPS9pvXKwbGG5w_CbHuOBCDrtafWwa
     OXomUlbo527FX3AFRduz-dv7ZxvW0O-IUe3ea0-rSxWfLxv2Ag",
  "access_token":"2bwc9otnFescZFEjr1zLTCsicMWpACC77",
  "token_type":"Bearer",
  "expires_in":3600
 }

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;16: Access Token Response with ID Token&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          The Relying Party validates the ID Token, the claims of which are
          shown in <a class='info' href='#ex-code-claims'>Figure&nbsp;17<span> (</span><span class='info'>JWT Claims in the ID Token</span><span>)</span></a>, as normal but also
          checks that the provided Token Binding ID from the
          <tt>Sec-Token-Binding</tt> header from the request in
          <a class='info' href='#ex-code-e'>Figure&nbsp;14<span> (</span><span class='info'>Authentication Response sent to the Relying Party</span><span>)</span></a> matches
          the Token Binding ID referenced by the <tt>tbh</tt>
          member of the <tt>cnf</tt> claim.
        
</p><br /><hr class="insert" />
<a name="ex-code-claims"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 {
   "sub": "4_ltc1ACC2esc3BWC4-",
   "name": "Brian Campbell",
   "email": "brian@example.com",
   "aud": "example-client-id",
   "jti": "xIPJPHqB8D3efnBEohhFPG",
   "iss": "https://idp.example.com",
   "iat": 1493045225,
   "exp": 1493045285,
   "nonce": "AH34XsFUVdieZU-joDxNFx4TmYOCpMo-Klik3Z6CV2k",
   "auth_time": 1493044290,
   "cnf": {
    "tbh": "suMuxh_IlrP-Zrj33LuQOQ5rX039cmBe-wt2df3BrUQ"
   }
 }
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;17: JWT Claims in the ID Token&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          The base64url-encoded
          representation of the exported keying material (EKM), which can
          be used to validate the Token Binding Message, from the TLS
          connection between the User Agent and the Relying Party is shown
          in <a class='info' href='#ex-code-rp-ekm'>Figure&nbsp;18<span> (</span><span class='info'>EKM from TLS connection with Relying Party</span><span>)</span></a> while the EKM from the TLS
          connection between the User Agent and the OpenID Provider is
          shown in <a class='info' href='#ex-code-idp-ekm'>Figure&nbsp;19<span> (</span><span class='info'>EKM from TLS connection with OpenID Provider</span><span>)</span></a>.
        
</p><br /><hr class="insert" />
<a name="ex-code-rp-ekm"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 AYVUayPTP9RmELNpGjFl6Ykm2CUx7pUMxe35yb11dgU
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;18: EKM from TLS connection with Relying Party&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="ex-code-idp-ekm"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 wEWWCP1KPxfq-QL4NxYII_P4ti_9YYqrTpGs28BZEqE
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;19: EKM from TLS connection with OpenID Provider&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          The public key corresponding to the private key that
          signed the ID Token, which can be used to verify the signature on the ID Token,
          is represented as a <a class='info' href='#RFC7517'>JSON Web Key<span> (</span><span class='info'>Jones, M., &ldquo;JSON Web Key (JWK),&rdquo; May&nbsp;2015.</span><span>)</span></a> [RFC7517]
          in <a class='info' href='#ex-code-jwk'>Figure&nbsp;20<span> (</span><span class='info'>JSON Web Key</span><span>)</span></a>.
        
</p><br /><hr class="insert" />
<a name="ex-code-jwk"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 {
  "kty":"EC",
  "crv":"P-256",
  "kid":"fM3V-Nc-uvQkNqDdNvi6WO",
  "use":"sig",
  "x":"9Yvmvy0clO9_mrC-orpGzBcqRvUhkoes_o5PrOoxX1s",
  "y":"-oMmBINhjIn2DysFJDicfMMxC9i5crgaeDEFf6Ef5ec"
 }

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;20: JSON Web Key&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Acknowledgements</h3>

<p>
	The OpenID Community would like to thank the following people for
	their contributions to this specification:
      
</p>
<p>
        </p>
<blockquote class="text">
<p>Dirk Balfanz (balfanz@google.com), Google
</p>
<p>William Denniss (wdenniss@google.com), Google
</p>
<p>Andrei Popov (Andrei.Popov@microsoft.com), Microsoft
</p>
<p>Nat Sakimura (n-sakimura@nri.co.jp), Nomura Research Institute, Ltd.
</p>
</blockquote><p>
      
</p>
<a name="Notices"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Notices</h3>

<p>Copyright (c) 2017 The OpenID Foundation.
</p>
<p>The OpenID Foundation (OIDF) grants to any Contributor, developer,
      implementer, or other interested party a non-exclusive, royalty free,
      worldwide copyright license to reproduce, prepare derivative works from,
      distribute, perform and display, this Implementers Draft or Final
      Specification solely for the purposes of (i) developing specifications,
      and (ii) implementing Implementers Drafts and Final Specifications based
      on such documents, provided that attribution be made to the OIDF as the
      source of the material, but that such attribution does not indicate an
      endorsement by the OIDF.
</p>
<p>The technology described in this specification was made available
      from contributions from various sources, including members of the OpenID
      Foundation and others. Although the OpenID Foundation has taken steps to
      help ensure that the technology is available for distribution, it takes
      no position regarding the validity or scope of any intellectual property
      or other rights that might be claimed to pertain to the implementation
      or use of the technology described in this specification or the extent
      to which any license under such rights might or might not be available;
      neither does it represent that it has made any independent effort to
      identify any such rights. The OpenID Foundation and the contributors to
      this specification make no (and hereby expressly disclaim any)
      warranties (express, implied, or otherwise), including implied
      warranties of merchantability, non-infringement, fitness for a
      particular purpose, or title, related to this specification, and the
      entire risk as to implementing this specification is assumed by the
      implementer. The OpenID Intellectual Property Rights policy requires
      contributors to offer a patent promise not to assert certain patent
      claims against other contributors and against implementers. The OpenID
      Foundation invites any interested party to bring to its attention any
      copyrights, patents, patent applications, or other proprietary rights
      that may cover technology that may be required to practice this
      specification.
</p>
<a name="History"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Document History</h3>

<p>[[ To be removed from the final specification ]]
</p>
<p>
	    -03
	    </p>
<ul class="text">
<li> 
	Adjust the metadata to indicate supported confirmation method hash algorithms
	for Token Binding of ID Tokens

</li>
<li>
	Updated references for draft-ietf-tokbind-protocol to -19,
	draft-ietf-tokbind-https to -17, draft-ietf-oauth-token-binding to -07,
	and draft-ietf-oauth-discovery to -10

</li>
<li>
	Explicitly state that the base64url encoding of the tbh value doesn't include
	any trailing pad characters, line breaks, whitespace, etc.

</li>
</ul><p>
      
</p>
<p>
        -02
        </p>
<ul class="text">
<li>
    Add text suggesting a new cnf member be defined in the future, if hash
    function(s) other than SHA-256 need to be used for the token binding hash
    as discussed http://lists.openid.net/pipermail/openid-specs-eap/Week-of-Mon-20170717/000042.html
  
</li>
<li>
    Adjust the language around aborting authentication in Phasing in Token Binding
    and the RP detecting attacks in Security Considerations to be somewhat more general
    as discussed http://lists.openid.net/pipermail/openid-specs-eap/Week-of-Mon-20170717/000042.html
  
</li>
<li>
    Updated references for draft-ietf-tokbind-protocol (from -14 to -16),
    draft-ietf-tokbind-https (from -09 to -10), draft-ietf-oauth-token-binding (from -03 to -05),
    and draft-ietf-oauth-discovery (from -06 to -07)
  
</li>
</ul><p>
      
</p>
<p>
        -01
        </p>
<ul class="text">
<li>
            Added examples of token bound authentication flows.
          
</li>
<li>
	    Added a Security Considerations paragraph describing that
	    additional security tokens can also be token bound, including
	    cookies, access tokens, refresh tokens, and authorization codes.
	  
</li>
<li>
            Updated references for draft-ietf-tokbind-protocol (from -06 to -14),
            draft-ietf-tokbind-https (from -03 to -09), and
	    draft-ietf-oauth-discovery (from -02 to -06).
          
</li>
</ul><p>
      
</p>
<p>
	-00
	</p>
<ul class="text">
<li>
	    Created initial version.
	  
</li>
</ul><p>
      
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael B. Jones</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Microsoft</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mbj@microsoft.com">mbj@microsoft.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://self-issued.info/">http://self-issued.info/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">John Bradley</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yubico</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ve7jtb@ve7jtb.com">ve7jtb@ve7jtb.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.thread-safe.com/">http://www.thread-safe.com/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Campbell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ping Identity</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:brian.d.campbell@gmail.com">brian.d.campbell@gmail.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="https://twitter.com/__b_c">https://twitter.com/__b_c</a></td></tr>
</table>
</body></html>
